<!DOCTYPE html>
<html lang="vi" class="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChemStudy Teen - Cân Bằng Hóa Học</title>
    <link rel="icon" href="../../../favicon/educhem.svg" type="image/svg+xml" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              chem: {
                100: "#e0f2fe",
                500: "#0ea5e9",
                600: "#0284c7",
                900: "#0c4a6e",
              },
              acid: "#ef4444",
              base: "#3b82f6",
              neutral: "#22c55e",
            },
            animation: {
              blob: "blob 7s infinite",
              float: "float 3s ease-in-out infinite",
            },
            keyframes: {
              blob: {
                "0%": { transform: "translate(0px, 0px) scale(1)" },
                "33%": { transform: "translate(30px, -50px) scale(1.1)" },
                "66%": { transform: "translate(-20px, 20px) scale(0.9)" },
                "100%": { transform: "translate(0px, 0px) scale(1)" },
              },
              float: {
                "0%, 100%": { transform: "translateY(0)" },
                "50%": { transform: "translateY(-10px)" },
              },
            },
          },
        },
      };
    </script>

    <!-- React & ReactDOM -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap");

      body {
        font-family: "Be Vietnam Pro", sans-serif;
        transition: background-color 0.3s, color 0.3s;
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      .dark ::-webkit-scrollbar-thumb {
        background: #475569;
      }

      /* 3D Molecule Styles */
      .molecule-container {
        perspective: 1000px;
      }
      .atom {
        transform-style: preserve-3d;
        box-shadow: inset -5px -5px 10px rgba(0, 0, 0, 0.2),
          5px 5px 10px rgba(255, 255, 255, 0.3);
      }

      /* Glassmorphism */
      .glass {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.5);
      }
      .dark .glass {
        background: rgba(15, 23, 42, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* Particle Animation for Reaction */
      .particle {
        transition: all 0.5s linear;
      }
    </style>
  </head>
  <body
    class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100"
  >
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef, useMemo } = React;

      // --- ICON COMPONENT ---
      const Icon = ({ name, size = 24, className = "" }) => {
        useEffect(() => {
          lucide.createIcons();
        }, [name]);
        return (
          <i
            data-lucide={name}
            width={size}
            height={size}
            className={className}
          ></i>
        );
      };

      // --- SIMULATION 1: REVERSIBLE REACTION (Particle Box) ---
      const ReversibleSim = () => {
        const [particles, setParticles] = useState([]);
        const [equilibrium, setEquilibrium] = useState(0.5); // 0 = All A, 1 = All B
        const canvasRef = useRef(null);

        // Init particles
        useEffect(() => {
          const initParticles = Array.from({ length: 40 }).map(() => ({
            x: Math.random() * 300,
            y: Math.random() * 180,
            vx: (Math.random() - 0.5) * 2,
            vy: (Math.random() - 0.5) * 2,
            type: Math.random() > 0.5 ? "A" : "B",
          }));
          setParticles(initParticles);
        }, []);

        // Animation Loop
        useEffect(() => {
          const canvas = canvasRef.current;
          const ctx = canvas.getContext("2d");
          let animationFrameId;

          const render = () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const newParticles = particles.map((p) => {
              let nx = p.x + p.vx;
              let ny = p.y + p.vy;

              // Bounce walls
              if (nx < 0 || nx > canvas.width) p.vx *= -1;
              if (ny < 0 || ny > canvas.height) p.vy *= -1;

              // Random conversion based on equilibrium setting
              // If equilibrium is high (favors B), A turns to B easily, B turns to A hard
              if (p.type === "A" && Math.random() < equilibrium * 0.05)
                p.type = "B";
              if (p.type === "B" && Math.random() < (1 - equilibrium) * 0.05)
                p.type = "A";

              // Draw
              ctx.beginPath();
              ctx.arc(nx, ny, 6, 0, Math.PI * 2);
              ctx.fillStyle = p.type === "A" ? "#3b82f6" : "#ef4444"; // Blue for A, Red for B
              ctx.fill();
              ctx.strokeStyle = "white";
              ctx.stroke();

              return { ...p, x: nx, y: ny };
            });

            // Note: In a real react app, we avoid setting state in render loop like this for perf,
            // but for this scale it's fine for smooth visual.
            // However, to avoid re-renders, we just mutate refs or draw directly.
            // Here we just draw.

            animationFrameId = requestAnimationFrame(render);
          };
          render();
          return () => cancelAnimationFrame(animationFrameId);
        }, [particles, equilibrium]);

        return (
          <div className="glass p-4 rounded-xl shadow-lg my-4">
            <h3 className="font-bold text-lg mb-2 flex items-center gap-2 text-chem-600 dark:text-chem-400">
              <Icon name="flask-conical" size={20} /> Mô phỏng 1: Cân bằng động
              (Vi mô)
            </h3>
            <div className="flex flex-col md:flex-row gap-4">
              <canvas
                ref={canvasRef}
                width={320}
                height={200}
                className="bg-slate-100 dark:bg-slate-800 rounded-lg shadow-inner w-full md:w-2/3"
              ></canvas>
              <div className="flex-1 space-y-4">
                <div className="flex justify-between text-sm font-medium">
                  <span className="text-blue-500">Chất A (Xanh)</span>
                  <span className="text-red-500">Chất B (Đỏ)</span>
                </div>
                <input
                  type="range"
                  min="0.1"
                  max="0.9"
                  step="0.1"
                  value={equilibrium}
                  onChange={(e) => setEquilibrium(parseFloat(e.target.value))}
                  className="w-full accent-chem-500"
                />
                <p className="text-xs text-slate-500 dark:text-slate-400">
                  Kéo thanh trượt để thay đổi hằng số cân bằng (K). Quan sát tốc
                  độ chuyển đổi giữa các hạt.
                  <br />
                  {equilibrium < 0.5
                    ? "Cân bằng nghịch (Ưu tiên A)"
                    : "Cân bằng thuận (Ưu tiên B)"}
                </p>
              </div>
            </div>
          </div>
        );
      };

      // --- SIMULATION 2: LE CHATELIER (NO2/N2O4) ---
      const LeChatelierSim = () => {
        const [temp, setTemp] = useState(25); // Celsius
        const [pressure, setPressure] = useState(1); // atm

        // 2NO2 (Nâu đỏ) <=> N2O4 (Không màu) + Nhiệt
        // Tăng nhiệt -> Dịch sang NO2 (Nâu đậm)
        // Tăng áp suất -> Dịch sang N2O4 (Nhạt)

        const opacity = Math.min(
          1,
          Math.max(0.1, temp / 100 - pressure / 10 + 0.3)
        );

        return (
          <div className="glass p-6 rounded-xl shadow-lg border-l-4 border-yellow-400">
            <h3 className="font-bold text-lg mb-4 text-yellow-600 dark:text-yellow-400">
              Mô phỏng 2: Nguyên lý Le Chatelier
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
              <div className="relative h-48 w-32 mx-auto bg-slate-200 dark:bg-slate-700 rounded-full border-4 border-slate-300 overflow-hidden shadow-inner flex items-end justify-center">
                <div
                  className="w-full transition-all duration-1000 ease-in-out"
                  style={{
                    height: `${100 / pressure}%`,
                    backgroundColor: `rgba(139, 69, 19, ${opacity})`, // Brown color
                  }}
                ></div>
                <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 font-bold text-white drop-shadow-md">
                  {opacity > 0.6 ? "NO₂ (Nâu)" : "N₂O₄ (Nhạt)"}
                </div>
              </div>
              <div className="space-y-6">
                <div>
                  <label className="flex justify-between text-sm font-semibold mb-1">
                    <span>Nhiệt độ: {temp}°C</span>
                    <Icon name="thermometer" size={16} />
                  </label>
                  <input
                    type="range"
                    min="0"
                    max="100"
                    value={temp}
                    onChange={(e) => setTemp(parseInt(e.target.value))}
                    className="w-full accent-red-500"
                  />
                  <p className="text-xs mt-1 text-slate-500">
                    Tăng nhiệt → Cân bằng dịch chuyển theo chiều thu nhiệt (tạo
                    NO₂).
                  </p>
                </div>
                <div>
                  <label className="flex justify-between text-sm font-semibold mb-1">
                    <span>Áp suất: {pressure} atm</span>
                    <Icon name="arrow-down-to-line" size={16} />
                  </label>
                  <input
                    type="range"
                    min="1"
                    max="5"
                    step="0.5"
                    value={pressure}
                    onChange={(e) => setPressure(parseFloat(e.target.value))}
                    className="w-full accent-blue-500"
                  />
                  <p className="text-xs mt-1 text-slate-500">
                    Tăng áp suất → Cân bằng dịch chuyển theo chiều giảm số mol
                    khí (tạo N₂O₄).
                  </p>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // --- SIMULATION 3: ELECTROLYTE ZOOM ---
      const ElectrolyteSim = () => {
        const [substance, setSubstance] = useState("NaCl"); // NaCl, HF, Glucose

        // Render particles
        const renderParticles = () => {
          const items = [];
          for (let i = 0; i < 15; i++) {
            const x = Math.random() * 90;
            const y = Math.random() * 90;

            if (substance === "NaCl") {
              // Strong: Completely separated
              items.push(
                <div
                  key={`na${i}`}
                  className="absolute w-4 h-4 rounded-full bg-purple-500 text-[8px] flex items-center justify-center text-white animate-float"
                  style={{
                    left: `${x}%`,
                    top: `${y}%`,
                    animationDelay: `${Math.random()}s`,
                  }}
                >
                  Na<sup>+</sup>
                </div>
              );
              items.push(
                <div
                  key={`cl${i}`}
                  className="absolute w-5 h-5 rounded-full bg-green-500 text-[8px] flex items-center justify-center text-white animate-float"
                  style={{
                    left: `${x + 5}%`,
                    top: `${y + 5}%`,
                    animationDelay: `${Math.random()}s`,
                  }}
                >
                  Cl<sup>-</sup>
                </div>
              );
            } else if (substance === "HF") {
              // Weak: Mostly combined
              if (i < 12) {
                items.push(
                  <div
                    key={`hf${i}`}
                    className="absolute w-8 h-5 rounded-full bg-gray-400 text-[10px] flex items-center justify-center text-white animate-float"
                    style={{ left: `${x}%`, top: `${y}%` }}
                  >
                    HF
                  </div>
                );
              } else {
                items.push(
                  <div
                    key={`h${i}`}
                    className="absolute w-3 h-3 rounded-full bg-red-400 text-[6px] flex items-center justify-center text-white"
                    style={{ left: `${x}%`, top: `${y}%` }}
                  >
                    H<sup>+</sup>
                  </div>
                );
                items.push(
                  <div
                    key={`f${i}`}
                    className="absolute w-4 h-4 rounded-full bg-green-400 text-[8px] flex items-center justify-center text-white"
                    style={{ left: `${x + 5}%`, top: `${y}%` }}
                  >
                    F<sup>-</sup>
                  </div>
                );
              }
            } else {
              // Non: All molecules
              items.push(
                <div
                  key={`glu${i}`}
                  className="absolute w-10 h-8 rounded-full border-2 border-slate-400 bg-white/50 text-[8px] flex items-center justify-center text-slate-800 animate-float"
                  style={{ left: `${x}%`, top: `${y}%` }}
                >
                  C<sub>6</sub>H<sub>12</sub>O<sub>6</sub>
                </div>
              );
            }
          }
          return items;
        };

        const bulbBrightness =
          substance === "NaCl"
            ? "bg-yellow-400 shadow-[0_0_30px_rgba(250,204,21,1)]"
            : substance === "HF"
            ? "bg-yellow-200 shadow-[0_0_10px_rgba(250,204,21,0.5)]"
            : "bg-slate-400";

        return (
          <div className="glass p-6 rounded-xl shadow-lg mt-6">
            <h3 className="font-bold text-lg mb-4 flex gap-2">
              <Icon name="zap" /> Mô phỏng 3: Độ dẫn điện & Sự điện li
            </h3>
            <div className="flex flex-col md:flex-row gap-8">
              <div className="flex-1 relative h-48 bg-blue-100 dark:bg-blue-900/30 rounded-xl overflow-hidden border-2 border-blue-200">
                {renderParticles()}
                <div className="absolute bottom-2 right-2 text-xs text-slate-500 bg-white/80 px-2 py-1 rounded">
                  Zoom 1000x
                </div>
              </div>
              <div className="w-full md:w-1/3 flex flex-col items-center justify-center gap-4">
                <div
                  className={`w-16 h-16 rounded-full border-4 border-slate-600 transition-all duration-500 ${bulbBrightness} relative`}
                >
                  <div className="absolute bottom-[-20px] left-1/2 -translate-x-1/2 w-8 h-6 bg-slate-600"></div>
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={() => setSubstance("NaCl")}
                    className={`px-3 py-1 rounded text-sm ${
                      substance === "NaCl"
                        ? "bg-blue-600 text-white"
                        : "bg-slate-200 dark:bg-slate-700"
                    }`}
                  >
                    Mạnh (NaCl)
                  </button>
                  <button
                    onClick={() => setSubstance("HF")}
                    className={`px-3 py-1 rounded text-sm ${
                      substance === "HF"
                        ? "bg-blue-600 text-white"
                        : "bg-slate-200 dark:bg-slate-700"
                    }`}
                  >
                    Yếu (HF)
                  </button>
                  <button
                    onClick={() => setSubstance("Glucose")}
                    className={`px-3 py-1 rounded text-sm ${
                      substance === "Glucose"
                        ? "bg-blue-600 text-white"
                        : "bg-slate-200 dark:bg-slate-700"
                    }`}
                  >
                    K.Đ.Li (Đường)
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // --- SIMULATION 4: PH SCALE ---
      const PHSim = () => {
        const [ph, setPh] = useState(7);

        const getColor = (v) => {
          const colors = [
            "#ef4444",
            "#f97316",
            "#fbbf24",
            "#a3e635",
            "#4ade80",
            "#22c55e",
            "#14b8a6",
            "#06b6d4",
            "#0ea5e9",
            "#3b82f6",
            "#6366f1",
            "#8b5cf6",
            "#a855f7",
            "#d946ef",
            "#ec4899",
          ];
          return colors[Math.round(v)];
        };

        const getExample = (v) => {
          if (v < 1) return "Pin axit";
          if (v < 3) return "Dịch vị dạ dày, Chanh";
          if (v < 5) return "Cà chua, Nước mưa";
          if (v < 7) return "Sữa, Nước tiểu";
          if (v == 7) return "Nước tinh khiết";
          if (v < 9) return "Trứng, Nước biển";
          if (v < 11) return "Xà phòng, Sữa Magie";
          if (v < 13) return "Thuốc tẩy";
          return "Dung dịch thông cống (NaOH)";
        };

        return (
          <div className="glass p-6 rounded-xl shadow-lg my-6">
            <h3 className="font-bold text-lg mb-4 flex gap-2">
              <Icon name="droplets" /> Mô phỏng 4: Thang đo pH
            </h3>
            <div className="flex flex-col items-center">
              <div
                className="w-32 h-32 rounded-full flex items-center justify-center text-3xl font-bold text-white shadow-xl transition-colors duration-300 border-4 border-white mb-4"
                style={{ backgroundColor: getColor(ph) }}
              >
                {ph}
              </div>
              <p className="text-xl font-semibold mb-2">{getExample(ph)}</p>
              <input
                type="range"
                min="0"
                max="14"
                step="0.5"
                value={ph}
                onChange={(e) => setPh(parseFloat(e.target.value))}
                className="w-full max-w-md accent-chem-600 h-2 bg-gradient-to-r from-red-500 via-green-500 to-purple-500 rounded-lg appearance-none cursor-pointer"
              />
              <div className="flex justify-between w-full max-w-md mt-2 text-xs font-bold text-slate-500">
                <span className="text-red-500">Axit (0)</span>
                <span className="text-green-500">Trung tính (7)</span>
                <span className="text-purple-500">Kiềm (14)</span>
              </div>
            </div>
          </div>
        );
      };

      // --- SIMULATION 5: TITRATION (Chuẩn độ) ---
      const TitrationSim = () => {
        const [volume, setVolume] = useState(0); // mL NaOH added
        const [isDripping, setIsDripping] = useState(false);

        // Simulating HCl titrated by NaOH with Phenolphthalein
        // Equivalence point at 25ml
        const phCurve = (v) => {
          if (v < 25) return 1 + (v / 25) * 3; // Slow rise
          if (v >= 25 && v < 25.5) return 7 + (v - 25) * 10; // Sharp jump
          return 12 + (v - 25) * 0.1; // Slow rise base
        };

        const currentPH = phCurve(volume).toFixed(1);
        const color =
          parseFloat(currentPH) >= 8.2
            ? "rgba(236, 72, 153, 0.6)"
            : "rgba(224, 242, 254, 0.5)"; // Pink if pH > 8.2

        useEffect(() => {
          let interval;
          if (isDripping && volume < 50) {
            interval = setInterval(() => {
              setVolume((v) => Math.min(v + 0.5, 50));
            }, 100);
          } else {
            setIsDripping(false);
          }
          return () => clearInterval(interval);
        }, [isDripping, volume]);

        return (
          <div className="glass p-6 rounded-xl shadow-lg my-6">
            <h3 className="font-bold text-lg mb-4 flex gap-2">
              <Icon name="flask-round" /> Mô phỏng 5: Chuẩn độ Acid - Base
            </h3>
            <div className="flex flex-col md:flex-row gap-8 items-center justify-center">
              <div className="relative w-40 h-64 flex flex-col items-center">
                {/* Burette */}
                <div className="w-4 h-32 bg-slate-200 border border-slate-400 relative rounded-b mb-1 z-10">
                  <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-0.5 h-2 bg-slate-400"></div>
                  {isDripping && (
                    <div className="absolute -bottom-4 left-1/2 -translate-x-1/2 w-1.5 h-1.5 bg-blue-400 rounded-full animate-bounce"></div>
                  )}
                </div>
                {/* Flask */}
                <div className="w-24 h-28 border-2 border-slate-400 border-t-0 rounded-b-2xl relative overflow-hidden bg-white/30 backdrop-blur-sm">
                  <div
                    className="absolute bottom-0 w-full transition-all duration-300 ease-out"
                    style={{
                      height: `${30 + volume}%`,
                      backgroundColor: color,
                    }}
                  ></div>
                </div>
              </div>
              <div className="space-y-4 w-full md:w-1/2">
                <div className="flex justify-between items-center bg-slate-100 dark:bg-slate-800 p-4 rounded-lg">
                  <div>
                    <div className="text-sm text-slate-500">Thể tích NaOH</div>
                    <div className="text-2xl font-bold font-mono">
                      {volume.toFixed(1)} mL
                    </div>
                  </div>
                  <div>
                    <div className="text-sm text-slate-500">pH Dung dịch</div>
                    <div
                      className={`text-2xl font-bold font-mono ${
                        parseFloat(currentPH) > 7
                          ? "text-pink-500"
                          : "text-red-500"
                      }`}
                    >
                      {currentPH}
                    </div>
                  </div>
                </div>
                <div className="flex gap-2">
                  <button
                    onMouseDown={() => setIsDripping(true)}
                    onMouseUp={() => setIsDripping(false)}
                    className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex-1 active:scale-95 transition"
                  >
                    Nhấn giữ để nhỏ giọt
                  </button>
                  <button
                    onClick={() => setVolume(0)}
                    className="bg-slate-500 hover:bg-slate-600 text-white px-4 py-2 rounded-lg active:scale-95 transition"
                  >
                    Làm lại
                  </button>
                </div>
                <p className="text-xs text-slate-500 italic">
                  *Chỉ thị Phenolphthalein chuyển hồng khi pH &ge; 8.2. Điểm
                  tương đương tại 25mL.
                </p>
              </div>
            </div>
          </div>
        );
      };

      // --- SIMULATION 6: WATER TREATMENT (Al3+) ---
      const FlocculationSim = () => {
        const [step, setStep] = useState(0);
        // 0: Dirty, 1: Add Al3+, 2: Hydrolysis, 3: Flocculation, 4: Clean

        const titles = [
          "Nước đục (Chứa hạt sét)",
          "Thêm Phèn chua (Al³⁺)",
          "Thủy phân tạo Keo Al(OH)₃",
          "Keo tụ chất bẩn",
          "Nước trong",
        ];

        return (
          <div className="glass p-6 rounded-xl shadow-lg my-6">
            <h3 className="font-bold text-lg mb-4 flex gap-2">
              <Icon name="glass-water" /> Mô phỏng 6: Ứng dụng Phèn chua (Al³⁺)
            </h3>
            <div className="relative h-48 bg-sky-100 dark:bg-sky-900/30 rounded-xl overflow-hidden border-2 border-sky-300 flex items-center justify-center transition-all duration-1000">
              {/* Dirt particles */}
              <div
                className={`absolute inset-0 transition-opacity duration-1000 ${
                  step >= 4 ? "opacity-0" : "opacity-100"
                }`}
              >
                {Array.from({ length: 20 }).map((_, i) => (
                  <div
                    key={i}
                    className={`absolute w-2 h-2 bg-amber-700 rounded-full transition-all duration-[2000ms]`}
                    style={{
                      left: `${Math.random() * 90}%`,
                      top: step === 3 ? "90%" : `${Math.random() * 80 + 10}%`,
                      transform: step === 3 ? "scale(2)" : "scale(1)", // Clumping together
                    }}
                  ></div>
                ))}
              </div>

              {/* Al(OH)3 Gel */}
              <div
                className={`absolute inset-0 pointer-events-none transition-opacity duration-1000 ${
                  step >= 2 && step < 4 ? "opacity-50" : "opacity-0"
                }`}
              >
                <div className="w-full h-full bg-white blur-md animate-pulse"></div>
              </div>

              <div className="absolute bottom-2 bg-white/80 dark:bg-black/50 px-3 py-1 rounded-full text-sm font-bold shadow">
                {titles[step]}
              </div>
            </div>

            <div className="flex justify-between mt-4">
              <button
                disabled={step === 0}
                onClick={() => setStep((s) => s - 1)}
                className="px-4 py-2 bg-slate-200 dark:bg-slate-700 rounded-lg disabled:opacity-50"
              >
                Trước
              </button>
              <div className="flex gap-1 items-center">
                {[0, 1, 2, 3, 4].map((i) => (
                  <div
                    key={i}
                    className={`w-2 h-2 rounded-full ${
                      i === step ? "bg-blue-600" : "bg-slate-300"
                    }`}
                  ></div>
                ))}
              </div>
              <button
                disabled={step === 4}
                onClick={() => setStep((s) => s + 1)}
                className="px-4 py-2 bg-blue-600 text-white rounded-lg disabled:opacity-50"
              >
                Tiếp theo
              </button>
            </div>
            <div className="mt-2 text-sm text-center font-mono bg-slate-100 dark:bg-slate-800 p-2 rounded">
              Al³⁺ + 3H₂O ⇌ Al(OH)₃↓ (keo) + 3H⁺
            </div>
          </div>
        );
      };

      // --- MAIN APP LAYOUT ---
      const App = () => {
        const [activeTab, setActiveTab] = useState("khai-niem");
        const [darkMode, setDarkMode] = useState(false);

        useEffect(() => {
          if (darkMode) document.documentElement.classList.add("dark");
          else document.documentElement.classList.remove("dark");
        }, [darkMode]);

        const tabs = [
          { id: "khai-niem", label: "Khái niệm & K" },
          { id: "le-chatelier", label: "Nguyên lý Le Chatelier" },
          { id: "dien-li", label: "Sự điện li" },
          { id: "ph-chuan-do", label: "pH & Chuẩn độ" },
          { id: "ung-dung", label: "Thực tiễn" },
        ];

        const renderContent = () => {
          switch (activeTab) {
            case "khai-niem":
              return (
                <div className="space-y-6 animate-fade-in">
                  <div className="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-8 text-white shadow-xl relative overflow-hidden">
                    <div className="relative z-10">
                      <h1 className="text-4xl font-bold mb-2">
                        Cân Bằng Hóa Học
                      </h1>
                      <p className="text-blue-100 text-lg">
                        Khám phá trạng thái cân bằng động của các phản ứng thuận
                        nghịch.
                      </p>
                    </div>
                    <div className="absolute right-0 top-0 opacity-20 transform translate-x-10 -translate-y-10">
                      <Icon name="atom" size={200} />
                    </div>
                  </div>

                  <div className="grid md:grid-cols-2 gap-6">
                    <div className="glass p-6 rounded-xl">
                      <h2 className="text-xl font-bold text-chem-600 dark:text-chem-400 mb-3">
                        1. Phản ứng thuận nghịch
                      </h2>
                      <ul className="list-disc pl-5 space-y-2 text-sm md:text-base">
                        <li>
                          <strong className="text-green-600">
                            Phản ứng một chiều:
                          </strong>{" "}
                          Chỉ xảy ra theo chiều chất tham gia tạo thành sản phẩm
                          (→). VD: 2KClO<sub>3</sub> → 2KCl + 3O<sub>2</sub>.
                        </li>
                        <li>
                          <strong className="text-blue-600">
                            Phản ứng thuận nghịch:
                          </strong>{" "}
                          Xảy ra theo hai chiều ngược nhau trong cùng điều kiện
                          (⇌).
                        </li>
                        <li>
                          <strong>Cân bằng hóa học:</strong> Trạng thái của phản
                          ứng thuận nghịch khi tốc độ phản ứng thuận bằng tốc độ
                          phản ứng nghịch (V<sub>t</sub> = V<sub>n</sub>).
                        </li>
                      </ul>
                    </div>
                    <div className="glass p-6 rounded-xl border-l-4 border-purple-500">
                      <h2 className="text-xl font-bold text-purple-600 dark:text-purple-400 mb-3">
                        2. Hằng số cân bằng (K<sub>C</sub>)
                      </h2>
                      <p className="mb-4 text-sm">
                        Với phản ứng: aA + bB ⇌ cC + dD
                      </p>
                      <div className="bg-slate-100 dark:bg-slate-800 p-4 rounded text-center font-serif text-xl border border-slate-300 dark:border-slate-600">
                        K<sub>C</sub> ={" "}
                        <span className="inline-block align-middle">
                          <span className="border-b border-current block">
                            [C]<sup>c</sup> . [D]<sup>d</sup>
                          </span>
                          <span className="block">
                            [A]<sup>a</sup> . [B]<sup>b</sup>
                          </span>
                        </span>
                      </div>
                      <p className="mt-4 text-xs italic text-slate-500">
                        * K chỉ phụ thuộc vào nhiệt độ.
                      </p>
                    </div>
                  </div>
                  <ReversibleSim />
                </div>
              );
            case "le-chatelier":
              return (
                <div className="space-y-6">
                  <div className="glass p-6 rounded-xl">
                    <h2 className="text-2xl font-bold text-amber-600 mb-4">
                      Nguyên lý Le Chatelier
                    </h2>
                    <p className="text-lg italic text-slate-600 dark:text-slate-300 border-l-4 border-amber-500 pl-4 py-2 bg-amber-50 dark:bg-amber-900/20">
                      "Một hệ đang ở trạng thái cân bằng, nếu chịu tác động của
                      các yếu tố bên ngoài như nồng độ, nhiệt độ, áp suất thì
                      cân bằng sẽ chuyển dịch theo chiều chống lại tác động đó."
                    </p>
                  </div>
                  <LeChatelierSim />
                  <div className="grid md:grid-cols-3 gap-4">
                    <div className="glass p-4 rounded-lg text-center hover:scale-105 transition">
                      <div className="w-12 h-12 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-2">
                        <Icon name="beaker" />
                      </div>
                      <h4 className="font-bold">Nồng độ</h4>
                      <p className="text-sm text-slate-500">
                        Tăng nồng độ chất nào, cân bằng dịch chuyển để giảm nồng
                        độ chất đó.
                      </p>
                    </div>
                    <div className="glass p-4 rounded-lg text-center hover:scale-105 transition">
                      <div className="w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-2">
                        <Icon name="flame" />
                      </div>
                      <h4 className="font-bold">Nhiệt độ</h4>
                      <p className="text-sm text-slate-500">
                        Tăng T → Theo chiều thu nhiệt.
                        <br />
                        Giảm T → Theo chiều tỏa nhiệt.
                      </p>
                    </div>
                    <div className="glass p-4 rounded-lg text-center hover:scale-105 transition">
                      <div className="w-12 h-12 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-2">
                        <Icon name="minimize" />
                      </div>
                      <h4 className="font-bold">Áp suất</h4>
                      <p className="text-sm text-slate-500">
                        Tăng P → Theo chiều giảm số mol khí.
                        <br />
                        (Chỉ áp dụng với chất khí).
                      </p>
                    </div>
                  </div>
                </div>
              );
            case "dien-li":
              return (
                <div className="space-y-6">
                  <h2 className="text-2xl font-bold text-chem-600">
                    Sự điện li trong dung dịch
                  </h2>
                  <div className="grid md:grid-cols-2 gap-6">
                    <div className="glass p-6 rounded-xl">
                      <h3 className="font-bold mb-2 text-lg">Chất điện li</h3>
                      <p className="mb-2">
                        Là chất khi tan trong nước phân li ra ion.
                      </p>
                      <ul className="space-y-2 text-sm">
                        <li className="flex items-center gap-2">
                          <div className="w-2 h-2 rounded-full bg-green-500"></div>
                          <strong>Mạnh:</strong> Phân li hoàn toàn (HCl, NaOH,
                          NaCl).
                        </li>
                        <li className="flex items-center gap-2">
                          <div className="w-2 h-2 rounded-full bg-yellow-500"></div>
                          <strong>Yếu:</strong> Phân li một phần (CH<sub>3</sub>
                          COOH, HF).
                        </li>
                      </ul>
                    </div>
                    <div className="glass p-6 rounded-xl">
                      <h3 className="font-bold mb-2 text-lg">
                        Thuyết Brønsted – Lowry
                      </h3>
                      <div className="space-y-3">
                        <div className="bg-red-50 dark:bg-red-900/20 p-3 rounded border border-red-200">
                          <strong className="text-red-600">Acid:</strong> Chất
                          cho proton (H<sup>+</sup>)
                        </div>
                        <div className="bg-blue-50 dark:bg-blue-900/20 p-3 rounded border border-blue-200">
                          <strong className="text-blue-600">Base:</strong> Chất
                          nhận proton (H<sup>+</sup>)
                        </div>
                      </div>
                    </div>
                  </div>
                  <ElectrolyteSim />
                </div>
              );
            case "ph-chuan-do":
              return (
                <div className="space-y-6">
                  <h2 className="text-2xl font-bold text-pink-600">
                    pH và Chuẩn độ Acid - Base
                  </h2>
                  <PHSim />
                  <div className="glass p-6 rounded-xl">
                    <h3 className="font-bold text-lg mb-4">Công thức pH</h3>
                    <div className="grid grid-cols-2 gap-4 text-center">
                      <div className="bg-slate-800 text-white p-4 rounded font-mono">
                        pH = -log[H<sup>+</sup>]
                      </div>
                      <div className="bg-slate-800 text-white p-4 rounded font-mono">
                        [H<sup>+</sup>] = 10<sup>-pH</sup>
                      </div>
                    </div>
                  </div>
                  <TitrationSim />
                </div>
              );
            case "ung-dung":
              return (
                <div className="space-y-6">
                  <h2 className="text-2xl font-bold text-green-600">
                    Ý nghĩa thực tiễn
                  </h2>
                  <FlocculationSim />
                  <div className="grid md:grid-cols-2 gap-6">
                    <div className="glass p-6 rounded-xl">
                      <h3 className="font-bold text-lg mb-2 text-chem-600">
                        Xử lý nước (Phèn chua)
                      </h3>
                      <p className="text-sm text-slate-600 dark:text-slate-300">
                        Phèn chua cung cấp ion Al<sup>3+</sup>. Ion này bị thủy
                        phân trong nước tạo thành keo Al(OH)<sub>3</sub> có khả
                        năng dính kết các hạt bụi bẩn, đất lơ lửng trong nước
                        làm chúng lắng xuống.
                      </p>
                    </div>
                    <div className="glass p-6 rounded-xl">
                      <h3 className="font-bold text-lg mb-2 text-chem-600">
                        Hệ đệm Carbonate
                      </h3>
                      <p className="text-sm text-slate-600 dark:text-slate-300">
                        Cân bằng CO<sub>3</sub>
                        <sup>2-</sup> + H<sub>2</sub>O ⇌ HCO<sub>3</sub>
                        <sup>-</sup> + OH<sup>-</sup> đóng vai trò quan trọng
                        trong việc ổn định pH của nước tự nhiên và máu, cũng như
                        quá trình hình thành thạch nhũ trong hang động.
                      </p>
                    </div>
                  </div>
                </div>
              );
            default:
              return null;
          }
        };

        return (
          <div className="min-h-screen pb-10">
            {/* Navigation */}
            <nav className="sticky top-0 z-50 glass shadow-sm px-4 py-3 mb-6">
              <div className="max-w-6xl mx-auto flex justify-between items-center">
                <div className="flex items-center gap-2">
                  <div className="bg-chem-600 text-white p-2 rounded-lg">
                    <Icon name="flask-conical" className="text-white" />
                  </div>
                  <span className="font-bold text-xl hidden md:block tracking-tight text-chem-900 dark:text-white">
                    ChemStudy Teen
                  </span>
                </div>

                {/* Desktop Menu */}
                <div className="hidden md:flex gap-1 bg-slate-100 dark:bg-slate-800 p-1 rounded-xl">
                  {tabs.map((tab) => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                        activeTab === tab.id
                          ? "bg-white dark:bg-slate-600 text-chem-600 dark:text-white shadow-sm"
                          : "text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"
                      }`}
                    >
                      {tab.label}
                    </button>
                  ))}
                </div>

                <div className="flex items-center gap-3">
                  <button
                    onClick={() => setDarkMode(!darkMode)}
                    className="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition"
                  >
                    <Icon name={darkMode ? "sun" : "moon"} size={20} />
                  </button>
                  <a
                    href="../chemstudyteen.html"
                    className="flex items-center gap-2 bg-slate-800 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-slate-700 transition"
                  >
                    <Icon name="arrow-left" size={16} /> Quay về
                  </a>
                </div>
              </div>
              {/* Mobile Menu (Scrollable) */}
              <div className="md:hidden mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                {tabs.map((tab) => (
                  <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id)}
                    className={`whitespace-nowrap px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${
                      activeTab === tab.id
                        ? "bg-chem-600 text-white"
                        : "bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300"
                    }`}
                  >
                    {tab.label}
                  </button>
                ))}
              </div>
            </nav>

            {/* Main Content */}
            <main className="max-w-5xl mx-auto px-4">{renderContent()}</main>

            {/* No Footer as requested */}
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
