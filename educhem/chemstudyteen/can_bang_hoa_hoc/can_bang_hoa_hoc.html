<!doctype html>
<html lang="vi" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cân Bằng Hoá Học & Sự Điện Li – ChemStudy Expert</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../../../favicon/educhem.avg" />

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap"
      rel="stylesheet"
    />

    <!-- Chart.js (Optional helper for graphs, but implementing via Raw Canvas as requested for dependency-free experience usually, strictly following "No external libraries" except Tailwind/FA. Using pure JS for Charts to adhere to constraints) -->

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              sans: ['"Be Vietnam Pro"', "sans-serif"],
              display: ['"Space Grotesk"', "sans-serif"],
            },
            colors: {
              chem: {
                primary: "#3b82f6",
                secondary: "#10b981",
                accent: "#8b5cf6",
                dark: "#0f172a",
                light: "#f8fafc",
              },
            },
            animation: {
              float: "floating 3s ease-in-out infinite",
              "pulse-slow": "pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",
              "spin-slow": "spin 8s linear infinite",
            },
          },
        },
      };
    </script>

    <style>
      /* * GLOBAL STYLES & GLASSMORPHISM 
         */
      :root {
        --footer-bg: #0f172a;
        --footer-text: #e2e8f0;
        --p-primary: #3b82f6;
      }

      html.dark :root {
        --footer-bg: #020617;
      }

      body {
        background-color: #f0f9ff;
        background-image:
          radial-gradient(at 0% 0%, hsla(253, 16%, 7%, 1) 0, transparent 50%),
          radial-gradient(at 50% 0%, hsla(225, 39%, 30%, 1) 0, transparent 50%),
          radial-gradient(at 100% 0%, hsla(339, 49%, 30%, 1) 0, transparent 50%);
        transition: background-color 0.5s ease;
      }

      .dark body {
        background-color: #0f172a;
        background-image:
          radial-gradient(at 0% 0%, hsla(253, 16%, 7%, 1) 0, transparent 50%),
          radial-gradient(
            at 50% 100%,
            hsla(225, 39%, 20%, 1) 0,
            transparent 50%
          );
      }

      /* Glassmorphism Classes */
      .glass-card {
        background: rgba(255, 255, 255, 0.7);
        -webkit-backdrop-filter: blur(12px);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        -webkit-transition: all 0.3s ease;
        -o-transition: all 0.3s ease;
        transition: all 0.3s ease;
      }

      .dark .glass-card {
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .glass-card:hover {
        -webkit-transform: translateY(-5px);
        -ms-transform: translateY(-5px);
        transform: translateY(-5px);
        -webkit-box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1);
        box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1);
      }

      .text-gradient {
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-image: linear-gradient(to right, #3b82f6, #8b5cf6, #ec4899);
      }

      /* Footer Specifics (Preserved from Prompt) */
      footer {
        background: var(--footer-bg);
        color: var(--footer-text);
        padding: 100px 5% 40px;
        position: relative;
        overflow: hidden;
        transition:
          background-color 0.8s ease,
          color 0.8s ease;
      }

      .footer-waves {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 60px;
        background: var(--footer-bg);
        clip-path: polygon(
          0% 45%,
          16% 44%,
          33% 50%,
          54% 60%,
          70% 61%,
          84% 59%,
          100% 52%,
          100% 100%,
          0% 100%
        );
        transition: background-color 0.8s;
      }

      .footer-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 60px;
        max-width: 1200px;
        margin: 0 auto;
      }

      .icon-btn {
        color: #94a3b8;
        font-size: 1.2rem;
        transition: 0.3s;
      }

      .icon-btn:hover {
        color: white;
        transform: scale(1.1);
      }

      .contact-item {
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
        color: #94a3b8;
        transition: 0.3s;
      }

      .contact-item i {
        color: var(--p-primary);
      }
      .contact-item:hover {
        color: white;
        transform: translateX(5px);
      }

      .copyright {
        margin-top: 80px;
        text-align: center;
        padding-top: 30px;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        color: #475569;
        font-size: 0.9rem;
      }

      .footer-brand h2 {
        font-family: "Space Grotesk", sans-serif;
        font-size: 2rem;
        margin-bottom: 20px;
      }

      .footer-links h4,
      h3 {
        margin-bottom: 25px;
        text-transform: uppercase;
        letter-spacing: 2px;
        color: var(--p-primary);
      }

      /* Animation Keyframes */
      @keyframes floating {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-15px);
        }
      }

      .floating {
        animation: floating 3s ease-in-out infinite;
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 10px;
      }
      ::-webkit-scrollbar-track {
        background: #1e293b;
      }
      ::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 5px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #3b82f6;
      }

      /* Simulation Containers */
      .sim-container {
        position: relative;
        overflow: hidden;
        border-radius: 1rem;
        background: linear-gradient(to bottom right, #1e293b, #0f172a);
        box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.3);
      }

      .molecule {
        transition: all 0.5s ease;
      }
    </style>
  </head>
  <body
    class="text-slate-800 dark:text-slate-200 antialiased selection:bg-blue-500 selection:text-white"
  >
    <!-- 
      HEADER SECTION 
      Fixed position, Glassmorphism
    -->
    <header
      class="fixed top-0 w-full z-50 transition-all duration-300 glass-card border-b-0 rounded-none px-6 py-3"
    >
      <div class="max-w-7xl mx-auto flex justify-between items-center">
        <!-- Logo Block -->
        <div
          class="flex items-center gap-3 cursor-pointer group"
          onclick="window.scrollTo(0, 0)"
        >
          <div
            class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-green-500 flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-blue-500/30"
          >
            <i class="fas fa-atom text-xl group-hover:animate-spin"></i>
          </div>
          <span
            class="font-display font-bold text-xl md:text-2xl tracking-tight text-slate-800 dark:text-white"
          >
            ChemStudy Expert
          </span>
        </div>

        <!-- Navigation & Controls -->
        <div class="flex items-center gap-4">
          <nav class="hidden md:flex gap-6 text-sm font-semibold">
            <a href="#equilibrium" class="hover:text-blue-500 transition-colors"
              >Cân Bằng</a
            >
            <a href="#lechatelier" class="hover:text-blue-500 transition-colors"
              >Le Chatelier</a
            >
            <a
              href="#electrolysis"
              class="hover:text-blue-500 transition-colors"
              >Sự Điện Li</a
            >
            <a href="#titration" class="hover:text-blue-500 transition-colors"
              >Chuẩn Độ</a
            >
          </nav>

          <!-- Dark Mode Toggle -->
          <button
            id="theme-toggle"
            class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors"
          >
            <i class="fas fa-moon dark:hidden text-slate-600"></i>
            <i class="fas fa-sun hidden dark:block text-yellow-400"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- 
      HERO SECTION
    -->
    <section
      class="relative pt-32 pb-20 px-6 min-h-[80vh] flex items-center justify-center overflow-hidden"
    >
      <!-- Background Elements -->
      <div
        class="absolute top-20 left-10 w-20 h-20 bg-blue-500 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-float"
      ></div>
      <div
        class="absolute top-40 right-10 w-32 h-32 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-float"
        style="animation-delay: 1s"
      ></div>
      <div
        class="absolute bottom-20 left-1/3 w-24 h-24 bg-green-400 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-float"
        style="animation-delay: 2s"
      ></div>

      <div class="max-w-4xl mx-auto text-center relative z-10">
        <span
          class="inline-block py-1 px-3 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-300 text-sm font-semibold mb-6 border border-blue-200 dark:border-blue-800"
        >
          Chuyên đề Hóa học 11
        </span>
        <h1
          class="text-5xl md:text-7xl font-display font-bold mb-6 tracking-tight leading-tight"
        >
          Cân Bằng Hoá Học & <br />
          <span class="text-gradient">Sự Điện Li</span>
        </h1>
        <p
          class="text-xl text-slate-600 dark:text-slate-300 mb-10 max-w-2xl mx-auto leading-relaxed"
        >
          Khám phá bản chất động của phản ứng thuận nghịch và thế giới vi mô của
          các ion thông qua
          <strong class="text-blue-500">mô phỏng tương tác</strong> và
          <strong class="text-green-500">thí nghiệm ảo</strong>.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <button
            onclick="document.getElementById('equilibrium').scrollIntoView()"
            class="px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-full font-bold shadow-lg shadow-blue-500/30 hover:shadow-blue-500/50 hover:-translate-y-1 transition-all duration-300 flex items-center justify-center gap-2"
          >
            <i class="fas fa-play-circle"></i> Vào bài học
          </button>
          <button
            onclick="document.getElementById('exercises').scrollIntoView()"
            class="px-8 py-4 glass-card text-slate-700 dark:text-white rounded-full font-bold hover:bg-white/50 dark:hover:bg-slate-700/50 transition-all duration-300 flex items-center justify-center gap-2"
          >
            <i class="fas fa-gamepad"></i> Luyện tập ngay
          </button>
        </div>
      </div>
    </section>

    <!-- MAIN CONTENT CONTAINER -->
    <main class="max-w-6xl mx-auto px-6 space-y-24 pb-20">
      <!-- ============================================
             CHỦ ĐỀ 1: CÂN BẰNG HOÁ HỌC
             ============================================ -->
      <section id="equilibrium" class="scroll-mt-28">
        <div class="flex items-center gap-4 mb-8">
          <div
            class="w-12 h-12 rounded-xl bg-blue-500 flex items-center justify-center text-white text-2xl shadow-lg"
          >
            <i class="fas fa-balance-scale"></i>
          </div>
          <h2
            class="text-3xl md:text-4xl font-display font-bold text-slate-800 dark:text-white"
          >
            I. Phản Ứng Thuận Nghịch & Cân Bằng
          </h2>
        </div>

        <!-- A. LÝ THUYẾT & B. MÔ PHỎNG (Kết hợp) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Theory Column -->
          <div class="space-y-6">
            <div class="glass-card p-6 rounded-2xl">
              <h3
                class="text-xl font-bold text-blue-500 mb-4 flex items-center gap-2"
              >
                <i class="fas fa-book-open"></i> Lý thuyết trọng tâm
              </h3>
              <ul class="space-y-3 text-slate-600 dark:text-slate-300">
                <li class="flex gap-3">
                  <i class="fas fa-check-circle text-green-500 mt-1"></i>
                  <span
                    ><strong>Phản ứng một chiều:</strong> Xảy ra 1 chiều (→),
                    chất đầu → sản phẩm.</span
                  >
                </li>
                <li class="flex gap-3">
                  <i class="fas fa-check-circle text-green-500 mt-1"></i>
                  <span
                    ><strong>Phản ứng thuận nghịch:</strong> Xảy ra 2 chiều (⇌)
                    trong cùng điều kiện.</span
                  >
                </li>
                <li class="flex gap-3">
                  <i class="fas fa-check-circle text-green-500 mt-1"></i>
                  <span
                    ><strong>Cân bằng hoá học:</strong> Trạng thái tốc độ phản
                    ứng thuận = tốc độ phản ứng nghịch ($v_t = v_n$). Nồng độ
                    các chất không đổi.</span
                  >
                </li>
                <li class="flex gap-3">
                  <i
                    class="fas fa-exclamation-triangle text-orange-500 mt-1"
                  ></i>
                  <span
                    ><strong>Bản chất:</strong> Là cân bằng ĐỘNG. Phản ứng vẫn
                    xảy ra ở cấp độ vi mô.</span
                  >
                </li>
              </ul>
            </div>

            <div class="glass-card p-6 rounded-2xl">
              <h3 class="text-xl font-bold text-purple-500 mb-4">
                <i class="fas fa-calculator"></i> Hằng số cân bằng ($K_c$)
              </h3>
              <div
                class="p-4 bg-slate-100 dark:bg-slate-800 rounded-lg font-mono text-center text-lg mb-2"
              >
                $$ aA + bB \rightleftharpoons cC + dD $$
                <br />
                $$ K_c = \frac{[C]^c.[D]^d}{[A]^a.[B]^b} $$
              </div>
              <p class="text-sm text-slate-500 italic">
                *Chất rắn không xuất hiện trong biểu thức $K_c$.
              </p>
            </div>
          </div>

          <!-- Simulation Column: Graph & Particles -->
          <div class="space-y-6">
            <!-- SIMULATION 1: RATE GRAPH -->
            <div class="glass-card p-1 rounded-2xl overflow-hidden shadow-2xl">
              <div
                class="bg-slate-900 p-4 border-b border-slate-700 flex justify-between items-center"
              >
                <h4 class="text-white font-bold">
                  <i class="fas fa-chart-line text-blue-400"></i> Mô phỏng Tốc
                  độ phản ứng
                </h4>
                <button
                  onclick="resetRateSim()"
                  class="text-xs bg-blue-600 hover:bg-blue-500 text-white px-3 py-1 rounded"
                >
                  Reset
                </button>
              </div>
              <div
                class="relative h-64 bg-slate-900 w-full flex items-center justify-center"
              >
                <canvas
                  id="rateCanvas"
                  width="500"
                  height="250"
                  class="w-full h-full"
                ></canvas>
                <div
                  id="equilibriumLabel"
                  class="absolute right-10 top-1/2 text-green-400 font-bold hidden bg-black/50 px-2 rounded border border-green-500"
                >
                  ĐẠT CÂN BẰNG ($v_t = v_n$)
                </div>
              </div>
              <div class="p-4 bg-slate-800 text-slate-300 text-sm">
                <p>
                  Quan sát đường
                  <span class="text-blue-400">Xanh (Thuận)</span> giảm dần và
                  đường <span class="text-red-400">Đỏ (Nghịch)</span> tăng dần
                  cho đến khi gặp nhau.
                </p>
              </div>
            </div>

            <!-- SIMULATION 2: DYNAMIC PARTICLES -->
            <div class="glass-card p-1 rounded-2xl overflow-hidden shadow-2xl">
              <div class="bg-slate-900 p-4 border-b border-slate-700">
                <h4 class="text-white font-bold">
                  <i class="fas fa-project-diagram text-green-400"></i> Bản chất
                  Cân bằng Động
                </h4>
              </div>
              <div
                class="relative h-48 bg-slate-900 w-full overflow-hidden"
                id="particleContainer"
              >
                <!-- Particles generated by JS -->
                <div
                  class="absolute inset-0 flex items-center justify-center text-white/20 pointer-events-none"
                >
                  Hệ kín: Hạt va chạm liên tục
                </div>
              </div>
              <div
                class="p-4 bg-slate-800 flex justify-between items-center text-sm text-slate-300"
              >
                <div>
                  <span
                    class="inline-block w-3 h-3 rounded-full bg-blue-500"
                  ></span>
                  Chất A
                  <span
                    class="inline-block w-3 h-3 rounded-full bg-red-500 ml-2"
                  ></span>
                  Chất B
                </div>
                <div id="particleCount">A: 10 | B: 10</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ============================================
             CHỦ ĐỀ 2: NGUYÊN LÍ LE CHATELIER
             ============================================ -->
      <section id="lechatelier" class="scroll-mt-28">
        <div class="flex items-center gap-4 mb-8">
          <div
            class="w-12 h-12 rounded-xl bg-purple-500 flex items-center justify-center text-white text-2xl shadow-lg"
          >
            <i class="fas fa-arrows-alt-h"></i>
          </div>
          <h2
            class="text-3xl md:text-4xl font-display font-bold text-slate-800 dark:text-white"
          >
            II. Chuyển Dịch Cân Bằng (Le Chatelier)
          </h2>
        </div>

        <!-- Theory Block -->
        <div
          class="glass-card p-6 rounded-2xl mb-8 border-l-4 border-purple-500"
        >
          <h3 class="text-lg font-bold mb-2">Nguyên lí Le Chatelier</h3>
          <p class="text-slate-600 dark:text-slate-300 italic">
            "Một phản ứng thuận nghịch đang ở trạng thái cân bằng, khi chịu một
            tác động từ bên ngoài (nồng độ, nhiệt độ, áp suất) thì cân bằng sẽ
            chuyển dịch theo chiều <strong>làm giảm tác động đó</strong>."
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <!-- SIMULATION 3: TEMPERATURE (NO2/N2O4) -->
          <div class="glass-card rounded-2xl overflow-hidden">
            <div
              class="p-4 bg-gradient-to-r from-orange-100 to-red-100 dark:from-slate-800 dark:to-slate-700 border-b border-slate-200 dark:border-slate-600"
            >
              <h4 class="font-bold text-slate-800 dark:text-white mb-1">
                1. Ảnh hưởng của Nhiệt độ
              </h4>
              <p class="text-xs text-slate-500">
                Thí nghiệm $2NO_2$ (Nâu đỏ) $\rightleftharpoons N_2O_4$ (Không
                màu, $\Delta H < 0$)
              </p>
            </div>
            <div
              class="p-6 flex flex-col items-center gap-6 bg-white dark:bg-slate-900"
            >
              <!-- Visual representation -->
              <div class="flex gap-4 items-end">
                <!-- Flask -->
                <div
                  id="flask"
                  class="w-24 h-32 rounded-b-xl border-2 border-slate-400 relative transition-colors duration-1000 flex items-center justify-center shadow-inner"
                  style="background-color: rgba(165, 42, 42, 0.5)"
                >
                  <span
                    id="flaskText"
                    class="font-bold text-white drop-shadow-md"
                    >Hỗn hợp</span
                  >
                </div>
                <!-- Thermometer -->
                <div
                  class="h-32 w-4 bg-slate-200 rounded-full relative overflow-hidden border border-slate-300"
                >
                  <div
                    id="thermoFluid"
                    class="absolute bottom-0 w-full bg-red-500 transition-all duration-500"
                    style="height: 50%"
                  ></div>
                </div>
              </div>

              <!-- Control -->
              <div class="w-full">
                <label
                  class="flex justify-between text-sm font-semibold mb-2 text-slate-700 dark:text-slate-300"
                >
                  <span>Lạnh (Nước đá)</span>
                  <span id="tempValue">25°C</span>
                  <span>Nóng (Nước sôi)</span>
                </label>
                <input
                  type="range"
                  min="0"
                  max="100"
                  value="25"
                  class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-red-500"
                  oninput="updateTempSim(this.value)"
                />
                <div
                  class="mt-3 text-xs text-center p-2 bg-slate-100 dark:bg-slate-800 rounded text-slate-600 dark:text-slate-400"
                  id="tempExplanation"
                >
                  Ở 25°C: Cân bằng màu nâu nhạt.
                </div>
              </div>
            </div>
          </div>

          <!-- SIMULATION 4: PRESSURE -->
          <div class="glass-card rounded-2xl overflow-hidden">
            <div
              class="p-4 bg-gradient-to-r from-blue-100 to-cyan-100 dark:from-slate-800 dark:to-slate-700 border-b border-slate-200 dark:border-slate-600"
            >
              <h4 class="font-bold text-slate-800 dark:text-white mb-1">
                2. Ảnh hưởng của Áp suất
              </h4>
              <p class="text-xs text-slate-500">
                Hệ có số mol khí thay đổi: $N_2(k) + 3H_2(k) \rightleftharpoons
                2NH_3(k)$
              </p>
            </div>
            <div
              class="p-6 flex flex-col items-center gap-6 bg-white dark:bg-slate-900"
            >
              <!-- Piston Visual -->
              <div
                class="relative w-32 h-40 border-l-4 border-r-4 border-b-4 border-slate-400 bg-slate-50 dark:bg-slate-800/50"
              >
                <!-- Piston Head -->
                <div
                  id="pistonHead"
                  class="absolute top-0 left-0 w-full h-4 bg-slate-600 transition-all duration-500 border-b-2 border-black"
                ></div>
                <!-- Particles -->
                <div
                  id="pressureParticles"
                  class="absolute bottom-0 w-full h-full p-2 grid grid-cols-4 gap-1 transition-all"
                >
                  <!-- Dots generated by JS -->
                </div>
              </div>

              <!-- Control -->
              <div class="flex gap-4">
                <button
                  onclick="changePressure('increase')"
                  class="px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 rounded font-bold transition"
                >
                  <i class="fas fa-compress-arrows-alt"></i> Tăng P
                </button>
                <button
                  onclick="changePressure('decrease')"
                  class="px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 rounded font-bold transition"
                >
                  <i class="fas fa-expand-arrows-alt"></i> Giảm P
                </button>
              </div>
              <div id="pressureText" class="text-xs text-center text-slate-500">
                Tăng áp suất $\to$ Cân bằng chuyển dịch theo chiều giảm số mol
                khí (Tạo $NH_3$).
              </div>
            </div>
          </div>
        </div>

        <!-- Application: Haber Process -->
        <div class="mt-8 glass-card p-6 rounded-2xl">
          <h4 class="font-bold text-lg mb-4 text-green-600">
            <i class="fas fa-industry"></i> Ứng dụng: Sản xuất Amoniac (Quy
            trình Haber)
          </h4>
          <div class="flex flex-col md:flex-row gap-4 items-center">
            <div
              class="flex-1 text-sm space-y-2 text-slate-700 dark:text-slate-300"
            >
              <p>
                Phương trình: $N_2 + 3H_2 \rightleftharpoons 2NH_3$ ($\Delta H =
                -92kJ$)
              </p>
              <ul class="list-disc pl-5">
                <li>
                  <strong>Tăng Áp suất:</strong> Dịch chuyển chiều thuận (giảm
                  mol khí 4 -> 2).
                </li>
                <li>
                  <strong>Giảm Nhiệt độ:</strong> Dịch chuyển chiều thuận (toả
                  nhiệt). *Thực tế dùng 450°C để tốc độ không quá chậm.
                </li>
                <li>
                  <strong>Xúc tác (Fe):</strong> Tăng tốc độ đạt cân bằng.
                </li>
              </ul>
            </div>
            <div
              class="w-full md:w-1/3 bg-slate-100 dark:bg-slate-800 p-4 rounded-xl text-center"
            >
              <i class="fas fa-flask text-4xl text-yellow-500 mb-2"></i>
              <p class="font-bold">Hiệu suất tối ưu</p>
              <div
                class="w-full bg-gray-300 rounded-full h-2.5 mt-2 dark:bg-gray-700"
              >
                <div
                  class="bg-green-500 h-2.5 rounded-full"
                  style="width: 45%"
                ></div>
              </div>
              <p class="text-xs mt-1">~20-25% (Tuần hoàn khí)</p>
            </div>
          </div>
        </div>
      </section>

      <!-- ============================================
             CHỦ ĐỀ 3: SỰ ĐIỆN LI
             ============================================ -->
      <section id="electrolysis" class="scroll-mt-28">
        <div class="flex items-center gap-4 mb-8">
          <div
            class="w-12 h-12 rounded-xl bg-green-500 flex items-center justify-center text-white text-2xl shadow-lg"
          >
            <i class="fas fa-bolt"></i>
          </div>
          <h2
            class="text-3xl md:text-4xl font-display font-bold text-slate-800 dark:text-white"
          >
            III. Sự Điện Li Trong Dung Dịch
          </h2>
        </div>

        <!-- SIMULATION 5: CONDUCTIVITY TESTER -->
        <div class="glass-card p-0 rounded-2xl overflow-hidden mb-8 shadow-xl">
          <div
            class="bg-slate-900 text-white p-4 flex justify-between items-center"
          >
            <h3 class="font-bold">
              <i class="fas fa-lightbulb text-yellow-400"></i> Thí nghiệm: Tính
              dẫn điện của dung dịch
            </h3>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2">
            <!-- Virtual Lab View -->
            <div
              class="bg-slate-800 relative h-64 flex justify-center items-end p-4 border-r border-slate-700"
            >
              <!-- Circuit -->
              <div
                class="absolute top-4 left-1/2 -translate-x-1/2 flex flex-col items-center"
              >
                <!-- Bulb -->
                <div
                  id="bulb"
                  class="w-12 h-12 bg-gray-600 rounded-full mb-2 transition-all duration-300 shadow-none border-2 border-gray-500"
                ></div>
                <div class="w-1 h-8 bg-gray-400"></div>
                <div class="w-32 h-1 bg-gray-400 relative">
                  <!-- Electrodes -->
                  <div class="absolute left-0 top-0 w-1 h-32 bg-gray-300"></div>
                  <div
                    class="absolute right-0 top-0 w-1 h-32 bg-gray-300"
                  ></div>
                </div>
              </div>

              <!-- Beaker -->
              <div
                class="w-40 h-32 border-l-2 border-r-2 border-b-2 border-white/30 rounded-b-xl relative overflow-hidden bg-white/5 backdrop-blur-sm z-10"
              >
                <!-- Liquid -->
                <div
                  class="absolute bottom-0 w-full h-24 bg-blue-400/30 transition-colors"
                  id="solutionLiquid"
                ></div>
                <!-- Ions Animation (SVG overlay) -->
                <div
                  id="ionsContainer"
                  class="absolute inset-0 flex flex-wrap justify-center content-end p-2 gap-2 opacity-0 transition-opacity"
                >
                  <!-- Injected via JS -->
                </div>
              </div>
            </div>

            <!-- Controls & Theory -->
            <div
              class="p-6 bg-white dark:bg-slate-900 flex flex-col justify-center gap-4"
            >
              <label
                class="block text-sm font-medium text-slate-700 dark:text-slate-300"
                >Chọn dung dịch thử nghiệm:</label
              >
              <select
                id="solutionSelect"
                class="w-full p-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-800 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none"
                onchange="runConductivityTest(this.value)"
              >
                <option value="water">Nước cất ($H_2O$)</option>
                <option value="salt">Dung dịch Muối ăn (NaCl)</option>
                <option value="sugar">
                  Dung dịch Đường ($C_{12}H_{22}O_{11}$)
                </option>
                <option value="weak_acid">Giấm ăn ($CH_3COOH$)</option>
                <option value="strong_acid">Acid mạnh ($HCl$)</option>
              </select>

              <div
                id="conductivityResult"
                class="p-4 rounded-lg bg-slate-100 dark:bg-slate-800 min-h-[100px]"
              >
                <p class="font-bold text-slate-800 dark:text-white">
                  Hiện tượng:
                </p>
                <p
                  class="text-sm text-slate-600 dark:text-slate-400 mt-1"
                  id="resultText"
                >
                  Chọn dung dịch để bắt đầu...
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Theory Cards Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="glass-card p-5 rounded-xl border-t-4 border-green-500">
            <h4 class="font-bold mb-2">Chất điện li mạnh</h4>
            <p class="text-sm text-slate-600 dark:text-slate-300">
              Phân li hoàn toàn ra ion.
            </p>
            <div
              class="mt-2 text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 p-2 rounded"
            >
              VD: NaCl, HCl, NaOH
              <br />
              $\alpha = 1$
            </div>
          </div>
          <div class="glass-card p-5 rounded-xl border-t-4 border-yellow-500">
            <h4 class="font-bold mb-2">Chất điện li yếu</h4>
            <p class="text-sm text-slate-600 dark:text-slate-300">
              Phân li một phần.
            </p>
            <div
              class="mt-2 text-xs bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 p-2 rounded"
            >
              VD: $CH_3COOH$, $H_2O$
              <br />
              $0 < \alpha < 1$
            </div>
          </div>
          <div class="glass-card p-5 rounded-xl border-t-4 border-red-500">
            <h4 class="font-bold mb-2">Không điện li</h4>
            <p class="text-sm text-slate-600 dark:text-slate-300">
              Không tạo ion.
            </p>
            <div
              class="mt-2 text-xs bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 p-2 rounded"
            >
              VD: Đường, Ethanol
              <br />
              $\alpha = 0$
            </div>
          </div>
        </div>

        <!-- SIMULATION 6: DISSOLUTION MECHANISM -->
        <div class="mt-8 glass-card p-6 rounded-2xl">
          <h3 class="font-bold text-lg mb-4 text-blue-600">
            Cơ chế điện li NaCl trong nước
          </h3>
          <div
            class="relative h-48 bg-blue-50 dark:bg-blue-900/20 rounded-xl overflow-hidden flex items-center justify-center"
          >
            <!-- Interactive Elements -->
            <div class="absolute animate-pulse-slow">
              <div class="flex gap-1 items-center justify-center">
                <div
                  class="w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center text-white text-xs font-bold ring-4 ring-blue-300 shadow-lg"
                >
                  Na+
                </div>
                <div
                  class="w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white text-xs font-bold ring-4 ring-blue-300 shadow-lg"
                >
                  Cl-
                </div>
              </div>
            </div>
            <!-- Water molecules surrounding (Static representation for layout, dynamic behavior implied via CSS animation) -->
            <div
              class="absolute top-10 left-1/4 animate-float text-blue-400 opacity-50"
            >
              <i class="fas fa-tint text-2xl"></i>
            </div>
            <div
              class="absolute bottom-10 right-1/4 animate-float text-blue-400 opacity-50"
              style="animation-delay: 1s"
            >
              <i class="fas fa-tint text-2xl"></i>
            </div>
          </div>
          <p class="mt-3 text-sm text-center text-slate-500">
            Các phân tử nước phân cực ($H^{\delta+}, O^{\delta-}$) bao quanh và
            tách các ion ra khỏi tinh thể.
          </p>
        </div>
      </section>

      <!-- ============================================
             CHỦ ĐỀ 4: CHUẨN ĐỘ & pH
             ============================================ -->
      <section id="titration" class="scroll-mt-28">
        <div class="flex items-center gap-4 mb-8">
          <div
            class="w-12 h-12 rounded-xl bg-pink-500 flex items-center justify-center text-white text-2xl shadow-lg"
          >
            <i class="fas fa-vial"></i>
          </div>
          <h2
            class="text-3xl md:text-4xl font-display font-bold text-slate-800 dark:text-white"
          >
            IV. Chuẩn Độ & Thang pH
          </h2>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- SIMULATION 7: pH SLIDER -->
          <div class="glass-card p-6 rounded-2xl">
            <h3 class="font-bold mb-4">Thang pH và Màu Chỉ Thị</h3>
            <div class="mb-6">
              <input
                type="range"
                min="0"
                max="14"
                step="1"
                value="7"
                id="phSlider"
                class="w-full h-4 rounded-lg appearance-none cursor-pointer"
                style="
                  background: linear-gradient(
                    to right,
                    #ef4444,
                    #eab308,
                    #22c55e,
                    #3b82f6,
                    #6366f1
                  );
                "
                oninput="updatePH(this.value)"
              />
              <div class="flex justify-between text-xs mt-2 font-mono">
                <span>0 (Acid)</span>
                <span>7 (Trung tính)</span>
                <span>14 (Base)</span>
              </div>
            </div>

            <div class="flex items-center gap-6">
              <div
                id="phDisplay"
                class="w-24 h-24 rounded-full flex items-center justify-center text-3xl font-bold text-white shadow-lg transition-colors duration-300 bg-green-500"
              >
                pH 7
              </div>
              <div class="space-y-2 text-sm">
                <p>
                  <strong>Quỳ tím:</strong>
                  <span id="litmusResult">Không đổi màu</span>
                </p>
                <p>
                  <strong>Phenolphthalein:</strong>
                  <span id="phenolResult">Không màu</span>
                </p>
                <p>
                  <strong>$[H^+]$:</strong>
                  <span id="hConcentration">$10^{-7} M$</span>
                </p>
              </div>
            </div>
          </div>

          <!-- SIMULATION 8: TITRATION LAB -->
          <div class="glass-card p-0 rounded-2xl overflow-hidden">
            <div
              class="bg-slate-900 p-4 border-b border-slate-700 flex justify-between"
            >
              <h4 class="text-white font-bold">
                <i class="fas fa-flask text-pink-400"></i> Thí nghiệm Chuẩn độ
                NaOH bằng HCl
              </h4>
              <button
                onclick="resetTitration()"
                class="text-xs bg-slate-700 text-white px-2 py-1 rounded"
              >
                Làm lại
              </button>
            </div>
            <div class="relative h-80 bg-slate-800 flex justify-center">
              <!-- Burette -->
              <div
                class="absolute top-0 w-4 h-40 bg-white/20 border-x border-white/40 flex flex-col items-center justify-end"
              >
                <!-- Liquid inside burette -->
                <div
                  id="buretteLiquid"
                  class="w-full bg-slate-200/50 transition-all duration-300"
                  style="height: 100%"
                ></div>
                <!-- Tip -->
                <div class="absolute -bottom-4 w-1 h-4 bg-white/40"></div>
                <!-- Drop -->
                <div
                  id="drop"
                  class="absolute -bottom-4 w-2 h-2 rounded-full bg-slate-200/50 opacity-0"
                ></div>
              </div>

              <!-- Flask -->
              <div class="absolute bottom-10 w-24 h-32">
                <!-- Flask Body shape using clip-path or border radius tricks -->
                <div
                  class="w-full h-full bg-white/10 border-2 border-white/30 rounded-b-3xl rounded-t-lg relative overflow-hidden backdrop-blur-sm"
                >
                  <!-- Solution Liquid -->
                  <div
                    id="flaskLiquid"
                    class="absolute bottom-0 w-full h-16 bg-pink-500/80 transition-colors duration-1000"
                  ></div>
                </div>
              </div>

              <!-- Tap Control -->
              <div class="absolute top-36 right-1/4">
                <button
                  id="titrateBtn"
                  onclick="addTitrant()"
                  class="w-12 h-12 rounded-full bg-blue-600 hover:bg-blue-500 text-white shadow-lg flex items-center justify-center active:scale-95 transition"
                >
                  <i class="fas fa-tint"></i>
                </button>
                <p class="text-xs text-center text-slate-400 mt-2">Nhỏ HCl</p>
              </div>
            </div>
            <div class="p-4 bg-white dark:bg-slate-900 text-sm">
              <div class="flex justify-between mb-2">
                <span
                  >V(HCl) đã dùng:
                  <strong id="volUsed" class="text-blue-600">0</strong> mL</span
                >
                <span id="titrationStatus" class="font-bold text-pink-500"
                  >Chưa đạt điểm tương đương</span
                >
              </div>
              <p class="text-slate-500 text-xs">
                Mục tiêu: Làm mất màu hồng của Phenolphthalein.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- ============================================
             CHỦ ĐỀ 5: BÀI TẬP CỦNG CỐ (GAMIFICATION)
             ============================================ -->
      <section id="exercises" class="scroll-mt-28 mb-20">
        <div class="text-center mb-10">
          <span
            class="text-blue-500 font-bold tracking-widest uppercase text-sm"
            >Review Time</span
          >
          <h2
            class="text-3xl font-display font-bold mt-2 text-slate-800 dark:text-white"
          >
            Thử Tài Hóa Học
          </h2>
        </div>

        <div
          class="glass-card max-w-3xl mx-auto rounded-3xl overflow-hidden shadow-2xl relative"
        >
          <!-- Progress Bar -->
          <div class="w-full h-2 bg-slate-200 dark:bg-slate-700">
            <div
              id="quizProgress"
              class="h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500"
              style="width: 0%"
            ></div>
          </div>

          <div class="p-8 md:p-12" id="quizContainer">
            <!-- Question Injected Here -->
            <div class="text-center">
              <div
                class="inline-block p-4 rounded-full bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-300 mb-6 text-2xl"
              >
                <i class="fas fa-question"></i>
              </div>
              <h3
                class="text-xl md:text-2xl font-bold mb-8 text-slate-800 dark:text-white"
                id="questionText"
              >
                Sẵn sàng chưa?
              </h3>
              <div class="grid grid-cols-1 gap-4" id="answersContainer">
                <button
                  onclick="startQuiz()"
                  class="w-full p-4 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-bold text-lg transition-transform hover:scale-105 shadow-lg shadow-blue-500/30"
                >
                  Bắt đầu ngay
                </button>
              </div>
            </div>
          </div>

          <!-- Feedback Overlay -->
          <div
            id="feedbackOverlay"
            class="absolute inset-0 bg-slate-900/90 backdrop-blur-sm hidden flex-col items-center justify-center text-center p-6 z-10"
          >
            <div id="feedbackIcon" class="text-6xl mb-4"></div>
            <h3
              id="feedbackTitle"
              class="text-2xl font-bold text-white mb-2"
            ></h3>
            <p id="feedbackDesc" class="text-slate-300 mb-6 max-w-md"></p>
            <button
              onclick="nextQuestion()"
              class="px-6 py-3 bg-white text-slate-900 rounded-full font-bold hover:bg-slate-200 transition"
            >
              Câu tiếp theo <i class="fas fa-arrow-right ml-2"></i>
            </button>
          </div>
        </div>
      </section>

      <!-- NAVIGATION BUTTONS (FIXED FROM PROMPT) -->
      <section
        class="text-center space-x-4 mb-20 flex flex-col md:flex-row justify-center gap-4 md:gap-0"
      >
        <button
          onclick="document.getElementById('exercises').scrollIntoView()"
          style="
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 30px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            color: #fff;
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.35);
            transition: 0.3s ease;
            justify-content: center;
          "
          onmouseover="
            this.style.transform = 'translateY(-3px) scale(1.03)';
            this.style.boxShadow = '0 18px 45px rgba(99,102,241,.55)';
          "
          onmouseout="
            this.style.transform = 'translateY(0) scale(1)';
            this.style.boxShadow = '0 10px 30px rgba(59,130,246,.35)';
          "
        >
          <i class="fas fa-pen-to-square"></i>
          Bài tập củng cố
        </button>

        <button
          onclick="window.location.reload()"
          style="
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 30px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            color: #fff;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            box-shadow: 0 10px 30px rgba(34, 197, 94, 0.35);
            transition: 0.3s ease;
            justify-content: center;
          "
          onmouseover="
            this.style.transform = 'translateY(-3px)';
            this.style.boxShadow = '0 18px 45px rgba(22,163,74,.55)';
          "
          onmouseout="
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 10px 30px rgba(34,197,94,.35)';
          "
        >
          <i class="fas fa-sync"></i>
          Tải lại trang
        </button>
      </section>
    </main>

    <!-- FOOTER (EXACT STRUCTURE FROM PROMPT) -->
    <footer>
      <div class="footer-waves"></div>
      <div class="footer-grid">
        <div class="footer-brand" data-aos="fade-right">
          <h2>EDUMATTER</h2>
          <p style="color: #94a3b8; line-height: 1.8">
            Kiến tạo môi trường học tập cảm xúc, nơi tri thức được số hóa và
            truyền tải đầy cảm hứng.
          </p>
          <div style="display: flex; gap: 15px; margin-top: 30px">
            <a href="https://www.facebook.com/ducnt214" class="icon-btn"
              ><i class="fab fa-facebook" alt="facebook"></i
            ></a>
            <a href="https://github.com/ducnt2104" class="icon-btn" alt="github"
              ><i class="fab fa-github"></i
            ></a>
            <a
              href="https://www.tiktok.com/@ktbtcthm210"
              class="icon-btn"
              alt="tiktok"
              ><i class="fab fa-tiktok"></i
            ></a>
          </div>
        </div>
        <div class="footer-links" data-aos="fade-up">
          <h3>Liên hệ nhanh</h3>
          <div class="contact-item">
            <i class="fas fa-envelope"></i>
            <span>ducnt21042010@gmail.com</span>
          </div>
          <div class="contact-item">
            <i class="fas fa-phone"></i>
            <span>034 226 6204</span>
          </div>
          <div class="contact-item">
            <i class="fas fa-location-dot"></i>
            <span>THPT Tôn Đức Thắng, Đồng Nai</span>
          </div>
        </div>
        <div class="footer-links" data-aos="fade-left">
          <h4>Đội ngũ DNT</h4>
          <p style="color: #94a3b8">
            "Sáng tạo không ngừng - Vươn tầm tri thức"
          </p>
          <div
            style="
              margin-top: 20px;
              padding: 15px;
              background: rgba(255, 255, 255, 0.05);
              border-radius: 15px;
            "
          >
            <p style="font-size: 0.8rem; color: #fff">
              Dự án được phát triển bởi các thành viên đam mê công nghệ tại Việt
              Nam.
            </p>
          </div>
        </div>
      </div>
      <div class="copyright">
        <p>
          © 2024 EDUMATTER Educational Ecosystem. Designed with
          <i class="fas fa-heart" style="color: #ef4444"></i> by DNT Team.
        </p>
      </div>
    </footer>

    <!-- 
      JAVASCRIPT LOGIC
      Modular, Clean, Commented
    -->
    <script>
      // --- 1. THEME TOGGLE ---
      const themeToggle = document.getElementById("theme-toggle");
      const html = document.documentElement;

      // Check local storage or system preference
      if (
        localStorage.theme === "dark" ||
        (!("theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        html.classList.add("dark");
      } else {
        html.classList.remove("dark");
      }

      themeToggle.addEventListener("click", () => {
        html.classList.toggle("dark");
        localStorage.theme = html.classList.contains("dark") ? "dark" : "light";
      });

      // --- 2. SIMULATION: RATE OF REACTION (CANVAS) ---
      const canvas = document.getElementById("rateCanvas");
      const ctx = canvas.getContext("2d");
      let animationId;
      let time = 0;
      let rateSimRunning = true;

      function drawRateGraph() {
        if (!rateSimRunning) return;

        // Clear Canvas
        ctx.fillStyle = "#0f172a"; // Dark bg
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw Axes
        ctx.strokeStyle = "#94a3b8";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(40, 20);
        ctx.lineTo(40, 220); // Y axis (Rate)
        ctx.lineTo(480, 220); // X axis (Time)
        ctx.stroke();

        // Labels
        ctx.fillStyle = "#94a3b8";
        ctx.font = "12px Arial";
        ctx.fillText("Tốc độ (v)", 10, 20);
        ctx.fillText("Thời gian (t)", 440, 240);

        // Calculate curves (Exponential decay/growth)
        // v_thuan (Starts high, decreases)
        // v_nghich (Starts 0, increases)

        const maxTime = 100; // arbitrary unit to reach equilibrium
        const currentT = Math.min(time, maxTime);

        // Draw Forward Rate (Green/Blue)
        ctx.beginPath();
        ctx.strokeStyle = "#3b82f6";
        ctx.lineWidth = 3;
        for (let t = 0; t <= currentT; t++) {
          let x = 40 + t * 4; // Scale x
          let y = 220 - (180 * Math.exp(-0.05 * t) + 20); // Equation
          if (t === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        ctx.stroke();

        // Draw Reverse Rate (Red)
        ctx.beginPath();
        ctx.strokeStyle = "#ef4444";
        for (let t = 0; t <= currentT; t++) {
          let x = 40 + t * 4;
          let y = 220 - 100 * (1 - Math.exp(-0.05 * t));
          if (t === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        ctx.stroke();

        time += 0.5;

        // Check equilibrium visual
        if (time > 70) {
          document
            .getElementById("equilibriumLabel")
            .classList.remove("hidden");
        } else {
          document.getElementById("equilibriumLabel").classList.add("hidden");
        }

        if (time < 110) {
          animationId = requestAnimationFrame(drawRateGraph);
        }
      }

      function resetRateSim() {
        time = 0;
        cancelAnimationFrame(animationId);
        document.getElementById("equilibriumLabel").classList.add("hidden");
        drawRateGraph();
      }

      // Start Sim 1
      drawRateGraph();

      // --- 3. SIMULATION: PARTICLES (DOM) ---
      const particleContainer = document.getElementById("particleContainer");
      const pCountDisplay = document.getElementById("particleCount");
      const particles = [];

      class Particle {
        constructor(type) {
          this.el = document.createElement("div");
          this.type = type; // 'A' or 'B'
          this.x = Math.random() * 100;
          this.y = Math.random() * 100;
          this.vx = (Math.random() - 0.5) * 1.5;
          this.vy = (Math.random() - 0.5) * 1.5;

          this.el.style.position = "absolute";
          this.el.style.width = "8px";
          this.el.style.height = "8px";
          this.el.style.borderRadius = "50%";
          this.updateColor();
          particleContainer.appendChild(this.el);
        }

        updateColor() {
          this.el.style.backgroundColor =
            this.type === "A" ? "#3b82f6" : "#ef4444";
          this.el.style.boxShadow =
            this.type === "A" ? "0 0 5px #3b82f6" : "0 0 5px #ef4444";
        }

        move() {
          this.x += this.vx;
          this.y += this.vy;

          // Bounce walls
          if (this.x <= 0 || this.x >= 98) this.vx *= -1;
          if (this.y <= 0 || this.y >= 95) this.vy *= -1;

          this.el.style.left = this.x + "%";
          this.el.style.top = this.y + "%";

          // Random conversion (simulating collision reaction)
          if (Math.random() < 0.005) {
            this.type = this.type === "A" ? "B" : "A";
            this.updateColor();
            updateCounts();
          }
        }
      }

      function initParticles() {
        for (let i = 0; i < 20; i++)
          particles.push(new Particle(i < 10 ? "A" : "B"));
        animateParticles();
      }

      function updateCounts() {
        const countA = particles.filter((p) => p.type === "A").length;
        const countB = particles.length - countA;
        pCountDisplay.innerText = `Chất đầu: ${countA} | Sản phẩm: ${countB}`;
      }

      function animateParticles() {
        particles.forEach((p) => p.move());
        requestAnimationFrame(animateParticles);
      }

      initParticles();

      // --- 4. SIMULATION: LE CHATELIER (TEMP) ---
      function updateTempSim(val) {
        const tempVal = document.getElementById("tempValue");
        const flask = document.getElementById("flask");
        const explanation = document.getElementById("tempExplanation");
        const fluid = document.getElementById("thermoFluid");

        tempVal.innerText = val + "°C";
        fluid.style.height = val + "%";

        // Color Logic:
        // Low Temp -> N2O4 (Colorless) dominates -> Lighter Brown
        // High Temp -> NO2 (Brown) dominates -> Darker Brown

        // Opacity maps from 0.1 to 0.9 based on 0-100 val
        const opacity = 0.1 + (val / 100) * 0.8;
        flask.style.backgroundColor = `rgba(165, 42, 42, ${opacity})`;

        if (val < 20) {
          explanation.innerText =
            "Lạnh: Cân bằng dịch chuyển chiều thuận (Toả nhiệt) -> Tạo N2O4 không màu.";
        } else if (val > 60) {
          explanation.innerText =
            "Nóng: Cân bằng dịch chuyển chiều nghịch (Thu nhiệt) -> Tạo NO2 màu nâu.";
        } else {
          explanation.innerText =
            "Nhiệt độ thường: Hỗn hợp cân bằng màu nâu nhạt.";
        }
      }

      // --- 5. SIMULATION: LE CHATELIER (PRESSURE) ---
      const pressureContainer = document.getElementById("pressureParticles");
      const pistonHead = document.getElementById("pistonHead");
      let currentPressureHeight = 0; // 0 = normal, -40 = high pressure

      // Create Dots for pressure sim
      for (let i = 0; i < 12; i++) {
        const dot = document.createElement("div");
        dot.className = "w-2 h-2 rounded-full bg-slate-400 m-auto";
        pressureContainer.appendChild(dot);
      }

      function changePressure(action) {
        const text = document.getElementById("pressureText");

        if (action === "increase") {
          pistonHead.style.top = "40%"; // Push down
          text.innerHTML =
            "Áp suất CAO: Thể tích giảm -> Nồng độ tăng -> Cân bằng tạo NH3 (ít mol khí hơn).";
          // Visualize clustering
          pressureContainer.classList.add("scale-75", "origin-bottom");
        } else {
          pistonHead.style.top = "0%"; // Pull up
          text.innerHTML =
            "Áp suất THẤP: Thể tích tăng -> Cân bằng tạo N2, H2 (nhiều mol khí hơn).";
          pressureContainer.classList.remove("scale-75", "origin-bottom");
        }
      }

      // --- 6. SIMULATION: CONDUCTIVITY ---
      function runConductivityTest(type) {
        const bulb = document.getElementById("bulb");
        const result = document.getElementById("resultText");
        const ions = document.getElementById("ionsContainer");
        const liquid = document.getElementById("solutionLiquid");

        // Reset styles
        bulb.className =
          "w-12 h-12 rounded-full mb-2 transition-all duration-300 shadow-none border-2 border-gray-500 bg-gray-600";
        ions.innerHTML = "";
        ions.style.opacity = "0";

        setTimeout(() => {
          ions.style.opacity = "1";

          switch (type) {
            case "water":
              result.innerHTML =
                "Đèn không sáng. Nước cất là chất điện li cực yếu (coi như không điện li).";
              liquid.className =
                "absolute bottom-0 w-full h-24 bg-blue-200/30 transition-colors";
              break;
            case "salt":
              bulb.classList.add(
                "bg-yellow-400",
                "shadow-[0_0_30px_rgba(250,204,21,1)]",
                "border-yellow-200",
              );
              result.innerHTML =
                "Đèn sáng mạnh! NaCl điện li hoàn toàn ra nhiều ion Na+, Cl-";
              liquid.className =
                "absolute bottom-0 w-full h-24 bg-blue-400/30 transition-colors";
              // Add Ions
              ions.innerHTML =
                '<span class="text-xs font-bold text-purple-600 p-1">Na+</span><span class="text-xs font-bold text-green-600 p-1">Cl-</span>'.repeat(
                  8,
                );
              break;
            case "sugar":
              result.innerHTML =
                "Đèn không sáng. Đường tan nhưng tồn tại dạng phân tử, không tạo ion.";
              liquid.className =
                "absolute bottom-0 w-full h-24 bg-yellow-100/30 transition-colors";
              ions.innerHTML =
                '<span class="text-[10px] bg-white/50 rounded p-1">C12H22O11</span>'.repeat(
                  4,
                );
              break;
            case "weak_acid":
              bulb.classList.add(
                "bg-yellow-600",
                "shadow-[0_0_10px_rgba(202,138,4,0.5)]",
              ); // Dim light
              bulb.classList.remove("bg-gray-600");
              result.innerHTML =
                "Đèn sáng yếu. CH3COOH là chất điện li yếu (ít ion).";
              liquid.className =
                "absolute bottom-0 w-full h-24 bg-transparent transition-colors";
              ions.innerHTML =
                '<span class="text-[10px]">CH3COOH</span>'.repeat(5) +
                '<span class="text-xs text-red-500 font-bold">H+</span>';
              break;
            case "strong_acid":
              bulb.classList.add(
                "bg-yellow-400",
                "shadow-[0_0_30px_rgba(250,204,21,1)]",
              );
              result.innerHTML = "Đèn sáng mạnh! HCl là acid mạnh.";
              ions.innerHTML =
                '<span class="text-xs font-bold text-red-600 p-1">H+</span><span class="text-xs font-bold text-green-600 p-1">Cl-</span>'.repeat(
                  8,
                );
              break;
          }
        }, 100);
      }

      // --- 7. SIMULATION: pH SLIDER ---
      function updatePH(val) {
        const display = document.getElementById("phDisplay");
        const litmus = document.getElementById("litmusResult");
        const phenol = document.getElementById("phenolResult");
        const hConc = document.getElementById("hConcentration");

        // Color logic for display circle
        let color = "";
        if (val < 7)
          color = "#ef4444"; // Red
        else if (val == 7)
          color = "#22c55e"; // Green
        else color = "#3b82f6"; // Blue

        display.style.backgroundColor = color;
        display.innerText = `pH ${val}`;

        // Calc H+
        hConc.innerHTML = `10<sup>-${val}</sup> M`;

        // Indicators
        if (val <= 6) {
          litmus.innerText = "Hoá Đỏ (Acid)";
          litmus.className = "text-red-500 font-bold";
          phenol.innerText = "Không màu";
        } else if (val >= 8) {
          litmus.innerText = "Hoá Xanh (Base)";
          litmus.className = "text-blue-500 font-bold";
          phenol.innerText = "Hoá Hồng";
          phenol.className = "text-pink-500 font-bold";
        } else {
          litmus.innerText = "Không đổi màu (Trung tính)";
          litmus.className = "text-slate-500";
          phenol.innerText = "Không màu";
          phenol.className = "text-slate-500";
        }
      }

      // --- 8. SIMULATION: TITRATION ---
      let titrantVolume = 0;
      const equivalencePoint = 10; // mL

      function addTitrant() {
        if (titrantVolume >= 20) return; // Max limit

        titrantVolume += 1;
        document.getElementById("volUsed").innerText = titrantVolume;

        // Animate Drop
        const drop = document.getElementById("drop");
        drop.style.opacity = "1";
        drop.style.transition = "top 0.5s ease-in, opacity 0.1s";
        drop.style.top = "150px"; // Fall distance

        setTimeout(() => {
          // Reset drop
          drop.style.transition = "none";
          drop.style.opacity = "0";
          drop.style.top = "-16px";

          // Check Color Change
          const flaskLiq = document.getElementById("flaskLiquid");
          const status = document.getElementById("titrationStatus");

          // Logic: NaOH in flask (Pink with Phenol). Add HCl (Acid).
          // At equivalence, Neutral -> Colorless.

          if (titrantVolume >= equivalencePoint) {
            flaskLiq.className =
              "absolute bottom-0 w-full h-16 bg-transparent transition-colors duration-1000"; // Clear
            status.innerText = "Đã đạt điểm tương đương! (Dung dịch mất màu)";
            status.className = "font-bold text-green-500";
          } else {
            // Flash clear then back to pink (simulation of mixing)
            flaskLiq.classList.add("opacity-50");
            setTimeout(() => flaskLiq.classList.remove("opacity-50"), 200);
          }
        }, 500);
      }

      function resetTitration() {
        titrantVolume = 0;
        document.getElementById("volUsed").innerText = "0";
        document.getElementById("titrationStatus").innerText =
          "Chưa đạt điểm tương đương";
        document.getElementById("titrationStatus").className =
          "font-bold text-pink-500";
        document.getElementById("flaskLiquid").className =
          "absolute bottom-0 w-full h-16 bg-pink-500/80 transition-colors duration-1000";
      }

      // --- 9. QUIZ SYSTEM (DATA FROM PROMPT) ---
      const quizData = [
        {
          q: "Phản ứng thuận nghịch là phản ứng xảy ra theo...",
          a: [
            "Một chiều duy nhất",
            "Hai chiều ngược nhau",
            "Chiều thuận khi đun nóng",
            "Chiều nghịch khi làm lạnh",
          ],
          correct: 1,
          expl: "Phản ứng thuận nghịch xảy ra theo hai chiều ngược nhau trong cùng điều kiện.",
        },
        {
          q: "Khi cân bằng hoá học được thiết lập thì...",
          a: [
            "Phản ứng dừng lại",
            "Nồng độ chất sản phẩm lớn hơn chất đầu",
            "Tốc độ phản ứng thuận bằng tốc độ phản ứng nghịch",
            "Nồng độ các chất bằng nhau",
          ],
          correct: 2,
          expl: "Cân bằng hoá học là cân bằng động, vt = vn.",
        },
        {
          q: "Yếu tố nào KHÔNG làm chuyển dịch cân bằng?",
          a: ["Nhiệt độ", "Áp suất", "Nồng độ", "Chất xúc tác"],
          correct: 3,
          expl: "Chất xúc tác chỉ làm tăng tốc độ phản ứng (cả thuận và nghịch) giúp nhanh đạt cân bằng chứ không làm chuyển dịch.",
        },
        {
          q: "Dung dịch nào sau đây dẫn điện tốt nhất?",
          a: ["Nước cất", "Dung dịch NaCl", "Dung dịch Đường", "Rượu Ethanol"],
          correct: 1,
          expl: "NaCl là chất điện li mạnh, phân li hoàn toàn thành ion dẫn điện.",
        },
        {
          q: "pH của dung dịch acid mạnh (như HCl 0.1M) khoảng bao nhiêu?",
          a: ["pH > 7", "pH = 7", "pH < 7", "pH = 14"],
          correct: 2,
          expl: "Môi trường Acid có pH < 7.",
        },
      ];

      let currentQuestion = 0;
      let score = 0;

      function startQuiz() {
        currentQuestion = 0;
        score = 0;
        document.getElementById("quizProgress").style.width = "0%";
        loadQuestion();
      }

      function loadQuestion() {
        if (currentQuestion >= quizData.length) {
          // End Quiz
          document.getElementById("questionText").innerHTML =
            `Hoàn thành! <br> Điểm của bạn: ${score}/${quizData.length}`;
          document.getElementById("answersContainer").innerHTML = `
                    <button onclick="startQuiz()" class="px-6 py-3 bg-blue-600 text-white rounded-full mx-auto block">Làm lại</button>
                `;
          return;
        }

        const data = quizData[currentQuestion];
        document.getElementById("questionText").innerText = data.q;

        const container = document.getElementById("answersContainer");
        container.innerHTML = ""; // Clear prev answers

        data.a.forEach((ans, index) => {
          const btn = document.createElement("button");
          btn.className =
            "w-full p-4 rounded-xl bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 font-semibold border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-700 text-left transition relative overflow-hidden group";
          btn.innerHTML = `<span class="inline-block w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-600 text-center leading-8 mr-3 text-sm">${String.fromCharCode(65 + index)}</span> ${ans}`;
          btn.onclick = () => checkAnswer(index);
          container.appendChild(btn);
        });

        // Update bar
        const pct = (currentQuestion / quizData.length) * 100;
        document.getElementById("quizProgress").style.width = pct + "%";
      }

      function checkAnswer(index) {
        const data = quizData[currentQuestion];
        const overlay = document.getElementById("feedbackOverlay");
        const icon = document.getElementById("feedbackIcon");
        const title = document.getElementById("feedbackTitle");
        const desc = document.getElementById("feedbackDesc");

        overlay.classList.remove("hidden");
        overlay.classList.add("flex"); // Show overlay

        if (index === data.correct) {
          score++;
          icon.innerHTML = "🎉";
          title.innerText = "Chính xác!";
          title.className = "text-2xl font-bold text-green-400 mb-2";
        } else {
          icon.innerHTML = "🤔";
          title.innerText = "Tiếc quá!";
          title.className = "text-2xl font-bold text-red-400 mb-2";
        }
        desc.innerText = data.expl;
      }

      function nextQuestion() {
        document.getElementById("feedbackOverlay").classList.add("hidden");
        document.getElementById("feedbackOverlay").classList.remove("flex");
        currentQuestion++;
        loadQuestion();
      }

      // Initialize simulations on load
      window.addEventListener("load", () => {
        initParticles();
        runConductivityTest(""); // Init state
      });
    </script>
  </body>
</html>
