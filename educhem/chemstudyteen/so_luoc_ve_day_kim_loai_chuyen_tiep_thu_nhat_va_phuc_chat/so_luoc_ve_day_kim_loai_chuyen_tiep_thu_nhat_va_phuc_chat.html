<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChemStudy Teen - Chương 8</title>
    <link rel="icon" href="../../../favicon/educhem.svg" type="image/svg+xml" />

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind Config for Dark Mode -->
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              sans: ['"Be Vietnam Pro"', "sans-serif"],
            },
            colors: {
              chem: {
                primary: "#0ea5e9", // Sky 500
                secondary: "#8b5cf6", // Violet 500
                dark: "#0f172a", // Slate 900
                light: "#f8fafc", // Slate 50
                glass: "rgba(255, 255, 255, 0.1)",
              },
            },
            animation: {
              float: "float 6s ease-in-out infinite",
              "pulse-slow": "pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite",
            },
            keyframes: {
              float: {
                "0%, 100%": { transform: "translateY(0)" },
                "50%": { transform: "translateY(-20px)" },
              },
            },
          },
        },
      };
    </script>

    <style>
      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      .dark ::-webkit-scrollbar-thumb {
        background: #475569;
      }
      .dark ::-webkit-scrollbar-track {
        background: #0f172a;
      }

      /* Glassmorphism Classes */
      .glass-panel {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
      .dark .glass-panel {
        background: rgba(30, 41, 59, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      /* 3D Canvas Container */
      #atom-canvas-container,
      #complex-canvas-container {
        width: 100%;
        height: 400px;
        position: relative;
        overflow: hidden;
        border-radius: 1rem;
      }

      /* Reaction Container */
      .beaker {
        border: 3px solid rgba(200, 200, 200, 0.5);
        border-top: none;
        border-radius: 0 0 20px 20px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s;
      }
      .liquid {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        transition: height 1s ease-in-out, background-color 0.8s ease;
      }
      .ppt {
        /* Kết tủa */
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 20px;
        opacity: 0;
        transition: opacity 1s, background-color 0.8s;
        filter: blur(1px);
      }
      /* Mobile handling */
      @media (max-width: 768px) {
        .mobile-hide {
          display: none;
        }
      }
    </style>
  </head>
  <body
    class="bg-chem-light text-slate-800 dark:bg-chem-dark dark:text-slate-100 transition-colors duration-300 font-sans min-h-screen"
  >
    <!-- NAVIGATION (Sticky Top) -->
    <nav
      class="fixed top-0 left-0 w-full z-50 glass-panel shadow-sm transition-all duration-300"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <!-- Left: Logo & Back -->
          <div class="flex items-center space-x-4">
            <a
              href="../chemstudyteen.html"
              class="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition group"
              title="Quay về"
            >
              <i
                class="fa-solid fa-arrow-left text-xl group-hover:-translate-x-1 transition-transform"
              ></i>
            </a>
            <div class="flex items-center gap-2">
              <i
                class="fa-solid fa-flask text-chem-primary text-2xl animate-pulse-slow"
              ></i>
              <span class="font-bold text-xl tracking-tight hidden sm:block"
                >ChemStudy <span class="text-chem-primary">Teen</span></span
              >
            </div>
          </div>

          <!-- Center: Menu -->
          <div class="hidden md:flex space-x-1">
            <a
              href="#elements"
              class="px-3 py-2 rounded-lg hover:bg-black/5 dark:hover:bg-white/5 transition font-medium text-sm"
              >Nguyên Tố & 3D</a
            >
            <a
              href="#properties"
              class="px-3 py-2 rounded-lg hover:bg-black/5 dark:hover:bg-white/5 transition font-medium text-sm"
              >Màu Sắc</a
            >
            <a
              href="#complexes"
              class="px-3 py-2 rounded-lg hover:bg-black/5 dark:hover:bg-white/5 transition font-medium text-sm"
              >Phức Chất</a
            >
            <a
              href="#lab"
              class="px-3 py-2 rounded-lg bg-chem-primary/10 text-chem-primary hover:bg-chem-primary/20 transition font-bold text-sm"
              >Phòng Thí Nghiệm</a
            >
            <a
              href="#applications"
              class="px-3 py-2 rounded-lg hover:bg-black/5 dark:hover:bg-white/5 transition font-medium text-sm"
              >Ứng Dụng</a
            >
          </div>

          <!-- Right: Theme Toggle -->
          <button
            id="theme-toggle"
            class="p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition text-yellow-500 dark:text-yellow-300"
          >
            <i class="fa-solid fa-sun text-xl dark:hidden"></i>
            <i class="fa-solid fa-moon text-xl hidden dark:block"></i>
          </button>
        </div>
      </div>
      <!-- Mobile Menu -->
      <div
        class="md:hidden flex overflow-x-auto px-4 py-2 gap-2 scrollbar-hide border-t border-gray-200 dark:border-gray-700"
      >
        <a
          href="#elements"
          class="whitespace-nowrap px-3 py-1 rounded-full bg-gray-200 dark:bg-gray-800 text-sm"
          >Nguyên Tố</a
        >
        <a
          href="#properties"
          class="whitespace-nowrap px-3 py-1 rounded-full bg-gray-200 dark:bg-gray-800 text-sm"
          >Màu Sắc</a
        >
        <a
          href="#complexes"
          class="whitespace-nowrap px-3 py-1 rounded-full bg-gray-200 dark:bg-gray-800 text-sm"
          >Phức Chất</a
        >
        <a
          href="#lab"
          class="whitespace-nowrap px-3 py-1 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 text-sm font-bold"
          >Thí Nghiệm</a
        >
      </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto space-y-20">
      <!-- HERO SECTION -->
      <header class="text-center space-y-4 animate-float relative">
        <span
          class="inline-block py-1 px-3 rounded-full bg-chem-secondary/20 text-chem-secondary text-sm font-bold tracking-wider"
          >HÓA HỌC 12 - CHƯƠNG 8</span
        >
        <h1
          class="text-4xl md:text-6xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-chem-primary to-chem-secondary pb-2"
        >
          Kim Loại Chuyển Tiếp<br />& Phức Chất
        </h1>
        <p class="max-w-2xl mx-auto text-gray-600 dark:text-gray-300 text-lg">
          Khám phá cấu hình electron, màu sắc ion, phức chất và ứng dụng thực
          tiễn của dãy kim loại chuyển tiếp thứ nhất (Sc → Zn).
        </p>
      </header>

      <!-- SECTION 1: 3D ELEMENTS (SIMULATIONS 1-10) -->
      <section id="elements" class="scroll-mt-24">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-1.5 h-8 bg-chem-primary rounded-full"></div>
          <h2 class="text-2xl font-bold">
            I. Đại Cương & Mô Hình Nguyên Tử 3D
          </h2>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- Left: Control Panel -->
          <div
            class="lg:col-span-1 glass-panel rounded-2xl p-6 shadow-lg h-fit"
          >
            <h3 class="font-bold text-lg mb-4 text-chem-primary">
              Chọn Nguyên Tố (Z = 21 → 30)
            </h3>
            <div class="grid grid-cols-5 gap-2 mb-6">
              <button
                onclick="loadElement(21)"
                class="elem-btn p-2 rounded bg-gray-200 dark:bg-gray-700 hover:bg-chem-primary hover:text-white transition text-center text-xs font-bold ring-2 ring-transparent focus:ring-chem-secondary"
                id="btn-21"
              >
                Sc<br />21
              </button>
              <button
                onclick="loadElement(22)"
                class="elem-btn p-2 rounded bg-gray-200 dark:bg-gray-700 hover:bg-chem-primary hover:text-white transition text-center text-xs font-bold"
                id="btn-22"
              >
                Ti<br />22
              </button>
              <button
                onclick="loadElement(23)"
                class="elem-btn p-2 rounded bg-gray-200 dark:bg-gray-700 hover:bg-chem-primary hover:text-white transition text-center text-xs font-bold"
                id="btn-23"
              >
                V<br />23
              </button>
              <button
                onclick="loadElement(24)"
                class="elem-btn p-2 rounded bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 border border-yellow-500 hover:bg-yellow-500 hover:text-white transition text-center text-xs font-bold"
                id="btn-24"
                title="Cấu hình đặc biệt"
              >
                Cr<br />24
              </button>
              <button
                onclick="loadElement(25)"
                class="elem-btn p-2 rounded bg-gray-200 dark:bg-gray-700 hover:bg-chem-primary hover:text-white transition text-center text-xs font-bold"
                id="btn-25"
              >
                Mn<br />25
              </button>
              <button
                onclick="loadElement(26)"
                class="elem-btn p-2 rounded bg-gray-200 dark:bg-gray-700 hover:bg-chem-primary hover:text-white transition text-center text-xs font-bold"
                id="btn-26"
              >
                Fe<br />26
              </button>
              <button
                onclick="loadElement(27)"
                class="elem-btn p-2 rounded bg-gray-200 dark:bg-gray-700 hover:bg-chem-primary hover:text-white transition text-center text-xs font-bold"
                id="btn-27"
              >
                Co<br />27
              </button>
              <button
                onclick="loadElement(28)"
                class="elem-btn p-2 rounded bg-gray-200 dark:bg-gray-700 hover:bg-chem-primary hover:text-white transition text-center text-xs font-bold"
                id="btn-28"
              >
                Ni<br />28
              </button>
              <button
                onclick="loadElement(29)"
                class="elem-btn p-2 rounded bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 border border-yellow-500 hover:bg-yellow-500 hover:text-white transition text-center text-xs font-bold"
                id="btn-29"
                title="Cấu hình đặc biệt"
              >
                Cu<br />29
              </button>
              <button
                onclick="loadElement(30)"
                class="elem-btn p-2 rounded bg-gray-200 dark:bg-gray-700 hover:bg-chem-primary hover:text-white transition text-center text-xs font-bold"
                id="btn-30"
              >
                Zn<br />30
              </button>
            </div>

            <div
              id="element-info"
              class="space-y-3 transition-opacity duration-300"
            >
              <h2 class="text-4xl font-bold text-chem-secondary" id="el-symbol">
                Sc
              </h2>
              <h3 class="text-xl font-medium" id="el-name">Scandium</h3>
              <div
                class="p-3 bg-black/5 dark:bg-white/5 rounded-lg font-mono text-sm text-chem-primary font-bold"
                id="el-config"
              >
                [Ar] 3d¹ 4s²
              </div>
              <div class="space-y-2 text-sm text-gray-600 dark:text-gray-300">
                <p>
                  <strong class="text-chem-primary">Đặc điểm:</strong>
                  <span id="el-desc"
                    >Kim loại chuyển tiếp đầu tiên. Ion Sc³⁺ không màu.</span
                  >
                </p>
                <p>
                  <strong class="text-green-600 dark:text-green-400"
                    >Ứng dụng:</strong
                  >
                  <span id="el-app">Hợp kim nhôm-scandium.</span>
                </p>
              </div>
              <div
                class="text-xs text-gray-500 mt-2 italic border-t border-gray-200 dark:border-gray-700 pt-2"
              >
                Lớp d chưa đầy (d¹-d⁹) gây ra tính thuận từ, nhiều số oxi hóa và
                ion có màu.
              </div>
            </div>
          </div>

          <!-- Right: 3D Visualization -->
          <div
            class="lg:col-span-2 glass-panel rounded-2xl p-1 shadow-lg relative"
          >
            <div
              id="atom-canvas-container"
              class="bg-gradient-to-br from-gray-900 to-black rounded-xl"
            ></div>
            <div
              class="absolute bottom-4 right-4 bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur"
            >
              <i class="fa-solid fa-mouse pointer-events-none"></i> Xoay & Zoom
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION 2: PROPERTIES & COLORS -->
      <section id="properties" class="scroll-mt-24">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-1.5 h-8 bg-pink-500 rounded-full"></div>
          <h2 class="text-2xl font-bold">
            II. Trạng Thái Oxi Hóa & Màu Sắc Ion
          </h2>
        </div>

        <div class="glass-panel p-6 rounded-2xl shadow-lg">
          <p class="mb-6 text-gray-600 dark:text-gray-300">
            Màu sắc đặc trưng đến từ sự chuyển mức năng lượng electron d-d trong
            orbital d bị tách mức.
          </p>

          <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
            <!-- Vanadium Series -->
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-purple-600 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">V²⁺</h4>
              <p class="text-xs text-gray-500">Tím</p>
            </div>
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-green-600 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">V³⁺</h4>
              <p class="text-xs text-gray-500">Xanh Lục</p>
            </div>
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-blue-600 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">VO²⁺ (V⁴⁺)</h4>
              <p class="text-xs text-gray-500">Xanh Dương</p>
            </div>
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-yellow-400 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">VO₂⁺ (V⁵⁺)</h4>
              <p class="text-xs text-gray-500">Vàng</p>
            </div>

            <!-- Chromium -->
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-green-500 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">Cr³⁺</h4>
              <p class="text-xs text-gray-500">Xanh Lục</p>
            </div>
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-orange-500 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">Cr₂O₇²⁻</h4>
              <p class="text-xs text-gray-500">Da Cam</p>
            </div>

            <!-- Manganese -->
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-pink-200 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">Mn²⁺</h4>
              <p class="text-xs text-gray-500">Hồng Nhạt</p>
            </div>
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-purple-900 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">MnO₄⁻</h4>
              <p class="text-xs text-gray-500">Tím Đậm</p>
            </div>

            <!-- Iron -->
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-green-300 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">Fe²⁺</h4>
              <p class="text-xs text-gray-500">Xanh Lục</p>
            </div>
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-yellow-600 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">Fe³⁺</h4>
              <p class="text-xs text-gray-500">Vàng Nâu</p>
            </div>

            <!-- Others -->
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-pink-500 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">Co²⁺</h4>
              <p class="text-xs text-gray-500">Hồng</p>
            </div>
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-green-500 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">Ni²⁺</h4>
              <p class="text-xs text-gray-500">Xanh Lá</p>
            </div>
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-blue-600 mx-auto mb-2 shadow-lg"
              ></div>
              <h4 class="font-bold text-sm">Cu²⁺</h4>
              <p class="text-xs text-gray-500">Xanh Lam</p>
            </div>
            <div
              class="color-card bg-white dark:bg-slate-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 text-center"
            >
              <div
                class="h-10 w-10 rounded-full bg-slate-100 mx-auto mb-2 shadow-lg border border-gray-300"
              ></div>
              <h4 class="font-bold text-sm">Zn²⁺</h4>
              <p class="text-xs text-gray-500">Không Màu</p>
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION 3: COMPLEXES & GEOMETRY (SIMULATIONS 11-14) -->
      <section id="complexes" class="scroll-mt-24">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-1.5 h-8 bg-chem-secondary rounded-full"></div>
          <h2 class="text-2xl font-bold">III. Phức Chất & Hình Học 3D</h2>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div class="lg:col-span-1 space-y-4">
            <div class="glass-panel p-6 rounded-2xl shadow-lg">
              <h3 class="font-bold text-lg mb-4 text-chem-secondary">
                Thành Phần & Cấu Tạo
              </h3>
              <ul
                class="text-sm space-y-2 mb-4 text-gray-600 dark:text-gray-300"
              >
                <li>
                  • <strong>Ion trung tâm:</strong> Thường là kim loại chuyển
                  tiếp (Cu²⁺, Fe³⁺...).
                </li>
                <li>
                  • <strong>Ligand (L):</strong> Phân tử/ion cho cặp e (NH₃,
                  H₂O, Cl⁻, CN⁻, EDTA).
                </li>
                <li>• <strong>Số phối trí:</strong> Thường là 4 hoặc 6.</li>
              </ul>
              <h3 class="font-bold text-lg mb-2 text-chem-secondary">
                Chọn Dạng Hình Học
              </h3>
              <div class="space-y-2">
                <button
                  onclick="loadComplex('octahedral')"
                  class="w-full text-left p-3 rounded-lg bg-white/50 dark:bg-black/20 hover:bg-chem-secondary hover:text-white transition flex items-center justify-between group complex-btn active"
                >
                  <span>Bát diện (6)</span>
                  <i
                    class="fa-solid fa-cube text-xs opacity-50 group-hover:opacity-100"
                  ></i>
                </button>
                <button
                  onclick="loadComplex('squarePlanar')"
                  class="w-full text-left p-3 rounded-lg bg-white/50 dark:bg-black/20 hover:bg-chem-secondary hover:text-white transition flex items-center justify-between group complex-btn"
                >
                  <span>Vuông phẳng (4)</span>
                  <i
                    class="fa-regular fa-square text-xs opacity-50 group-hover:opacity-100"
                  ></i>
                </button>
                <button
                  onclick="loadComplex('tetrahedral')"
                  class="w-full text-left p-3 rounded-lg bg-white/50 dark:bg-black/20 hover:bg-chem-secondary hover:text-white transition flex items-center justify-between group complex-btn"
                >
                  <span>Tứ diện (4)</span>
                  <i
                    class="fa-solid fa-shapes text-xs opacity-50 group-hover:opacity-100"
                  ></i>
                </button>
                <button
                  onclick="loadComplex('linear')"
                  class="w-full text-left p-3 rounded-lg bg-white/50 dark:bg-black/20 hover:bg-chem-secondary hover:text-white transition flex items-center justify-between group complex-btn"
                >
                  <span>Thẳng (2)</span>
                  <i
                    class="fa-solid fa-arrows-left-right text-xs opacity-50 group-hover:opacity-100"
                  ></i>
                </button>
              </div>
            </div>

            <div class="glass-panel p-6 rounded-2xl shadow-lg">
              <h4 class="font-bold text-sm text-gray-500 uppercase mb-2">
                Thông tin chi tiết
              </h4>
              <div id="complex-info">
                <h3 class="text-xl font-bold text-chem-secondary">Bát diện</h3>
                <p class="text-sm mt-2">
                  Ví dụ: [Cu(H₂O)₆]²⁺ (xanh lam), [Fe(CN)₆]³⁻.
                </p>
              </div>
            </div>
          </div>

          <div
            class="lg:col-span-2 glass-panel p-1 rounded-2xl shadow-lg relative"
          >
            <div
              id="complex-canvas-container"
              class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl"
            ></div>
            <div
              class="absolute top-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm backdrop-blur"
            >
              Mô phỏng Phân Tử
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION 4: VIRTUAL LAB (SIMULATIONS 15-25) -->
      <section id="lab" class="scroll-mt-24">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-1.5 h-8 bg-green-500 rounded-full"></div>
          <h2 class="text-2xl font-bold">
            IV. Phòng Thí Nghiệm Ảo (Thí Nghiệm Tiêu Biểu)
          </h2>
        </div>

        <div
          class="glass-panel p-0 rounded-2xl shadow-2xl overflow-hidden border border-green-500/30"
        >
          <!-- Lab Toolbar -->
          <div
            class="bg-gray-100 dark:bg-gray-800 p-4 border-b border-gray-200 dark:border-gray-700 flex flex-wrap gap-4 items-center justify-between"
          >
            <span class="font-bold text-green-600 dark:text-green-400"
              ><i class="fa-solid fa-flask-vial mr-2"></i>Chọn Phản Ứng:</span
            >
            <select
              id="reaction-selector"
              onchange="setupExperiment()"
              class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500 w-full md:w-auto"
            >
              <option value="none">-- Chọn thí nghiệm --</option>
              <optgroup label="Tạo phức chất (Sự đổi màu)">
                <option value="CuOH2_NH3">
                  1. Cu²⁺ + NH₃ (Tạo phức xanh thẫm)
                </option>
                <option value="AgCl_NH3">
                  2. AgCl + NH₃ (Phức Tollens tan)
                </option>
                <option value="Fe3_SCN">3. Fe³⁺ + SCN⁻ (Phức đỏ máu)</option>
              </optgroup>
              <optgroup label="Nhận biết & Oxi hóa khử">
                <option value="Ni_DMG">4. Ni²⁺ + DMG (Kết tủa đỏ tươi)</option>
                <option value="Fe2_Oxidation">
                  5. Fe²⁺ + Br₂ (Oxi hóa lên Fe³⁺)
                </option>
                <option value="MnO4_Redox">
                  6. MnO₄⁻ + Fe²⁺/H⁺ (Mất màu tím)
                </option>
                <option value="Cr2O7_Ba">
                  7. Cr₂O₇²⁻ + Ba²⁺ (Kết tủa vàng)
                </option>
                <option value="Cu_Identification">
                  8. Nhận biết Cu²⁺ (Kết tủa xanh)
                </option>
              </optgroup>
            </select>
            <button
              onclick="resetLab()"
              class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded text-sm font-bold transition"
            >
              <i class="fa-solid fa-rotate-right mr-1"></i> Làm lại
            </button>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 min-h-[500px]">
            <!-- Reaction Area -->
            <div
              class="relative bg-gradient-to-b from-gray-200 to-gray-300 dark:from-gray-800 dark:to-gray-900 p-8 flex flex-col items-center justify-end"
            >
              <!-- Beaker -->
              <div
                class="relative w-48 h-64 beaker bg-white/10 glass border-b-4 border-white/20"
              >
                <!-- Liquid -->
                <div id="lab-liquid" class="liquid h-0 bg-transparent"></div>
                <!-- Precipitate -->
                <div id="lab-ppt" class="ppt bg-transparent"></div>

                <!-- Stirrer (Visual only) -->
                <div
                  class="absolute bottom-2 left-1/2 transform -translate-x-1/2 w-16 h-2 bg-white/20 rounded-full blur-sm"
                ></div>
              </div>

              <div
                class="mt-4 w-full h-4 bg-black/20 rounded-full blur-md"
              ></div>
              <!-- Shadow -->

              <!-- Dropper Animation (Hidden by default) -->
              <div
                id="dropper"
                class="absolute top-10 left-1/2 transform -translate-x-1/2 transition-all duration-500 opacity-0 -translate-y-10 z-10"
              >
                <div
                  class="w-4 h-24 bg-gray-300 border border-gray-400 mx-auto rounded-t-lg relative"
                >
                  <div
                    class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-1 h-3 bg-gray-300"
                  ></div>
                </div>
                <div
                  class="w-8 h-12 bg-red-400 rounded-t-full -mt-2 mx-auto cursor-pointer active:scale-90 transition transform"
                  onclick="addReagent()"
                ></div>
                <!-- Drop -->
                <div
                  id="lab-drop"
                  class="w-3 h-3 rounded-full bg-blue-500 absolute bottom-[-10px] left-1/2 -translate-x-1/2 opacity-0"
                ></div>
              </div>
            </div>

            <!-- Info & Action Panel -->
            <div
              class="bg-white dark:bg-slate-800 p-8 flex flex-col justify-center border-l border-gray-200 dark:border-gray-700"
            >
              <div id="lab-instructions" class="text-center">
                <div class="text-6xl text-gray-300 mb-4">
                  <i class="fa-solid fa-flask"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">
                  Phòng Thí Nghiệm Đang Chờ
                </h3>
                <p class="text-gray-500">
                  Vui lòng chọn phản ứng từ menu thả xuống ở trên để bắt đầu.
                </p>
              </div>

              <div id="lab-content" class="hidden space-y-6">
                <div>
                  <h3
                    class="text-2xl font-bold text-chem-primary mb-1"
                    id="react-name"
                  >
                    Tên Phản Ứng
                  </h3>
                  <p
                    class="font-mono text-sm bg-gray-100 dark:bg-black/30 p-2 rounded border border-gray-200 dark:border-gray-600 break-words"
                    id="react-eq"
                  >
                    Equation
                  </p>
                </div>

                <div class="space-y-4">
                  <div
                    class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"
                  >
                    <span class="font-bold"
                      ><i class="fa-solid fa-vial mr-2 text-blue-500"></i>Dung
                      dịch có sẵn:</span
                    >
                    <span id="reagent-1" class="text-blue-500 font-bold"
                      >CuSO₄</span
                    >
                  </div>
                  <div class="flex items-center justify-center">
                    <i class="fa-solid fa-plus text-gray-400"></i>
                  </div>
                  <div
                    class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"
                  >
                    <span class="font-bold"
                      ><i class="fa-solid fa-eye-dropper mr-2 text-red-500"></i
                      >Thuốc thử thêm vào:</span
                    >
                    <span id="reagent-2" class="text-red-500 font-bold"
                      >NaOH</span
                    >
                  </div>
                </div>

                <button
                  id="btn-add-reagent"
                  onclick="startReaction()"
                  class="w-full py-4 bg-green-600 hover:bg-green-500 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-green-500/30 transition transform active:scale-95 flex items-center justify-center gap-2"
                >
                  <i class="fa-solid fa-flask"></i> THỰC HIỆN PHẢN ỨNG
                </button>

                <div
                  id="lab-result"
                  class="hidden p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg animate-fade-in"
                >
                  <h4
                    class="font-bold text-yellow-700 dark:text-yellow-400 mb-1"
                  >
                    <i class="fa-solid fa-check-circle mr-1"></i> Hiện tượng:
                  </h4>
                  <p
                    id="result-text"
                    class="text-sm text-gray-700 dark:text-gray-300"
                  >
                    Kết tủa xanh xuất hiện.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION 5: APPLICATIONS -->
      <section id="applications" class="scroll-mt-24 mb-16">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-1.5 h-8 bg-orange-500 rounded-full"></div>
          <h2 class="text-2xl font-bold">V. Ứng Dụng Thực Tiễn & Phức Chất</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <div
            class="glass-panel p-6 rounded-2xl hover:bg-white/50 dark:hover:bg-black/20 transition group"
          >
            <div
              class="h-12 w-12 rounded-lg bg-orange-100 dark:bg-orange-900/50 flex items-center justify-center mb-4 text-orange-600 dark:text-orange-400 group-hover:scale-110 transition"
            >
              <i class="fa-solid fa-vial-virus text-2xl"></i>
            </div>
            <h3 class="font-bold text-lg mb-2">Phân Tích Định Tính</h3>
            <p class="text-sm text-gray-600 dark:text-gray-300">
              Nhận biết ion kim loại dựa vào màu sắc đặc trưng của phức chất. Ví
              dụ: Fe³⁺ với SCN⁻ (đỏ máu), Ni²⁺ với DMG (đỏ tươi).
            </p>
          </div>

          <div
            class="glass-panel p-6 rounded-2xl hover:bg-white/50 dark:hover:bg-black/20 transition group"
          >
            <div
              class="h-12 w-12 rounded-lg bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center mb-4 text-blue-600 dark:text-blue-400 group-hover:scale-110 transition"
            >
              <i class="fa-solid fa-heart-pulse text-2xl"></i>
            </div>
            <h3 class="font-bold text-lg mb-2">Y Học & Sinh Học</h3>
            <p class="text-sm text-gray-600 dark:text-gray-300">
              - <strong>Cis-platin:</strong> [Pt(NH₃)₂Cl₂] điều trị ung thư.<br />
              - <strong>Hemoglobin:</strong> Phức Fe²⁺ vận chuyển O₂ trong máu.
            </p>
          </div>

          <div
            class="glass-panel p-6 rounded-2xl hover:bg-white/50 dark:hover:bg-black/20 transition group"
          >
            <div
              class="h-12 w-12 rounded-lg bg-green-100 dark:bg-green-900/50 flex items-center justify-center mb-4 text-green-600 dark:text-green-400 group-hover:scale-110 transition"
            >
              <i class="fa-solid fa-industry text-2xl"></i>
            </div>
            <h3 class="font-bold text-lg mb-2">Công Nghiệp</h3>
            <p class="text-sm text-gray-600 dark:text-gray-300">
              - <strong>Mạ điện:</strong> Dùng phức cyanua của Ag, Au, Cu.<br />
              - <strong>Xúc tác:</strong> Fe trong tổng hợp NH₃, Ni trong hydro
              hóa dầu.
            </p>
          </div>

          <div
            class="glass-panel p-6 rounded-2xl hover:bg-white/50 dark:hover:bg-black/20 transition group"
          >
            <div
              class="h-12 w-12 rounded-lg bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-4 text-gray-600 dark:text-gray-400 group-hover:scale-110 transition"
            >
              <i class="fa-solid fa-wand-magic-sparkles text-2xl"></i>
            </div>
            <h3 class="font-bold text-lg mb-2">Thuốc thử Tollens</h3>
            <p class="text-sm text-gray-600 dark:text-gray-300">
              Phức [Ag(NH₃)₂]⁺ dùng để tráng bạc gương soi và kiểm tra aldehyde
              (phản ứng tráng gương).
            </p>
          </div>
          <div
            class="glass-panel p-6 rounded-2xl hover:bg-white/50 dark:hover:bg-black/20 transition group"
          >
            <div
              class="h-12 w-12 rounded-lg bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center mb-4 text-purple-600 dark:text-purple-400 group-hover:scale-110 transition"
            >
              <i class="fa-solid fa-shield-virus text-2xl"></i>
            </div>
            <h3 class="font-bold text-lg mb-2">Hấp thụ khí độc</h3>
            <p class="text-sm text-gray-600 dark:text-gray-300">
              Các phức chất có khả năng liên kết với khí độc (như CO, NO) giúp
              lọc không khí hoặc giải độc.
            </p>
          </div>
        </div>
      </section>
    </main>

    <!-- SCRIPTS -->
    <script>
      // --- 1. THEME TOGGLE ---
      const themeToggle = document.getElementById("theme-toggle");
      const html = document.documentElement;

      if (
        localStorage.theme === "dark" ||
        (!("theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        html.classList.add("dark");
      } else {
        html.classList.remove("dark");
      }

      themeToggle.addEventListener("click", () => {
        html.classList.toggle("dark");
        localStorage.theme = html.classList.contains("dark") ? "dark" : "light";
      });

      // --- 2. DATASETS (Full data as requested) ---
      const elementsData = {
        21: {
          symbol: "Sc",
          name: "Scandium",
          config: "[Ar] 3d¹ 4s²",
          desc: "Kim loại nhẹ. Ion Sc³⁺ không màu.",
          app: "Hợp kim nhôm-scandium (vỏ máy bay, gậy bóng chày).",
          color: 0xaaaaaa,
        },
        22: {
          symbol: "Ti",
          name: "Titanium",
          config: "[Ar] 3d² 4s²",
          desc: "Bền, nhẹ, nóng chảy cao. Ti³⁺ màu tím.",
          app: "Hợp kim chịu nhiệt, khung máy bay, y tế.",
          color: 0x9ca3af,
        },
        23: {
          symbol: "V",
          name: "Vanadium",
          config: "[Ar] 3d³ 4s²",
          desc: "Đa dạng số oxi hóa với màu sặc sỡ (Tím, Lục, Xanh dương, Vàng).",
          app: "Hợp kim thép siêu bền, xúc tác.",
          color: 0xef4444,
        },
        24: {
          symbol: "Cr",
          name: "Chromium",
          config: "[Ar] 3d⁵ 4s¹",
          desc: "Rất cứng. Ion Cr³⁺ (Lục), Cr₂O₇²⁻ (Da cam).",
          app: "Thép không gỉ, mạ chrome, hợp kim chịu nhiệt.",
          color: 0x22d3ee,
        },
        25: {
          symbol: "Mn",
          name: "Manganese",
          config: "[Ar] 3d⁵ 4s²",
          desc: "Mn²⁺ hồng nhạt, MnO₄⁻ tím đậm.",
          app: "Thép Mn chịu mài mòn, pin khô.",
          color: 0xc084fc,
        },
        26: {
          symbol: "Fe",
          name: "Iron",
          config: "[Ar] 3d⁶ 4s²",
          desc: "Vua công nghiệp. Fe²⁺ (Lục), Fe³⁺ (Vàng nâu). Có từ tính.",
          app: "Thép, xây dựng, máy móc.",
          color: 0xea580c,
        },
        27: {
          symbol: "Co",
          name: "Cobalt",
          config: "[Ar] 3d⁷ 4s²",
          desc: "Từ tính mạnh. Co²⁺ (Hồng).",
          app: "Nam châm vĩnh cửu, pin Li-ion, xúc tác.",
          color: 0x3b82f6,
        },
        28: {
          symbol: "Ni",
          name: "Nickel",
          config: "[Ar] 3d⁸ 4s²",
          desc: "Từ tính. Ni²⁺ (Xanh lá).",
          app: "Pin sạc, tiền xu, xúc tác hydro hóa.",
          color: 0x10b981,
        },
        29: {
          symbol: "Cu",
          name: "Copper",
          config: "[Ar] 3d¹⁰ 4s¹",
          desc: "Dẫn điện tốt. Cu²⁺ (Xanh lam).",
          app: "Dây điện, đồng thau, đồng đỏ.",
          color: 0xf97316,
        },
        30: {
          symbol: "Zn",
          name: "Zinc",
          config: "[Ar] 3d¹⁰ 4s²",
          desc: "Zn²⁺ không màu.",
          app: "Mạ chống gỉ (tôn), pin Zn-C.",
          color: 0x94a3b8,
        },
      };

      const experimentsData = {
        CuOH2_NH3: {
          name: "Cu(OH)₂ + NH₃",
          eq: "Cu(OH)₂ + 4NH₃ → [Cu(NH₃)₄]²⁺ (Xanh thẫm)",
          r1: "Cu(OH)₂ (Kết tủa xanh)",
          r2: "NH₃ (dư)",
          lColor: "#0ea5e9",
          endColor: "#1e3a8a",
          ppt: false,
          res: "Kết tủa tan, dung dịch chuyển sang màu Xanh Thẫm đặc trưng.",
        },
        AgCl_NH3: {
          name: "AgCl + NH₃ (Tollens)",
          eq: "AgCl + 2NH₃ → [Ag(NH₃)₂]⁺ (Tan)",
          r1: "AgCl (Trắng)",
          r2: "NH₃",
          lColor: "#ffffff",
          endColor: "#f8fafc",
          ppt: false,
          res: "Kết tủa trắng tan dần, tạo dung dịch trong suốt (Phức Tollens).",
        },
        Fe3_SCN: {
          name: "Fe³⁺ + SCN⁻",
          eq: "Fe³⁺ + SCN⁻ → [Fe(SCN)]²⁺ (Đỏ máu)",
          r1: "FeCl₃ (Vàng)",
          r2: "KSCN",
          lColor: "#fde047",
          endColor: "#991b1b",
          ppt: false,
          res: "Dung dịch chuyển ngay lập tức sang màu Đỏ Máu.",
        },
        Ni_DMG: {
          name: "Ni²⁺ + DMG",
          eq: "Ni²⁺ + 2DMG → Ni(DMG)₂↓",
          r1: "NiCl₂ (Xanh lá)",
          r2: "DMG",
          lColor: "#4ade80",
          pptColor: "#ec4899",
          ppt: true,
          res: "Xuất hiện kết tủa màu Đỏ Tươi rực rỡ (Dấu hiệu nhận biết Ni).",
        },
        Fe2_Oxidation: {
          name: "Oxi hóa Fe²⁺",
          eq: "2Fe²⁺ + Br₂ → 2Fe³⁺ + 2Br⁻",
          r1: "FeSO₄ (Lục nhạt)",
          r2: "Nước Br₂ (Nâu đỏ)",
          lColor: "#dcfce7",
          endColor: "#ca8a04",
          ppt: false,
          res: "Dung dịch chuyển từ lục nhạt sang Vàng Nâu (Fe³⁺).",
        },
        MnO4_Redox: {
          name: "Khử MnO₄⁻",
          eq: "MnO₄⁻ (Tím) + 5e → Mn²⁺ (Không màu)",
          r1: "KMnO₄ (Tím)",
          r2: "Chất khử (H₂C₂O₄)",
          lColor: "#7e22ce",
          endColor: "#f3f4f6",
          ppt: false,
          res: "Màu tím đậm của thuốc tím biến mất, dung dịch trở nên trong suốt.",
        },
        Cr2O7_Ba: {
          name: "Cr₂O₇²⁻ + Ba²⁺",
          eq: "Cr₂O₇²⁻ + 2Ba²⁺ + H₂O → 2BaCrO₄↓ + 2H⁺",
          r1: "K₂Cr₂O₇ (Cam)",
          r2: "BaCl₂",
          lColor: "#f97316",
          pptColor: "#facc15",
          ppt: true,
          res: "Xuất hiện kết tủa màu Vàng tươi của BaCrO₄.",
        },
        Cu_Identification: {
          name: "Nhận biết Cu²⁺",
          eq: "Cu²⁺ + 2OH⁻ → Cu(OH)₂↓ (Xanh)",
          r1: "CuSO₄ (Xanh lam)",
          r2: "NaOH",
          lColor: "#3b82f6",
          pptColor: "#0ea5e9",
          ppt: true,
          res: "Tạo kết tủa màu Xanh da trời đặc trưng.",
        },
      };

      // --- 3. THREE.JS: ATOM VISUALIZATION ---
      let atomScene,
        atomCamera,
        atomRenderer,
        atomGroup,
        electrons = [];

      function initAtom3D() {
        const container = document.getElementById("atom-canvas-container");
        if (!container) return;
        atomScene = new THREE.Scene();

        atomCamera = new THREE.PerspectiveCamera(
          50,
          container.clientWidth / container.clientHeight,
          0.1,
          1000
        );
        atomCamera.position.z = 15;

        atomRenderer = new THREE.WebGLRenderer({
          alpha: true,
          antialias: true,
        });
        atomRenderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(atomRenderer.domElement);

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        atomScene.add(ambientLight);
        const pointLight = new THREE.PointLight(0xffffff, 1);
        pointLight.position.set(10, 10, 10);
        atomScene.add(pointLight);

        createAtomModel(21);
        animateAtom();

        window.addEventListener("resize", () => {
          if (atomCamera && atomRenderer) {
            atomCamera.aspect = container.clientWidth / container.clientHeight;
            atomCamera.updateProjectionMatrix();
            atomRenderer.setSize(container.clientWidth, container.clientHeight);
          }
        });
      }

      function createAtomModel(atomicNumber) {
        if (atomGroup) atomScene.remove(atomGroup);
        atomGroup = new THREE.Group();
        electrons = [];
        const data = elementsData[atomicNumber];

        // Nucleus
        const nucleusGeo = new THREE.SphereGeometry(1.5, 32, 32);
        const nucleusMat = new THREE.MeshPhongMaterial({
          color: data.color,
          emissive: data.color,
          emissiveIntensity: 0.2,
          shininess: 100,
        });
        const nucleus = new THREE.Mesh(nucleusGeo, nucleusMat);
        atomGroup.add(nucleus);

        // Shells
        const orbits = [3, 5, 7, 9];
        let electronCount = atomicNumber;
        let layers = 4;

        for (let i = 0; i < layers; i++) {
          const ringGeo = new THREE.TorusGeometry(orbits[i], 0.05, 32, 100);
          const ringMat = new THREE.MeshBasicMaterial({
            color: 0x475569,
            opacity: 0.3,
            transparent: true,
          });
          const ring = new THREE.Mesh(ringGeo, ringMat);
          ring.rotation.x = Math.PI / 2;
          ring.rotation.y = Math.random() * Math.PI;
          atomGroup.add(ring);

          let eInLayer = Math.min(electronCount, (i + 1) * 2 + 4);
          if (i === layers - 1) eInLayer = electronCount;
          electronCount -= eInLayer;
          if (electronCount < 0) eInLayer += electronCount;

          const eGeo = new THREE.SphereGeometry(0.2, 16, 16);
          const eMat = new THREE.MeshBasicMaterial({ color: 0x38bdf8 });

          for (let j = 0; j < eInLayer; j++) {
            const angle = (j / eInLayer) * Math.PI * 2;
            const electron = new THREE.Mesh(eGeo, eMat);
            electron.userData = {
              angle: angle,
              radius: orbits[i],
              speed: 0.02 - i * 0.003,
              offsetY: (Math.random() - 0.5) * 2,
            };
            electrons.push(electron);
            atomGroup.add(electron);
          }
        }
        atomScene.add(atomGroup);
      }

      function animateAtom() {
        requestAnimationFrame(animateAtom);
        if (atomGroup) {
          atomGroup.children[0].rotation.y += 0.01;
          atomGroup.rotation.y += 0.002;
          atomGroup.rotation.z += 0.001;
        }
        electrons.forEach((e) => {
          e.userData.angle += e.userData.speed;
          e.position.x = Math.cos(e.userData.angle) * e.userData.radius;
          e.position.z = Math.sin(e.userData.angle) * e.userData.radius;
          e.position.y = Math.sin(e.userData.angle) * e.userData.offsetY;
        });
        atomRenderer.render(atomScene, atomCamera);
      }

      // --- 4. THREE.JS: COMPLEX VISUALIZATION ---
      let compScene, compCamera, compRenderer, compGroup;

      function initComplex3D() {
        const container = document.getElementById("complex-canvas-container");
        if (!container) return;
        compScene = new THREE.Scene();

        compCamera = new THREE.PerspectiveCamera(
          50,
          container.clientWidth / container.clientHeight,
          0.1,
          1000
        );
        compCamera.position.z = 8;

        compRenderer = new THREE.WebGLRenderer({
          alpha: true,
          antialias: true,
        });
        compRenderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(compRenderer.domElement);

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        compScene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(5, 5, 5);
        compScene.add(dirLight);

        loadComplex("octahedral");
        animateComplex();
        window.addEventListener("resize", () => {
          if (compCamera && compRenderer) {
            compCamera.aspect = container.clientWidth / container.clientHeight;
            compCamera.updateProjectionMatrix();
            compRenderer.setSize(container.clientWidth, container.clientHeight);
          }
        });
      }

      function createBallStick(geometry) {
        if (compGroup) compScene.remove(compGroup);
        compGroup = new THREE.Group();

        const centerGeo = new THREE.SphereGeometry(1, 32, 32);
        const centerMat = new THREE.MeshPhongMaterial({ color: 0x3b82f6 });
        const center = new THREE.Mesh(centerGeo, centerMat);
        compGroup.add(center);

        let positions = [];
        if (geometry === "octahedral")
          positions = [
            [2, 0, 0],
            [-2, 0, 0],
            [0, 2, 0],
            [0, -2, 0],
            [0, 0, 2],
            [0, 0, -2],
          ];
        else if (geometry === "tetrahedral") {
          const d = 1.8;
          positions = [
            [d, d, d],
            [-d, -d, d],
            [-d, d, -d],
            [d, -d, -d],
          ];
        } else if (geometry === "squarePlanar")
          positions = [
            [2, 0, 0],
            [-2, 0, 0],
            [0, 0, 2],
            [0, 0, -2],
          ];
        else if (geometry === "linear")
          positions = [
            [0, 2.5, 0],
            [0, -2.5, 0],
          ];

        positions.forEach((pos) => {
          const lGeo = new THREE.SphereGeometry(0.6, 32, 32);
          const lMat = new THREE.MeshPhongMaterial({ color: 0x10b981 });
          const ligand = new THREE.Mesh(lGeo, lMat);
          ligand.position.set(pos[0], pos[1], pos[2]);
          compGroup.add(ligand);

          const start = new THREE.Vector3(0, 0, 0);
          const end = new THREE.Vector3(pos[0], pos[1], pos[2]);
          const dist = start.distanceTo(end);

          const cylinderGeo = new THREE.CylinderGeometry(0.15, 0.15, dist, 8);
          const cylinderMat = new THREE.MeshPhongMaterial({ color: 0x94a3b8 });
          const bond = new THREE.Mesh(cylinderGeo, cylinderMat);
          bond.position.copy(start).lerp(end, 0.5);
          bond.lookAt(end);
          bond.rotateX(Math.PI / 2);
          compGroup.add(bond);
        });
        compScene.add(compGroup);
      }

      function animateComplex() {
        requestAnimationFrame(animateComplex);
        if (compGroup) {
          compGroup.rotation.x += 0.005;
          compGroup.rotation.y += 0.008;
        }
        compRenderer.render(compScene, compCamera);
      }

      // --- UI FUNCTIONS ---
      function loadElement(z) {
        const data = elementsData[z];
        document.getElementById("el-symbol").innerText = data.symbol;
        document.getElementById("el-symbol").style.color =
          "#" + data.color.toString(16);
        document.getElementById("el-name").innerText = data.name;
        document.getElementById("el-config").innerText = data.config;
        document.getElementById("el-desc").innerText = data.desc;
        document.getElementById("el-app").innerText = data.app;
        createAtomModel(z);
      }

      function loadComplex(type) {
        document
          .querySelectorAll(".complex-btn")
          .forEach((b) =>
            b.classList.remove("active", "bg-chem-secondary", "text-white")
          );
        const infoMap = {
          octahedral: {
            title: "Bát diện (Octahedral)",
            desc: "Số phối trí: 6. Ví dụ: [Cu(H₂O)₆]²⁺ (Xanh lam), [Fe(CN)₆]³⁻.",
          },
          tetrahedral: {
            title: "Tứ diện (Tetrahedral)",
            desc: "Số phối trí: 4. Góc liên kết 109.5°. Ví dụ: [Zn(OH)₄]²⁻, [CoCl₄]²⁻.",
          },
          squarePlanar: {
            title: "Vuông phẳng (Square Planar)",
            desc: "Số phối trí: 4. Phẳng. Ví dụ: [Cu(NH₃)₄]²⁺ (Xanh thẫm), Cis-platin.",
          },
          linear: {
            title: "Thẳng (Linear)",
            desc: "Số phối trí: 2. Ví dụ: [Ag(NH₃)₂]⁺ (Phức Tollens).",
          },
        };
        const info = infoMap[type];
        document.querySelector("#complex-info h3").innerText = info.title;
        document.querySelector("#complex-info p").innerText = info.desc;
        createBallStick(type);
      }

      // --- EXPERIMENT LOGIC ---
      let currentExperiment = null;

      function setupExperiment() {
        const selector = document.getElementById("reaction-selector");
        const val = selector.value;
        const instructions = document.getElementById("lab-instructions");
        const content = document.getElementById("lab-content");
        const liquid = document.getElementById("lab-liquid");

        if (val === "none") {
          instructions.classList.remove("hidden");
          content.classList.add("hidden");
          resetBeaker();
          return;
        }

        currentExperiment = experimentsData[val];
        instructions.classList.add("hidden");
        content.classList.remove("hidden");
        document.getElementById("lab-result").classList.add("hidden");

        document.getElementById("react-name").innerText =
          currentExperiment.name;
        document.getElementById("react-eq").innerText = currentExperiment.eq;
        document.getElementById("reagent-1").innerText = currentExperiment.r1;
        document.getElementById("reagent-2").innerText = currentExperiment.r2;

        resetBeaker();
        liquid.style.height = "40%";
        liquid.style.backgroundColor = currentExperiment.lColor;

        const btn = document.getElementById("btn-add-reagent");
        btn.disabled = false;
        btn.classList.remove("opacity-50", "cursor-not-allowed");
      }

      function resetBeaker() {
        const liquid = document.getElementById("lab-liquid");
        const ppt = document.getElementById("lab-ppt");
        liquid.style.height = "0%";
        liquid.style.backgroundColor = "transparent";
        ppt.style.opacity = "0";
        ppt.style.backgroundColor = "transparent";
      }

      function resetLab() {
        document.getElementById("reaction-selector").value = "none";
        setupExperiment();
      }

      function addReagent() {
        const drop = document.getElementById("lab-drop");
        drop.style.opacity = "1";
        gsap.to(drop, {
          y: 150,
          duration: 0.5,
          ease: "power2.in",
          onComplete: () => {
            drop.style.opacity = "0";
            drop.style.transform = "translate(-50%, 0)";
            processReaction();
          },
        });
      }

      function startReaction() {
        const btn = document.getElementById("btn-add-reagent");
        btn.disabled = true;
        btn.classList.add("opacity-50", "cursor-not-allowed");
        const dropper = document.getElementById("dropper");
        dropper.style.opacity = "1";
        dropper.style.transform = "translate(-50%, 0)";
        setTimeout(() => addReagent(), 800);
        setTimeout(() => {
          dropper.style.opacity = "0";
          dropper.style.transform = "translate(-50%, -40px)";
        }, 2000);
      }

      function processReaction() {
        const liquid = document.getElementById("lab-liquid");
        const ppt = document.getElementById("lab-ppt");
        liquid.style.height = "60%";

        if (currentExperiment.ppt) {
          ppt.style.backgroundColor = currentExperiment.pptColor;
          ppt.style.opacity = "1";
          liquid.style.backgroundColor = currentExperiment.lColor + "80";
        } else {
          liquid.style.backgroundColor = currentExperiment.endColor;
          ppt.style.opacity = "0";
        }

        setTimeout(() => {
          document.getElementById("lab-result").classList.remove("hidden");
          document.getElementById("result-text").innerText =
            currentExperiment.res;
        }, 1000);
      }

      window.onload = function () {
        initAtom3D();
        initComplex3D();
        loadElement(21);
        loadComplex("octahedral");
      };
    </script>
  </body>
</html>
