<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChemStudyTeen - Chương 5: Năng Lượng Hóa Học</title>
    <link rel="icon" href="../../../favicon/educhem.svg" type="image/svg+xml" />

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              chem: {
                amber: "#F59E0B",
                red: "#EF4444",
                blue: "#3B82F6",
                dark: "#0F172A",
              },
            },
            animation: {
              float: "float 6s ease-in-out infinite",
              shake: "shake 0.5s cubic-bezier(.36,.07,.19,.97) both",
              steam: "steam 2s infinite ease-out",
            },
            keyframes: {
              float: {
                "0%, 100%": { transform: "translateY(0)" },
                "50%": { transform: "translateY(-20px)" },
              },
              shake: {
                "10%, 90%": { transform: "translate3d(-1px, 0, 0)" },
                "20%, 80%": { transform: "translate3d(2px, 0, 0)" },
                "30%, 50%, 70%": { transform: "translate3d(-4px, 0, 0)" },
                "40%, 60%": { transform: "translate3d(4px, 0, 0)" },
              },
              steam: {
                "0%": { transform: "translateY(0) scale(1)", opacity: "0.8" },
                "100%": {
                  transform: "translateY(-20px) scale(1.5)",
                  opacity: "0",
                },
              },
            },
          },
        },
      };
    </script>

    <style>
      body {
        font-family: "Segoe UI", sans-serif;
      }
      .glass-panel {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
      .dark .glass-panel {
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      input[type="range"] {
        -webkit-appearance: none;
        background: transparent;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 16px;
        width: 16px;
        border-radius: 50%;
        background: #f59e0b;
        margin-top: -6px;
        cursor: pointer;
      }
      input[type="range"]::-webkit-slider-runnable-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        background: #cbd5e1;
        border-radius: 2px;
      }

      /* Bond Animation Classes */
      .bond-stick {
        transition: all 0.5s;
        transform-origin: center;
      }
      .bond-broken {
        opacity: 0;
        transform: scale(0);
      }
      .atom {
        transition: all 0.5s ease-out;
      }
      .atom-separated-left {
        transform: translateX(-30px);
      }
      .atom-separated-right {
        transform: translateX(30px);
      }
    </style>
  </head>
  <body
    class="bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-100 transition-colors duration-300"
  >
    <!-- Navbar -->
    <nav
      class="fixed top-0 w-full z-50 glass-panel shadow-sm transition-all duration-300"
    >
      <div class="max-w-7xl mx-auto px-4">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center gap-4">
            <a
              href="../chemstudyteen.html"
              class="w-10 h-10 rounded-full bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 flex items-center justify-center transition"
              ><i class="fas fa-arrow-left"></i
            ></a>
            <span
              class="font-bold text-xl bg-clip-text text-transparent bg-gradient-to-r from-amber-500 to-red-600"
              >ChemStudyTeen</span
            >
          </div>
          <div class="hidden md:flex space-x-6">
            <a href="#intro" class="hover:text-amber-500 font-medium"
              >Khái Niệm</a
            >
            <a href="#diagram" class="hover:text-amber-500 font-medium"
              >Biểu Đồ</a
            >
            <a href="#calc" class="hover:text-amber-500 font-medium"
              >Tính Toán</a
            >
            <a href="#lab" class="hover:text-amber-500 font-medium"
              >Nhiệt Lượng Kế</a
            >
          </div>
          <button
            id="theme-toggle"
            class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700"
          >
            <i class="fas fa-adjust"></i>
          </button>
        </div>
      </div>
    </nav>

    <!-- Hero: Fire Particles -->
    <header
      class="relative pt-32 pb-20 overflow-hidden min-h-[500px] flex items-center bg-slate-50 dark:bg-slate-900"
    >
      <div
        class="max-w-7xl mx-auto px-4 grid lg:grid-cols-2 gap-12 items-center relative z-10"
      >
        <div>
          <span
            class="py-1 px-3 rounded-full bg-amber-100 dark:bg-amber-900 text-amber-600 dark:text-amber-300 text-sm font-bold border border-amber-200"
            >Hóa Học 10 • Chương 5</span
          >
          <h1 class="text-5xl lg:text-7xl font-extrabold my-6 leading-tight">
            Năng Lượng <br /><span
              class="text-transparent bg-clip-text bg-gradient-to-r from-amber-500 to-red-600"
              >Hóa Học</span
            >
          </h1>
          <p class="text-xl text-slate-600 dark:text-slate-300 mb-8">
            Nghiên cứu về sự chuyển hóa năng lượng, nhiệt phản ứng và cách tính
            toán Enthalpy.
          </p>
          <div class="flex gap-4">
            <a
              href="#lab"
              class="px-8 py-3 rounded-xl bg-gradient-to-r from-amber-500 to-red-600 text-white font-bold shadow-lg shadow-amber-500/30 hover:-translate-y-1 transition"
              >Vào Phòng Thí Nghiệm</a
            >
          </div>
        </div>
        <!-- Sim 1: Fire Particles -->
        <div id="sim1-container" class="h-[400px] w-full relative">
          <div
            class="absolute bottom-4 right-4 bg-white/10 backdrop-blur px-3 py-1 rounded text-xs text-slate-400"
          >
            Mô phỏng 1: Hạt năng lượng
          </div>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8 space-y-24 pb-20">
      <!-- I. Intro & Beaker Sim -->
      <section id="intro" class="scroll-mt-24">
        <h2
          class="text-3xl font-bold mb-8 text-center flex items-center justify-center gap-3"
        >
          <span
            class="w-8 h-8 rounded bg-amber-500 text-white flex items-center justify-center text-lg"
            >1</span
          >
          Phản Ứng Tỏa Nhiệt & Thu Nhiệt
        </h2>

        <div class="grid lg:grid-cols-2 gap-8">
          <!-- Concept Cards -->
          <div class="space-y-4">
            <div
              class="bg-white dark:bg-slate-800 p-6 rounded-xl border-l-4 border-red-500 shadow-sm"
            >
              <h3 class="text-xl font-bold text-red-500 flex justify-between">
                Tỏa Nhiệt (Exothermic) <i class="fas fa-fire"></i>
              </h3>
              <p class="text-3xl font-mono font-bold my-2">
                \(\Delta_r H < 0\)
              </p>
              <p class="text-sm text-slate-600 dark:text-slate-300">
                Nhiệt truyền từ hệ ra môi trường. Nhiệt độ môi trường tăng.
              </p>
              <p class="text-xs mt-2 text-slate-500">
                VD: Phản ứng cháy, trung hòa acid-base, vôi sống tôi nước.
              </p>
            </div>
            <div
              class="bg-white dark:bg-slate-800 p-6 rounded-xl border-l-4 border-blue-500 shadow-sm"
            >
              <h3 class="text-xl font-bold text-blue-500 flex justify-between">
                Thu Nhiệt (Endothermic) <i class="fas fa-snowflake"></i>
              </h3>
              <p class="text-3xl font-mono font-bold my-2">
                \(\Delta_r H > 0\)
              </p>
              <p class="text-sm text-slate-600 dark:text-slate-300">
                Hệ hấp thụ nhiệt từ môi trường. Nhiệt độ môi trường giảm.
              </p>
              <p class="text-xs mt-2 text-slate-500">
                VD: Nhiệt phân CaCO3, hòa tan NH4NO3, quang hợp.
              </p>
            </div>
          </div>

          <!-- Sim 2: Beaker -->
          <div
            class="glass-panel p-6 rounded-2xl shadow-xl relative overflow-hidden"
          >
            <div
              class="absolute top-0 right-0 p-2 bg-amber-100 dark:bg-amber-900 text-xs font-bold text-amber-600 rounded-bl-lg"
            >
              Mô phỏng 2
            </div>
            <h3 class="font-bold mb-4 text-center">Thí Nghiệm Hòa Tan</h3>

            <div class="flex flex-col items-center">
              <!-- Beaker Visual -->
              <div class="relative w-40 h-48 mb-4">
                <!-- Thermometer -->
                <div
                  class="absolute -right-4 top-0 w-2 h-60 bg-slate-200 rounded-full border border-slate-400 z-10"
                >
                  <div
                    id="sim2-temp-bar"
                    class="absolute bottom-0 w-full bg-red-500 rounded-full transition-all duration-1000"
                    style="height: 40%"
                  ></div>
                </div>
                <div
                  id="sim2-temp-text"
                  class="absolute -right-16 top-10 font-mono font-bold bg-white dark:bg-slate-800 px-2 rounded shadow"
                >
                  25°C
                </div>

                <!-- Beaker Glass -->
                <div
                  class="w-full h-full border-b-4 border-l-4 border-r-4 border-slate-300 rounded-b-xl relative overflow-hidden bg-white/10 backdrop-blur-sm"
                >
                  <!-- Liquid -->
                  <div
                    id="sim2-liquid"
                    class="absolute bottom-0 w-full h-3/4 bg-blue-300/50 transition-colors duration-1000 flex items-center justify-center"
                  >
                    <!-- Effects -->
                    <div
                      id="sim2-steam"
                      class="hidden absolute -top-10 w-full flex justify-center gap-2 opacity-0"
                    >
                      <i
                        class="fas fa-cloud text-white/40 text-2xl animate-steam"
                      ></i>
                      <i
                        class="fas fa-cloud text-white/40 text-xl animate-steam"
                        style="animation-delay: 0.5s"
                      ></i>
                    </div>
                    <div
                      id="sim2-ice"
                      class="hidden absolute w-full h-full bg-white/20 backdrop-blur-[2px]"
                    ></div>
                  </div>
                  <div
                    class="absolute bottom-2 w-full text-center text-xs font-bold opacity-50"
                  >
                    H2O
                  </div>
                </div>
              </div>

              <!-- Controls -->
              <div class="grid grid-cols-2 gap-3 w-full">
                <button
                  onclick="runSim2('exo')"
                  class="p-3 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg font-bold text-sm transition"
                >
                  <i class="fas fa-plus-circle mr-1"></i> CaO (Vôi sống)
                  <div class="text-[10px] font-normal">Tỏa nhiệt mạnh</div>
                </button>
                <button
                  onclick="runSim2('endo')"
                  class="p-3 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg font-bold text-sm transition"
                >
                  <i class="fas fa-plus-circle mr-1"></i> NH4NO3
                  <div class="text-[10px] font-normal">Thu nhiệt (Lạnh)</div>
                </button>
                <button
                  onclick="runSim2('reset')"
                  class="col-span-2 p-2 border border-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded text-sm"
                >
                  Làm lại
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- II. Energy Diagram -->
      <section id="diagram" class="scroll-mt-24">
        <h2
          class="text-3xl font-bold mb-8 text-center flex items-center justify-center gap-3"
        >
          <span
            class="w-8 h-8 rounded bg-amber-500 text-white flex items-center justify-center text-lg"
            >2</span
          >
          Biến Thiên Enthalpy
        </h2>

        <div class="glass-panel p-6 rounded-2xl shadow-xl">
          <div
            class="flex flex-col md:flex-row justify-between items-center mb-6"
          >
            <h3 class="text-xl font-bold">
              <i class="fas fa-chart-area mr-2 text-purple-500"></i>Mô phỏng 3:
              Giản đồ năng lượng
            </h3>
            <div
              class="text-sm bg-slate-100 dark:bg-slate-800 px-3 py-1 rounded mt-2 md:mt-0"
            >
              Kéo thanh trượt để thay đổi năng lượng sản phẩm
            </div>
          </div>

          <div class="grid md:grid-cols-3 gap-8">
            <div
              class="md:col-span-2 h-[350px] relative bg-slate-50 dark:bg-slate-900 rounded border border-slate-200 dark:border-slate-700"
            >
              <canvas id="energyChart" class="w-full h-full"></canvas>
            </div>

            <div class="flex flex-col justify-center space-y-6">
              <div>
                <label class="block text-sm font-bold mb-2 text-blue-500"
                  >Năng lượng Chất tham gia (Cố định)</label
                >
                <input
                  type="range"
                  value="50"
                  disabled
                  class="w-full opacity-50 cursor-not-allowed"
                />
              </div>
              <div>
                <label class="block text-sm font-bold mb-2 text-red-500"
                  >Năng lượng Sản phẩm</label
                >
                <input
                  type="range"
                  id="productSlider"
                  min="10"
                  max="90"
                  value="30"
                  class="w-full"
                  oninput="drawChart()"
                />
              </div>

              <div
                id="chart-info"
                class="p-4 rounded-lg bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700"
              >
                <div class="flex justify-between mb-2">
                  <span>\(\Delta_r H\):</span>
                  <span id="deltaH-val" class="font-bold text-red-500"
                    >-20 kJ</span
                  >
                </div>
                <div class="flex justify-between">
                  <span>Kết luận:</span>
                  <span id="reaction-type" class="font-bold text-red-500"
                    >Tỏa nhiệt</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- III. Calculation (Sim 4) -->
      <section id="calc" class="scroll-mt-24">
        <h2
          class="text-3xl font-bold mb-8 text-center flex items-center justify-center gap-3"
        >
          <span
            class="w-8 h-8 rounded bg-amber-500 text-white flex items-center justify-center text-lg"
            >3</span
          >
          Tính Toán Enthalpy
        </h2>

        <div class="grid md:grid-cols-2 gap-8">
          <!-- Hess Law Theory -->
          <div class="space-y-4">
            <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm">
              <h4 class="font-bold text-amber-600 mb-2">
                Cách 1: Theo nhiệt tạo thành (\(\Delta_f H^0\))
              </h4>
              <div
                class="p-3 bg-slate-100 dark:bg-slate-700 rounded font-mono text-center text-lg mb-2"
              >
                \(\Delta_r H^0 = \sum \Delta_f H^0_{sp} - \sum \Delta_f
                H^0_{cđ}\)
              </div>
              <p class="text-sm text-center italic">"Lấy Sau trừ Trước"</p>
            </div>
            <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm">
              <h4 class="font-bold text-emerald-600 mb-2">
                Cách 2: Theo năng lượng liên kết (\(E_b\))
              </h4>
              <div
                class="p-3 bg-slate-100 dark:bg-slate-700 rounded font-mono text-center text-lg mb-2"
              >
                \(\Delta_r H^0 = \sum E_b(cđ) - \sum E_b(sp)\)
              </div>
              <p class="text-sm text-center italic">
                "Lấy Trước trừ Sau" (Phá vỡ - Hình thành)
              </p>
            </div>
          </div>

          <!-- Sim 4: Bond Breaking -->
          <div
            class="glass-panel p-6 rounded-2xl border border-emerald-500/30 relative"
          >
            <div
              class="absolute top-0 right-0 p-2 bg-emerald-100 dark:bg-emerald-900 text-xs font-bold text-emerald-600 rounded-bl-lg"
            >
              Mô phỏng 4
            </div>
            <h3 class="font-bold mb-6 text-center">
              Phản ứng: \(H_2 + Cl_2 \rightarrow 2HCl\)
            </h3>

            <div
              class="flex justify-around items-center h-40 mb-4"
              id="sim4-stage"
            >
              <!-- H2 Molecule -->
              <div
                class="molecule cursor-pointer group"
                onclick="breakBond(this, 436, 'H2')"
              >
                <div class="text-xs text-center mb-1 font-bold text-slate-500">
                  H-H (Click để bẻ)
                </div>
                <div
                  class="flex items-center justify-center bg-slate-200 dark:bg-slate-700 p-2 rounded-full border border-slate-300 dark:border-slate-600 group-hover:bg-red-100 transition"
                >
                  <div
                    class="w-6 h-6 rounded-full bg-white border-2 border-slate-400 atom"
                  >
                    H
                  </div>
                  <div class="w-8 h-1 bg-slate-400 bond-stick"></div>
                  <div
                    class="w-6 h-6 rounded-full bg-white border-2 border-slate-400 atom"
                  >
                    H
                  </div>
                </div>
                <div
                  class="text-center text-xs mt-1 text-red-500 opacity-0 transition energy-val"
                >
                  +436 kJ
                </div>
              </div>

              <div class="text-2xl font-bold text-slate-300">+</div>

              <!-- Cl2 Molecule -->
              <div
                class="molecule cursor-pointer group"
                onclick="breakBond(this, 243, 'Cl2')"
              >
                <div class="text-xs text-center mb-1 font-bold text-slate-500">
                  Cl-Cl (Click để bẻ)
                </div>
                <div
                  class="flex items-center justify-center bg-slate-200 dark:bg-slate-700 p-2 rounded-full border border-slate-300 dark:border-slate-600 group-hover:bg-red-100 transition"
                >
                  <div
                    class="w-8 h-8 rounded-full bg-green-200 border-2 border-green-500 flex items-center justify-center text-sm font-bold text-green-800 atom"
                  >
                    Cl
                  </div>
                  <div class="w-8 h-1 bg-slate-400 bond-stick"></div>
                  <div
                    class="w-8 h-8 rounded-full bg-green-200 border-2 border-green-500 flex items-center justify-center text-sm font-bold text-green-800 atom"
                  >
                    Cl
                  </div>
                </div>
                <div
                  class="text-center text-xs mt-1 text-red-500 opacity-0 transition energy-val"
                >
                  +243 kJ
                </div>
              </div>
            </div>

            <div class="text-center">
              <button
                id="btn-form-bond"
                onclick="formBonds()"
                disabled
                class="px-6 py-2 bg-slate-300 text-slate-500 rounded-lg font-bold transition"
              >
                Tạo thành 2 HCl
              </button>
            </div>

            <div
              id="sim4-result"
              class="mt-4 text-center hidden animate-fade-in"
            >
              <p class="text-sm">
                Tổng năng lượng phá vỡ:
                <span class="font-bold text-red-500">679 kJ</span>
              </p>
              <p class="text-sm">
                Tổng năng lượng tỏa ra:
                <span class="font-bold text-blue-500">-864 kJ</span>
              </p>
              <div
                class="text-xl font-bold mt-2 border-t pt-2 inline-block border-slate-300"
              >
                \(\Delta_r H = -185 \text{ kJ}\) (Tỏa nhiệt)
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- IV. Lab (Sim 5 - NEW) -->
      <section id="lab" class="scroll-mt-24">
        <h2
          class="text-3xl font-bold mb-8 text-center flex items-center justify-center gap-3"
        >
          <span
            class="w-8 h-8 rounded bg-amber-500 text-white flex items-center justify-center text-lg"
            >4</span
          >
          Phòng Thí Nghiệm Ảo
        </h2>

        <div
          class="bg-slate-900 rounded-3xl p-8 shadow-2xl overflow-hidden relative border border-slate-700 text-white"
        >
          <div
            class="absolute top-0 right-0 p-4 bg-purple-600 text-xs font-bold rounded-bl-xl z-20"
          >
            Mô phỏng 5 (Mới)
          </div>
          <div class="grid lg:grid-cols-2 gap-12 relative z-10">
            <div>
              <h3 class="text-2xl font-bold mb-2 text-purple-400">
                <i class="fas fa-flask mr-2"></i>Nhiệt Lượng Kế (Calorimeter)
              </h3>
              <p class="text-slate-400 text-sm mb-6">
                Xác định nhiệt phản ứng trung hòa: \(HCl + NaOH \rightarrow NaCl
                + H_2O\)
              </p>

              <!-- Lab Steps -->
              <div class="space-y-4">
                <div
                  class="step p-3 rounded bg-slate-800 border border-slate-700 cursor-pointer hover:border-purple-500 transition"
                  id="step1"
                  onclick="labAction(1)"
                >
                  <div class="flex justify-between items-center">
                    <span class="font-bold text-sm"
                      >B1. Chuẩn bị dung dịch</span
                    >
                    <i
                      class="fas fa-check-circle text-slate-600 status-icon"
                    ></i>
                  </div>
                  <div class="text-xs text-slate-400 mt-1">
                    Lấy 50ml HCl 1M và 50ml NaOH 1M. Đo nhiệt độ đầu t_1.
                  </div>
                </div>

                <div
                  class="step p-3 rounded bg-slate-800 border border-slate-700 cursor-pointer hover:border-purple-500 transition opacity-50"
                  id="step2"
                  onclick="labAction(2)"
                >
                  <div class="flex justify-between items-center">
                    <span class="font-bold text-sm"
                      >B2. Tiến hành phản ứng</span
                    >
                    <i class="fas fa-bolt text-slate-600 status-icon"></i>
                  </div>
                  <div class="text-xs text-slate-400 mt-1">
                    Đổ nhanh NaOH vào HCl trong cốc xốp. Khuấy đều.
                  </div>
                </div>

                <div
                  class="step p-3 rounded bg-slate-800 border border-slate-700 opacity-50"
                  id="step3"
                >
                  <div class="flex justify-between items-center">
                    <span class="font-bold text-sm"
                      >B3. Kết quả & Tính toán</span
                    >
                    <i class="fas fa-calculator text-slate-600 status-icon"></i>
                  </div>
                  <div
                    id="lab-results"
                    class="hidden mt-2 pt-2 border-t border-slate-600 text-sm"
                  >
                    <p>
                      Nhiệt độ đầu t_1:
                      <span class="text-blue-400">25.0°C</span>
                    </p>
                    <p>
                      Nhiệt độ cao nhất t_2:
                      <span class="text-red-400">31.8°C</span>
                    </p>
                    <p
                      class="mt-2 font-mono text-amber-400 bg-slate-900 p-2 rounded"
                    >
                      $$Q = (m_1+m_2).c.\Delta T$$ $$Q = 100 \times 4.18 \times
                      (31.8 - 25.0) \approx 2842 \text{ J}$$
                    </p>
                  </div>
                </div>

                <button
                  onclick="resetLab()"
                  class="text-xs text-slate-500 hover:text-white underline mt-2"
                >
                  Làm lại thí nghiệm
                </button>
              </div>
            </div>

            <!-- Visual Lab Area -->
            <div
              class="relative h-[400px] bg-slate-800/50 rounded-xl border border-slate-700 flex items-end justify-center pb-8 overflow-hidden"
            >
              <!-- Coffee Cup -->
              <div class="relative w-48 h-56 z-10">
                <!-- Lid -->
                <div
                  class="absolute -top-4 w-52 -left-2 h-6 bg-slate-300 rounded-full shadow-lg z-20 flex justify-center items-center"
                >
                  <div
                    class="w-2 h-40 bg-gray-400 absolute -top-20 right-16 rounded cursor-move"
                    id="stir-rod"
                  ></div>
                  <!-- Stirrer -->
                  <div
                    class="w-2 h-48 bg-white border border-gray-400 absolute -top-20 left-16 rounded-full flex flex-col justify-end overflow-hidden"
                  >
                    <div
                      id="lab-thermometer"
                      class="w-full bg-red-600 transition-all duration-1000"
                      style="height: 30%"
                    ></div>
                  </div>
                  <div
                    class="absolute -top-24 left-20 bg-white text-slate-900 px-2 py-1 rounded text-xs font-bold font-mono"
                    id="lab-temp-display"
                  >
                    25.0°C
                  </div>
                </div>
                <!-- Cup Body -->
                <div
                  class="w-full h-full bg-white rounded-b-xl shadow-inner relative overflow-hidden border-2 border-slate-200"
                >
                  <div
                    id="lab-liquid"
                    class="absolute bottom-0 w-full h-0 bg-transparent transition-all duration-1000 flex items-center justify-center"
                  >
                    <span
                      id="lab-reaction-glow"
                      class="w-20 h-20 bg-red-500 rounded-full blur-xl opacity-0 transition duration-500"
                    ></span>
                  </div>
                  <div
                    class="absolute bottom-2 w-full text-center text-slate-400 text-xs font-bold"
                  >
                    Cốc Xốp Cách Nhiệt
                  </div>
                </div>
              </div>

              <!-- Pouring Beakers -->
              <div
                id="beaker-hcl"
                class="absolute top-10 left-10 w-16 h-20 bg-transparent border-2 border-slate-400 rounded-b-lg flex justify-center transition-all duration-1000 opacity-100"
              >
                <div
                  class="w-full h-3/4 bg-blue-400/30 absolute bottom-0 transition-all duration-1000"
                  id="vol-hcl"
                ></div>
                <span class="absolute -bottom-6 text-xs text-slate-400"
                  >HCl</span
                >
              </div>
              <div
                id="beaker-naoh"
                class="absolute top-10 right-10 w-16 h-20 bg-transparent border-2 border-slate-400 rounded-b-lg flex justify-center transition-all duration-1000 opacity-100"
              >
                <div
                  class="w-full h-3/4 bg-purple-400/30 absolute bottom-0 transition-all duration-1000"
                  id="vol-naoh"
                ></div>
                <span class="absolute -bottom-6 text-xs text-slate-400"
                  >NaOH</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Extra info -->
        <div
          class="mt-8 bg-amber-50 dark:bg-amber-900/20 border-l-4 border-amber-500 p-4 text-sm text-slate-700 dark:text-slate-300"
        >
          <strong>Công thức cần nhớ:</strong> \(Q = m.c.\Delta T\) <br />
          Trong đó: \(m\) là khối lượng dung dịch (g), \(c\) là nhiệt dung riêng
          (thường lấy \(4.18 J/g.K\) với dung dịch loãng), \(\Delta T\) là độ
          biến thiên nhiệt độ t_{sau} - t_{trước}.
        </div>
      </section>
    </main>

    <!-- Scripts -->
    <script>
      // --- Dark Mode ---
      const themeToggle = document.getElementById("theme-toggle");
      const html = document.documentElement;
      themeToggle.addEventListener("click", () => {
        html.classList.toggle("dark");
        drawChart(); // Redraw canvas on theme switch
      });

      // --- Sim 1: Fire Particles (Three.js) ---
      function initSim1() {
        const container = document.getElementById("sim1-container");
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(
          75,
          container.clientWidth / container.clientHeight,
          0.1,
          1000
        );
        const renderer = new THREE.WebGLRenderer({
          alpha: true,
          antialias: true,
        });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);
        camera.position.z = 5;

        // Particles
        const particlesGeometry = new THREE.BufferGeometry();
        const count = 1500;
        const positions = new Float32Array(count * 3);
        const colors = new Float32Array(count * 3);

        for (let i = 0; i < count * 3; i++) {
          positions[i] = (Math.random() - 0.5) * 5;
          colors[i] = Math.random();
        }
        particlesGeometry.setAttribute(
          "position",
          new THREE.BufferAttribute(positions, 3)
        );
        particlesGeometry.setAttribute(
          "color",
          new THREE.BufferAttribute(colors, 3)
        );

        // Shader Material for Fire effect (Simple Points)
        const particlesMaterial = new THREE.PointsMaterial({
          size: 0.1,
          vertexColors: true,
          transparent: true,
          opacity: 0.8,
          blending: THREE.AdditiveBlending,
        });

        const particles = new THREE.Points(
          particlesGeometry,
          particlesMaterial
        );
        scene.add(particles);

        function animate() {
          requestAnimationFrame(animate);
          const positions = particles.geometry.attributes.position.array;
          const cols = particles.geometry.attributes.color.array;

          for (let i = 0; i < count; i++) {
            // Move up
            positions[i * 3 + 1] += 0.02 + Math.random() * 0.02;
            // Reset if too high
            if (positions[i * 3 + 1] > 3) {
              positions[i * 3 + 1] = -2;
              positions[i * 3] = (Math.random() - 0.5) * 3; // Center X
              positions[i * 3 + 2] = (Math.random() - 0.5) * 3; // Center Z
            }

            // Color gradient based on height (Yellow -> Red -> Smoke)
            const h = positions[i * 3 + 1];
            if (h < -1) {
              cols[i * 3] = 1;
              cols[i * 3 + 1] = 0.8;
              cols[i * 3 + 2] = 0.2;
            } // Yellow
            else if (h < 1) {
              cols[i * 3] = 1;
              cols[i * 3 + 1] = 0.2;
              cols[i * 3 + 2] = 0.0;
            } // Red
            else {
              cols[i * 3] = 0.5;
              cols[i * 3 + 1] = 0.5;
              cols[i * 3 + 2] = 0.5;
            } // Smoke
          }
          particles.geometry.attributes.position.needsUpdate = true;
          particles.geometry.attributes.color.needsUpdate = true;
          particles.rotation.y += 0.002;
          renderer.render(scene, camera);
        }
        animate();
        window.addEventListener("resize", () => {
          camera.aspect = container.clientWidth / container.clientHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(container.clientWidth, container.clientHeight);
        });
      }

      // --- Sim 2: Beaker ---
      function runSim2(type) {
        const liquid = document.getElementById("sim2-liquid");
        const tempBar = document.getElementById("sim2-temp-bar");
        const tempText = document.getElementById("sim2-temp-text");
        const steam = document.getElementById("sim2-steam");
        const ice = document.getElementById("sim2-ice");

        // Reset effects
        steam.classList.add("hidden");
        ice.classList.add("hidden");

        if (type === "exo") {
          liquid.className =
            "absolute bottom-0 w-full h-3/4 transition-colors duration-1000 flex items-center justify-center bg-red-400/60";
          tempBar.style.height = "80%";
          tempText.innerText = "80°C";
          tempText.className =
            "absolute -right-16 top-10 font-mono font-bold bg-white dark:bg-slate-800 px-2 rounded shadow text-red-600";
          setTimeout(() => steam.classList.remove("hidden"), 500);
        } else if (type === "endo") {
          liquid.className =
            "absolute bottom-0 w-full h-3/4 transition-colors duration-1000 flex items-center justify-center bg-cyan-200/60";
          tempBar.style.height = "10%";
          tempText.innerText = "5°C";
          tempText.className =
            "absolute -right-16 top-10 font-mono font-bold bg-white dark:bg-slate-800 px-2 rounded shadow text-blue-600";
          setTimeout(() => ice.classList.remove("hidden"), 500);
        } else {
          liquid.className =
            "absolute bottom-0 w-full h-3/4 transition-colors duration-1000 flex items-center justify-center bg-blue-300/50";
          tempBar.style.height = "30%";
          tempText.innerText = "25°C";
          tempText.className =
            "absolute -right-16 top-10 font-mono font-bold bg-white dark:bg-slate-800 px-2 rounded shadow text-slate-800 dark:text-white";
        }
      }

      // --- Sim 3: Canvas Chart ---
      function drawChart() {
        const canvas = document.getElementById("energyChart");
        const ctx = canvas.getContext("2d");
        const prodE = document.getElementById("productSlider").value;
        const reactE = 50; // Fixed

        // Fix canvas resolution
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);

        const w = rect.width;
        const h = rect.height;
        const isDark = html.classList.contains("dark");

        // Clear
        ctx.clearRect(0, 0, w, h);

        // Axes
        ctx.beginPath();
        ctx.strokeStyle = isDark ? "#64748b" : "#94a3b8";
        ctx.lineWidth = 2;
        ctx.moveTo(40, h - 20);
        ctx.lineTo(40, 20); // Y
        ctx.moveTo(40, h - 20);
        ctx.lineTo(w - 20, h - 20); // X
        ctx.stroke();

        // Convert percent to Y coords (flip Y)
        const yR = h - 20 - (reactE / 100) * (h - 40);
        const yP = h - 20 - (prodE / 100) * (h - 40);

        // Draw Reactant Line
        ctx.beginPath();
        ctx.strokeStyle = "#3b82f6";
        ctx.lineWidth = 4;
        ctx.moveTo(50, yR);
        ctx.lineTo(120, yR);
        ctx.stroke();
        ctx.fillStyle = "#3b82f6";
        ctx.font = "bold 14px Arial";
        ctx.fillText("Chất đầu", 50, yR - 10);

        // Draw Product Line
        ctx.beginPath();
        ctx.strokeStyle = "#ef4444";
        ctx.lineWidth = 4;
        ctx.moveTo(w - 120, yP);
        ctx.lineTo(w - 50, yP);
        ctx.stroke();
        ctx.fillStyle = "#ef4444";
        ctx.fillText("Sản phẩm", w - 110, yP - 10);

        // Activation Curve
        const activationH = Math.min(yR, yP) - 60; // Peak
        ctx.beginPath();
        ctx.strokeStyle = isDark ? "#cbd5e1" : "#475569";
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.moveTo(120, yR);
        ctx.bezierCurveTo(w / 2 - 20, yR, w / 2, activationH, w - 120, yP); // Simple curve approximation
        ctx.stroke();
        ctx.setLineDash([]);

        // Ea Label
        ctx.fillStyle = isDark ? "#aaa" : "#555";
        ctx.font = "12px Arial";
        ctx.fillText("Ea", w / 2 - 10, activationH - 10);

        // Update DOM Info
        const delta = prodE - reactE;
        const deltaText = document.getElementById("deltaH-val");
        const typeText = document.getElementById("reaction-type");

        deltaText.innerText = (delta > 0 ? "+" : "") + delta + " kJ";
        if (delta < 0) {
          deltaText.className = "font-bold text-red-500";
          typeText.innerText = "Tỏa nhiệt (Bền vững)";
          typeText.className = "font-bold text-red-500";
        } else {
          deltaText.className = "font-bold text-blue-500";
          typeText.innerText = "Thu nhiệt (Kém bền)";
          typeText.className = "font-bold text-blue-500";
        }
      }

      // --- Sim 4: Bond Breaking ---
      let broken = { H2: false, Cl2: false };

      function breakBond(el, energy, type) {
        if (broken[type]) return;

        // Animation: Shake then separate
        const atoms = el.querySelectorAll(".atom");
        const stick = el.querySelector(".bond-stick");
        const energyTxt = el.querySelector(".energy-val");

        // Shake
        el.classList.add("animate-shake");

        setTimeout(() => {
          el.classList.remove("animate-shake");
          stick.classList.add("bond-broken");
          atoms[0].classList.add("atom-separated-left");
          atoms[1].classList.add("atom-separated-right");
          energyTxt.style.opacity = "1";
          broken[type] = true;

          if (broken.H2 && broken.Cl2) {
            document.getElementById("btn-form-bond").disabled = false;
            document
              .getElementById("btn-form-bond")
              .classList.replace("bg-slate-300", "bg-blue-600");
            document
              .getElementById("btn-form-bond")
              .classList.replace("text-slate-500", "text-white");
            document
              .getElementById("btn-form-bond")
              .classList.add("hover:bg-blue-700");
          }
        }, 500);
      }

      function formBonds() {
        const stage = document.getElementById("sim4-stage");
        // Replace visual with result molecules
        stage.innerHTML = `
                <div class="flex gap-8 animate-fade-in">
                    <div class="flex items-center justify-center p-2 rounded-full border border-purple-500 bg-purple-100 dark:bg-slate-800">
                        <div class="w-6 h-6 rounded-full bg-white border border-slate-400 flex items-center justify-center text-[10px]">H</div>
                        <div class="w-6 h-1 bg-purple-500"></div>
                        <div class="w-8 h-8 rounded-full bg-green-200 border border-green-500 flex items-center justify-center text-xs">Cl</div>
                    </div>
                    <div class="flex items-center justify-center p-2 rounded-full border border-purple-500 bg-purple-100 dark:bg-slate-800">
                        <div class="w-6 h-6 rounded-full bg-white border border-slate-400 flex items-center justify-center text-[10px]">H</div>
                        <div class="w-6 h-1 bg-purple-500"></div>
                        <div class="w-8 h-8 rounded-full bg-green-200 border border-green-500 flex items-center justify-center text-xs">Cl</div>
                    </div>
                </div>
            `;
        document.getElementById("sim4-result").classList.remove("hidden");
        document.getElementById("btn-form-bond").style.display = "none";
      }

      // --- Sim 5: Calorimetry Lab ---
      let labState = 0;

      function labAction(step) {
        if (step === 1 && labState === 0) {
          // Pouring HCL and NaOH into separate beakers is implied pre-lab, show checked
          document
            .getElementById("step1")
            .querySelector(".status-icon").className =
            "fas fa-check-circle text-green-500 status-icon";
          document.getElementById("step1").style.borderColor = "#10B981";
          document.getElementById("step2").classList.remove("opacity-50");
          labState = 1;

          // Fill HCL beaker in visual
          document.getElementById("beaker-hcl").style.top = "150px"; // Move down conceptually or just show level
        } else if (step === 2 && labState === 1) {
          // Animation: Pour
          const bHcl = document.getElementById("beaker-hcl");
          const bNaoh = document.getElementById("beaker-naoh");
          const cupLiquid = document.getElementById("lab-liquid");
          const glow = document.getElementById("lab-reaction-glow");
          const thermo = document.getElementById("lab-thermometer");
          const tempDisplay = document.getElementById("lab-temp-display");

          // Move beakers to cup
          bHcl.style.top = "10px";
          bHcl.style.left = "80px";
          bHcl.style.transform = "rotate(45deg)";
          bNaoh.style.top = "10px";
          bNaoh.style.right = "80px";
          bNaoh.style.transform = "rotate(-45deg)";

          setTimeout(() => {
            // Empty beakers
            document.getElementById("vol-hcl").style.height = "0";
            document.getElementById("vol-naoh").style.height = "0";

            // Fill cup
            cupLiquid.style.height = "50%";
            cupLiquid.style.backgroundColor = "rgba(200, 200, 255, 0.5)"; // Mixed color

            setTimeout(() => {
              // Reaction!
              glow.style.opacity = "0.8";

              // Temp Rise
              let temp = 25.0;
              const interval = setInterval(() => {
                temp += 0.2;
                tempDisplay.innerText = temp.toFixed(1) + "°C";
                thermo.style.height = (temp / 50) * 100 + "%"; // Scale
                if (temp >= 31.8) {
                  clearInterval(interval);
                  labFinish();
                }
              }, 50);
            }, 1000);
          }, 500);

          document
            .getElementById("step2")
            .querySelector(".status-icon").className =
            "fas fa-check-circle text-green-500 status-icon";
          document.getElementById("step2").style.borderColor = "#10B981";
          labState = 2;
        }
      }

      function labFinish() {
        document.getElementById("step3").classList.remove("opacity-50");
        document.getElementById("lab-results").classList.remove("hidden");
        document
          .getElementById("step3")
          .querySelector(".status-icon").className =
          "fas fa-check-circle text-green-500 status-icon";
        document.getElementById("step3").style.borderColor = "#10B981";

        // Fade out beakers
        document.getElementById("beaker-hcl").style.opacity = "0";
        document.getElementById("beaker-naoh").style.opacity = "0";
      }

      function resetLab() {
        labState = 0;
        // UI Reset
        document
          .getElementById("step1")
          .querySelector(".status-icon").className =
          "fas fa-check-circle text-slate-600 status-icon";
        document.getElementById("step1").style.borderColor = "";
        document.getElementById("step2").classList.add("opacity-50");
        document
          .getElementById("step2")
          .querySelector(".status-icon").className =
          "fas fa-bolt text-slate-600 status-icon";
        document.getElementById("step2").style.borderColor = "";
        document.getElementById("step3").classList.add("opacity-50");
        document.getElementById("lab-results").classList.add("hidden");

        // Visual Reset
        document.getElementById("lab-liquid").style.height = "0";
        document.getElementById("lab-reaction-glow").style.opacity = "0";
        document.getElementById("lab-thermometer").style.height = "30%";
        document.getElementById("lab-temp-display").innerText = "25.0°C";

        const bHcl = document.getElementById("beaker-hcl");
        const bNaoh = document.getElementById("beaker-naoh");

        bHcl.style.opacity = "1";
        bHcl.style.top = "40px";
        bHcl.style.left = "40px";
        bHcl.style.transform = "rotate(0deg)";
        bNaoh.style.opacity = "1";
        bNaoh.style.top = "40px";
        bNaoh.style.right = "40px";
        bNaoh.style.transform = "rotate(0deg)";

        document.getElementById("vol-hcl").style.height = "75%";
        document.getElementById("vol-naoh").style.height = "75%";
      }

      // Init
      window.onload = function () {
        initSim1();
        drawChart();
        window.addEventListener("resize", drawChart);
      };
    </script>
  </body>
</html>
