<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChemStudy Teen - Ch∆∞∆°ng 1: Ester & Lipid</title>
    <link rel="icon" href="../../../favicon/educhem.svg" type="image/svg+xml" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Three.js for 3D Simulations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;900&display=swap"
      rel="stylesheet"
    />

    <!-- MathJax (Optional fallback, but avoiding $ as requested) -->

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              sans: ["Be Vietnam Pro", "sans-serif"],
            },
            colors: {
              chem: {
                ester: "#f59e0b", // Amber 500
                lipid: "#eab308", // Yellow 500
                soap: "#0ea5e9", // Sky 500
                dark: "#0f172a", // Slate 900
                light: "#f8fafc", // Slate 50
                accent: "#ec4899", // Pink 500
              },
            },
            animation: {
              float: "float 6s ease-in-out infinite",
              bubble: "bubble 2s infinite",
              wiggle: "wiggle 1s ease-in-out infinite",
              "spin-slow": "spin 10s linear infinite",
            },
            keyframes: {
              float: {
                "0%, 100%": { transform: "translateY(0)" },
                "50%": { transform: "translateY(-20px)" },
              },
              bubble: {
                "0%": { transform: "translateY(100%) scale(0)", opacity: "0" },
                "50%": { opacity: "1" },
                "100%": {
                  transform: "translateY(-20px) scale(1.5)",
                  opacity: "0",
                },
              },
              wiggle: {
                "0%, 100%": { transform: "rotate(-3deg)" },
                "50%": { transform: "rotate(3deg)" },
              },
            },
          },
        },
      };
    </script>

    <style>
      body {
        font-family: "Be Vietnam Pro", sans-serif;
      }

      /* Glassmorphism */
      .glass {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
      .dark .glass {
        background: rgba(15, 23, 42, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      /* 3D Canvas Container */
      .canvas-3d {
        width: 100%;
        height: 300px;
        border-radius: 1rem;
        cursor: move;
        position: relative;
        overflow: hidden;
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
      }
      .dark ::-webkit-scrollbar-thumb {
        background: #475569;
      }

      /* Micelle Game Styles */
      .micelle-canvas {
        background: #e0f2fe;
        border-radius: 1rem;
        width: 100%;
        height: 400px;
        cursor: crosshair;
      }
      .dark .micelle-canvas {
        background: #0c4a6e;
      }

      .hidden-content {
        display: none;
      }
      .active-content {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Range Input Styling */
      input[type="range"] {
        -webkit-appearance: none;
        background: transparent;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 20px;
        width: 20px;
        border-radius: 50%;
        background: #f59e0b;
        cursor: pointer;
        margin-top: -8px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
      }
      input[type="range"]::-webkit-slider-runnable-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        background: #cbd5e1;
        border-radius: 2px;
      }
    </style>
  </head>
  <body
    class="bg-chem-light text-slate-800 dark:bg-chem-dark dark:text-slate-100 transition-colors duration-300 min-h-screen flex flex-col"
  >
    <!-- NAVIGATION BAR -->
    <nav
      class="fixed top-0 w-full z-50 glass shadow-sm transition-all duration-300"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <!-- Left: Back & Logo -->
          <div class="flex items-center gap-4">
            <button
              onclick="window.location.href='../chemstudyteen.html'"
              class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition text-chem-ester group"
              title="Quay v·ªÅ trang ch·ªß"
            >
              <i
                data-lucide="arrow-left"
                class="w-6 h-6 group-hover:-translate-x-1 transition-transform"
              ></i>
            </button>
            <div class="flex items-center gap-2">
              <div class="relative">
                <i
                  data-lucide="flask-conical"
                  class="w-8 h-8 text-chem-ester"
                ></i>
                <div
                  class="absolute -top-1 -right-1 w-3 h-3 bg-chem-accent rounded-full animate-ping"
                ></div>
              </div>
              <span
                class="font-bold text-xl tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-chem-ester to-chem-accent"
              >
                ChemStudy Teen
              </span>
            </div>
          </div>

          <!-- Center: Tabs -->
          <div
            class="hidden md:flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl"
          >
            <button
              onclick="switchTab('tab-ester')"
              class="nav-tab px-4 py-2 rounded-lg text-sm font-bold transition-all bg-white dark:bg-slate-700 shadow-sm text-chem-ester"
            >
              I. Ester
            </button>
            <button
              onclick="switchTab('tab-lipid')"
              class="nav-tab px-4 py-2 rounded-lg text-sm font-medium transition-all text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-white"
            >
              II. Lipid
            </button>
            <button
              onclick="switchTab('tab-soap')"
              class="nav-tab px-4 py-2 rounded-lg text-sm font-medium transition-all text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-white"
            >
              III. X√† ph√≤ng
            </button>
          </div>

          <!-- Right: Tools -->
          <div class="flex items-center gap-3">
            <button
              id="theme-toggle"
              class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition text-yellow-500"
            >
              <i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i>
              <i
                data-lucide="moon"
                class="w-5 h-5 block dark:hidden text-slate-600"
              ></i>
            </button>
          </div>
        </div>
      </div>
      <!-- Progress Bar -->
      <div class="h-1 bg-slate-200 dark:bg-slate-800 w-full">
        <div
          id="scroll-progress"
          class="h-full bg-gradient-to-r from-chem-ester via-chem-lipid to-chem-soap w-0 transition-all duration-100"
        ></div>
      </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="pt-24 pb-10 max-w-7xl mx-auto px-4 w-full flex-grow space-y-8">
      <!-- INTRO BANNER -->
      <header
        class="relative rounded-3xl overflow-hidden shadow-2xl h-64 md:h-80 flex items-center justify-center bg-gradient-to-br from-orange-600 to-yellow-500"
      >
        <div class="absolute inset-0">
          <div
            class="absolute top-10 left-10 w-32 h-32 bg-white/20 rounded-full blur-3xl animate-float"
          ></div>
          <div
            class="absolute bottom-10 right-10 w-40 h-40 bg-pink-500/30 rounded-full blur-3xl animate-float"
            style="animation-delay: 2s"
          ></div>
        </div>
        <div class="relative z-10 text-center text-white px-4">
          <h1 class="text-3xl md:text-6xl font-black mb-4 drop-shadow-lg">
            ESTER & LIPID
          </h1>
          <p class="text-lg md:text-2xl font-light opacity-95">
            H∆∞∆°ng th∆°m tr√°i c√¢y, Dinh d∆∞·ª°ng & C√¥ng ngh·ªá l√†m s·∫°ch
          </p>
          <div class="mt-6 flex justify-center gap-2 md:gap-4 flex-wrap">
            <span
              class="px-3 py-1 bg-white/20 backdrop-blur rounded-full text-xs md:text-sm font-mono border border-white/30"
              >R-COO-R'</span
            >
            <span
              class="px-3 py-1 bg-white/20 backdrop-blur rounded-full text-xs md:text-sm font-mono border border-white/30"
              >Triglyceride</span
            >
            <span
              class="px-3 py-1 bg-white/20 backdrop-blur rounded-full text-xs md:text-sm font-mono border border-white/30"
              >Micelle</span
            >
          </div>
        </div>
      </header>

      <!-- === SECTION 1: ESTER === -->
      <section id="tab-ester" class="active-content space-y-8">
        <!-- 1.1 Kh√°i ni·ªám & 3D -->
        <div class="grid md:grid-cols-2 gap-8">
          <div
            class="glass p-6 rounded-2xl shadow-lg border-t-4 border-chem-ester"
          >
            <h2
              class="text-2xl font-bold text-chem-ester mb-4 flex items-center gap-2"
            >
              <i data-lucide="atom" class="w-6 h-6"></i> 1. Kh√°i ni·ªám & C·∫•u tr√∫c
            </h2>
            <ul class="space-y-3 text-slate-700 dark:text-slate-300">
              <li>
                <strong>ƒê·ªãnh nghƒ©a:</strong> Khi thay nh√≥m -OH ·ªü nh√≥m carboxyl
                (-COOH) c·ªßa acid b·∫±ng nh√≥m -OR' c·ªßa alcohol, ta ƒë∆∞·ª£c Ester.
              </li>
              <li>
                <strong>C√¥ng th·ª©c chung:</strong>
                <span
                  class="font-mono bg-orange-100 dark:bg-orange-900 px-2 py-1 rounded text-orange-600 dark:text-orange-300"
                  >R-COO-R'</span
                >
              </li>
              <li>
                <strong>ƒê·∫∑c ƒëi·ªÉm:</strong> √çt tan trong n∆∞·ªõc, nhi·ªát ƒë·ªô s√¥i th·∫•p
                h∆°n acid/alcohol c√πng C (do kh√¥ng c√≥ li√™n k·∫øt Hidro li√™n ph√¢n
                t·ª≠).
              </li>
            </ul>
            <!-- Sim 1: Reaction Builder -->
            <div
              class="mt-6 bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-dashed border-chem-ester"
            >
              <h3 class="font-bold text-sm mb-2 text-slate-500">
                M√¥ ph·ªèng 1: Ph·∫£n ·ª©ng Ester h√≥a
              </h3>
              <div
                class="flex items-center justify-center gap-2 text-lg font-mono flex-wrap"
              >
                <div
                  class="bg-red-100 dark:bg-red-900 p-2 rounded text-red-600"
                >
                  R-COOH
                </div>
                <span>+</span>
                <div
                  class="bg-blue-100 dark:bg-blue-900 p-2 rounded text-blue-600"
                >
                  HO-R'
                </div>
                <span class="text-sm text-slate-400">‚áå H‚ÇÇSO‚ÇÑ, t¬∞</span>
                <div
                  class="bg-chem-ester/20 p-2 rounded text-chem-ester font-bold animate-pulse"
                >
                  R-COO-R'
                </div>
                <span>+</span>
                <div
                  class="bg-cyan-100 dark:bg-cyan-900 p-2 rounded text-cyan-600"
                >
                  H‚ÇÇO
                </div>
              </div>
            </div>
          </div>
          <!-- Sim 2: 3D Molecule -->
          <div class="glass p-4 rounded-2xl shadow-lg relative bg-slate-900">
            <div
              class="absolute top-4 left-4 z-10 bg-black/60 text-white text-xs px-2 py-1 rounded backdrop-blur"
            >
              M√¥ ph·ªèng 2: Ethyl Acetate (CH‚ÇÉCOOC‚ÇÇH‚ÇÖ) - 3D
            </div>
            <div id="sim-ester-3d" class="canvas-3d"></div>
            <div
              class="absolute bottom-4 left-0 right-0 text-center text-slate-400 text-xs"
            >
              K√©o th·∫£ ƒë·ªÉ xoay ‚Ä¢ Cu·ªôn ƒë·ªÉ zoom
            </div>
          </div>
        </div>

        <!-- 1.2 Danh ph√°p & M√πi h∆∞∆°ng -->
        <div class="glass p-6 rounded-2xl shadow-lg">
          <h2
            class="text-2xl font-bold text-chem-ester mb-6 flex items-center gap-2"
          >
            <i data-lucide="flower" class="w-6 h-6"></i> 2. M√πi h∆∞∆°ng & Danh
            ph√°p
          </h2>

          <!-- Sim 3: Fragrance Lab -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div
              class="cursor-pointer group relative overflow-hidden rounded-xl h-40 bg-yellow-100 dark:bg-yellow-900/30 border-2 border-transparent hover:border-yellow-400 transition"
              onclick="playSmell('banana')"
            >
              <img
                src="https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?auto=format&fit=crop&w=300&q=80"
                class="absolute inset-0 w-full h-full object-cover opacity-60 group-hover:scale-110 transition duration-500"
              />
              <div
                class="absolute inset-0 flex flex-col items-center justify-center bg-black/30 text-white p-2 text-center"
              >
                <i data-lucide="banana" class="w-8 h-8 mb-1"></i>
                <span class="font-bold">Isoamyl Acetate</span>
                <span
                  class="text-xs opacity-0 group-hover:opacity-100 transition"
                  >M√πi Chu·ªëi Ch√≠n</span
                >
              </div>
            </div>
            <div
              class="cursor-pointer group relative overflow-hidden rounded-xl h-40 bg-pink-100 dark:bg-pink-900/30 border-2 border-transparent hover:border-pink-400 transition"
              onclick="playSmell('rose')"
            >
              <div
                class="absolute inset-0 bg-gradient-to-br from-pink-300 to-purple-400 opacity-60 group-hover:scale-110 transition duration-500"
              ></div>
              <div
                class="absolute inset-0 flex flex-col items-center justify-center bg-black/20 text-white p-2 text-center"
              >
                <i data-lucide="flower-2" class="w-8 h-8 mb-1"></i>
                <span class="font-bold">Geranyl Acetate</span>
                <span
                  class="text-xs opacity-0 group-hover:opacity-100 transition"
                  >M√πi Hoa H·ªìng</span
                >
              </div>
            </div>
            <div
              class="cursor-pointer group relative overflow-hidden rounded-xl h-40 bg-orange-100 dark:bg-orange-900/30 border-2 border-transparent hover:border-orange-400 transition"
              onclick="playSmell('pineapple')"
            >
              <img
                src="https://images.unsplash.com/photo-1550258987-190a2d41a8ba?auto=format&fit=crop&w=300&q=80"
                class="absolute inset-0 w-full h-full object-cover opacity-60 group-hover:scale-110 transition duration-500"
              />
              <div
                class="absolute inset-0 flex flex-col items-center justify-center bg-black/30 text-white p-2 text-center"
              >
                <i data-lucide="citrus" class="w-8 h-8 mb-1"></i>
                <span class="font-bold">Ethyl Butyrate</span>
                <span
                  class="text-xs opacity-0 group-hover:opacity-100 transition"
                  >M√πi D·ª©a</span
                >
              </div>
            </div>
            <div
              class="cursor-pointer group relative overflow-hidden rounded-xl h-40 bg-purple-100 dark:bg-purple-900/30 border-2 border-transparent hover:border-purple-400 transition"
              onclick="playSmell('jasmine')"
            >
              <div
                class="absolute inset-0 bg-gradient-to-br from-indigo-300 to-purple-500 opacity-60 group-hover:scale-110 transition duration-500"
              ></div>
              <div
                class="absolute inset-0 flex flex-col items-center justify-center bg-black/20 text-white p-2 text-center"
              >
                <i data-lucide="star" class="w-8 h-8 mb-1"></i>
                <span class="font-bold">Benzyl Acetate</span>
                <span
                  class="text-xs opacity-0 group-hover:opacity-100 transition"
                  >M√πi Hoa Nh√†i</span
                >
              </div>
            </div>
          </div>
          <div
            id="smell-feedback"
            class="mt-4 text-center font-bold text-chem-ester min-h-[1.5rem] animate-bounce"
          ></div>
        </div>

        <!-- 1.3 T√≠nh ch·∫•t h√≥a h·ªçc (Th·ªßy ph√¢n) -->
        <div class="glass p-6 rounded-2xl shadow-lg border-l-4 border-blue-500">
          <h2
            class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-6 flex items-center gap-2"
          >
            <i data-lucide="flask-conical-off" class="w-6 h-6"></i> 3. T√≠nh ch·∫•t
            h√≥a h·ªçc
          </h2>

          <!-- Sim 4 & 5: Hydrolysis Lab -->
          <div class="bg-white dark:bg-slate-800 rounded-xl p-6 shadow-inner">
            <h3 class="font-bold mb-4">M√¥ ph·ªèng 4: Th√≠ nghi·ªám Th·ªßy ph√¢n</h3>
            <div
              class="flex flex-col md:flex-row gap-8 items-center justify-center"
            >
              <!-- Acid Beaker -->
              <div class="flex flex-col items-center">
                <div
                  class="relative w-24 h-32 border-b-4 border-l-2 border-r-2 border-slate-300 rounded-b-xl overflow-hidden bg-white/10"
                >
                  <div
                    id="layer-acid-top"
                    class="absolute top-[20%] w-full h-[20%] bg-yellow-200/80 transition-all duration-1000 border-b border-white/50"
                  ></div>
                  <div
                    id="layer-acid-bot"
                    class="absolute bottom-0 w-full h-[60%] bg-blue-100/50 transition-all"
                  ></div>
                  <div
                    class="absolute bottom-2 w-full text-center text-xs font-bold text-slate-400"
                  >
                    H‚ÇÇSO‚ÇÑ
                  </div>
                </div>
                <button
                  onclick="runHydrolysis('acid')"
                  class="mt-3 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-full text-sm font-bold shadow transition"
                >
                  + H‚Å∫ (Acid)
                </button>
                <p class="text-xs mt-2 text-center max-w-[150px]">
                  Ph·∫£n ·ª©ng thu·∫≠n ngh·ªãch, c√≤n l·ªõp Ester
                </p>
              </div>

              <!-- Heat Icon -->
              <i
                data-lucide="flame"
                class="w-8 h-8 text-orange-500 animate-pulse"
              ></i>

              <!-- Base Beaker -->
              <div class="flex flex-col items-center">
                <div
                  class="relative w-24 h-32 border-b-4 border-l-2 border-r-2 border-slate-300 rounded-b-xl overflow-hidden bg-white/10"
                >
                  <div
                    id="layer-base-top"
                    class="absolute top-[20%] w-full h-[20%] bg-yellow-200/80 transition-all duration-1000 border-b border-white/50"
                  ></div>
                  <div
                    id="layer-base-bot"
                    class="absolute bottom-0 w-full h-[60%] bg-blue-100/50 transition-all"
                  ></div>
                  <div
                    class="absolute bottom-2 w-full text-center text-xs font-bold text-slate-400"
                  >
                    NaOH
                  </div>
                </div>
                <button
                  onclick="runHydrolysis('base')"
                  class="mt-3 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-full text-sm font-bold shadow transition"
                >
                  + NaOH (Base)
                </button>
                <p class="text-xs mt-2 text-center max-w-[150px]">
                  Ph·∫£n ·ª©ng 1 chi·ªÅu, h·∫øt l·ªõp Ester (ƒê·ªìng nh·∫•t)
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- === SECTION 2: LIPID === -->
      <section id="tab-lipid" class="hidden-content space-y-8">
        <!-- 2.1 C·∫•u tr√∫c & Ph√¢n lo·∫°i -->
        <div
          class="glass p-6 rounded-2xl shadow-lg border-t-4 border-chem-lipid"
        >
          <h2
            class="text-2xl font-bold text-chem-lipid mb-4 flex items-center gap-2"
          >
            <i data-lucide="layers" class="w-6 h-6"></i> 1. Lipid (Ch·∫•t b√©o)
          </h2>
          <div class="grid md:grid-cols-2 gap-8 items-center">
            <div>
              <p class="mb-4 text-slate-700 dark:text-slate-300">
                L√† triester c·ªßa <strong>Glycerol</strong> v√† c√°c
                <strong>Acid b√©o</strong> (Acid ƒë∆°n ch·ª©c, m·∫°ch C d√†i, kh√¥ng ph√¢n
                nh√°nh).
              </p>
              <!-- Sim 6: Structure Builder -->
              <div
                class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl border border-yellow-200"
              >
                <h4
                  class="font-bold text-sm text-yellow-800 dark:text-yellow-200 mb-2"
                >
                  M√¥ ph·ªèng 5: C√¥ng th·ª©c c·∫•u t·∫°o (R-COO)‚ÇÉC‚ÇÉH‚ÇÖ
                </h4>
                <div class="font-mono text-center space-y-1">
                  <div
                    class="bg-white dark:bg-slate-800 p-1 border rounded inline-block w-40"
                  >
                    CH‚ÇÇ - OOC - R‚ÇÅ
                  </div>
                  <br />
                  <div
                    class="bg-white dark:bg-slate-800 p-1 border rounded inline-block w-40"
                  >
                    |
                  </div>
                  <br />
                  <div
                    class="bg-white dark:bg-slate-800 p-1 border rounded inline-block w-40"
                  >
                    CH - OOC - R‚ÇÇ
                  </div>
                  <br />
                  <div
                    class="bg-white dark:bg-slate-800 p-1 border rounded inline-block w-40"
                  >
                    |
                  </div>
                  <br />
                  <div
                    class="bg-white dark:bg-slate-800 p-1 border rounded inline-block w-40"
                  >
                    CH‚ÇÇ - OOC - R‚ÇÉ
                  </div>
                </div>
              </div>
            </div>

            <!-- Sim 7: Classification Drag Drop (Simplified Visual) -->
            <div class="space-y-4">
              <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow">
                <div class="flex justify-between items-center mb-2">
                  <span class="font-bold text-green-600">D·∫¶U (L·ªèng)</span>
                  <span
                    class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded"
                    >G·ªëc Acid Kh√¥ng No</span
                  >
                </div>
                <div class="flex gap-2 text-xs">
                  <span class="bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded"
                    >D·∫ßu l·∫°c</span
                  >
                  <span class="bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded"
                    >D·∫ßu v·ª´ng</span
                  >
                  <span class="bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded"
                    >Triolein</span
                  >
                </div>
              </div>
              <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow">
                <div class="flex justify-between items-center mb-2">
                  <span class="font-bold text-orange-600">M·ª† (R·∫Øn)</span>
                  <span
                    class="text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded"
                    >G·ªëc Acid No</span
                  >
                </div>
                <div class="flex gap-2 text-xs">
                  <span class="bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded"
                    >M·ª° l·ª£n</span
                  >
                  <span class="bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded"
                    >Tristearin</span
                  >
                  <span class="bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded"
                    >B∆°</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 2.2 T√≠nh ch·∫•t h√≥a h·ªçc -->
        <div class="grid md:grid-cols-2 gap-8">
          <!-- Sim 8: Hydrogenation -->
          <div class="glass p-6 rounded-2xl shadow-lg relative overflow-hidden">
            <h3 class="font-bold text-lg mb-4">
              M√¥ ph·ªèng 6: Ph·∫£n ·ª©ng Hydro h√≥a (L·ªèng ‚Üí R·∫Øn)
            </h3>
            <p class="text-sm mb-4 text-slate-600">
              Bi·∫øn ƒë·ªïi d·∫ßu (kh√¥ng no) th√†nh m·ª°/b∆° nh√¢n t·∫°o (no) b·∫±ng c√°ch c·ªông
              H‚ÇÇ.
            </p>

            <div
              class="relative h-48 bg-slate-100 dark:bg-slate-800 rounded-xl border border-slate-300 dark:border-slate-700 flex items-center justify-center"
            >
              <!-- Liquid Oil -->
              <div
                id="oil-state"
                class="absolute w-20 h-20 bg-yellow-400 rounded-full opacity-80 blur-sm animate-wiggle transition-all duration-1000 flex items-center justify-center"
              >
                <span class="text-xs font-bold text-yellow-900">D·∫ßu L·ªèng</span>
              </div>
              <!-- Solid Fat (Hidden initially) -->
              <div
                id="fat-state"
                class="absolute w-24 h-16 bg-yellow-200 border-2 border-yellow-400 rounded-lg shadow-xl opacity-0 scale-50 transition-all duration-1000 flex items-center justify-center"
              >
                <span class="text-xs font-bold text-yellow-800">B∆° R·∫Øn</span>
              </div>
              <!-- H2 Particles -->
              <div
                id="h2-particles"
                class="absolute inset-0 pointer-events-none"
              ></div>
            </div>

            <button
              onclick="runHydrogenation()"
              class="mt-4 w-full py-2 bg-chem-lipid text-white font-bold rounded-lg hover:bg-yellow-600 transition shadow"
            >
              <i data-lucide="wind" class="inline w-4 h-4 mr-2"></i> B∆°m H‚ÇÇ (Ni,
              t¬∞)
            </button>
          </div>

          <!-- Sim 9: Oxidation (Rancidity) -->
          <div class="glass p-6 rounded-2xl shadow-lg">
            <h3 class="font-bold text-lg mb-4">
              M√¥ ph·ªèng 7: S·ª± √îi thiu (Oxi h√≥a)
            </h3>
            <p class="text-sm mb-4 text-slate-600">
              Li√™n k·∫øt ƒë√¥i C=C b·ªã oxi h√≥a ch·∫≠m b·ªüi O‚ÇÇ kh√¥ng kh√≠ t·∫°o Peroxit ‚Üí
              m√πi kh√≥ ch·ªãu.
            </p>

            <div
              class="bg-white dark:bg-slate-900 p-4 rounded-xl border flex flex-col items-center"
            >
              <input
                type="range"
                id="time-slider"
                min="0"
                max="100"
                value="0"
                class="w-full mb-4"
                oninput="updateRancidity(this.value)"
              />
              <div
                class="w-32 h-32 rounded-full border-4 transition-colors duration-500 relative flex items-center justify-center overflow-hidden"
                id="oil-sample"
              >
                <div
                  class="absolute inset-0 bg-yellow-300 transition-colors duration-500"
                  id="oil-color"
                ></div>
                <!-- Flies/Smell lines -->
                <div
                  id="smell-lines"
                  class="absolute -top-4 opacity-0 transition-opacity text-2xl"
                >
                  ‚ô®Ô∏è ü§¢
                </div>
              </div>
              <p id="oil-status" class="mt-2 font-bold text-green-600">
                T∆∞∆°i m·ªõi
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- === SECTION 3: SOAP === -->
      <section id="tab-soap" class="hidden-content space-y-8">
        <div
          class="glass p-6 rounded-2xl shadow-lg border-t-4 border-chem-soap"
        >
          <h2
            class="text-2xl font-bold text-chem-soap mb-4 flex items-center gap-2"
          >
            <i data-lucide="droplet" class="w-6 h-6"></i> 1. X√† ph√≤ng & Ch·∫•t
            gi·∫∑t r·ª≠a
          </h2>
          <div class="grid md:grid-cols-2 gap-8">
            <div>
              <ul class="space-y-3 text-slate-700 dark:text-slate-300 text-sm">
                <li>
                  <strong>X√† ph√≤ng:</strong> Mu·ªëi Na/K c·ªßa acid b√©o (R-COONa).
                  <span class="text-red-500"
                    >(M·∫•t t√°c d·ª•ng trong n∆∞·ªõc c·ª©ng)</span
                  >
                </li>
                <li>
                  <strong>Ch·∫•t gi·∫∑t r·ª≠a TH:</strong> Mu·ªëi Sunfat/Sunfonat.
                  <span class="text-green-500"
                    >(D√πng ƒë∆∞·ª£c trong n∆∞·ªõc c·ª©ng)</span
                  >
                </li>
                <li><strong>C·∫•u t·∫°o chung:</strong> G·ªìm 2 ph·∫ßn.</li>
              </ul>
              <!-- Sim 10: Molecule Builder -->
              <div
                class="mt-4 flex items-center justify-center bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm"
              >
                <div class="flex items-center">
                  <div
                    class="w-32 h-4 bg-slate-400 rounded-l-full relative group cursor-help"
                  >
                    <div
                      class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] opacity-0 group-hover:opacity-100 transition whitespace-nowrap bg-black text-white px-2 rounded"
                    >
                      ƒêu√¥i K·ªã N∆∞·ªõc (Hydrocarbon)
                    </div>
                  </div>
                  <div
                    class="w-8 h-8 bg-blue-500 rounded-full border-2 border-white relative group cursor-help -ml-2 z-10"
                  >
                    <div
                      class="absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] opacity-0 group-hover:opacity-100 transition whitespace-nowrap bg-blue-600 text-white px-2 rounded"
                    >
                      ƒê·∫ßu ∆Øa N∆∞·ªõc (Ion)
                    </div>
                    <span
                      class="absolute inset-0 flex items-center justify-center text-white text-[8px] font-bold"
                      >Na+</span
                    >
                  </div>
                </div>
              </div>
            </div>
            <!-- Sim 11: Hard Water Test -->
            <div
              class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-200 text-center"
            >
              <h4 class="font-bold text-sm mb-4">
                M√¥ ph·ªèng 8: N∆∞·ªõc c·ª©ng (Ca¬≤‚Å∫)
              </h4>
              <div class="flex justify-around">
                <div
                  class="relative w-16 h-24 bg-blue-100 border-2 border-slate-300 rounded-b-lg overflow-hidden cursor-pointer hover:scale-105 transition"
                  onclick="testHardWater('soap', this)"
                >
                  <div
                    class="absolute bottom-0 w-full h-3/4 bg-blue-200 transition-all"
                  ></div>
                  <div class="absolute top-2 w-full text-[10px] font-bold">
                    X√† ph√≤ng
                  </div>
                  <div
                    class="precipitate absolute bottom-0 w-full h-full bg-white opacity-0 transition-opacity duration-1000 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmZmIi8+Cjwvc3ZnPg==')]"
                  ></div>
                </div>
                <div
                  class="relative w-16 h-24 bg-blue-100 border-2 border-slate-300 rounded-b-lg overflow-hidden cursor-pointer hover:scale-105 transition"
                  onclick="testHardWater('det', this)"
                >
                  <div
                    class="absolute bottom-0 w-full h-3/4 bg-blue-200 transition-all"
                  ></div>
                  <div class="absolute top-2 w-full text-[10px] font-bold">
                    Ch·∫•t t·∫©y TH
                  </div>
                  <div
                    class="foam absolute top-[25%] w-full h-4 bg-white opacity-0 transition-opacity duration-1000 rounded-full blur-sm"
                  ></div>
                </div>
              </div>
              <p id="hard-water-res" class="text-xs mt-2 h-4 text-slate-500">
                Nh·∫•n v√†o ·ªëng nghi·ªám ƒë·ªÉ th·ª≠
              </p>
            </div>
          </div>
        </div>

        <!-- Sim 12: MICELLE GAME -->
        <div class="glass p-6 rounded-2xl shadow-lg">
          <div class="flex justify-between items-center mb-4">
            <h2
              class="text-2xl font-bold text-chem-soap flex items-center gap-2"
            >
              <i data-lucide="crosshair" class="w-6 h-6"></i> 2. C∆° ch·∫ø gi·∫∑t r·ª≠a
              (Micelle)
            </h2>
            <button
              onclick="resetMicelleGame()"
              class="px-4 py-1 bg-slate-200 dark:bg-slate-700 text-xs rounded hover:bg-slate-300 transition"
            >
              Reset
            </button>
          </div>
          <p class="text-sm mb-4 text-slate-600">
            Di chu·ªôt (ho·∫∑c ch·∫°m) ƒë·ªÉ th·∫£ c√°c ph√¢n t·ª≠ x√† ph√≤ng t·∫•n c√¥ng v·∫øt d·∫ßu
            m·ª°!
          </p>

          <div
            class="relative w-full h-[400px] bg-blue-50 dark:bg-slate-900 rounded-xl overflow-hidden border border-blue-200 cursor-pointer"
            id="micelle-container"
            onclick="addSoap(event)"
          >
            <!-- Grease Stain -->
            <div
              id="grease"
              class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-20 h-20 bg-yellow-600 rounded-full blur-sm transition-all duration-1000 flex items-center justify-center text-white text-xs font-bold shadow-lg"
            >
              V·∫øt b·∫©n
            </div>
            <div id="soap-particles"></div>
            <div
              id="clean-message"
              class="absolute inset-0 flex items-center justify-center bg-white/80 dark:bg-black/80 z-20 hidden backdrop-blur"
            >
              <div class="text-center animate-bounce">
                <h3 class="text-4xl font-bold text-chem-soap mb-2">
                  S·∫°ch Bong! ‚ú®
                </h3>
                <button
                  onclick="resetMicelleGame()"
                  class="px-6 py-2 bg-chem-soap text-white rounded-full font-bold shadow hover:bg-blue-600"
                >
                  Gi·∫∑t l·∫°i
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- EXTRA: QUIZ & TOOLS -->
      <section
        class="grid md:grid-cols-2 gap-8 pt-8 border-t border-slate-200 dark:border-slate-700"
      >
        <!-- Sim 13: Quiz -->
        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg">
          <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
            <i data-lucide="help-circle" class="w-5 h-5 text-purple-500"></i>
            Luy·ªán T·∫≠p Nhanh
          </h3>
          <div id="quiz-box">
            <p class="mb-4 font-medium" id="quiz-question">ƒêang t·∫£i...</p>
            <div class="grid grid-cols-2 gap-2" id="quiz-options"></div>
            <p
              id="quiz-feedback"
              class="mt-4 text-sm font-bold min-h-[1.5rem]"
            ></p>
          </div>
          <button
            onclick="nextQuestion()"
            class="mt-4 text-xs text-slate-400 hover:text-purple-500 underline"
          >
            C√¢u ti·∫øp theo
          </button>
        </div>

        <!-- Tools -->
        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg">
          <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
            <i data-lucide="calculator" class="w-5 h-5 text-green-500"></i> C√¥ng
            c·ª• b·ªï tr·ª£
          </h3>
          <div class="grid grid-cols-2 gap-4">
            <button
              class="p-3 bg-slate-50 dark:bg-slate-700 rounded-lg text-sm hover:bg-slate-100 transition text-left"
              onclick="alert('M(RCOOR\') = R + 44 + R\'')"
            >
              ‚öñÔ∏è T√≠nh M (Ester)
            </button>
            <button
              class="p-3 bg-slate-50 dark:bg-slate-700 rounded-lg text-sm hover:bg-slate-100 transition text-left"
              onclick="alert('C15H31 (Palmitic): 256\nC17H35 (Stearic): 284\nC17H33 (Oleic): 282')"
            >
              üìù M Acid b√©o
            </button>
            <button
              class="p-3 bg-slate-50 dark:bg-slate-700 rounded-lg text-sm hover:bg-slate-100 transition text-left"
              onclick="window.scrollTo({top:0, behavior:'smooth'})"
            >
              ‚¨ÜÔ∏è L√™n ƒë·∫ßu trang
            </button>
          </div>
        </div>
      </section>
    </main>

    <!-- SCRIPTS -->
    <script>
      // --- 1. UI & THEME ---
      lucide.createIcons();

      const html = document.documentElement;
      const themeBtn = document.getElementById("theme-toggle");

      // Theme Logic
      if (
        localStorage.theme === "dark" ||
        (!("theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        html.classList.add("dark");
      }

      themeBtn.addEventListener("click", () => {
        html.classList.toggle("dark");
        localStorage.theme = html.classList.contains("dark") ? "dark" : "light";
      });

      // Tab Logic
      function switchTab(tabId) {
        // Hide all
        document.querySelectorAll('section[id^="tab-"]').forEach((el) => {
          el.classList.remove("active-content");
          el.classList.add("hidden-content");
        });
        // Show target
        const target = document.getElementById(tabId);
        target.classList.remove("hidden-content");
        target.classList.add("active-content");

        // Update buttons style
        document.querySelectorAll(".nav-tab").forEach((btn) => {
          btn.classList.remove(
            "bg-white",
            "dark:bg-slate-700",
            "shadow-sm",
            "text-chem-ester",
            "text-chem-lipid",
            "text-chem-soap"
          );
          btn.classList.add("text-slate-500", "dark:text-slate-400");
        });

        // Highlight active button (approximate matching)
        const index = ["tab-ester", "tab-lipid", "tab-soap"].indexOf(tabId);
        const activeBtn = document.querySelectorAll(".nav-tab")[index];
        activeBtn.classList.remove("text-slate-500", "dark:text-slate-400");
        activeBtn.classList.add("bg-white", "dark:bg-slate-700", "shadow-sm");

        if (index === 0) activeBtn.classList.add("text-chem-ester");
        if (index === 1) activeBtn.classList.add("text-chem-lipid");
        if (index === 2) activeBtn.classList.add("text-chem-soap");

        // Scroll Progress Color
        const bar = document.getElementById("scroll-progress");
        bar.className = `h-full w-0 transition-all duration-100 bg-gradient-to-r ${
          index === 0
            ? "from-orange-400 to-yellow-500"
            : index === 1
            ? "from-yellow-400 to-orange-500"
            : "from-sky-400 to-blue-600"
        }`;
      }

      // Scroll Progress
      window.onscroll = function () {
        let winScroll =
          document.body.scrollTop || document.documentElement.scrollTop;
        let height =
          document.documentElement.scrollHeight -
          document.documentElement.clientHeight;
        let scrolled = (winScroll / height) * 100;
        document.getElementById("scroll-progress").style.width = scrolled + "%";
      };

      // --- 2. THREE.JS MOLECULES ---
      function init3D(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x00000000); // Transparent

        const camera = new THREE.PerspectiveCamera(
          70,
          container.clientWidth / container.clientHeight,
          0.1,
          100
        );
        camera.position.z = 6;

        const renderer = new THREE.WebGLRenderer({
          alpha: true,
          antialias: true,
        });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        // Light
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(5, 5, 5);
        scene.add(dirLight);

        // Group
        const molecule = new THREE.Group();
        scene.add(molecule);

        // Simple Ethyl Acetate Model (Spheres)
        const atoms = [
          { color: 0x333333, size: 0.7, x: -1.5, y: 0, z: 0 }, // C (Methyl)
          { color: 0x333333, size: 0.7, x: 0, y: 0, z: 0 }, // C (Carbonyl)
          { color: 0xff0000, size: 0.6, x: 0, y: 1.2, z: 0 }, // O (Double bond)
          { color: 0xff0000, size: 0.6, x: 1.2, y: -0.8, z: 0 }, // O (Bridge)
          { color: 0x333333, size: 0.7, x: 2.5, y: -0.5, z: 0 }, // C (Ethyl 1)
          { color: 0x333333, size: 0.7, x: 3.5, y: 0.5, z: 0.5 }, // C (Ethyl 2)
        ];

        // Add Atoms
        const sphereGeo = new THREE.SphereGeometry(1, 32, 32);
        atoms.forEach((atom) => {
          const mat = new THREE.MeshPhongMaterial({ color: atom.color });
          const mesh = new THREE.Mesh(sphereGeo, mat);
          mesh.position.set(atom.x - 1, atom.y, atom.z);
          mesh.scale.set(atom.size, atom.size, atom.size);
          molecule.add(mesh);
        });

        // Add Bonds (Simplified visually)
        const bondGeo = new THREE.CylinderGeometry(0.15, 0.15, 1, 32);
        const bondMat = new THREE.MeshPhongMaterial({ color: 0xcccccc });

        function createBond(p1, p2, isDouble = false) {
          const start = new THREE.Vector3(p1.x - 1, p1.y, p1.z);
          const end = new THREE.Vector3(p2.x - 1, p2.y, p2.z);
          const distance = start.distanceTo(end);

          const mesh = new THREE.Mesh(bondGeo, bondMat);
          mesh.position.copy(start);
          mesh.position.lerp(end, 0.5);
          mesh.scale.set(1, distance, 1);
          mesh.lookAt(end);
          mesh.rotateX(Math.PI / 2);

          molecule.add(mesh);

          if (isDouble) {
            const mesh2 = mesh.clone();
            mesh2.position.x += 0.2;
            molecule.add(mesh2);
          }
        }

        createBond(atoms[0], atoms[1]);
        createBond(atoms[1], atoms[2], true);
        createBond(atoms[1], atoms[3]);
        createBond(atoms[3], atoms[4]);
        createBond(atoms[4], atoms[5]);

        // Animation
        function animate() {
          requestAnimationFrame(animate);
          molecule.rotation.y += 0.005;
          molecule.rotation.x += 0.002;
          renderer.render(scene, camera);
        }
        animate();

        // Resize
        window.addEventListener("resize", () => {
          renderer.setSize(container.clientWidth, container.clientHeight);
          camera.aspect = container.clientWidth / container.clientHeight;
          camera.updateProjectionMatrix();
        });
      }

      // Init 3D on load
      window.addEventListener("load", () => {
        init3D("sim-ester-3d");
        loadQuestion();
      });

      // --- 3. SIMULATION LOGIC ---

      // Sim 3: Smell
      function playSmell(type) {
        const feedback = document.getElementById("smell-feedback");
        const texts = {
          banana: "üçå M√πi Chu·ªëi Ch√≠n (Isoamyl Acetate) lan t·ªèa...",
          rose: "üåπ M√πi Hoa H·ªìng (Geranyl Acetate) th∆°m ng√°t...",
          pineapple: "üçç M√πi D·ª©a (Ethyl Butyrate) ng·ªçt ng√†o...",
          jasmine: "‚≠ê M√πi Hoa Nh√†i (Benzyl Acetate) n·ªìng n√†n...",
        };
        feedback.textContent = texts[type];
        feedback.classList.remove("animate-bounce");
        void feedback.offsetWidth; // trigger reflow
        feedback.classList.add("animate-bounce");
      }

      // Sim 4 & 5: Hydrolysis
      function runHydrolysis(type) {
        const acidTop = document.getElementById("layer-acid-top");
        const baseTop = document.getElementById("layer-base-top");

        if (type === "acid") {
          // Acid: Reversible -> Layers stay separate mostly, just visual shake
          acidTop.classList.add("animate-wiggle");
          setTimeout(() => acidTop.classList.remove("animate-wiggle"), 1000);
        } else {
          // Base: Complete -> Layer disappears (Saponification)
          baseTop.style.opacity = "0";
          baseTop.style.height = "0";
          setTimeout(() => {
            alert(
              "Ph·∫£n ·ª©ng X√† ph√≤ng h√≥a x·∫£y ra ho√†n to√†n! L·ªõp Ester bi·∫øn m·∫•t, t·∫°o th√†nh dung d·ªãch ƒë·ªìng nh·∫•t mu·ªëi v√† ancol."
            );
          }, 1000);
        }
      }

      // Sim 6: Hydrogenation
      function runHydrogenation() {
        const h2 = document.getElementById("h2-particles");
        const oil = document.getElementById("oil-state");
        const fat = document.getElementById("fat-state");

        // Generate particles
        for (let i = 0; i < 20; i++) {
          const p = document.createElement("div");
          p.className = "absolute w-2 h-2 bg-white rounded-full opacity-70";
          p.style.left = Math.random() * 100 + "%";
          p.style.bottom = "0";
          p.style.transition = `all ${Math.random() * 2 + 1}s ease-out`;
          h2.appendChild(p);

          setTimeout(() => {
            p.style.bottom = "100%";
            p.style.opacity = "0";
          }, 50);
          setTimeout(() => p.remove(), 3000);
        }

        // Transform
        setTimeout(() => {
          oil.style.transform = "scale(0)";
          oil.style.opacity = "0";
          fat.style.transform = "scale(1)";
          fat.style.opacity = "1";
        }, 1500);
      }

      // Sim 7: Rancidity Slider
      function updateRancidity(val) {
        const color = document.getElementById("oil-color");
        const lines = document.getElementById("smell-lines");
        const status = document.getElementById("oil-status");

        // Color shift yellow -> brown
        const r = 253 - val * 1; // Darken red slightly
        const g = 224 - val * 1.5; // Reduce green -> brown
        const b = 71 - val * 0.5;

        color.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;

        if (val > 70) {
          lines.style.opacity = 1;
          status.innerText = "ƒê√£ b·ªã √¥i (Peroxit h√≥a)";
          status.className = "mt-2 font-bold text-red-600";
        } else {
          lines.style.opacity = val / 100;
          status.innerText = "ƒêang oxi h√≥a...";
          status.className = "mt-2 font-bold text-yellow-600";
        }
        if (val < 10) {
          status.innerText = "T∆∞∆°i m·ªõi";
          status.className = "mt-2 font-bold text-green-600";
        }
      }

      // Sim 8: Hard Water
      function testHardWater(type, el) {
        if (type === "soap") {
          const ppt = el.querySelector(".precipitate");
          ppt.style.opacity = "1";
          document.getElementById("hard-water-res").innerText =
            "X√† ph√≤ng + Ca¬≤‚Å∫ ‚Üí K·∫øt t·ªßa tr·∫Øng (m·∫•t t√°c d·ª•ng)";
          document.getElementById("hard-water-res").className =
            "text-xs mt-2 h-4 text-red-500 font-bold";
        } else {
          const foam = el.querySelector(".foam");
          foam.style.opacity = "1";
          document.getElementById("hard-water-res").innerText =
            "Ch·∫•t gi·∫∑t r·ª≠a TH kh√¥ng t·∫°o k·∫øt t·ªßa, v·∫´n t·∫°o b·ªçt t·ªët!";
          document.getElementById("hard-water-res").className =
            "text-xs mt-2 h-4 text-green-500 font-bold";
        }
      }

      // Sim 12: Micelle Game Logic
      let soapCount = 0;
      function addSoap(e) {
        if (soapCount > 15) return;

        const container = document.getElementById("micelle-container");
        const grease = document.getElementById("grease");
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        // Create Soap Molecule Visual
        const soap = document.createElement("div");
        soap.className =
          "absolute flex items-center w-12 h-4 transition-all duration-1000";
        soap.style.left = x + "px";
        soap.style.top = y + "px";
        soap.innerHTML = `
                <div class="w-8 h-1 bg-slate-400"></div>
                <div class="w-4 h-4 rounded-full bg-blue-500 -ml-1 z-10"></div>
            `;

        document.getElementById("soap-particles").appendChild(soap);
        soapCount++;

        // Animate towards grease center
        setTimeout(() => {
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;

          // Calculate angle to center
          const dx = centerX - x;
          const dy = centerY - y;
          const angle = Math.atan2(dy, dx);

          // Position in circle around grease
          const radius = 50;
          const finalX = centerX - Math.cos(angle) * radius; // Head out
          const finalY = centerY - Math.sin(angle) * radius; // Head out

          // Rotation: Head (blue, right side of div logic needs adjustment)
          // Current HTML: Tail(left)-Head(right).
          // We want Tail IN, Head OUT.
          // Vector points TO center.
          const deg = (angle * 180) / Math.PI;

          soap.style.left = finalX + "px";
          soap.style.top = finalY + "px";
          soap.style.transform = `translate(-50%, -50%) rotate(${deg}deg)`;
        }, 100);

        // Check win
        if (soapCount >= 10) {
          setTimeout(() => {
            grease.style.transform = "translate(-50%, -50%) scale(0)"; // Dissolved
            document.getElementById("clean-message").classList.remove("hidden");
          }, 1500);
        }
      }

      function resetMicelleGame() {
        document.getElementById("soap-particles").innerHTML = "";
        document.getElementById("grease").style.transform =
          "translate(-50%, -50%) scale(1)";
        document.getElementById("clean-message").classList.add("hidden");
        soapCount = 0;
      }

      // --- 4. QUIZ LOGIC ---
      const questions = [
        {
          q: "Ph·∫£n ·ª©ng th·ªßy ph√¢n Ester trong m√¥i tr∆∞·ªùng ki·ªÅm g·ªçi l√† g√¨?",
          a: ["Ester h√≥a", "X√† ph√≤ng h√≥a", "Tr√πng ng∆∞ng"],
          c: 1,
        },
        {
          q: "Isoamyl acetat c√≥ m√πi g√¨?",
          a: ["Hoa nh√†i", "Chu·ªëi ch√≠n", "D·ª©a"],
          c: 1,
        },
        {
          q: "Ch·∫•t b√©o ·ªü tr·∫°ng th√°i l·ªèng ch·ª©a ch·ªß y·∫øu g·ªëc acid b√©o n√†o?",
          a: ["No", "Kh√¥ng no", "Th∆°m"],
          c: 1,
        },
        {
          q: "ƒê·ªÉ chuy·ªÉn h√≥a d·∫ßu th√†nh m·ª° r·∫Øn, ta th·ª±c hi·ªán ph·∫£n ·ª©ng n√†o?",
          a: ["C·ªông H‚ÇÇ", "Oxi h√≥a", "X√† ph√≤ng h√≥a"],
          c: 0,
        },
        {
          q: "X√† ph√≤ng m·∫•t t√°c d·ª•ng trong m√¥i tr∆∞·ªùng n√†o?",
          a: ["N∆∞·ªõc m·ªÅm", "N∆∞·ªõc c·ª©ng", "N∆∞·ªõc n√≥ng"],
          c: 1,
        },
      ];
      let qIndex = 0;

      function loadQuestion() {
        const q = questions[qIndex];
        document.getElementById("quiz-question").innerText = `C√¢u ${
          qIndex + 1
        }: ${q.q}`;
        const opts = document.getElementById("quiz-options");
        opts.innerHTML = "";
        q.a.forEach((opt, i) => {
          opts.innerHTML += `<button onclick="checkAnswer(${i})" class="p-3 rounded-lg border hover:bg-slate-100 dark:hover:bg-slate-700 text-left transition text-sm">${opt}</button>`;
        });
        document.getElementById("quiz-feedback").innerText = "";
      }

      function checkAnswer(i) {
        const feedback = document.getElementById("quiz-feedback");
        if (i === questions[qIndex].c) {
          feedback.innerText = "Ch√≠nh x√°c! üéâ";
          feedback.className = "mt-4 text-sm font-bold text-green-500";
        } else {
          feedback.innerText = "Sai r·ªìi! Th·ª≠ l·∫°i nh√©. üòÖ";
          feedback.className = "mt-4 text-sm font-bold text-red-500";
        }
      }

      function nextQuestion() {
        qIndex = (qIndex + 1) % questions.length;
        loadQuestion();
      }
    </script>
  </body>
</html>
