<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ch∆∞∆°ng 3: ƒê·∫°i C∆∞∆°ng H√≥a H·ªçc H·ªØu C∆° - Interactive</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js cho Ph·ªï IR -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap");

      body {
        font-family: "Be Vietnam Pro", sans-serif;
        background-color: #f1f5f9;
        color: #334155;
        scroll-behavior: smooth;
      }

      .mono-font {
        font-family: "JetBrains Mono", monospace;
      }

      /* Card Styles */
      .interactive-card {
        background: white;
        border-radius: 1rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transition: all 0.3s ease;
        overflow: hidden;
        border: 1px solid #e2e8f0;
      }

      .interactive-card:hover {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        transform: translateY(-2px);
      }

      /* Animation cho ph·∫ßn t√°ch ch·∫•t */
      @keyframes bubble {
        0% {
          transform: translateY(0) scale(1);
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          transform: translateY(-40px) scale(1.2);
          opacity: 0;
        }
      }
      .bubble {
        position: absolute;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 50%;
        animation: bubble 2s infinite ease-in;
      }

      @keyframes drip {
        0% {
          top: 0;
          opacity: 1;
          height: 5px;
        }
        100% {
          top: 100%;
          opacity: 0;
          height: 15px;
        }
      }
      .drip {
        position: absolute;
        width: 4px;
        background: #3b82f6;
        left: 50%;
        transform: translateX(-50%);
        animation: drip 1.5s infinite linear;
      }

      /* Chromatography Animation */
      @keyframes climb {
        0% {
          bottom: 0;
        }
        100% {
          bottom: var(--final-height);
        }
      }
      .chroma-dot {
        animation: climb 3s ease-out forwards;
      }

      /* Tab Styles */
      .tab-btn.active {
        background-color: #4f46e5;
        color: white;
        font-weight: 600;
      }
    </style>
  </head>
  <body onload="initApp()">
    <!-- Navigation -->
    <nav class="bg-indigo-900 text-white sticky top-0 z-50 shadow-lg">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center gap-2">
            <i data-lucide="flask-conical" class="w-8 h-8 text-yellow-400"></i>
            <span class="font-bold text-lg tracking-wide"
              >H√ìA H·ªåC H·ªÆU C∆† 11</span
            >
          </div>
          <div class="hidden md:flex space-x-4 text-sm font-medium">
            <a href="#khainiem" class="hover:text-yellow-400 transition"
              >Kh√°i ni·ªám</a
            >
            <a href="#nhomchuc" class="hover:text-yellow-400 transition"
              >Nh√≥m ch·ª©c & IR</a
            >
            <a href="#tachchat" class="hover:text-yellow-400 transition"
              >T√°ch ch·∫•t</a
            >
            <a href="#congthuc" class="hover:text-yellow-400 transition"
              >C√¥ng th·ª©c PT</a
            >
          </div>
        </div>
      </div>
    </nav>

    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 space-y-12">
      <!-- Header Hero -->
      <header class="text-center py-10">
        <h1
          class="text-4xl sm:text-5xl font-extrabold text-slate-800 mb-4 bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600"
        >
          ƒê·∫†I C∆Ø∆†NG H√ìA H·ªåC H·ªÆU C∆†
        </h1>
        <p class="text-lg text-slate-600 max-w-2xl mx-auto">
          Kh√°m ph√° th·∫ø gi·ªõi c·ªßa Carbon th√¥ng qua c√°c m√¥ ph·ªèng t∆∞∆°ng t√°c, bi·ªÉu ƒë·ªì
          tr·ª±c quan v√† c√¥ng c·ª• t√≠nh to√°n th√¥ng minh.
        </p>
      </header>

      <!-- PH·∫¶N I: KH√ÅI NI·ªÜM -->
      <section id="khainiem" class="grid md:grid-cols-2 gap-8 items-start">
        <div class="space-y-4">
          <h2
            class="text-2xl font-bold text-indigo-700 flex items-center gap-2"
          >
            <i data-lucide="book-open" class="w-6 h-6"></i> I. Kh√°i ni·ªám & ƒê·∫∑c
            ƒëi·ªÉm
          </h2>
          <div class="prose text-slate-600 text-justify">
            <p>
              <strong>H·ª£p ch·∫•t h·ªØu c∆°</strong> l√† h·ª£p ch·∫•t c·ªßa Carbon (tr·ª´ CO,
              CO‚ÇÇ, mu·ªëi carbonate, cyanide, carbide...).
            </p>
            <ul class="list-disc pl-5 mt-2 space-y-1">
              <li>
                <strong>Th√†nh ph·∫ßn:</strong> Ch·ªß y·∫øu C, H, th∆∞·ªùng c√≥ O, N, S,
                Halogen.
              </li>
              <li><strong>Li√™n k·∫øt:</strong> Ch·ªß y·∫øu l√† c·ªông h√≥a tr·ªã.</li>
              <li>
                <strong>T√≠nh ch·∫•t v·∫≠t l√Ω:</strong> $T_{nc}, T_{s√¥i}$ th·∫•p, k√©m
                b·ªÅn v·ªõi nhi·ªát, d·ªÖ bay h∆°i.
              </li>
              <li>
                <strong>T√≠nh ch·∫•t h√≥a h·ªçc:</strong> D·ªÖ ch√°y, ph·∫£n ·ª©ng th∆∞·ªùng
                ch·∫≠m v√† x·∫£y ra theo nhi·ªÅu h∆∞·ªõng (t·∫°o h·ªón h·ª£p s·∫£n ph·∫©m).
              </li>
            </ul>
          </div>
        </div>

        <!-- Interactive Quiz Card -->
        <div class="interactive-card bg-indigo-50 border-indigo-200 p-6">
          <h3
            class="font-bold text-lg text-indigo-800 mb-3 flex items-center gap-2"
          >
            <i data-lucide="brain-circuit" class="w-5 h-5"></i> Ki·ªÉm tra nhanh
          </h3>
          <p class="text-sm text-slate-600 mb-4">
            Ch·∫•t n√†o sau ƒë√¢y l√† h·ª£p ch·∫•t h·ªØu c∆°?
          </p>
          <div class="grid grid-cols-2 gap-3" id="quiz-container">
            <button
              onclick="checkQuiz(this, false)"
              class="p-3 bg-white rounded shadow hover:bg-slate-50 transition border border-slate-200 font-mono"
            >
              CaCO‚ÇÉ
            </button>
            <button
              onclick="checkQuiz(this, true)"
              class="p-3 bg-white rounded shadow hover:bg-slate-50 transition border border-slate-200 font-mono"
            >
              C‚ÇÇH‚ÇÖOH
            </button>
            <button
              onclick="checkQuiz(this, false)"
              class="p-3 bg-white rounded shadow hover:bg-slate-50 transition border border-slate-200 font-mono"
            >
              CO‚ÇÇ
            </button>
            <button
              onclick="checkQuiz(this, false)"
              class="p-3 bg-white rounded shadow hover:bg-slate-50 transition border border-slate-200 font-mono"
            >
              NH‚ÇÑCl
            </button>
          </div>
          <p id="quiz-result" class="mt-3 text-sm font-semibold h-6"></p>
        </div>
      </section>

      <!-- PH·∫¶N II: NH√ìM CH·ª®C & PH·ªî IR (Interactive) -->
      <section id="nhomchuc" class="space-y-6">
        <h2
          class="text-2xl font-bold text-indigo-700 flex items-center gap-2 border-b pb-2 border-slate-200"
        >
          <i data-lucide="activity" class="w-6 h-6"></i> II. Nh√≥m ch·ª©c & Ph·ªï
          H·ªìng Ngo·∫°i (IR)
        </h2>

        <div class="grid lg:grid-cols-3 gap-8">
          <!-- C·ªôt tr√°i: Danh s√°ch nh√≥m ch·ª©c -->
          <div class="lg:col-span-1 space-y-3">
            <p class="text-sm text-slate-500 mb-2">
              Ch·ªçn m·ªôt nh√≥m ch·ª©c ƒë·ªÉ xem chi ti·∫øt:
            </p>
            <div class="grid grid-cols-1 gap-2">
              <button
                onclick="loadFuncGroup('alcohol')"
                class="func-btn group p-3 text-left rounded-lg bg-white border hover:border-indigo-500 hover:shadow-md transition flex justify-between items-center active"
              >
                <span class="font-bold text-slate-700">Alcohol</span>
                <span
                  class="mono-font text-xs bg-slate-100 px-2 py-1 rounded text-indigo-600"
                  >-OH</span
                >
              </button>
              <button
                onclick="loadFuncGroup('aldehyde')"
                class="func-btn group p-3 text-left rounded-lg bg-white border hover:border-indigo-500 hover:shadow-md transition flex justify-between items-center"
              >
                <span class="font-bold text-slate-700">Aldehyde</span>
                <span
                  class="mono-font text-xs bg-slate-100 px-2 py-1 rounded text-indigo-600"
                  >-CHO</span
                >
              </button>
              <button
                onclick="loadFuncGroup('ketone')"
                class="func-btn group p-3 text-left rounded-lg bg-white border hover:border-indigo-500 hover:shadow-md transition flex justify-between items-center"
              >
                <span class="font-bold text-slate-700">Ketone</span>
                <span
                  class="mono-font text-xs bg-slate-100 px-2 py-1 rounded text-indigo-600"
                  >>C=O</span
                >
              </button>
              <button
                onclick="loadFuncGroup('acid')"
                class="func-btn group p-3 text-left rounded-lg bg-white border hover:border-indigo-500 hover:shadow-md transition flex justify-between items-center"
              >
                <span class="font-bold text-slate-700">Carboxylic Acid</span>
                <span
                  class="mono-font text-xs bg-slate-100 px-2 py-1 rounded text-indigo-600"
                  >-COOH</span
                >
              </button>
              <button
                onclick="loadFuncGroup('amine')"
                class="func-btn group p-3 text-left rounded-lg bg-white border hover:border-indigo-500 hover:shadow-md transition flex justify-between items-center"
              >
                <span class="font-bold text-slate-700">Amine</span>
                <span
                  class="mono-font text-xs bg-slate-100 px-2 py-1 rounded text-indigo-600"
                  >-NH‚ÇÇ</span
                >
              </button>
              <button
                onclick="loadFuncGroup('ester')"
                class="func-btn group p-3 text-left rounded-lg bg-white border hover:border-indigo-500 hover:shadow-md transition flex justify-between items-center"
              >
                <span class="font-bold text-slate-700">Ester</span>
                <span
                  class="mono-font text-xs bg-slate-100 px-2 py-1 rounded text-indigo-600"
                  >-COO-</span
                >
              </button>
            </div>
          </div>

          <!-- C·ªôt ph·∫£i: Hi·ªÉn th·ªã chi ti·∫øt & Bi·ªÉu ƒë·ªì -->
          <div class="lg:col-span-2 space-y-6">
            <!-- Info Box -->
            <div
              id="func-info"
              class="bg-gradient-to-r from-blue-50 to-indigo-50 p-5 rounded-xl border border-blue-100"
            >
              <div class="flex justify-between items-start">
                <div>
                  <h3 id="info-name" class="text-xl font-bold text-indigo-800">
                    Alcohol
                  </h3>
                  <p id="info-desc" class="text-sm text-slate-600 mt-1">
                    H·ª£p ch·∫•t h·ªØu c∆° c√≥ nh√≥m hydroxyl (-OH) li√™n k·∫øt tr·ª±c ti·∫øp
                    v·ªõi nguy√™n t·ª≠ carbon no.
                  </p>
                </div>
                <div
                  id="info-mol"
                  class="mono-font text-2xl font-bold text-indigo-600 bg-white px-3 py-1 rounded shadow-sm"
                >
                  R-OH
                </div>
              </div>
              <div class="mt-4 flex gap-4 text-sm">
                <div class="bg-white px-3 py-2 rounded border border-blue-100">
                  <span class="text-slate-400 block text-xs"
                    >T√≠n hi·ªáu IR ƒë·∫∑c tr∆∞ng</span
                  >
                  <span id="info-ir" class="font-bold text-orange-600"
                    >3200 - 3500 cm‚Åª¬π</span
                  >
                </div>
                <div class="bg-white px-3 py-2 rounded border border-blue-100">
                  <span class="text-slate-400 block text-xs">V√≠ d·ª•</span>
                  <span id="info-ex" class="font-bold text-slate-700"
                    >Ethanol (C‚ÇÇH‚ÇÖOH)</span
                  >
                </div>
              </div>
            </div>

            <!-- IR Chart Simulation -->
            <div class="interactive-card p-4">
              <div class="flex justify-between items-center mb-2">
                <h4 class="font-bold text-slate-700 text-sm">
                  M√¥ ph·ªèng Ph·ªï H·ªìng Ngo·∫°i (IR Spectrum)
                </h4>
                <span class="text-xs text-slate-400 italic"
                  >Tr·ª•c Y: ƒê·ªô truy·ªÅn qua (%) - Tr·ª•c X: S·ªë s√≥ng (cm‚Åª¬π)</span
                >
              </div>
              <div class="relative h-64 w-full">
                <canvas id="irChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- PH·∫¶N III: T√ÅCH CH·∫§T (Lab Simulation) -->
      <section id="tachchat" class="space-y-6">
        <h2 class="text-2xl font-bold text-indigo-700 flex items-center gap-2">
          <i data-lucide="flask-conical-off" class="w-6 h-6"></i> III. Ph∆∞∆°ng
          ph√°p T√°ch & Tinh ch·∫ø
        </h2>

        <div class="interactive-card">
          <!-- Tabs -->
          <div class="flex border-b border-slate-200 overflow-x-auto">
            <button
              onclick="switchLabTab('chungcat')"
              class="lab-tab-btn active px-6 py-4 font-medium text-slate-600 hover:bg-slate-50 transition whitespace-nowrap"
            >
              1. Ch∆∞ng c·∫•t
            </button>
            <button
              onclick="switchLabTab('chiet')"
              class="lab-tab-btn px-6 py-4 font-medium text-slate-600 hover:bg-slate-50 transition whitespace-nowrap"
            >
              2. Chi·∫øt
            </button>
            <button
              onclick="switchLabTab('ketinh')"
              class="lab-tab-btn px-6 py-4 font-medium text-slate-600 hover:bg-slate-50 transition whitespace-nowrap"
            >
              3. K·∫øt tinh
            </button>
            <button
              onclick="switchLabTab('sacky')"
              class="lab-tab-btn px-6 py-4 font-medium text-slate-600 hover:bg-slate-50 transition whitespace-nowrap"
            >
              4. S·∫Øc k√Ω c·ªôt
            </button>
          </div>

          <!-- Content Area -->
          <div class="p-6 grid md:grid-cols-2 gap-8 min-h-[300px]">
            <!-- Simulation Visualization (Left) -->
            <div
              id="lab-visual"
              class="bg-slate-100 rounded-xl relative overflow-hidden flex items-center justify-center border border-slate-200"
            >
              <!-- Content injected via JS -->
            </div>

            <!-- Explanation (Right) -->
            <div class="flex flex-col justify-center">
              <h3 id="lab-title" class="text-xl font-bold text-slate-800 mb-3">
                Ch∆∞ng c·∫•t
              </h3>
              <p id="lab-desc" class="text-slate-600 mb-4">
                Ph∆∞∆°ng ph√°p t√°ch d·ª±a tr√™n s·ª± kh√°c nhau v·ªÅ nhi·ªát ƒë·ªô s√¥i c·ªßa c√°c
                ch·∫•t l·ªèng h√≤a tan v√†o nhau.
              </p>

              <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                <p class="text-sm text-yellow-800 font-medium">Nguy√™n t·∫Øc:</p>
                <p id="lab-principle" class="text-sm text-yellow-700 italic">
                  ƒêun n√≥ng ‚Üí H√≥a h∆°i ‚Üí Ng∆∞ng t·ª• ‚Üí Thu h·ªìi.
                </p>
              </div>

              <button
                id="lab-action-btn"
                class="self-start px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition shadow-lg flex items-center gap-2"
              >
                <i data-lucide="play" class="w-4 h-4"></i> B·∫Øt ƒë·∫ßu m√¥ ph·ªèng
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- PH·∫¶N IV: C√îNG TH·ª®C & C·∫§U T·∫†O -->
      <section id="congthuc" class="grid lg:grid-cols-2 gap-8">
        <!-- Theory: Structure & Isomers -->
        <div class="space-y-4">
          <h2
            class="text-2xl font-bold text-indigo-700 flex items-center gap-2"
          >
            <i data-lucide="layout-grid" class="w-6 h-6"></i> IV. C·∫•u t·∫°o h√≥a
            h·ªçc
          </h2>
          <div class="prose text-slate-600">
            <h3 class="font-bold text-slate-800">
              1. Thuy·∫øt c·∫•u t·∫°o (Butlerov)
            </h3>
            <ul class="list-decimal pl-5 text-sm space-y-2">
              <li>Nguy√™n t·ª≠ li√™n k·∫øt theo tr·∫≠t t·ª± nh·∫•t ƒë·ªãnh (c·∫•u t·∫°o).</li>
              <li>T√≠nh ch·∫•t ph·ª• thu·ªôc th√†nh ph·∫ßn v√† c·∫•u t·∫°o.</li>
              <li>Thay ƒë·ªïi tr·∫≠t t·ª± li√™n k·∫øt ‚Üí ch·∫•t m·ªõi.</li>
            </ul>

            <h3 class="font-bold text-slate-800 mt-4">
              2. ƒê·ªìng ph√¢n & ƒê·ªìng ƒë·∫≥ng
            </h3>
            <div class="grid grid-cols-2 gap-4 mt-2">
              <div class="bg-white p-3 rounded border shadow-sm">
                <strong class="text-purple-600 text-sm block mb-1"
                  >ƒê·ªìng ƒë·∫≥ng</strong
                >
                <p class="text-xs text-slate-500">
                  C√πng c√¥ng th·ª©c chung, t√≠nh ch·∫•t h√≥a h·ªçc t∆∞∆°ng t·ª±, h∆°n k√©m nhau
                  nh√≥m $CH_2$.
                </p>
              </div>
              <div class="bg-white p-3 rounded border shadow-sm">
                <strong class="text-red-600 text-sm block mb-1"
                  >ƒê·ªìng ph√¢n</strong
                >
                <p class="text-xs text-slate-500">
                  C√πng c√¥ng th·ª©c ph√¢n t·ª≠, kh√°c c·∫•u t·∫°o ‚Üí kh√°c t√≠nh ch·∫•t.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Tool: Empirical Formula Calculator -->
        <div
          class="interactive-card bg-slate-900 text-white p-6 border-slate-700"
        >
          <h3
            class="text-xl font-bold text-yellow-400 mb-4 flex items-center gap-2"
          >
            <i data-lucide="calculator" class="w-5 h-5"></i> M√°y t√≠nh C√¥ng th·ª©c
            ph√¢n t·ª≠
          </h3>
          <p class="text-sm text-slate-400 mb-4">
            Nh·∫≠p % kh·ªëi l∆∞·ª£ng v√† Ph√¢n t·ª≠ kh·ªëi (M) ƒë·ªÉ t√¨m c√¥ng th·ª©c.
          </p>

          <div class="grid grid-cols-3 gap-3 mb-4">
            <div>
              <label class="block text-xs text-slate-400 mb-1">% Carbon</label>
              <input
                type="number"
                id="inp-c"
                placeholder="VD: 40"
                class="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white focus:border-yellow-400 outline-none"
              />
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1"
                >% Hydrogen</label
              >
              <input
                type="number"
                id="inp-h"
                placeholder="VD: 6.67"
                class="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white focus:border-yellow-400 outline-none"
              />
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">% Oxygen</label>
              <input
                type="number"
                id="inp-o"
                placeholder="VD: 53.33"
                class="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white focus:border-yellow-400 outline-none"
              />
            </div>
          </div>
          <div class="mb-6">
            <label class="block text-xs text-slate-400 mb-1"
              >Ph√¢n t·ª≠ kh·ªëi (M) (T√πy ch·ªçn)</label
            >
            <input
              type="number"
              id="inp-m"
              placeholder="VD: 60, 180..."
              class="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white focus:border-yellow-400 outline-none"
            />
          </div>

          <button
            onclick="calculateFormula()"
            class="w-full py-3 bg-gradient-to-r from-yellow-500 to-orange-500 text-slate-900 font-bold rounded shadow-lg hover:from-yellow-400 hover:to-orange-400 transition"
          >
            X√ÅC ƒê·ªäNH C√îNG TH·ª®C
          </button>

          <div
            id="calc-result"
            class="mt-6 p-4 bg-slate-800 rounded border border-slate-700 hidden"
          >
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm text-slate-400"
                >C√¥ng th·ª©c ƒë∆°n gi·∫£n nh·∫•t:</span
              >
              <span
                id="res-empirical"
                class="font-mono text-lg font-bold text-white"
              ></span>
            </div>
            <div
              class="flex justify-between items-center border-t border-slate-600 pt-2"
            >
              <span class="text-sm text-slate-400">C√¥ng th·ª©c ph√¢n t·ª≠:</span>
              <span
                id="res-molecular"
                class="font-mono text-xl font-bold text-yellow-400"
              ></span>
            </div>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer class="text-center py-8 border-t border-slate-200 mt-12">
        <p class="text-slate-500 text-sm">Interactive Learning Module ¬© 2024</p>
        <p class="text-slate-400 text-xs mt-1">
          ƒê∆∞·ª£c x√¢y d·ª±ng v·ªõi HTML5, TailwindCSS v√† Chart.js
        </p>
      </footer>
    </div>

    <script>
      // --- Initialization ---
      function initApp() {
        lucide.createIcons();
        loadFuncGroup("alcohol"); // Default Selection
        switchLabTab("chungcat"); // Default Lab
      }

      // --- Quiz Logic ---
      function checkQuiz(btn, isCorrect) {
        const container = document.getElementById("quiz-container");
        const result = document.getElementById("quiz-result");

        // Reset styles
        const buttons = container.querySelectorAll("button");
        buttons.forEach((b) => {
          b.className =
            "p-3 bg-white rounded shadow border border-slate-200 font-mono opacity-50 cursor-not-allowed";
          b.disabled = true;
        });

        // Highlight chosen
        btn.style.opacity = "1";

        if (isCorrect) {
          btn.classList.add(
            "bg-green-100",
            "border-green-500",
            "text-green-800"
          );
          result.textContent =
            "üéâ Ch√≠nh x√°c! C‚ÇÇH‚ÇÖOH (Ethanol) l√† d·∫´n xu·∫•t hydrocarbon.";
          result.className = "mt-3 text-sm font-semibold h-6 text-green-600";
        } else {
          btn.classList.add("bg-red-100", "border-red-500", "text-red-800");
          result.textContent = "‚ùå Sai r·ªìi. ƒê√¢y l√† h·ª£p ch·∫•t v√¥ c∆°.";
          result.className = "mt-3 text-sm font-semibold h-6 text-red-600";
        }
      }

      // --- Functional Groups & IR Logic ---
      const funcData = {
        alcohol: {
          name: "Alcohol (Ancol)",
          desc: "Nh√≥m Hydroxyl (-OH) li√™n k·∫øt v·ªõi nguy√™n t·ª≠ Carbon no.",
          mol: "R-OH",
          irRange: "3200-3500 (R·ªông)",
          example: "Ethanol (C‚ÇÇH‚ÇÖOH)",
          irData: [
            { x: 3350, y: 10, w: 200 },
            { x: 2950, y: 30, w: 50 },
            { x: 1050, y: 20, w: 60 },
          ], // Fake peak data points
        },
        aldehyde: {
          name: "Aldehyde",
          desc: "Nh√≥m Carbonyl (-CHO) li√™n k·∫øt v·ªõi H v√† g·ªëc Hydrocarbon.",
          mol: "R-CHO",
          irRange: "1720-1740 (M·∫°nh)",
          example: "Acetaldehyde (CH‚ÇÉCHO)",
          irData: [
            { x: 2850, y: 40, w: 50 },
            { x: 2750, y: 40, w: 50 },
            { x: 1725, y: 5, w: 30 },
          ],
        },
        ketone: {
          name: "Ketone",
          desc: "Nh√≥m Carbonyl (>C=O) li√™n k·∫øt v·ªõi 2 g·ªëc Hydrocarbon.",
          mol: "R-CO-R'",
          irRange: "1705-1725 (M·∫°nh)",
          example: "Acetone (CH‚ÇÉCOCH‚ÇÉ)",
          irData: [
            { x: 2950, y: 30, w: 50 },
            { x: 1715, y: 5, w: 30 },
            { x: 1200, y: 40, w: 100 },
          ],
        },
        acid: {
          name: "Carboxylic Acid",
          desc: "Nh√≥m Carboxyl (-COOH). C√≥ t√≠nh axit y·∫øu.",
          mol: "R-COOH",
          irRange: "2500-3000 (R·∫•t r·ªông), 1700",
          example: "Acetic Acid (CH‚ÇÉCOOH)",
          irData: [
            { x: 3000, y: 20, w: 400 },
            { x: 1710, y: 5, w: 30 },
            { x: 1250, y: 30, w: 80 },
          ],
        },
        amine: {
          name: "Amine",
          desc: "D·∫´n xu·∫•t c·ªßa Ammonia (NH‚ÇÉ) khi thay th·∫ø H b·∫±ng g·ªëc hydrocarbon.",
          mol: "R-NH‚ÇÇ",
          irRange: "3300-3500 (Trung b√¨nh)",
          example: "Methylamine (CH‚ÇÉNH‚ÇÇ)",
          irData: [
            { x: 3400, y: 30, w: 80 },
            { x: 3300, y: 30, w: 80 },
            { x: 1600, y: 50, w: 40 },
          ],
        },
        ester: {
          name: "Ester",
          desc: "S·∫£n ph·∫©m thay th·∫ø nh√≥m OH ·ªü nh√≥m carboxyl b·∫±ng nh√≥m OR'.",
          mol: "R-COO-R'",
          irRange: "1735-1750 (M·∫°nh)",
          example: "Ethyl Acetate (CH‚ÇÉCOOC‚ÇÇH‚ÇÖ)",
          irData: [
            { x: 2950, y: 30, w: 50 },
            { x: 1740, y: 5, w: 30 },
            { x: 1240, y: 15, w: 60 },
          ],
        },
      };

      let irChartInstance = null;

      function loadFuncGroup(key) {
        const data = funcData[key];

        // Update Text Info
        document.getElementById("info-name").textContent = data.name;
        document.getElementById("info-desc").textContent = data.desc;
        document.getElementById("info-mol").textContent = data.mol;
        document.getElementById("info-ir").textContent = data.irRange + " cm‚Åª¬π";
        document.getElementById("info-ex").textContent = data.example;

        // Update UI Active State
        document.querySelectorAll(".func-btn").forEach((btn) => {
          btn.classList.remove(
            "border-indigo-500",
            "bg-indigo-50",
            "ring-1",
            "ring-indigo-500"
          );
        });
        event.target
          .closest("button")
          .classList.add(
            "border-indigo-500",
            "bg-indigo-50",
            "ring-1",
            "ring-indigo-500"
          );

        // Draw Chart
        drawIRChart(data.irData, data.name);
      }

      function drawIRChart(peaks, label) {
        const ctx = document.getElementById("irChart").getContext("2d");

        // Generate basic baseline data (approximate an IR spectrum line)
        let labels = [];
        let dataPoints = [];

        // IR Spectrum goes from 4000 to 400 (reversed usually, but here we plot left to right 4000->500 for simplicity or reverse x-axis)
        // Let's create points every 50 units
        for (let i = 4000; i >= 500; i -= 20) {
          labels.push(i);

          // Base transmission is high (~95-100%)
          let transmission = 98 + Math.random() * 2;

          // Apply peaks logic (Simplified gaussian-ish dip)
          peaks.forEach((p) => {
            if (Math.abs(i - p.x) < p.w) {
              const depth = p.y; // Lowest point
              const dist = Math.abs(i - p.x);
              // Simple inverted parabolic shape for peak
              const drop = (1 - dist / p.w) * (100 - depth);
              if (drop > 0) transmission -= drop;
            }
          });

          if (transmission < 0) transmission = 0;
          dataPoints.push(transmission);
        }

        if (irChartInstance) irChartInstance.destroy();

        irChartInstance = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: `Ph·ªï IR m√¥ ph·ªèng: ${label}`,
                data: dataPoints,
                borderColor: "#4f46e5",
                borderWidth: 2,
                pointRadius: 0,
                tension: 0.4,
                fill: false,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                title: { display: true, text: "S·ªë s√≥ng (cm‚Åª¬π)" },
                ticks: { maxTicksLimit: 10 },
              },
              y: {
                title: { display: true, text: "ƒê·ªô truy·ªÅn qua (%)" },
                min: 0,
                max: 105,
                reverse: false, // Usually IR is Transmission vs Wavenumber
              },
            },
            plugins: {
              legend: { display: true },
              tooltip: { enabled: true, intersect: false, mode: "index" },
            },
          },
        });
      }

      // --- Lab Simulation Logic ---
      const labData = {
        chungcat: {
          title: "1. Ch∆∞ng c·∫•t (Distillation)",
          desc: "T√°ch c√°c ch·∫•t l·ªèng c√≥ nhi·ªát ƒë·ªô s√¥i kh√°c nhau ƒë√°ng k·ªÉ (th∆∞·ªùng >25¬∞C).",
          principle:
            "ƒêun n√≥ng h·ªón h·ª£p ‚Üí Ch·∫•t c√≥ nhi·ªát ƒë·ªô s√¥i th·∫•p h∆°n bay h∆°i tr∆∞·ªõc ‚Üí Ng∆∞ng t·ª• v√† thu h·ªìi.",
          html: `
                    <div class="relative w-40 h-52 flex flex-col items-center">
                        <!-- Thermometer -->
                        <div class="absolute top-0 right-8 w-2 h-20 bg-slate-300 rounded border border-slate-400">
                             <div class="w-full bg-red-500 rounded-b transition-all duration-[3s]" style="height: 20%" id="sim-temp"></div>
                        </div>
                        <!-- Flask -->
                        <div class="w-24 h-24 rounded-full border-4 border-slate-400 border-t-0 mt-auto bg-blue-100 relative overflow-hidden" id="flask-liquid">
                             <div class="absolute bottom-0 w-full h-full bg-blue-300 transition-all duration-[5s]" style="height: 80%"></div>
                             <!-- Bubbles container -->
                             <div id="bubbles-area"></div>
                        </div>
                        <!-- Heater -->
                        <div class="w-28 h-4 bg-orange-600 mt-1 rounded"></div>
                        
                        <!-- Condenser Tube (Simplified) -->
                        <div class="absolute top-10 -right-16 w-24 h-4 bg-slate-300 -rotate-12 rounded border border-slate-400"></div>
                        
                        <!-- Collection Flask -->
                         <div class="absolute top-20 -right-28 w-12 h-16 border-2 border-slate-400 rounded-b-lg bg-transparent flex items-end justify-center overflow-hidden">
                             <div id="collect-liquid" class="w-full bg-blue-500 h-0 transition-all duration-[5s]"></div>
                         </div>
                         <div id="drip-area"></div>
                    </div>
                `,
          action: () => {
            const btn = document.getElementById("lab-action-btn");
            btn.disabled = true;
            btn.innerHTML =
              '<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> ƒêang ƒëun n√≥ng...';
            lucide.createIcons();

            // 1. Heat up thermometer
            document.getElementById("sim-temp").style.height = "90%";

            // 2. Create Bubbles
            const bubbleArea = document.getElementById("bubbles-area");
            const interval = setInterval(() => {
              const b = document.createElement("div");
              b.className = "bubble w-3 h-3";
              b.style.left = Math.random() * 80 + "%";
              b.style.bottom = "10px";
              bubbleArea.appendChild(b);
              setTimeout(() => b.remove(), 2000);
            }, 300);

            // 3. Decrease source liquid, Increase collection
            setTimeout(() => {
              const dripArea = document.getElementById("drip-area");
              // Create drips
              const dripInterval = setInterval(() => {
                const d = document.createElement("div");
                d.className = "drip h-2 bg-blue-500 rounded";
                d.style.top = "70px"; // Approx end of condenser
                d.style.right = "-90px"; // Approx position of flask
                d.style.position = "absolute";
                dripArea.appendChild(d);
                setTimeout(() => d.remove(), 1500);
              }, 400);

              document.querySelector("#flask-liquid > div").style.height =
                "40%";
              document.querySelector("#collect-liquid").style.height = "60%";

              // Finish
              setTimeout(() => {
                clearInterval(interval);
                clearInterval(dripInterval);
                btn.disabled = false;
                btn.innerHTML =
                  '<i data-lucide="rotate-ccw" class="w-4 h-4"></i> L√†m l·∫°i';
                lucide.createIcons();
              }, 5000);
            }, 1500);
          },
        },
        chiet: {
          title: "2. Chi·∫øt (Extraction)",
          desc: "T√°ch ch·∫•t d·ª±a v√†o ƒë·ªô tan kh√°c nhau trong 2 dung m√¥i kh√¥ng h√≤a tan (vd: d·∫ßu v√† n∆∞·ªõc).",
          principle:
            "Ch·∫•t tan chuy·ªÉn t·ª´ dung m√¥i n√†y sang dung m√¥i kh√°c. D√πng ph·ªÖu chi·∫øt ƒë·ªÉ t√°ch l·ªõp.",
          html: `
                    <div class="relative flex flex-col items-center">
                        <!-- Funnel -->
                        <div class="relative w-0 h-0 border-l-[40px] border-r-[40px] border-t-[80px] border-l-transparent border-r-transparent border-t-slate-300 opacity-30 absolute top-0"></div>
                        <div class="w-20 h-32 border-2 border-slate-400 rounded-b-[40px] relative overflow-hidden bg-white mb-2" id="funnel-body">
                            <!-- Layers -->
                            <div id="layer-top" class="w-full h-1/2 bg-yellow-300 transition-all duration-1000 flex items-center justify-center text-xs text-yellow-800 font-bold opacity-90">D·∫ßu (H·ªØu c∆°)</div>
                            <div id="layer-bottom" class="w-full h-1/2 bg-blue-400 transition-all duration-1000 flex items-center justify-center text-xs text-white font-bold opacity-90">N∆∞·ªõc</div>
                        </div>
                        <!-- Tap -->
                        <div class="w-2 h-6 bg-slate-500"></div>
                        
                        <!-- Beaker -->
                        <div class="w-16 h-20 border-2 border-slate-400 border-t-0 mt-2 bg-transparent flex items-end relative overflow-hidden">
                             <div id="beaker-liquid" class="w-full bg-blue-400 h-0 transition-all"></div>
                        </div>
                    </div>
                `,
          action: () => {
            const btn = document.getElementById("lab-action-btn");
            const top = document.getElementById("layer-top");
            const bottom = document.getElementById("layer-bottom");
            const beaker = document.getElementById("beaker-liquid");

            // Reset
            top.style.height = "50%";
            bottom.style.height = "50%";
            beaker.style.height = "0";

            // 1. Shake animation (Simulated by blurring/mixing colors conceptually)
            btn.disabled = true;
            btn.innerHTML = "ƒêang l·∫Øc & T√°ch l·ªõp...";

            top.classList.add("animate-pulse");
            bottom.classList.add("animate-pulse");

            setTimeout(() => {
              top.classList.remove("animate-pulse");
              bottom.classList.remove("animate-pulse");
              btn.innerHTML = "M·ªü kh√≥a ph·ªÖu...";

              // 2. Drain bottom layer
              bottom.style.height = "0%";
              beaker.style.height = "40%";

              setTimeout(() => {
                btn.disabled = false;
                btn.innerHTML =
                  '<i data-lucide="rotate-ccw" class="w-4 h-4"></i> L√†m l·∫°i';
                lucide.createIcons();
              }, 2000);
            }, 1500);
          },
        },
        sacky: {
          title: "4. S·∫Øc k√Ω c·ªôt (Chromatography)",
          desc: "T√°ch ch·∫•t d·ª±a tr√™n kh·∫£ nƒÉng h·∫•p ph·ª• kh√°c nhau l√™n b·ªÅ m·∫∑t pha tƒ©nh.",
          principle:
            "Ch·∫•t h·∫•p ph·ª• k√©m s·∫Ω di chuy·ªÉn nhanh h∆°n theo pha ƒë·ªông ch·∫£y qua c·ªôt.",
          html: `
                    <div class="relative flex flex-col items-center">
                        <!-- Column -->
                        <div class="w-12 h-64 border-2 border-slate-400 bg-white relative overflow-hidden rounded-sm" id="column-body">
                            <!-- Silica Gel background -->
                            <div class="absolute inset-0 bg-slate-100 opacity-50"></div>
                            
                            <!-- Initial Mix Band -->
                            <div id="band-mix" class="absolute top-2 left-0 w-full h-2 bg-purple-900 z-10"></div>
                            
                            <!-- Separating Bands (Hidden initially) -->
                            <div id="band-fast" class="absolute top-2 left-0 w-full h-2 bg-red-500 opacity-0 z-10 rounded-full blur-[1px]"></div>
                            <div id="band-slow" class="absolute top-2 left-0 w-full h-2 bg-blue-600 opacity-0 z-10 rounded-full blur-[1px]"></div>
                        </div>
                         <!-- Tap -->
                        <div class="w-1 h-4 bg-slate-500"></div>
                    </div>
                `,
          action: () => {
            const btn = document.getElementById("lab-action-btn");
            const mix = document.getElementById("band-mix");
            const fast = document.getElementById("band-fast");
            const slow = document.getElementById("band-slow");

            btn.disabled = true;
            btn.innerHTML = "Dung m√¥i ƒëang ch·∫£y...";

            // Reset
            mix.style.opacity = 1;
            fast.style.opacity = 0;
            fast.style.top = "8px";
            slow.style.opacity = 0;
            slow.style.top = "8px";

            // Start
            setTimeout(() => {
              mix.style.transition = "opacity 0.5s";
              mix.style.opacity = 0;

              fast.style.opacity = 1;
              slow.style.opacity = 1;

              // Animate down
              fast.style.transition = "top 3s linear";
              slow.style.transition = "top 5s linear"; // Slower

              fast.style.top = "240px"; // Bottom of column
              slow.style.top = "150px"; // Middle

              setTimeout(() => {
                btn.disabled = false;
                btn.innerHTML =
                  '<i data-lucide="rotate-ccw" class="w-4 h-4"></i> L√†m l·∫°i';
                lucide.createIcons();
              }, 5100);
            }, 500);
          },
        },
        ketinh: {
          title: "3. K·∫øt tinh (Crystallization)",
          desc: "Tinh ch·∫ø ch·∫•t r·∫Øn d·ª±a tr√™n ƒë·ªô tan thay ƒë·ªïi theo nhi·ªát ƒë·ªô.",
          principle:
            "Tan t·ªët khi n√≥ng, √≠t tan khi l·∫°nh ‚Üí L√†m l·∫°nh dung d·ªãch b√£o h√≤a ƒë·ªÉ t√°ch tinh th·ªÉ.",
          html: `
                    <div class="flex flex-col items-center justify-end h-64">
                         <div class="w-32 h-24 border-2 border-slate-400 border-t-0 bg-blue-200 relative flex items-center justify-center overflow-hidden transition-colors duration-[3s]" id="crystal-beaker">
                             <span id="sol-text" class="text-xs text-blue-800 font-bold z-10">Dung d·ªãch n√≥ng</span>
                             <!-- Crystals -->
                             <div id="crystals-area" class="absolute bottom-0 w-full h-full flex flex-wrap justify-center items-end p-2 gap-1">
                                 <!-- JS will add crystals here -->
                             </div>
                         </div>
                         <div class="mt-2 text-sm text-slate-500 flex gap-2">
                             <span id="temp-indicator" class="text-red-500 font-bold">80¬∞C</span>
                         </div>
                    </div>
                `,
          action: () => {
            const btn = document.getElementById("lab-action-btn");
            const beaker = document.getElementById("crystal-beaker");
            const temp = document.getElementById("temp-indicator");
            const area = document.getElementById("crystals-area");
            const text = document.getElementById("sol-text");

            // Reset
            area.innerHTML = "";
            beaker.classList.remove("bg-blue-50");
            beaker.classList.add("bg-blue-200");
            temp.textContent = "80¬∞C";
            temp.className = "text-red-500 font-bold";
            text.style.opacity = 1;

            btn.disabled = true;
            btn.innerHTML = "ƒêang l√†m l·∫°nh...";

            // Animation
            let t = 80;
            const interval = setInterval(() => {
              t -= 2;
              temp.textContent = t + "¬∞C";
              if (t < 30) temp.className = "text-blue-500 font-bold";

              // Change color to lighter (less soluble/cleaner)
              if (t === 50) {
                beaker.classList.remove("bg-blue-200");
                beaker.classList.add("bg-blue-50");
                text.style.opacity = 0;
              }

              // Add crystals
              if (t < 60 && t % 5 === 0) {
                const c = document.createElement("div");
                c.className =
                  "w-4 h-4 bg-white border border-slate-300 rotate-45 transform transition-all duration-500 scale-0";
                area.appendChild(c);
                setTimeout(() => c.classList.remove("scale-0"), 50);
              }

              if (t <= 20) {
                clearInterval(interval);
                btn.disabled = false;
                btn.innerHTML =
                  '<i data-lucide="rotate-ccw" class="w-4 h-4"></i> L√†m l·∫°i';
                lucide.createIcons();
              }
            }, 100);
          },
        },
      };

      function switchLabTab(key) {
        // UI Tabs
        document
          .querySelectorAll(".lab-tab-btn")
          .forEach((btn) =>
            btn.classList.remove("active", "bg-indigo-600", "text-white")
          );
        event.target.classList.add("active"); // CSS handles styling via .active class

        const data = labData[key];

        // Render Content
        document.getElementById("lab-visual").innerHTML = data.html;
        document.getElementById("lab-title").textContent = data.title;
        document.getElementById("lab-desc").textContent = data.desc;
        document.getElementById("lab-principle").textContent = data.principle;

        // Attach Action
        const btn = document.getElementById("lab-action-btn");
        btn.innerHTML =
          '<i data-lucide="play" class="w-4 h-4"></i> B·∫Øt ƒë·∫ßu m√¥ ph·ªèng';
        btn.onclick = data.action;
        lucide.createIcons();
      }

      // --- Calculator Logic ---
      function calculateFormula() {
        const pcC = parseFloat(document.getElementById("inp-c").value) || 0;
        const pcH = parseFloat(document.getElementById("inp-h").value) || 0;
        const pcO = parseFloat(document.getElementById("inp-o").value) || 0;
        const M = parseFloat(document.getElementById("inp-m").value) || 0;

        const resDiv = document.getElementById("calc-result");
        const empSpan = document.getElementById("res-empirical");
        const molSpan = document.getElementById("res-molecular");

        if (pcC === 0) {
          alert("Vui l√≤ng nh·∫≠p √≠t nh·∫•t % Carbon!");
          return;
        }

        // 1. Calculate mole ratios
        const nC = pcC / 12;
        const nH = pcH / 1;
        const nO = pcO / 16;

        // 2. Find smallest
        let min = nC;
        if (nH > 0 && nH < min) min = nH;
        if (nO > 0 && nO < min) min = nO;

        // 3. Simple integer ratio
        let x = Math.round(nC / min);
        let y = Math.round(nH / min);
        let z = nO > 0 ? Math.round(nO / min) : 0;

        let empirical = `C${x}H${y}`;
        if (z > 0) empirical += `O${z}`;

        // Calculate Empirical Mass
        const empMass = 12 * x + 1 * y + 16 * z;

        empSpan.textContent = empirical + ` (M = ${empMass})`;

        // 4. Molecular Formula
        if (M > 0) {
          const factor = Math.round(M / empMass);
          let molForm = `C${x * factor}H${y * factor}`;
          if (z > 0) molForm += `O${z * factor}`;
          molSpan.textContent = molForm;
        } else {
          molSpan.textContent = `(C${x}H${y}${z > 0 ? "O" + z : ""})n`;
        }

        resDiv.classList.remove("hidden");
      }
    </script>
  </body>
</html>
