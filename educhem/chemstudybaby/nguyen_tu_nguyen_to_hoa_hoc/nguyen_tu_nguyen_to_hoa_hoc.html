<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ch·ªß ƒë·ªÅ 1: Nguy√™n T·ª≠ & B·∫£ng Tu·∫ßn Ho√†n - ChemStudy</title>
    <link rel="icon" href="../../../favicon/educhem.svg" type="image/svg+xml" />
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Tailwind Config for Dark Mode -->
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#2563eb",
              secondary: "#4f46e5",
              accent: "#f43f5e",
              dark: "#0f172a",
              "dark-card": "#1e293b",
            },
            animation: {
              "spin-slow": "spin 8s linear infinite",
            },
          },
        },
      };
    </script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap");

      body {
        font-family: "Nunito", sans-serif;
      }

      /* Glassmorphism */
      .glass-panel {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }
      .dark .glass-panel {
        background: rgba(15, 23, 42, 0.9);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      .dark ::-webkit-scrollbar-thumb {
        background: #475569;
      }

      /* Tab Button Styles */
      .tab-btn.active {
        background-color: #2563eb;
        color: white;
        box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3);
      }

      /* Animations */
      .fade-in {
        animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card-shadow {
        box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
      }
      .dark .card-shadow {
        box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.3);
      }

      .interactive-hover:hover {
        transform: translateY(-3px);
        transition: all 0.3s ease;
      }

      /* Drag Game */
      .draggable-item {
        cursor: grab;
        user-select: none;
      }
      .draggable-item:active {
        cursor: grabbing;
      }
      .drop-zone.drag-over {
        border-style: solid;
        transform: scale(1.02);
      }
    </style>
  </head>
  <body
    class="text-slate-800 bg-slate-50 dark:bg-slate-900 dark:text-slate-200 transition-colors duration-300"
  >
    <!-- NAVIGATION -->
    <nav
      class="fixed top-0 w-full z-50 glass-panel transition-all duration-300"
    >
      <div class="max-w-7xl mx-auto px-4">
        <div class="flex justify-between h-16 items-center">
          <!-- Left: Back & Logo -->
          <div class="flex items-center gap-4">
            <!-- Back Button -->
            <a
              href="../chemstudybaby.html"
              class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 hover:bg-slate-200 text-slate-600 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700 transition"
            >
              <i class="fa-solid fa-arrow-left"></i>
            </a>

            <!-- Logo & Title -->
            <div class="flex flex-col">
              <div class="flex items-center gap-2">
                <div
                  class="w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-lg flex items-center justify-center text-white font-bold text-sm shadow-lg"
                >
                  <i class="fa-solid fa-atom fa-spin-slow"></i>
                </div>
                <span
                  class="font-extrabold text-xl bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary"
                >
                  ChemStudy
                </span>
              </div>
              <span
                class="text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider ml-1"
                >H√≥a h·ªçc 7</span
              >
            </div>
          </div>

          <!-- Desktop Tabs -->
          <div
            class="hidden md:flex bg-slate-100 dark:bg-slate-800 p-1 rounded-full border border-slate-200 dark:border-slate-700"
          >
            <button
              onclick="switchTab('atom')"
              class="tab-btn active px-4 py-1.5 rounded-full text-xs font-bold transition-all"
            >
              I. Nguy√™n T·ª≠
            </button>
            <button
              onclick="switchTab('element')"
              class="tab-btn px-4 py-1.5 rounded-full text-xs font-bold transition-all dark:text-slate-300"
            >
              II. Nguy√™n T·ªë
            </button>
            <button
              onclick="switchTab('ptable')"
              class="tab-btn px-4 py-1.5 rounded-full text-xs font-bold transition-all dark:text-slate-300"
            >
              III. B·∫£ng Tu·∫ßn Ho√†n
            </button>
            <button
              onclick="switchTab('practice')"
              class="tab-btn px-4 py-1.5 rounded-full text-xs font-bold transition-all dark:text-slate-300"
            >
              Luy·ªán T·∫≠p
            </button>
          </div>

          <!-- Right: Controls -->
          <div class="flex items-center gap-2">
            <!-- Theme Toggle -->
            <button
              onclick="toggleTheme()"
              class="w-9 h-9 rounded-full bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-yellow-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition flex items-center justify-center"
            >
              <i class="fa-solid fa-sun dark:hidden"></i>
              <i class="fa-solid fa-moon hidden dark:inline"></i>
            </button>

            <!-- Mobile Menu Btn -->
            <button
              class="md:hidden text-slate-600 dark:text-slate-300 text-xl p-2"
              onclick="toggleMobileMenu()"
            >
              <i class="fa-solid fa-bars"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Mobile Menu -->
      <div
        id="mobile-menu"
        class="hidden md:hidden bg-white dark:bg-slate-900 border-t dark:border-slate-800 px-4 pb-4 shadow-lg"
      >
        <div class="flex flex-col gap-2 mt-2">
          <button
            onclick="switchTab('atom')"
            class="text-left p-3 rounded-lg font-bold hover:bg-slate-50 dark:hover:bg-slate-800 text-primary"
          >
            I. Nguy√™n T·ª≠
          </button>
          <button
            onclick="switchTab('element')"
            class="text-left p-3 rounded-lg font-bold hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-300"
          >
            II. Nguy√™n T·ªë
          </button>
          <button
            onclick="switchTab('ptable')"
            class="text-left p-3 rounded-lg font-bold hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-300"
          >
            III. B·∫£ng Tu·∫ßn Ho√†n
          </button>
          <button
            onclick="switchTab('practice')"
            class="text-left p-3 rounded-lg font-bold hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-300"
          >
            Luy·ªán T·∫≠p
          </button>
        </div>
      </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="pt-24 pb-12 px-4 max-w-7xl mx-auto min-h-screen">
      <!-- === SECTION I: NGUY√äN T·ª¨ === -->
      <section id="atom" class="tab-content fade-in">
        <div class="text-center mb-8">
          <span
            class="px-3 py-1 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 text-xs font-bold uppercase tracking-wider mb-2 inline-block"
            >I.</span
          >
          <h1
            class="text-3xl md:text-4xl font-extrabold text-slate-800 dark:text-white mb-2"
          >
            C·∫§U T·∫†O NGUY√äN T·ª¨
          </h1>
          <p class="text-slate-500 dark:text-slate-400">
            Kh√°m ph√° m√¥ h√¨nh Rutherford - Bohr & Kh·ªëi l∆∞·ª£ng nguy√™n t·ª≠
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
          <!-- Theory Column -->
          <div class="lg:col-span-4 space-y-6">
            <!-- 1. M√¥ h√¨nh Rutherford -->
            <div
              class="bg-white dark:bg-dark-card rounded-xl p-6 card-shadow border border-slate-100 dark:border-slate-700"
            >
              <h3
                class="text-lg font-bold text-primary mb-3 flex items-center gap-2"
              >
                <span
                  class="bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 w-8 h-8 rounded-lg flex items-center justify-center text-sm"
                  >1</span
                >
                M√¥ h√¨nh Nguy√™n t·ª≠
              </h3>
              <ul class="space-y-3 text-sm text-slate-700 dark:text-slate-300">
                <li
                  class="pl-3 border-l-4 border-green-400 bg-green-50/50 dark:bg-green-900/10 p-2 rounded-r"
                >
                  <b class="text-green-700 dark:text-green-400"
                    >H·∫°t nh√¢n (+):</b
                  >
                  N·∫±m ·ªü t√¢m, g·ªìm Proton (p, +) v√† Neutron (n, kh√¥ng m√†u).
                </li>
                <li
                  class="pl-3 border-l-4 border-blue-400 bg-blue-50/50 dark:bg-blue-900/10 p-2 rounded-r"
                >
                  <b class="text-blue-700 dark:text-blue-400"
                    >V·ªè electron (-):</b
                  >
                  C√°c h·∫°t e (-) chuy·ªÉn ƒë·ªông r·∫•t nhanh xung quanh theo l·ªõp.
                </li>
                <li
                  class="bg-slate-100 dark:bg-slate-800 p-2 rounded-lg text-center font-bold text-slate-800 dark:text-slate-200 border border-slate-200 dark:border-slate-600 mt-2"
                >
                  ‚ö° Trung h√≤a ƒëi·ªán: S·ªë p = S·ªë e
                </li>
              </ul>

              <!-- Visualization -->
              <div
                class="mt-4 bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded-lg border border-yellow-100 dark:border-yellow-900/30"
              >
                <p
                  class="text-xs font-bold text-yellow-700 dark:text-yellow-400 uppercase mb-1"
                >
                  So s√°nh vui
                </p>
                <p class="text-sm text-yellow-800 dark:text-yellow-200 italic">
                  "N·∫øu nguy√™n t·ª≠ to b·∫±ng s√¢n v·∫≠n ƒë·ªông, th√¨ h·∫°t nh√¢n ch·ªâ nh∆∞ m·ªôt
                  h√≤n bi ·ªü gi·ªØa s√¢n."
                </p>
              </div>
            </div>

            <!-- 2. Kh·ªëi l∆∞·ª£ng nguy√™n t·ª≠ -->
            <div
              class="bg-white dark:bg-dark-card rounded-xl p-6 card-shadow border border-slate-100 dark:border-slate-700"
            >
              <h3
                class="text-lg font-bold text-primary mb-3 flex items-center gap-2"
              >
                <span
                  class="bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 w-8 h-8 rounded-lg flex items-center justify-center text-sm"
                  >2</span
                >
                Kh·ªëi l∆∞·ª£ng nguy√™n t·ª≠
              </h3>
              <div class="space-y-3 text-sm text-slate-700 dark:text-slate-300">
                <p><b>ƒê∆°n v·ªã:</b> amu (atomic mass unit).</p>
                <p>1 amu = 1/12 kh·ªëi l∆∞·ª£ng nguy√™n t·ª≠ Carbon-12.</p>
                <div
                  class="bg-indigo-50 dark:bg-indigo-900/20 p-3 rounded border border-indigo-100 dark:border-indigo-800 text-center"
                >
                  <b>C√¥ng th·ª©c t√≠nh g·∫ßn ƒë√∫ng:</b><br />
                  <span
                    class="text-lg font-bold text-indigo-700 dark:text-indigo-400"
                    >Kh·ªëi l∆∞·ª£ng ‚âà p + n</span
                  >
                  <div class="text-[10px] text-slate-500 mt-1">
                    (B·ªè qua kh·ªëi l∆∞·ª£ng electron v√¨ r·∫•t nh·ªè)
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Simulation Column -->
          <div class="lg:col-span-8 space-y-6">
            <!-- Simulator -->
            <div
              class="bg-slate-900 dark:bg-black rounded-2xl p-4 shadow-xl overflow-hidden relative min-h-[450px] border border-slate-800"
            >
              <div class="absolute top-4 left-4 z-10">
                <span
                  class="bg-white/10 text-white px-3 py-1 rounded-full text-sm backdrop-blur-md border border-white/20 font-bold shadow-lg"
                  id="atom-name-display"
                  >Hydrogen (H)</span
                >
              </div>

              <div
                class="absolute top-4 right-4 z-10 flex flex-col gap-1 text-xs text-white bg-black/60 p-3 rounded-lg backdrop-blur-md border border-white/10 w-44 shadow-lg"
              >
                <div class="flex justify-between items-center">
                  <span>Proton (p):</span>
                  <span
                    id="p-count"
                    class="font-bold text-red-400 bg-red-900/30 px-2 rounded"
                    >1</span
                  >
                </div>
                <div class="flex justify-between items-center mt-1">
                  <span>Neutron (n):</span>
                  <span
                    id="n-count"
                    class="font-bold text-gray-400 bg-gray-700/50 px-2 rounded"
                    >0</span
                  >
                </div>
                <div class="flex justify-between items-center mt-1">
                  <span>Electron (e):</span>
                  <span
                    id="e-count"
                    class="font-bold text-blue-400 bg-blue-900/30 px-2 rounded"
                    >1</span
                  >
                </div>
                <div class="h-px bg-white/20 my-2"></div>
                <div class="flex justify-between items-center">
                  <span>Kh·ªëi l∆∞·ª£ng (A):</span>
                  <span
                    id="mass-display"
                    class="font-bold text-green-400 text-sm"
                    >1</span
                  >
                </div>
                <div
                  id="charge-status"
                  class="text-center font-bold text-green-400 mt-2 text-[10px] uppercase border border-green-500/30 rounded py-1"
                >
                  Trung h√≤a
                </div>
              </div>

              <canvas
                id="atomCanvas"
                class="w-full h-[400px] cursor-pointer"
              ></canvas>

              <!-- Controls -->
              <div class="flex justify-center flex-wrap gap-4 mt-2">
                <div
                  class="bg-slate-800/80 p-2 rounded-lg backdrop-blur-sm border border-slate-700"
                >
                  <div
                    class="text-red-400 text-[10px] font-bold text-center mb-1"
                  >
                    PROTON (+)
                  </div>
                  <div class="flex gap-1">
                    <button
                      onclick="updateAtom('p', -1)"
                      class="w-8 h-8 rounded bg-slate-700 hover:bg-red-900/80 text-white font-bold transition"
                    >
                      -
                    </button>
                    <button
                      onclick="updateAtom('p', 1)"
                      class="w-8 h-8 rounded bg-slate-700 hover:bg-red-600 text-white font-bold transition"
                    >
                      +
                    </button>
                  </div>
                </div>
                <div
                  class="bg-slate-800/80 p-2 rounded-lg backdrop-blur-sm border border-slate-700"
                >
                  <div
                    class="text-gray-400 text-[10px] font-bold text-center mb-1"
                  >
                    NEUTRON
                  </div>
                  <div class="flex gap-1">
                    <button
                      onclick="updateAtom('n', -1)"
                      class="w-8 h-8 rounded bg-slate-700 hover:bg-gray-600 text-white font-bold transition"
                    >
                      -
                    </button>
                    <button
                      onclick="updateAtom('n', 1)"
                      class="w-8 h-8 rounded bg-slate-700 hover:bg-gray-500 text-white font-bold transition"
                    >
                      +
                    </button>
                  </div>
                </div>
                <div
                  class="bg-slate-800/80 p-2 rounded-lg backdrop-blur-sm border border-slate-700"
                >
                  <div
                    class="text-blue-400 text-[10px] font-bold text-center mb-1"
                  >
                    ELECTRON (-)
                  </div>
                  <div class="flex gap-1">
                    <button
                      onclick="updateAtom('e', -1)"
                      class="w-8 h-8 rounded bg-slate-700 hover:bg-blue-900/80 text-white font-bold transition"
                    >
                      -
                    </button>
                    <button
                      onclick="updateAtom('e', 1)"
                      class="w-8 h-8 rounded bg-slate-700 hover:bg-blue-600 text-white font-bold transition"
                    >
                      +
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Mini Exercises -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div
                class="bg-orange-50 dark:bg-orange-900/10 p-4 rounded-xl border border-orange-100 dark:border-orange-900/30"
              >
                <h4
                  class="font-bold text-orange-800 dark:text-orange-400 text-sm mb-2"
                >
                  <i class="fa-solid fa-calculator mr-1"></i> T√≠nh s·ªë h·∫°t
                  Neutron
                </h4>
                <p class="text-sm text-slate-700 dark:text-slate-300 mb-2">
                  Nguy√™n t·ª≠ Natri c√≥ <b>11 proton</b> v√† s·ªë kh·ªëi l√† <b>23</b>.
                </p>
                <div class="flex gap-2">
                  <input
                    type="number"
                    id="ex1-input"
                    class="w-20 p-1.5 text-sm border rounded dark:bg-slate-800 dark:border-slate-600 dark:text-white"
                    placeholder="?"
                  />
                  <button
                    onclick="checkEx1()"
                    class="px-3 py-1 bg-orange-500 text-white text-sm rounded hover:bg-orange-600 transition shadow-sm font-bold"
                  >
                    Ki·ªÉm tra
                  </button>
                </div>
              </div>
              <div
                class="bg-purple-50 dark:bg-purple-900/10 p-4 rounded-xl border border-purple-100 dark:border-purple-900/30"
              >
                <h4
                  class="font-bold text-purple-800 dark:text-purple-400 text-sm mb-2"
                >
                  <i class="fa-solid fa-weight-hanging mr-1"></i> T√≠nh kh·ªëi
                  l∆∞·ª£ng
                </h4>
                <p class="text-sm text-slate-700 dark:text-slate-300 mb-2">
                  Nguy√™n t·ª≠ Nit∆° c√≥ <b>7 p, 7 n</b>. Kh·ªëi l∆∞·ª£ng (amu)?
                </p>
                <div class="flex gap-2">
                  <input
                    type="number"
                    id="ex2-input"
                    class="w-20 p-1.5 text-sm border rounded dark:bg-slate-800 dark:border-slate-600 dark:text-white"
                    placeholder="?"
                  />
                  <button
                    onclick="checkEx2()"
                    class="px-3 py-1 bg-purple-500 text-white text-sm rounded hover:bg-purple-600 transition shadow-sm font-bold"
                  >
                    Ki·ªÉm tra
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- === SECTION II: NGUY√äN T·ªê === -->
      <section id="element" class="hidden tab-content fade-in">
        <div class="text-center mb-8">
          <span
            class="px-3 py-1 rounded-full bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 text-xs font-bold uppercase tracking-wider mb-2 inline-block"
            >II.</span
          >
          <h1
            class="text-3xl md:text-4xl font-extrabold text-slate-800 dark:text-white mb-2"
          >
            NGUY√äN T·ªê H√ìA H·ªåC
          </h1>
          <p class="text-slate-500 dark:text-slate-400">
            T√™n g·ªçi, K√≠ hi·ªáu & C√¥ng th·ª©c h√≥a h·ªçc
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
          <!-- Info Card -->
          <div class="lg:col-span-1 space-y-4">
            <div
              class="bg-white dark:bg-dark-card p-6 rounded-xl card-shadow border border-slate-100 dark:border-slate-700"
            >
              <h3 class="font-bold text-primary mb-3">1. Kh√°i ni·ªám</h3>
              <p class="text-sm text-slate-600 dark:text-slate-300 mb-3">
                T·∫≠p h·ª£p nh·ªØng nguy√™n t·ª≠ c√≥ <b>c√πng s·ªë proton</b> trong h·∫°t nh√¢n.
              </p>
              <ul class="text-sm space-y-2 mb-4">
                <li
                  class="flex items-center justify-between bg-slate-50 dark:bg-slate-800 p-2 rounded"
                >
                  <span class="text-slate-500 dark:text-slate-400"
                    >1 proton</span
                  >
                  <b class="dark:text-white">Hydrogen (H)</b>
                </li>
                <li
                  class="flex items-center justify-between bg-slate-50 dark:bg-slate-800 p-2 rounded"
                >
                  <span class="text-slate-500 dark:text-slate-400"
                    >6 proton</span
                  >
                  <b class="dark:text-white">Carbon (C)</b>
                </li>
                <li
                  class="flex items-center justify-between bg-slate-50 dark:bg-slate-800 p-2 rounded"
                >
                  <span class="text-slate-500 dark:text-slate-400"
                    >8 proton</span
                  >
                  <b class="dark:text-white">Oxygen (O)</b>
                </li>
              </ul>
            </div>

            <div
              class="bg-white dark:bg-dark-card p-6 rounded-xl card-shadow border border-slate-100 dark:border-slate-700"
            >
              <h3 class="font-bold text-primary mb-3">2. Quy t·∫Øc k√≠ hi·ªáu</h3>
              <p class="text-sm text-slate-600 dark:text-slate-300 mb-2">
                1 ho·∫∑c 2 ch·ªØ c√°i. Ch·ªØ ƒë·∫ßu vi·∫øt hoa, ch·ªØ sau (n·∫øu c√≥) vi·∫øt
                th∆∞·ªùng.
              </p>
              <div class="grid grid-cols-2 gap-2 text-center text-sm">
                <div
                  class="p-2 border rounded bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800"
                >
                  <span
                    class="block font-bold text-lg text-green-700 dark:text-green-400"
                    >Ca</span
                  >
                  <span class="text-xs text-green-600 dark:text-green-500"
                    >ƒê√∫ng</span
                  >
                </div>
                <div
                  class="p-2 border rounded bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"
                >
                  <span
                    class="block font-bold text-lg text-red-700 dark:text-red-400"
                    >CA</span
                  >
                  <span class="text-xs text-red-600 dark:text-red-500"
                    >Sai</span
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Interactive Flashcards -->
          <div class="lg:col-span-2">
            <div
              class="bg-white dark:bg-dark-card p-6 rounded-xl card-shadow border border-slate-100 dark:border-slate-700 h-full"
            >
              <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-slate-700 dark:text-slate-200">
                  Th·ª≠ th√°ch: L·∫≠t th·∫ª nh·ªõ t√™n
                </h3>
                <button
                  onclick="initFlashcards()"
                  class="text-xs bg-slate-100 dark:bg-slate-700 dark:text-slate-300 px-3 py-1 rounded-full hover:bg-slate-200 dark:hover:bg-slate-600 transition"
                >
                  L√†m m·ªõi
                </button>
              </div>
              <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">
                T√¨m c·∫∑p <b>T√™n nguy√™n t·ªë</b> v√† <b>K√≠ hi·ªáu</b> t∆∞∆°ng ·ª©ng:
              </p>
              <div
                id="flashcard-grid"
                class="grid grid-cols-3 sm:grid-cols-4 gap-3"
              ></div>
            </div>
          </div>
        </div>

        <!-- Formula Analysis -->
        <div
          class="bg-white dark:bg-dark-card p-6 rounded-xl card-shadow border border-slate-100 dark:border-slate-700 mb-8"
        >
          <h3 class="font-bold text-primary mb-4 text-lg">
            Ph√¢n T√≠ch C√¥ng Th·ª©c H√≥a H·ªçc
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
            <div>
              <p class="text-sm text-slate-600 dark:text-slate-300 mb-4">
                Ch·ªçn m·ªôt ch·∫•t ƒë·ªÉ xem m√¥ h√¨nh ph√¢n t·ª≠:
              </p>
              <div class="flex flex-wrap gap-2 mb-4">
                <button
                  onclick="analyzeFormula('O2')"
                  class="px-4 py-2 bg-slate-100 dark:bg-slate-800 hover:bg-blue-100 dark:hover:bg-blue-900 text-slate-700 dark:text-slate-300 rounded-lg font-bold transition"
                >
                  O‚ÇÇ
                </button>
                <button
                  onclick="analyzeFormula('H2O')"
                  class="px-4 py-2 bg-slate-100 dark:bg-slate-800 hover:bg-blue-100 dark:hover:bg-blue-900 text-slate-700 dark:text-slate-300 rounded-lg font-bold transition"
                >
                  H‚ÇÇO
                </button>
                <button
                  onclick="analyzeFormula('CO2')"
                  class="px-4 py-2 bg-slate-100 dark:bg-slate-800 hover:bg-blue-100 dark:hover:bg-blue-900 text-slate-700 dark:text-slate-300 rounded-lg font-bold transition"
                >
                  CO‚ÇÇ
                </button>
                <button
                  onclick="analyzeFormula('CaCO3')"
                  class="px-4 py-2 bg-slate-100 dark:bg-slate-800 hover:bg-blue-100 dark:hover:bg-blue-900 text-slate-700 dark:text-slate-300 rounded-lg font-bold transition"
                >
                  CaCO‚ÇÉ
                </button>
                <button
                  onclick="analyzeFormula('Al2O3')"
                  class="px-4 py-2 bg-slate-100 dark:bg-slate-800 hover:bg-blue-100 dark:hover:bg-blue-900 text-slate-700 dark:text-slate-300 rounded-lg font-bold transition"
                >
                  Al‚ÇÇO‚ÇÉ
                </button>
              </div>
            </div>
            <div
              id="formula-display"
              class="min-h-[180px] bg-slate-50 dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 flex flex-col items-center justify-center p-4 transition-all"
            >
              <span class="text-slate-400 text-sm"
                >Ch·ªçn ch·∫•t b√™n tr√°i ƒë·ªÉ xem...</span
              >
            </div>
          </div>
        </div>

        <!-- Write Symbols Exercise -->
        <div
          class="bg-indigo-50 dark:bg-indigo-900/20 p-6 rounded-xl border border-indigo-100 dark:border-indigo-900/30"
        >
          <h3
            class="font-bold text-indigo-800 dark:text-indigo-400 mb-4 flex items-center gap-2"
          >
            <i class="fa-solid fa-pen-nib"></i> Luy·ªán vi·∫øt k√≠ hi·ªáu nhanh
          </h3>
          <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            <div>
              <label
                class="text-xs text-indigo-900 dark:text-indigo-300 block mb-1 font-bold"
                >L∆∞u hu·ª≥nh</label
              >
              <input
                type="text"
                data-ans="S"
                class="ex-sym w-full p-2 rounded border border-indigo-200 dark:border-indigo-700 dark:bg-slate-800 dark:text-white text-center uppercase focus:ring-2 focus:ring-indigo-400 outline-none"
                placeholder="?"
              />
            </div>
            <div>
              <label
                class="text-xs text-indigo-900 dark:text-indigo-300 block mb-1 font-bold"
                >Clo</label
              >
              <input
                type="text"
                data-ans="Cl"
                class="ex-sym w-full p-2 rounded border border-indigo-200 dark:border-indigo-700 dark:bg-slate-800 dark:text-white text-center focus:ring-2 focus:ring-indigo-400 outline-none"
                placeholder="?"
              />
            </div>
            <div>
              <label
                class="text-xs text-indigo-900 dark:text-indigo-300 block mb-1 font-bold"
                >Canxi</label
              >
              <input
                type="text"
                data-ans="Ca"
                class="ex-sym w-full p-2 rounded border border-indigo-200 dark:border-indigo-700 dark:bg-slate-800 dark:text-white text-center focus:ring-2 focus:ring-indigo-400 outline-none"
                placeholder="?"
              />
            </div>
            <div>
              <label
                class="text-xs text-indigo-900 dark:text-indigo-300 block mb-1 font-bold"
                >Nh√¥m</label
              >
              <input
                type="text"
                data-ans="Al"
                class="ex-sym w-full p-2 rounded border border-indigo-200 dark:border-indigo-700 dark:bg-slate-800 dark:text-white text-center focus:ring-2 focus:ring-indigo-400 outline-none"
                placeholder="?"
              />
            </div>
            <div>
              <label
                class="text-xs text-indigo-900 dark:text-indigo-300 block mb-1 font-bold"
                >Nito</label
              >
              <input
                type="text"
                data-ans="N"
                class="ex-sym w-full p-2 rounded border border-indigo-200 dark:border-indigo-700 dark:bg-slate-800 dark:text-white text-center uppercase focus:ring-2 focus:ring-indigo-400 outline-none"
                placeholder="?"
              />
            </div>
          </div>
          <button
            onclick="checkSymbolEx()"
            class="mt-4 px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition text-sm font-bold shadow-md"
          >
            Ki·ªÉm tra ƒë√°p √°n
          </button>
        </div>
      </section>

      <!-- === SECTION III: B·∫¢NG TU·∫¶N HO√ÄN === -->
      <section id="ptable" class="hidden tab-content fade-in">
        <div class="text-center mb-8">
          <span
            class="px-3 py-1 rounded-full bg-teal-100 dark:bg-teal-900/30 text-teal-600 dark:text-teal-400 text-xs font-bold uppercase tracking-wider mb-2 inline-block"
            >III.</span
          >
          <h1
            class="text-3xl md:text-4xl font-extrabold text-slate-800 dark:text-white mb-2"
          >
            B·∫¢NG TU·∫¶N HO√ÄN
          </h1>
          <p class="text-slate-500 dark:text-slate-400">
            Nguy√™n t·∫Øc s·∫Øp x·∫øp, Ph√¢n lo·∫°i & ·ª®ng d·ª•ng
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <div
            class="bg-white dark:bg-dark-card p-6 rounded-xl card-shadow border border-slate-100 dark:border-slate-700"
          >
            <h3 class="font-bold text-primary mb-2">1. S∆° l∆∞·ª£c & L·ªãch s·ª≠</h3>
            <p class="text-sm text-slate-600 dark:text-slate-300 mb-4">
              C√°c nguy√™n t·ªë ƒë∆∞·ª£c s·∫Øp x·∫øp theo chi·ªÅu
              <b>tƒÉng d·∫ßn s·ªë hi·ªáu nguy√™n t·ª≠ (s·ªë p)</b>.
            </p>
            <div
              class="bg-orange-50 dark:bg-orange-900/10 p-3 rounded border border-orange-100 dark:border-orange-900/30 flex gap-3 items-start"
            >
              <img
                src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Dmitri_Mendeleev_1890s.jpg/220px-Dmitri_Mendeleev_1890s.jpg"
                class="w-12 h-16 object-cover rounded shadow"
                alt="Mendeleev"
              />
              <div class="text-xs text-orange-900 dark:text-orange-300">
                <b>Dmitri Mendeleev (1869)</b> - Nh√† b√°c h·ªçc ng∆∞·ªùi Nga, ng∆∞·ªùi
                cha ƒë·∫ª c·ªßa b·∫£ng tu·∫ßn ho√†n, ƒë√£ d·ª± ƒëo√°n ch√≠nh x√°c t√≠nh ch·∫•t c·ªßa
                c√°c nguy√™n t·ªë ch∆∞a ƒë∆∞·ª£c t√¨m th·∫•y th·ªùi ƒë√≥.
              </div>
            </div>
          </div>
          <div
            class="bg-white dark:bg-dark-card p-6 rounded-xl card-shadow border border-slate-100 dark:border-slate-700"
          >
            <h3 class="font-bold text-primary mb-2">2. C·∫•u t·∫°o b·∫£ng</h3>
            <ul class="space-y-3 text-sm text-slate-700 dark:text-slate-300">
              <li class="flex items-center gap-3">
                <span
                  class="bg-slate-200 dark:bg-slate-700 dark:text-white px-2 py-1 rounded text-xs font-bold w-24 text-center"
                  >√î nguy√™n t·ªë</span
                >
                <span>Ch·ª©a k√≠ hi·ªáu, t√™n, s·ªë hi·ªáu nguy√™n t·ª≠ (Z).</span>
              </li>
              <li class="flex items-center gap-3">
                <span
                  class="bg-slate-200 dark:bg-slate-700 dark:text-white px-2 py-1 rounded text-xs font-bold w-24 text-center"
                  >Chu k√¨ (7)</span
                >
                <span>H√†ng ngang. C√°c nguy√™n t·ªë c√≥ c√πng s·ªë l·ªõp e.</span>
              </li>
              <li class="flex items-center gap-3">
                <span
                  class="bg-slate-200 dark:bg-slate-700 dark:text-white px-2 py-1 rounded text-xs font-bold w-24 text-center"
                  >Nh√≥m (18)</span
                >
                <span>C·ªôt d·ªçc. T√≠nh ch·∫•t h√≥a h·ªçc t∆∞∆°ng t·ª± nhau.</span>
              </li>
            </ul>
          </div>
        </div>

        <div class="mb-8">
          <h3
            class="font-bold text-slate-700 dark:text-slate-200 mb-4 text-center"
          >
            3. Ph√¢n Lo·∫°i & ·ª®ng D·ª•ng Th·ª±c T·∫ø
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Metal -->
            <div
              class="bg-gradient-to-br from-yellow-50 to-white dark:from-yellow-900/20 dark:to-slate-800 p-5 rounded-xl border border-yellow-200 dark:border-yellow-700/50 interactive-hover"
            >
              <h4
                class="font-bold text-yellow-800 dark:text-yellow-400 flex items-center gap-2 mb-2"
              >
                <i class="fa-solid fa-hammer"></i> Kim Lo·∫°i
              </h4>
              <p
                class="text-xs text-yellow-900 dark:text-yellow-200 mb-3 opacity-80"
              >
                D·∫´n ƒëi·ªán/nhi·ªát t·ªët, c√≥ √°nh kim, d·∫ªo. Th∆∞·ªùng nh∆∞·ªùng e (t·∫°o
                Cation).
              </p>
              <div class="flex gap-1 flex-wrap">
                <span
                  class="text-[10px] bg-white dark:bg-slate-900 border border-yellow-200 dark:border-yellow-800 px-2 py-1 rounded"
                  >S·∫Øt (Fe)</span
                >
                <span
                  class="text-[10px] bg-white dark:bg-slate-900 border border-yellow-200 dark:border-yellow-800 px-2 py-1 rounded"
                  >Nh√¥m (Al)</span
                >
                <span
                  class="text-[10px] bg-white dark:bg-slate-900 border border-yellow-200 dark:border-yellow-800 px-2 py-1 rounded"
                  >ƒê·ªìng (Cu)</span
                >
              </div>
            </div>
            <!-- Non-metal -->
            <div
              class="bg-gradient-to-br from-green-50 to-white dark:from-green-900/20 dark:to-slate-800 p-5 rounded-xl border border-green-200 dark:border-green-700/50 interactive-hover"
            >
              <h4
                class="font-bold text-green-800 dark:text-green-400 flex items-center gap-2 mb-2"
              >
                <i class="fa-solid fa-cloud"></i> Phi Kim
              </h4>
              <p
                class="text-xs text-green-900 dark:text-green-200 mb-3 opacity-80"
              >
                Kh√¥ng d·∫´n ƒëi·ªán/nhi·ªát, gi√≤n. Th∆∞·ªùng nh·∫≠n e (t·∫°o Anion).
              </p>
              <div class="flex gap-1 flex-wrap">
                <span
                  class="text-[10px] bg-white dark:bg-slate-900 border border-green-200 dark:border-green-800 px-2 py-1 rounded"
                  >Oxi (O)</span
                >
                <span
                  class="text-[10px] bg-white dark:bg-slate-900 border border-green-200 dark:border-green-800 px-2 py-1 rounded"
                  >L∆∞u hu·ª≥nh (S)</span
                >
                <span
                  class="text-[10px] bg-white dark:bg-slate-900 border border-green-200 dark:border-green-800 px-2 py-1 rounded"
                  >Clo (Cl)</span
                >
              </div>
            </div>
            <!-- Noble Gas -->
            <div
              class="bg-gradient-to-br from-blue-50 to-white dark:from-blue-900/20 dark:to-slate-800 p-5 rounded-xl border border-blue-200 dark:border-blue-700/50 interactive-hover"
            >
              <h4
                class="font-bold text-blue-800 dark:text-blue-400 flex items-center gap-2 mb-2"
              >
                <i class="fa-solid fa-wind"></i> Kh√≠ Hi·∫øm
              </h4>
              <p
                class="text-xs text-blue-900 dark:text-blue-200 mb-3 opacity-80"
              >
                Nh√≥m 18. Tr∆°, b·ªÅn v·ªØng, kh√¥ng tham gia ph·∫£n ·ª©ng.
              </p>
              <div class="flex gap-1 flex-wrap">
                <span
                  class="text-[10px] bg-white dark:bg-slate-900 border border-blue-200 dark:border-blue-800 px-2 py-1 rounded"
                  >Heli (He)</span
                >
                <span
                  class="text-[10px] bg-white dark:bg-slate-900 border border-blue-200 dark:border-blue-800 px-2 py-1 rounded"
                  >Neon (Ne)</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Drag Game -->
        <div
          class="bg-white dark:bg-dark-card p-6 rounded-xl card-shadow border border-slate-100 dark:border-slate-700"
        >
          <div class="flex justify-between items-center mb-4">
            <h3 class="font-bold text-slate-700 dark:text-slate-200">
              Tr√≤ ch∆°i: Ph√¢n lo·∫°i nguy√™n t·ªë
            </h3>
            <button
              onclick="resetDragGame()"
              class="text-xs text-primary underline"
            >
              Ch∆°i l·∫°i
            </button>
          </div>

          <p class="text-sm text-slate-500 mb-4 dark:text-slate-400">
            K√©o c√°c nguy√™n t·ªë v√†o ƒë√∫ng nh√≥m c·ªßa ch√∫ng:
          </p>

          <div
            class="flex flex-wrap justify-center gap-3 mb-6 min-h-[60px] bg-slate-50 dark:bg-slate-800 p-4 rounded-lg border border-dashed border-slate-300 dark:border-slate-600"
            id="draggables-container"
          >
            <!-- Items will be injected here -->
          </div>

          <div class="grid grid-cols-3 gap-4">
            <div
              class="drop-zone min-h-[120px] border-2 border-dashed border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-900/10 rounded-xl flex flex-col items-center justify-center p-2 transition-all"
              ondragover="allowDrop(event)"
              ondrop="drop(event, 'metal')"
              onclick="handleMobileDrop('metal')"
            >
              <i class="fa-solid fa-hammer text-yellow-500 mb-2"></i>
              <span
                class="text-xs font-bold text-yellow-700 dark:text-yellow-400"
                >Kim Lo·∫°i</span
              >
            </div>
            <div
              class="drop-zone min-h-[120px] border-2 border-dashed border-green-300 dark:border-green-700 bg-green-50 dark:bg-green-900/10 rounded-xl flex flex-col items-center justify-center p-2 transition-all"
              ondragover="allowDrop(event)"
              ondrop="drop(event, 'nonmetal')"
              onclick="handleMobileDrop('nonmetal')"
            >
              <i class="fa-solid fa-cloud text-green-500 mb-2"></i>
              <span class="text-xs font-bold text-green-700 dark:text-green-400"
                >Phi Kim</span
              >
            </div>
            <div
              class="drop-zone min-h-[120px] border-2 border-dashed border-blue-300 dark:border-blue-700 bg-blue-50 dark:bg-blue-900/10 rounded-xl flex flex-col items-center justify-center p-2 transition-all"
              ondragover="allowDrop(event)"
              ondrop="drop(event, 'noble')"
              onclick="handleMobileDrop('noble')"
            >
              <i class="fa-solid fa-wind text-blue-500 mb-2"></i>
              <span class="text-xs font-bold text-blue-700 dark:text-blue-400"
                >Kh√≠ Hi·∫øm</span
              >
            </div>
          </div>
          <p
            class="text-center text-[10px] text-slate-400 mt-2 italic md:hidden"
          >
            (Ch·∫°m v√†o th·∫ª r·ªìi ch·∫°m v√†o √¥ ƒë·ªÉ ch·ªçn)
          </p>
        </div>
      </section>

      <!-- === SECTION IV: LUY·ªÜN T·∫¨P === -->
      <section id="practice" class="hidden tab-content fade-in">
        <div class="text-center mb-8">
          <span
            class="px-3 py-1 rounded-full bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 text-xs font-bold uppercase tracking-wider mb-2 inline-block"
            >Ki·ªÉm tra</span
          >
          <h1
            class="text-3xl md:text-4xl font-extrabold text-slate-800 dark:text-white mb-2"
          >
            T·ªîNG H·ª¢P & LUY·ªÜN T·∫¨P
          </h1>
          <p class="text-slate-500 dark:text-slate-400">
            Ki·ªÉm tra ki·∫øn th·ª©c to√†n b·ªô ch·ªß ƒë·ªÅ
          </p>
        </div>

        <div class="max-w-3xl mx-auto">
          <div id="quiz-container" class="space-y-6">
            <!-- Quiz Items -->
          </div>

          <div
            id="quiz-result"
            class="hidden mt-8 bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-8 rounded-2xl text-center shadow-xl"
          >
            <div class="text-5xl mb-4">üéâ</div>
            <h3 class="font-bold text-2xl mb-2">B·∫°n ƒë√£ ho√†n th√†nh b√†i h·ªçc!</h3>
            <p class="text-indigo-100 mb-6">
              B·∫°n ƒë√£ n·∫Øm v·ªØng ki·∫øn th·ª©c c∆° b·∫£n v·ªÅ Nguy√™n t·ª≠ v√† B·∫£ng tu·∫ßn ho√†n.
            </p>
            <button
              onclick="switchTab('atom'); window.scrollTo(0,0)"
              class="bg-white text-indigo-600 px-8 py-3 rounded-full font-bold hover:bg-indigo-50 transition shadow-lg"
            >
              Quay l·∫°i t·ª´ ƒë·∫ßu
            </button>
          </div>
        </div>
      </section>
    </main>

    <!-- JS Logic -->
    <script>
      // --- THEME MANAGEMENT ---
      function toggleTheme() {
        const html = document.documentElement;
        if (html.classList.contains("dark")) {
          html.classList.remove("dark");
          localStorage.setItem("theme", "light");
        } else {
          html.classList.add("dark");
          localStorage.setItem("theme", "dark");
        }
      }

      // Init theme
      if (
        localStorage.getItem("theme") === "dark" ||
        (!("theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark");
      }

      // --- DATA ---
      const elementsData = {
        O2: {
          f: "O‚ÇÇ",
          name: "Kh√≠ Oxi",
          desc: "2 nguy√™n t·ª≠ Oxi li√™n k·∫øt v·ªõi nhau.",
          atoms: [{ s: "O", c: 2, color: "bg-red-500" }],
        },
        H2O: {
          f: "H‚ÇÇO",
          name: "N∆∞·ªõc",
          desc: "2 nguy√™n t·ª≠ Hidro v√† 1 nguy√™n t·ª≠ Oxi.",
          atoms: [
            { s: "O", c: 1, color: "bg-red-500" },
            { s: "H", c: 2, color: "bg-gray-400" },
          ],
        },
        CO2: {
          f: "CO‚ÇÇ",
          name: "Cacbon ƒëioxit",
          desc: "1 nguy√™n t·ª≠ Cacbon v√† 2 nguy√™n t·ª≠ Oxi.",
          atoms: [
            { s: "C", c: 1, color: "bg-gray-800" },
            { s: "O", c: 2, color: "bg-red-500" },
          ],
        },
        CaCO3: {
          f: "CaCO‚ÇÉ",
          name: "Canxi Cacbonat",
          desc: "ƒê√° v√¥i: 1 Ca, 1 C, 3 O.",
          atoms: [
            { s: "Ca", c: 1, color: "bg-green-600" },
            { s: "C", c: 1, color: "bg-gray-800" },
            { s: "O", c: 3, color: "bg-red-500" },
          ],
        },
        Al2O3: {
          f: "Al‚ÇÇO‚ÇÉ",
          name: "Nh√¥m Oxit",
          desc: "Th√†nh ph·∫ßn ch√≠nh c·ªßa qu·∫∑ng boxit.",
          atoms: [
            { s: "Al", c: 2, color: "bg-gray-500" },
            { s: "O", c: 3, color: "bg-red-500" },
          ],
        },
      };

      const quizQuestions = [
        {
          q: "Nguy√™n t·ª≠ trung h√≤a v·ªÅ ƒëi·ªán v√¨ l√≠ do n√†o sau ƒë√¢y?",
          opts: ["S·ªë p > S·ªë e", "S·ªë p = S·ªë e", "S·ªë n = S·ªë e"],
          ans: 1,
        },
        {
          q: "Nguy√™n t·ª≠ X c√≥ s·ªë kh·ªëi 40 v√† neutron 20. S·ªë proton l√†?",
          opts: ["20", "40", "60"],
          ans: 0,
        },
        {
          q: "K√≠ hi·ªáu h√≥a h·ªçc c·ªßa S·∫Øt, Oxi, Natri l·∫ßn l∆∞·ª£t l√†?",
          opts: ["S, O, Na", "Fe, O, N", "Fe, O, Na"],
          ans: 2,
        },
        {
          q: "C√°c nguy√™n t·ªë trong c√πng m·ªôt nh√≥m c√≥ ƒë·∫∑c ƒëi·ªÉm g√¨?",
          opts: [
            "C√πng s·ªë l·ªõp electron",
            "T√≠nh ch·∫•t h√≥a h·ªçc t∆∞∆°ng t·ª± nhau",
            "C√πng kh·ªëi l∆∞·ª£ng",
          ],
          ans: 1,
        },
        {
          q: "Oxi thu·ªôc chu k√¨ n√†o, nh√≥m n√†o? (Z=8: l·ªõp v·ªè 2,6)",
          opts: ["Chu k√¨ 2, Nh√≥m 16", "Chu k√¨ 3, Nh√≥m 2", "Chu k√¨ 2, Nh√≥m 2"],
          ans: 0,
        },
        {
          q: "ƒê√¢u l√† 3 kim lo·∫°i?",
          opts: ["Na, Fe, Cu", "O, N, C", "He, Ne, Ar"],
          ans: 0,
        },
      ];

      // --- NAVIGATION ---
      function switchTab(id) {
        document
          .querySelectorAll(".tab-content")
          .forEach((el) => el.classList.add("hidden"));
        document.getElementById(id).classList.remove("hidden");

        document
          .querySelectorAll(".tab-btn")
          .forEach((b) => b.classList.remove("active"));
        const btns = document.querySelectorAll(
          `button[onclick="switchTab('${id}')"]`
        );
        btns.forEach((b) => {
          if (b.classList.contains("tab-btn")) b.classList.add("active");
        });

        if (id === "atom") startAtomSim();
        if (id === "element") initFlashcards();
        if (id === "ptable") initDragGame();
        if (id === "practice") renderQuiz();

        document.getElementById("mobile-menu").classList.add("hidden");
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function toggleMobileMenu() {
        document.getElementById("mobile-menu").classList.toggle("hidden");
      }

      // --- ATOM SIMULATOR ---
      let atomState = { p: 1, n: 0, e: 1 };
      const canvas = document.getElementById("atomCanvas");
      const ctx = canvas.getContext("2d");
      let animId;

      const elementsMap = {
        1: "Hydrogen (H)",
        2: "Helium (He)",
        3: "Lithium (Li)",
        4: "Beryllium (Be)",
        5: "Boron (B)",
        6: "Carbon (C)",
        7: "Nitrogen (N)",
        8: "Oxygen (O)",
        11: "Sodium (Na)",
      };

      function updateAtom(type, val) {
        atomState[type] = Math.max(0, atomState[type] + val);
        if (atomState.p > 18) atomState.p = 18;

        document.getElementById("p-count").innerText = atomState.p;
        document.getElementById("n-count").innerText = atomState.n;
        document.getElementById("e-count").innerText = atomState.e;
        document.getElementById("mass-display").innerText =
          atomState.p + atomState.n;

        const name = elementsMap[atomState.p] || `Nguy√™n t·ªë Z=${atomState.p}`;
        document.getElementById("atom-name-display").innerText = name;

        const net = atomState.p - atomState.e;
        const statusEl = document.getElementById("charge-status");
        if (net === 0) {
          statusEl.innerText = "Trung h√≤a";
          statusEl.className =
            "text-center font-bold text-green-400 mt-2 text-[10px] uppercase border border-green-500/30 rounded py-1";
        } else if (net > 0) {
          statusEl.innerText = `Ion D∆∞∆°ng (+${net})`;
          statusEl.className =
            "text-center font-bold text-red-400 mt-2 text-[10px] uppercase border border-red-500/30 rounded py-1";
        } else {
          statusEl.innerText = `Ion √Çm (${net})`;
          statusEl.className =
            "text-center font-bold text-blue-400 mt-2 text-[10px] uppercase border border-blue-500/30 rounded py-1";
        }
      }

      function startAtomSim() {
        canvas.width = canvas.parentElement.clientWidth;
        canvas.height = 400;
        if (animId) cancelAnimationFrame(animId);
        animate();
      }

      let angleOffset = 0;
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const cx = canvas.width / 2,
          cy = canvas.height / 2;

        // Nucleus
        const nucR = 12 + (atomState.p + atomState.n) * 0.8;
        ctx.beginPath();
        ctx.arc(cx, cy, nucR, 0, Math.PI * 2);
        ctx.fillStyle = "#ef4444";
        ctx.fill();
        ctx.shadowBlur = 15;
        ctx.shadowColor = "#ef4444";
        ctx.fill();
        ctx.shadowBlur = 0;

        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.font = "bold 12px Arial";
        ctx.fillText(`${atomState.p}p`, cx, cy - 4);
        ctx.fillText(`${atomState.n}n`, cx, cy + 8);

        // Electrons
        let remaining = atomState.e;
        const shells = [];
        if (remaining > 0) {
          shells.push(Math.min(remaining, 2));
          remaining -= 2;
        }
        if (remaining > 0) {
          shells.push(Math.min(remaining, 8));
          remaining -= 8;
        }
        if (remaining > 0) {
          shells.push(Math.min(remaining, 8));
        }

        angleOffset += 0.015;
        shells.forEach((count, idx) => {
          const r = nucR + 40 + idx * 35;

          // Orbit path
          ctx.beginPath();
          ctx.arc(cx, cy, r, 0, Math.PI * 2);
          ctx.strokeStyle = "rgba(255,255,255,0.15)";
          ctx.lineWidth = 1;
          ctx.stroke();

          // Electrons
          for (let i = 0; i < count; i++) {
            const theta =
              angleOffset * (1 - idx * 0.2) + (Math.PI * 2 * i) / count;
            const ex = cx + Math.cos(theta) * r;
            const ey = cy + Math.sin(theta) * r;

            ctx.beginPath();
            ctx.arc(ex, ey, 6, 0, Math.PI * 2);
            ctx.fillStyle = "#3b82f6";
            ctx.fill();
            ctx.shadowBlur = 10;
            ctx.shadowColor = "#3b82f6";
            ctx.fill();
            ctx.shadowBlur = 0;
          }
        });
        animId = requestAnimationFrame(animate);
      }
      window.addEventListener("resize", startAtomSim);

      // --- EXERCISE LOGIC ---
      function checkEx1() {
        const val = document.getElementById("ex1-input").value;
        if (val == 12)
          Swal.fire("Ch√≠nh x√°c!", "n = A - p = 23 - 11 = 12", "success");
        else
          Swal.fire(
            "Ch∆∞a ƒë√∫ng",
            "G·ª£i √Ω: S·ªë neutron = S·ªë kh·ªëi - S·ªë proton",
            "error"
          );
      }
      function checkEx2() {
        const val = document.getElementById("ex2-input").value;
        if (val == 14)
          Swal.fire("Ch√≠nh x√°c!", "Kh·ªëi l∆∞·ª£ng ‚âà p + n = 14 amu", "success");
        else Swal.fire("Ch∆∞a ƒë√∫ng", "H√£y c·ªông s·ªë p v√† n l·∫°i nh√©.", "error");
      }

      function checkSymbolEx() {
        const inputs = document.querySelectorAll(".ex-sym");
        let correct = 0;
        inputs.forEach((inp) => {
          if (
            inp.value.trim().toLowerCase() === inp.dataset.ans.toLowerCase()
          ) {
            inp.classList.add(
              "bg-green-100",
              "border-green-500",
              "text-green-700"
            );
            inp.classList.remove("bg-red-100", "border-red-500");
            correct++;
          } else {
            inp.classList.add("bg-red-100", "border-red-500");
            inp.classList.remove("bg-green-100", "border-green-500");
          }
        });
        if (correct === inputs.length) {
          confetti({ particleCount: 80, spread: 60, origin: { y: 0.6 } });
          Swal.fire("Tuy·ªát v·ªùi!", "B·∫°n ƒë√£ nh·ªõ h·∫øt c√°c k√≠ hi·ªáu.", "success");
        }
      }

      // --- FLASHCARDS ---
      function initFlashcards() {
        const grid = document.getElementById("flashcard-grid");
        grid.innerHTML = "";
        const pairs = [
          { n: "Hidro", s: "H" },
          { n: "Oxi", s: "O" },
          { n: "Cacbon", s: "C" },
          { n: "Natri", s: "Na" },
          { n: "S·∫Øt", s: "Fe" },
          { n: "ƒê·ªìng", s: "Cu" },
        ];
        let cards = [];
        pairs.forEach((p) => {
          cards.push({ val: p.n, id: p.s });
          cards.push({ val: p.s, id: p.s });
        });
        cards.sort(() => Math.random() - 0.5);

        let first = null;
        let lock = false;

        cards.forEach((c) => {
          const el = document.createElement("div");
          el.className =
            "aspect-[4/3] bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-600 rounded-lg flex items-center justify-center cursor-pointer font-bold text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 transition transform hover:-translate-y-1 shadow-sm";
          el.innerHTML =
            '<i class="fa-solid fa-question text-slate-300 dark:text-slate-600"></i>';

          el.onclick = () => {
            if (
              lock ||
              el.classList.contains("flipped") ||
              el.classList.contains("matched")
            )
              return;

            el.classList.add(
              "flipped",
              "bg-blue-50",
              "dark:bg-blue-900",
              "border-blue-400"
            );
            el.innerText = c.val;

            if (!first) {
              first = { el, id: c.id };
            } else {
              lock = true;
              if (first.id === c.id) {
                // Match
                first.el.classList.add(
                  "matched",
                  "bg-green-100",
                  "dark:bg-green-900",
                  "border-green-500",
                  "text-green-700",
                  "dark:text-green-300"
                );
                el.classList.add(
                  "matched",
                  "bg-green-100",
                  "dark:bg-green-900",
                  "border-green-500",
                  "text-green-700",
                  "dark:text-green-300"
                );
                first = null;
                lock = false;
                confetti({ particleCount: 15, spread: 30, origin: { y: 0.7 } });
              } else {
                // Fail
                setTimeout(() => {
                  first.el.classList.remove(
                    "flipped",
                    "bg-blue-50",
                    "dark:bg-blue-900",
                    "border-blue-400"
                  );
                  first.el.innerHTML =
                    '<i class="fa-solid fa-question text-slate-300 dark:text-slate-600"></i>';
                  el.classList.remove(
                    "flipped",
                    "bg-blue-50",
                    "dark:bg-blue-900",
                    "border-blue-400"
                  );
                  el.innerHTML =
                    '<i class="fa-solid fa-question text-slate-300 dark:text-slate-600"></i>';
                  first = null;
                  lock = false;
                }, 800);
              }
            }
          };
          grid.appendChild(el);
        });
      }

      // --- FORMULA ANALYZER ---
      function analyzeFormula(key) {
        const d = elementsData[key];
        const container = document.getElementById("formula-display");
        let balls = "";
        d.atoms.forEach((a) => {
          for (let i = 0; i < a.c; i++) {
            balls += `<div class="w-10 h-10 ${
              a.color
            } rounded-full border-2 border-white/50 shadow-lg flex items-center justify-center text-white font-bold text-xs animate-bounce" style="animation-delay: ${Math.random()}s">${
              a.s
            }</div>`;
          }
        });
        container.innerHTML = `
            <div class="text-3xl font-extrabold text-slate-800 dark:text-white mb-2">${d.f}</div>
            <div class="flex flex-wrap justify-center gap-1 mb-3">${balls}</div>
            <div class="text-center">
                <div class="font-bold text-primary">${d.name}</div>
                <div class="text-xs text-slate-500 dark:text-slate-400 mt-1">${d.desc}</div>
            </div>
        `;
      }

      // --- DRAG GAME LOGIC ---
      let selectedMobileItem = null;

      function initDragGame() {
        const container = document.getElementById("draggables-container");
        container.innerHTML = "";
        const items = [
          {
            id: "Fe",
            text: "S·∫Øt (Fe)",
            type: "metal",
            bg: "bg-yellow-100 text-yellow-800",
          },
          {
            id: "Cu",
            text: "ƒê·ªìng (Cu)",
            type: "metal",
            bg: "bg-yellow-100 text-yellow-800",
          },
          {
            id: "O",
            text: "Oxi (O)",
            type: "nonmetal",
            bg: "bg-green-100 text-green-800",
          },
          {
            id: "S",
            text: "L∆∞u hu·ª≥nh (S)",
            type: "nonmetal",
            bg: "bg-green-100 text-green-800",
          },
          {
            id: "He",
            text: "Heli (He)",
            type: "noble",
            bg: "bg-blue-100 text-blue-800",
          },
          {
            id: "Ne",
            text: "Neon (Ne)",
            type: "noble",
            bg: "bg-blue-100 text-blue-800",
          },
        ];

        // Shuffle
        items.sort(() => Math.random() - 0.5);

        items.forEach((item) => {
          const el = document.createElement("div");
          el.draggable = true;
          el.className = `draggable-item px-3 py-2 rounded-lg font-bold text-sm shadow-sm border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white bg-white`;
          el.innerText = item.text;
          el.dataset.type = item.type;

          // Desktop Drag
          el.addEventListener("dragstart", (e) => {
            e.dataTransfer.setData("type", item.type);
            e.dataTransfer.setData("id", item.id);
            el.classList.add("opacity-50");
          });
          el.addEventListener("dragend", () =>
            el.classList.remove("opacity-50")
          );

          // Mobile Click
          el.onclick = () => {
            if (selectedMobileItem)
              selectedMobileItem.classList.remove("ring-2", "ring-primary");
            selectedMobileItem = el;
            el.classList.add("ring-2", "ring-primary");
          };

          container.appendChild(el);
        });
      }

      function allowDrop(ev) {
        ev.preventDefault();
      }

      function drop(ev, zoneType) {
        ev.preventDefault();
        const type = ev.dataTransfer.getData("type");
        const id = ev.dataTransfer.getData("id");
        processDrop(type, zoneType, id);
      }

      function handleMobileDrop(zoneType) {
        if (!selectedMobileItem) return;
        const type = selectedMobileItem.dataset.type;
        processDrop(type, zoneType, null, selectedMobileItem);
        selectedMobileItem = null;
      }

      function processDrop(itemType, zoneType, itemId, domElement) {
        if (itemType === zoneType) {
          // Success
          const zone =
            document.querySelector(`.drop-zone[data-type="${zoneType}"]`) ||
            document.querySelector(`.drop-zone[onclick*="${zoneType}"]`);

          // Visual feedback
          zone.classList.add("bg-green-200", "dark:bg-green-900");
          setTimeout(
            () => zone.classList.remove("bg-green-200", "dark:bg-green-900"),
            500
          );

          // Remove item from container
          if (domElement) {
            domElement.remove();
          } else {
            // Find element by text content logic or store ID (simplified here to just finding the dragging element logic isn't strictly needed if we just trust the UI update, but let's remove the correct one)
            const container = document.getElementById("draggables-container");
            // For desktop drag, the browser handles the ghost, we need to remove actual DOM
            // Since we don't have direct ref to dragging DOM in 'drop', we can iterate or use a global var.
            // Easier: Re-render list minus this item? Or just hide it.
            // Let's iterate children to find text match or use a global 'draggedEl'
          }
          // Re-check count
          const container = document.getElementById("draggables-container");
          // Hacky removal for desktop:
          if (!domElement) {
            // We didn't pass domElement from dragstart. Let's rely on checking text
            // Actually simpler: clear all matches from container that are hidden?
            // Let's just re-init drag game if empty?
          }

          // Confetti
          confetti({
            particleCount: 20,
            spread: 40,
            origin: { y: 0.8 },
            colors: ["#10b981"],
          });

          // Check win
          const remaining = container.querySelectorAll("div").length;
          // Note: This logic is slightly buggy without removing the element.
          // Fix: We need to remove the element.
          // Let's fix processDrop to actually find the element.
          const allItems = document.querySelectorAll(".draggable-item");
          allItems.forEach((el) => {
            if (
              el.dataset.type === itemType &&
              (domElement === el || !domElement)
            ) {
              // Check if this specific element is the one being interacted with.
              // Since we didn't pass unique IDs well, let's just remove the first match for simplicity in this demo context
              if (!el.classList.contains("hidden-force")) {
                el.remove(); // Simple remove
                domElement = el; // Flag as handled
              }
            }
          });

          if (
            document.getElementById("draggables-container").children.length ===
            0
          ) {
            Swal.fire("Xu·∫•t s·∫Øc!", "B·∫°n ƒë√£ ph√¢n lo·∫°i ƒë√∫ng t·∫•t c·∫£!", "success");
          }
        } else {
          Swal.fire({
            icon: "error",
            title: "Sai r·ªìi!",
            text: "H√£y th·ª≠ nh√≥m kh√°c nh√©.",
            timer: 1000,
            showConfirmButton: false,
          });
        }
      }

      function resetDragGame() {
        initDragGame();
      }

      // --- QUIZ ---
      function renderQuiz() {
        const c = document.getElementById("quiz-container");
        c.innerHTML = "";
        document.getElementById("quiz-result").classList.add("hidden");

        quizQuestions.forEach((q, idx) => {
          const div = document.createElement("div");
          div.className =
            "bg-white dark:bg-dark-card p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700";
          let opts = "";
          q.opts.forEach((o, i) => {
            opts += `<button onclick="checkQuiz(${idx}, ${i}, this)" class="w-full text-left p-3 rounded-lg border border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 mb-2 transition text-sm dark:text-slate-300">${o}</button>`;
          });
          div.innerHTML = `
                <div class="font-bold text-slate-800 dark:text-white mb-4">C√¢u ${
                  idx + 1
                }: ${q.q}</div>
                <div>${opts}</div>
                <div class="mt-2 text-xs font-bold hidden feedback"></div>
            `;
          c.appendChild(div);
        });
      }

      let quizScore = 0;
      function checkQuiz(qIdx, ansIdx, btn) {
        const q = quizQuestions[qIdx];
        const parent = btn.parentElement;
        const feedback = parent.nextElementSibling;

        // Disable all buttons in this question
        const allBtns = parent.querySelectorAll("button");
        allBtns.forEach((b) => (b.disabled = true));

        if (ansIdx === q.ans) {
          btn.classList.add(
            "bg-green-100",
            "border-green-500",
            "text-green-700",
            "dark:bg-green-900",
            "dark:text-green-300"
          );
          feedback.innerText = "Ch√≠nh x√°c! üéâ";
          feedback.className =
            "mt-2 text-xs font-bold text-green-600 dark:text-green-400 block";
          quizScore++;
          confetti({ particleCount: 30, spread: 40, origin: { y: 0.8 } });
        } else {
          btn.classList.add(
            "bg-red-100",
            "border-red-500",
            "text-red-700",
            "dark:bg-red-900",
            "dark:text-red-300"
          );
          allBtns[q.ans].classList.add(
            "bg-green-50",
            "border-green-300",
            "text-green-700",
            "dark:text-green-300"
          );
          feedback.innerText = "Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√†: " + q.opts[q.ans];
          feedback.className =
            "mt-2 text-xs font-bold text-red-500 dark:text-red-400 block";
        }

        // Check if all done (simple logic)
        const answered = document.querySelectorAll("button:disabled").length;
        // Total buttons = questions * 3 options. This logic is fuzzy.
        // Better: Count how many feedbacks are visible
        const done = document.querySelectorAll(".feedback.block").length;
        if (done === quizQuestions.length) {
          document.getElementById("quiz-result").classList.remove("hidden");
          window.scrollTo({
            top: document.body.scrollHeight,
            behavior: "smooth",
          });
        }
      }

      // Start
      startAtomSim();
    </script>
  </body>
</html>
