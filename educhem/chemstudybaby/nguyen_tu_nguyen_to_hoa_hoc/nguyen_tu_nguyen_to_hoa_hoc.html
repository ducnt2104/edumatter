<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H√≥a H·ªçc 7: Nguy√™n T·ª≠ & B·∫£ng Tu·∫ßn Ho√†n</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>

    <style>
      :root {
        --primary: #4361ee;
        --primary-dark: #3a0ca3;
        --accent: #f72585;
        --success: #4cc9f0;
        --warning: #f8961e;
        --bg-body: #f0f2f5;
        --bg-card: #ffffff;
        --text-main: #2b2d42;
        --text-light: #8d99ae;
        --metal: #ffadad;
        --nonmetal: #ffd6a5;
        --gas: #a0c4ff;
        --shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1);
        --radius: 20px;
      }

      body.theme-dark {
        --bg-body: #0f172a;
        --bg-card: #1e293b;
        --text-main: #f1f5f9;
        --text-light: #94a3b8;
        --shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Be Vietnam Pro", sans-serif;
        transition: all 0.3s ease;
      }
      body {
        background-color: var(--bg-body);
        color: var(--text-main);
        min-height: 100vh;
        padding-bottom: 80px;
      }

      /* --- Header --- */
      header {
        background: var(--bg-card);
        padding: 1rem 2rem;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: var(--shadow);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .logo {
        font-size: 1.5rem;
        font-weight: 800;
        background: linear-gradient(45deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .nav-pills {
        display: flex;
        gap: 10px;
        background: var(--bg-body);
        padding: 5px;
        border-radius: 50px;
      }
      .nav-item {
        padding: 8px 20px;
        border-radius: 40px;
        cursor: pointer;
        font-weight: 700;
        color: var(--text-light);
        border: none;
        background: transparent;
      }
      .nav-item.active {
        background: var(--primary);
        color: white;
        box-shadow: 0 4px 15px rgba(67, 97, 238, 0.4);
      }
      .theme-toggle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid var(--text-light);
        background: transparent;
        color: var(--text-main);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* --- Content Layout --- */
      .container {
        max-width: 1000px;
        margin: 2rem auto;
        padding: 0 20px;
      }
      .section-content {
        display: none;
        animation: slideUp 0.5s ease;
      }
      .section-content.active {
        display: block;
      }

      .card {
        background: var(--bg-card);
        border-radius: var(--radius);
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow);
        border: 1px solid rgba(0, 0, 0, 0.05);
        position: relative;
        overflow: hidden;
      }

      h2 {
        color: var(--primary);
        margin-bottom: 1.2rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      h2::before {
        content: "";
        display: block;
        width: 6px;
        height: 24px;
        background: var(--accent);
        border-radius: 4px;
      }
      h3 {
        color: var(--text-main);
        margin: 1rem 0 0.5rem;
        font-weight: 700;
        font-size: 1.1rem;
      }
      p,
      li {
        line-height: 1.7;
        color: var(--text-main);
        margin-bottom: 0.5rem;
      }
      ul {
        margin-left: 20px;
        margin-bottom: 1rem;
      }

      .highlight-box {
        background: rgba(67, 97, 238, 0.1);
        border-left: 4px solid var(--primary);
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
      }
      .fact-box {
        background: linear-gradient(135deg, #fff3cd, #ffecb3);
        color: #856404;
        padding: 15px;
        border-radius: 12px;
        margin-top: 15px;
        border: 2px dashed #ffeeba;
      }
      .theme-dark .fact-box {
        background: #332b00;
        color: #ffecb3;
        border-color: #665500;
      }

      /* --- Visualizers & Games --- */
      /* Atom Canvas */
      #atom-canvas-container {
        position: relative;
        background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%);
        border-radius: var(--radius);
        height: 350px;
        overflow: hidden;
        box-shadow: inset 0 0 50px rgba(67, 97, 238, 0.2);
      }
      canvas {
        width: 100%;
        height: 100%;
      }

      /* Game Buttons */
      .btn-game {
        padding: 10px 20px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-weight: bold;
        font-size: 1rem;
        box-shadow: 0 4px 0 var(--primary-dark);
        margin-top: 10px;
      }
      .btn-game:active {
        transform: translateY(4px);
        box-shadow: none;
      }
      .btn-game.secondary {
        background: var(--text-light);
        box-shadow: 0 4px 0 #6c757d;
      }

      /* Memory Game */
      .memory-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        perspective: 1000px;
      }
      .memory-card {
        height: 100px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.5s;
        cursor: pointer;
      }
      .memory-card.flipped {
        transform: rotateY(180deg);
      }
      .memory-card.matched {
        opacity: 0;
        pointer-events: none;
      }
      .face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .front-face {
        background: white;
        color: var(--text-main);
        transform: rotateY(180deg);
        border: 2px solid var(--accent);
      }
      .back-face {
        background: linear-gradient(45deg, var(--primary), var(--success));
        color: white;
        font-size: 2rem;
      }

      /* Formula Game */
      .formula-display {
        font-size: 2.5rem;
        font-weight: 800;
        text-align: center;
        margin: 20px 0;
        color: var(--primary);
        letter-spacing: 2px;
      }
      .formula-input {
        width: 80px;
        padding: 10px;
        border-radius: 8px;
        border: 2px solid var(--text-light);
        text-align: center;
        font-size: 1.2rem;
        margin: 0 5px;
      }

      /* Sorter Game */
      .sorter-area {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
      }
      .drop-zone {
        width: 30%;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        font-weight: bold;
        border: 2px dashed rgba(0, 0, 0, 0.2);
        transition: 0.2s;
        cursor: pointer;
      }
      .drop-zone:hover {
        transform: scale(1.05);
      }
      .element-card-drag {
        background: white;
        padding: 15px 30px;
        border-radius: 12px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        font-size: 1.5rem;
        font-weight: 800;
        text-align: center;
        margin: 0 auto 20px;
        width: fit-content;
        border: 2px solid var(--text-main);
        color: #333;
      }

      /* --- Animations --- */
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @media (max-width: 768px) {
        .nav-pills {
          width: 100%;
          justify-content: space-between;
          overflow-x: auto;
        }
        .memory-grid {
          grid-template-columns: repeat(3, 1fr);
        }
        header {
          flex-direction: column;
          gap: 15px;
          padding: 15px;
        }
        .sorter-area {
          flex-direction: column;
        }
        .drop-zone {
          width: 100%;
        }
      }

      html,
      body {
        overflow-y: auto !important;
        height: auto !important;
      }
    </style>
    <link rel="stylesheet" href="../../component/component.css" />
    <script src="../../component/component.js"></script>
  </head>
  <body>
    <div id="topbar-container"></div>
    <header>
      <div class="logo">
        <i class="fas fa-atom fa-spin"></i> H√ìA H·ªåC 7 : Nguy√™n t·ª≠, nguy√™n t·ªë h√≥a
        h·ªçc v√† b·∫£ng tu·∫ßn ho√†n
      </div>
      <nav class="nav-pills">
        <button class="nav-item active" onclick="switchTab('atom')">
          I. Nguy√™n T·ª≠
        </button>
        <button class="nav-item" onclick="switchTab('element')">
          II. Nguy√™n T·ªë
        </button>
        <button class="nav-item" onclick="switchTab('ptable')">
          III. B·∫£ng Tu·∫ßn Ho√†n
        </button>
      </nav>
      <button class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon"></i>
      </button>
    </header>

    <div class="container">
      <section id="atom" class="section-content active">
        <div class="card">
          <h2>1. M√¥ h√¨nh Nguy√™n t·ª≠ Rutherford - Bohr</h2>
          <div id="atom-canvas-container">
            <canvas id="atomCanvas"></canvas>
            <div
              style="
                position: absolute;
                bottom: 15px;
                left: 15px;
                color: rgba(255, 255, 255, 0.8);
                pointer-events: none;
              "
            >
              <h3 id="atom-name-display" style="color: white; margin: 0">
                Ch·ªçn nguy√™n t·ª≠ b√™n d∆∞·ªõi
              </h3>
            </div>
          </div>
          <div
            style="
              display: flex;
              gap: 10px;
              justify-content: center;
              flex-wrap: wrap;
              margin-top: 15px;
            "
          >
            <button class="btn-game secondary" onclick="loadAtom('H')">
              Hidro (1p)
            </button>
            <button class="btn-game secondary" onclick="loadAtom('C')">
              Cacbon (6p)
            </button>
            <button class="btn-game secondary" onclick="loadAtom('O')">
              Oxi (8p)
            </button>
            <button class="btn-game secondary" onclick="loadAtom('Na')">
              Natri (11p)
            </button>
          </div>

          <div class="highlight-box">
            <h3><i class="fas fa-microscope"></i> C·∫•u t·∫°o chi ti·∫øt:</h3>
            <ul>
              <li>
                <strong>H·∫°t nh√¢n (T√¢m):</strong> G·ªìm Proton (p, ƒëi·ªán t√≠ch +) v√†
                Neutron (n, kh√¥ng ƒëi·ªán).
              </li>
              <li>
                <strong>V·ªè nguy√™n t·ª≠:</strong> G·ªìm Electron (e, ƒëi·ªán t√≠ch -)
                chuy·ªÉn ƒë·ªông c·ª±c nhanh quanh h·∫°t nh√¢n.
              </li>
              <li><strong>Nguy√™n t·ª≠ trung h√≤a:</strong> S·ªë p = S·ªë e.</li>
            </ul>
          </div>
          <div class="fact-box">
            <i class="fas fa-lightbulb"></i>
            <strong>So s√°nh th√∫ v·ªã:</strong> N·∫øu h·∫°t nh√¢n l√† qu·∫£ b√≥ng b√†n gi·ªØa
            s√¢n v·∫≠n ƒë·ªông, th√¨ electron nh∆∞ nh·ªØng ch√∫ ong bay quanh kh√°n ƒë√†i!
          </div>
        </div>

        <div class="card">
          <h2>2. Kh·ªëi l∆∞·ª£ng nguy√™n t·ª≠ (amu)</h2>
          <p>
            Kh·ªëi l∆∞·ª£ng nguy√™n t·ª≠ t·∫≠p trung ch·ªß y·∫øu ·ªü h·∫°t nh√¢n (v√¨ electron si√™u
            nh·∫π).
          </p>
          <div
            style="
              background: rgba(0, 0, 0, 0.03);
              padding: 15px;
              border-radius: 12px;
              text-align: center;
              margin: 10px 0;
            "
          >
            <span
              style="
                font-size: 1.5rem;
                font-weight: bold;
                color: var(--primary);
              "
              >A ‚âà p + n</span
            >
            <p style="font-size: 0.9rem">
              (A: S·ªë kh·ªëi, p: S·ªë proton, n: S·ªë neutron)
            </p>
          </div>

          <div
            style="
              border-top: 2px dashed #ddd;
              margin-top: 20px;
              padding-top: 20px;
            "
          >
            <h3>
              <i class="fas fa-calculator"></i> Tr√≤ ch∆°i: Th·ª≠ t√†i To√°n H√≥a
            </h3>
            <div id="amu-game-ui" style="text-align: center">
              <div style="font-size: 1.2rem; margin-bottom: 10px">
                Nguy√™n t·ª≠
                <b id="q-element-name" style="color: var(--accent)">X</b> c√≥:
              </div>
              <div
                style="
                  display: flex;
                  justify-content: center;
                  gap: 20px;
                  margin-bottom: 15px;
                  font-weight: bold;
                "
              >
                <span style="color: var(--success)"
                  ><i class="fas fa-plus-circle"></i> p =
                  <span id="q-p">?</span></span
                >
                <span style="color: var(--text-light)"
                  ><i class="fas fa-circle"></i> n =
                  <span id="q-n">?</span></span
                >
              </div>
              <p>T√≠nh kh·ªëi l∆∞·ª£ng (s·ªë kh·ªëi A)?</p>
              <input
                type="number"
                id="amu-input"
                placeholder="..."
                class="formula-input"
              />
              <button onclick="checkAmu()" class="btn-game">Ki·ªÉm tra</button>
            </div>
          </div>
        </div>

        <div class="card" style="border-left: 5px solid var(--warning)">
          <h2><i class="fas fa-expand"></i> M·ªü r·ªông: Ion & ƒê·ªìng v·ªã</h2>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px">
            <div>
              <h3>ƒê·ªìng v·ªã</h3>
              <p>
                L√† c√°c nguy√™n t·ª≠ c√πng s·ªë <b>proton</b> nh∆∞ng kh√°c s·ªë
                <b>neutron</b>.
              </p>
              <p><i>V√≠ d·ª•:</i> Cacbon-12 (6n), Cacbon-14 (8n).</p>
            </div>
            <div>
              <h3>Ion (Mang ƒëi·ªán)</h3>
              <p>Khi nguy√™n t·ª≠ <b>nh∆∞·ªùng</b> ho·∫∑c <b>nh·∫≠n</b> electron.</p>
              <div style="text-align: center; margin-top: 10px">
                <span style="font-weight: bold">Na</span>
                <i
                  class="fas fa-arrow-right"
                  style="color: var(--text-light)"
                ></i>
                <span style="font-weight: bold; color: var(--accent)"
                  >Na<sup>+</sup></span
                >
                + 1e <br /><small>(M·∫•t electron h√≥a tr·ªã d∆∞∆°ng)</small>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="element" class="section-content">
        <div class="card">
          <h2>1. Nguy√™n t·ªë & K√≠ hi·ªáu h√≥a h·ªçc</h2>
          <ul>
            <li>
              <strong>Nguy√™n t·ªë:</strong> T·∫≠p h·ª£p c√°c nguy√™n t·ª≠ c√≥
              <b>c√πng s·ªë proton</b>.
            </li>
            <li>
              <strong>K√≠ hi·ªáu:</strong> 1 ho·∫∑c 2 ch·ªØ c√°i. Ch·ªØ ƒë·∫ßu in hoa, ch·ªØ
              sau th∆∞·ªùng.
            </li>
            <li><i>V√≠ d·ª•:</i> Ca (Canxi), Cu (ƒê·ªìng), Fe (S·∫Øt), Al (Nh√¥m).</li>
          </ul>

          <div style="margin-top: 20px">
            <h3><i class="fas fa-brain"></i> Game: L·∫≠t th·∫ª nh·ªõ K√≠ hi·ªáu</h3>
            <div class="memory-grid" id="memory-grid"></div>
            <div style="text-align: center; margin-top: 15px">
              <button onclick="initMemoryGame()" class="btn-game secondary">
                <i class="fas fa-redo"></i> Ch∆°i l·∫°i
              </button>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>2. √ù nghƒ©a C√¥ng th·ª©c h√≥a h·ªçc</h2>
          <p>
            S·ªë ch·ªâ s·ªë ch√¢n b√™n ph·∫£i k√≠ hi·ªáu cho bi·∫øt s·ªë l∆∞·ª£ng nguy√™n t·ª≠ c·ªßa
            nguy√™n t·ªë ƒë√≥.
          </p>
          <div class="highlight-box">
            <ul>
              <li><b style="color: var(--primary)">O‚ÇÇ</b>: 2 nguy√™n t·ª≠ Oxi.</li>
              <li><b style="color: var(--primary)">H‚ÇÇO</b>: 2 Hidro, 1 Oxi.</li>
              <li>
                <b style="color: var(--primary)">CaCO‚ÇÉ</b>: 1 Canxi, 1 Cacbon, 3
                Oxi.
              </li>
            </ul>
          </div>

          <div
            style="
              border-top: 2px dashed #ddd;
              margin-top: 20px;
              padding-top: 10px;
              text-align: center;
            "
          >
            <h3><i class="fas fa-flask"></i> Game: Vua C√¥ng Th·ª©c</h3>
            <p>H√£y ƒë·∫øm s·ªë nguy√™n t·ª≠ c·ªßa nguy√™n t·ªë ƒë∆∞·ª£c h·ªèi.</p>

            <div class="formula-display" id="fm-display">H‚ÇÇSO‚ÇÑ</div>
            <p id="fm-question">C√≥ bao nhi√™u nguy√™n t·ª≠ <b>Oxi</b>?</p>

            <div style="margin-top: 15px">
              <button class="btn-game secondary" onclick="checkFormula(1)">
                1
              </button>
              <button class="btn-game secondary" onclick="checkFormula(2)">
                2
              </button>
              <button class="btn-game secondary" onclick="checkFormula(3)">
                3
              </button>
              <button class="btn-game secondary" onclick="checkFormula(4)">
                4
              </button>
            </div>
            <div
              id="fm-feedback"
              style="margin-top: 10px; font-weight: bold; height: 24px"
            ></div>
          </div>
        </div>
      </section>

      <section id="ptable" class="section-content">
        <div class="card">
          <h2>1. C·∫•u tr√∫c B·∫£ng tu·∫ßn ho√†n</h2>
          <ul>
            <li>
              <strong>√î nguy√™n t·ªë:</strong> Ch·ª©a s·ªë hi·ªáu nguy√™n t·ª≠ (Z = p = e),
              k√≠ hi·ªáu, t√™n, kh·ªëi l∆∞·ª£ng.
            </li>
            <li>
              <strong>Chu k√¨ (H√†ng ngang):</strong> G·ªìm c√°c nguy√™n t·ªë c√πng s·ªë
              l·ªõp electron (7 chu k√¨).
            </li>
            <li>
              <strong>Nh√≥m (C·ªôt d·ªçc):</strong> G·ªìm c√°c nguy√™n t·ªë c√≥ t√≠nh ch·∫•t
              h√≥a h·ªçc t∆∞∆°ng t·ª± nhau.
            </li>
          </ul>
          <div class="fact-box">
            <i class="fas fa-history"></i>
            <strong>Dmitri Mendeleev</strong> (1869) l√† ng∆∞·ªùi ƒë·∫ßu ti√™n s·∫Øp x·∫øp
            b·∫£ng n√†y v√† d·ª± ƒëo√°n ƒë√∫ng c√°c nguy√™n t·ªë ch∆∞a t√¨m th·∫•y!
          </div>
        </div>

        <div class="card">
          <h2>2. Ph√¢n lo·∫°i: Kim lo·∫°i - Phi kim - Kh√≠ hi·∫øm</h2>
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 15px;
              margin-bottom: 20px;
            "
          >
            <div
              style="
                background: var(--metal);
                padding: 15px;
                border-radius: 12px;
                color: #5c0000;
              "
            >
              <h3><i class="fas fa-bolt"></i> Kim lo·∫°i</h3>
              <p>D·∫´n ƒëi·ªán/nhi·ªát t·ªët, c√≥ √°nh kim, d·∫ªo. D·ªÖ nh∆∞·ªùng e.</p>
              <small>Vd: Fe, Cu, Al, Na</small>
            </div>
            <div
              style="
                background: var(--nonmetal);
                padding: 15px;
                border-radius: 12px;
                color: #5c3a00;
              "
            >
              <h3><i class="fas fa-cloud"></i> Phi kim</h3>
              <p>Kh√¥ng d·∫´n ƒëi·ªán, kh√¥ng √°nh kim, gi√≤n. D·ªÖ nh·∫≠n e.</p>
              <small>Vd: O, S, Cl, N</small>
            </div>
            <div
              style="
                background: var(--gas);
                padding: 15px;
                border-radius: 12px;
                color: #001d4a;
              "
            >
              <h3><i class="fas fa-wind"></i> Kh√≠ hi·∫øm</h3>
              <p>Tr∆°, b·ªÅn v·ªØng, √≠t ph·∫£n ·ª©ng. L·ªõp e ngo√†i c√πng b√£o h√≤a.</p>
              <small>Vd: He, Ne, Ar</small>
            </div>
          </div>

          <div style="border-top: 2px dashed #ddd; padding-top: 20px">
            <h3><i class="fas fa-filter"></i> Game: Ph√¢n Lo·∫°i Nhanh</h3>
            <p style="text-align: center">Nguy√™n t·ªë n√†y thu·ªôc nh√≥m n√†o?</p>

            <div id="sort-game-area" style="text-align: center">
              <div id="element-to-sort" class="element-card-drag">S·∫Øt (Fe)</div>

              <div class="sorter-area">
                <div
                  class="drop-zone"
                  style="background: #ffe5e5; color: #c0392b"
                  onclick="checkSort('metal')"
                >
                  KIM LO·∫†I
                </div>
                <div
                  class="drop-zone"
                  style="background: #fff4e5; color: #d35400"
                  onclick="checkSort('nonmetal')"
                >
                  PHI KIM
                </div>
                <div
                  class="drop-zone"
                  style="background: #e5f0ff; color: #2980b9"
                  onclick="checkSort('gas')"
                >
                  KH√ç HI·∫æM
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <h2><i class="fas fa-user-secret"></i> Th√°m t·ª≠ H√≥a h·ªçc</h2>
          <div class="highlight-box" style="text-align: center">
            <span style="font-size: 2rem">üîé</span>
            <p
              id="detective-clue"
              style="font-size: 1.1rem; font-weight: bold; margin: 10px 0"
            >
              ƒêang t·∫£i manh m·ªëi...
            </p>
          </div>
          <div
            id="detective-options"
            style="
              display: grid;
              grid-template-columns: repeat(2, 1fr);
              gap: 10px;
            "
          ></div>
        </div>
      </section>
    </div>

    <script>
      // --- DATA ---
      const ELEMENTS = [
        {
          z: 1,
          s: "H",
          n: "Hidro",
          p: 1,
          n_h: 0,
          m: 1,
          shells: [1],
          type: "nonmetal",
        },
        {
          z: 2,
          s: "He",
          n: "Helium",
          p: 2,
          n_h: 2,
          m: 4,
          shells: [2],
          type: "gas",
        },
        {
          z: 3,
          s: "Li",
          n: "Lithi",
          p: 3,
          n_h: 4,
          m: 7,
          shells: [2, 1],
          type: "metal",
        },
        {
          z: 6,
          s: "C",
          n: "Cacbon",
          p: 6,
          n_h: 6,
          m: 12,
          shells: [2, 4],
          type: "nonmetal",
        },
        {
          z: 7,
          s: "N",
          n: "Nito",
          p: 7,
          n_h: 7,
          m: 14,
          shells: [2, 5],
          type: "nonmetal",
        },
        {
          z: 8,
          s: "O",
          n: "Oxi",
          p: 8,
          n_h: 8,
          m: 16,
          shells: [2, 6],
          type: "nonmetal",
        },
        {
          z: 10,
          s: "Ne",
          n: "Neon",
          p: 10,
          n_h: 10,
          m: 20,
          shells: [2, 8],
          type: "gas",
        },
        {
          z: 11,
          s: "Na",
          n: "Natri",
          p: 11,
          n_h: 12,
          m: 23,
          shells: [2, 8, 1],
          type: "metal",
        },
        {
          z: 12,
          s: "Mg",
          n: "Magie",
          p: 12,
          n_h: 12,
          m: 24,
          shells: [2, 8, 2],
          type: "metal",
        },
        {
          z: 13,
          s: "Al",
          n: "Nh√¥m",
          p: 13,
          n_h: 14,
          m: 27,
          shells: [2, 8, 3],
          type: "metal",
        },
        {
          z: 16,
          s: "S",
          n: "L∆∞u hu·ª≥nh",
          p: 16,
          n_h: 16,
          m: 32,
          shells: [2, 8, 6],
          type: "nonmetal",
        },
        {
          z: 17,
          s: "Cl",
          n: "Clo",
          p: 17,
          n_h: 18,
          m: 35.5,
          shells: [2, 8, 7],
          type: "nonmetal",
        },
        {
          z: 18,
          s: "Ar",
          n: "Argon",
          p: 18,
          n_h: 22,
          m: 40,
          shells: [2, 8, 8],
          type: "gas",
        },
        {
          z: 20,
          s: "Ca",
          n: "Canxi",
          p: 20,
          n_h: 20,
          m: 40,
          shells: [2, 8, 8, 2],
          type: "metal",
        },
        {
          z: 26,
          s: "Fe",
          n: "S·∫Øt",
          p: 26,
          n_h: 30,
          m: 56,
          shells: [2, 8, 14, 2],
          type: "metal",
        },
        {
          z: 29,
          s: "Cu",
          n: "ƒê·ªìng",
          p: 29,
          n_h: 35,
          m: 64,
          shells: [2, 8, 18, 1],
          type: "metal",
        },
      ];

      // --- AUDIO (No External Files) ---
      // Using simple Howler placeholders or Web Audio API
      const soundCorrect = new Howl({
        src: [
          "https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3",
        ],
        volume: 0.5,
      });
      const soundWrong = new Howl({
        src: [
          "https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3",
        ],
        volume: 0.4,
      });
      const soundClick = new Howl({
        src: [
          "https://assets.mixkit.co/sfx/preview/mixkit-modern-technology-select-3124.mp3",
        ],
        volume: 0.3,
      });

      // --- UI FUNCTIONS ---
      function switchTab(id) {
        document
          .querySelectorAll(".section-content")
          .forEach((el) => el.classList.remove("active"));
        document
          .querySelectorAll(".nav-item")
          .forEach((el) => el.classList.remove("active"));
        document.getElementById(id).classList.add("active");

        const btns = document.querySelectorAll(".nav-item");
        if (id === "atom") btns[0].classList.add("active");
        if (id === "element") btns[1].classList.add("active");
        if (id === "ptable") btns[2].classList.add("active");
        soundClick.play();
      }

      function toggleTheme() {
        document.body.classList.toggle("theme-dark");
        soundClick.play();
      }

      // --- 1. VISUALIZER (ATOM CANVAS) ---
      const canvas = document.getElementById("atomCanvas");
      const ctx = canvas.getContext("2d");
      let electrons = [];

      function resizeCanvas() {
        canvas.width = canvas.parentElement.offsetWidth;
        canvas.height = canvas.parentElement.offsetHeight;
      }
      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();

      function loadAtom(sym) {
        const el = ELEMENTS.find((e) => e.s === sym);
        document.getElementById(
          "atom-name-display"
        ).innerHTML = `<b>${el.n} (${el.s})</b> - ${el.p} Proton`;

        electrons = [];
        el.shells.forEach((count, shellIdx) => {
          const radius = 50 + shellIdx * 35;
          const speed =
            (0.02 - shellIdx * 0.002) * (shellIdx % 2 === 0 ? 1 : -1);
          for (let i = 0; i < count; i++) {
            electrons.push({
              angle: ((Math.PI * 2) / count) * i,
              r: radius,
              s: speed,
            });
          }
        });
        soundClick.play();
      }

      function animateAtom() {
        ctx.fillStyle = document.body.classList.contains("theme-dark")
          ? "rgba(0,0,0,0.2)"
          : "rgba(26,26,46,0.2)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        const cx = canvas.width / 2,
          cy = canvas.height / 2;

        // Nucleus
        ctx.beginPath();
        ctx.arc(cx, cy, 12, 0, Math.PI * 2);
        ctx.fillStyle = "#f72585";
        ctx.shadowBlur = 15;
        ctx.shadowColor = "#f72585";
        ctx.fill();
        ctx.shadowBlur = 0;

        // Electrons
        electrons.forEach((e) => {
          e.angle += e.s;
          const x = cx + Math.cos(e.angle) * e.r,
            y = cy + Math.sin(e.angle) * e.r;
          ctx.beginPath();
          ctx.arc(cx, cy, e.r, 0, Math.PI * 2);
          ctx.strokeStyle = "rgba(255,255,255,0.1)";
          ctx.stroke();
          ctx.beginPath();
          ctx.arc(x, y, 5, 0, Math.PI * 2);
          ctx.fillStyle = "#4cc9f0";
          ctx.fill();
        });
        requestAnimationFrame(animateAtom);
      }

      // --- 2. GAME: T√çNH AMU ---
      let amuCurrent = {};
      function loadAmuQuestion() {
        const pool = ELEMENTS.filter((e) => e.z > 2);
        amuCurrent = pool[Math.floor(Math.random() * pool.length)];
        document.getElementById("q-element-name").textContent = amuCurrent.n;
        document.getElementById("q-p").textContent = amuCurrent.p;
        document.getElementById("q-n").textContent = amuCurrent.n_h;
        document.getElementById("amu-input").value = "";
      }
      function checkAmu() {
        const val = parseInt(document.getElementById("amu-input").value);
        const correct = amuCurrent.p + amuCurrent.n_h;
        if (val === correct) {
          soundCorrect.play();
          confetti({ particleCount: 50, spread: 60, origin: { y: 0.6 } });
          Swal.fire({
            icon: "success",
            title: "Ch√≠nh x√°c!",
            text: `${amuCurrent.n} c√≥ kh·ªëi l∆∞·ª£ng ~ ${correct} amu`,
            timer: 1500,
            showConfirmButton: false,
          });
          loadAmuQuestion();
        } else {
          soundWrong.play();
          Swal.fire({
            icon: "error",
            title: "Sai r·ªìi!",
            text: `G·ª£i √Ω: L·∫•y p + n (${amuCurrent.p} + ${amuCurrent.n_h})`,
          });
        }
      }

      // --- 3. GAME: MEMORY ---
      let hasFlipped = false,
        lockBoard = false,
        firstCard,
        secondCard;
      function initMemoryGame() {
        const grid = document.getElementById("memory-grid");
        grid.innerHTML = "";
        const selection = ELEMENTS.sort(() => 0.5 - Math.random()).slice(0, 4);
        let deck = [];
        selection.forEach((el) => {
          deck.push({ id: el.s, content: el.s, type: "symbol" });
          deck.push({ id: el.s, content: el.n, type: "name" });
        });
        deck.sort(() => 0.5 - Math.random());
        deck.forEach((item) => {
          const card = document.createElement("div");
          card.classList.add("memory-card");
          card.dataset.id = item.id;
          card.innerHTML = `<div class="face front-face">${item.content}</div><div class="face back-face"><i class="fas fa-atom"></i></div>`;
          card.addEventListener("click", flipCard);
          grid.appendChild(card);
        });
      }
      function flipCard() {
        if (lockBoard || this === firstCard) return;
        this.classList.add("flipped");
        soundClick.play();
        if (!hasFlipped) {
          hasFlipped = true;
          firstCard = this;
          return;
        }
        secondCard = this;
        checkForMatch();
      }
      function checkForMatch() {
        let isMatch = firstCard.dataset.id === secondCard.dataset.id;
        isMatch ? disableCards() : unflipCards();
      }
      function disableCards() {
        soundCorrect.play();
        firstCard.removeEventListener("click", flipCard);
        secondCard.removeEventListener("click", flipCard);
        setTimeout(() => {
          firstCard.classList.add("matched");
          secondCard.classList.add("matched");
          resetBoard();
        }, 500);
      }
      function unflipCards() {
        lockBoard = true;
        soundWrong.play();
        setTimeout(() => {
          firstCard.classList.remove("flipped");
          secondCard.classList.remove("flipped");
          resetBoard();
        }, 1000);
      }
      function resetBoard() {
        [hasFlipped, lockBoard] = [false, false];
        [firstCard, secondCard] = [null, null];
      }

      // --- 4. GAME: VUA C√îNG TH·ª®C ---
      const FORMULAS = [
        { f: "H‚ÇÇSO‚ÇÑ", q: "Oxi", a: 4 },
        { f: "CaCO‚ÇÉ", q: "Cacbon", a: 1 },
        { f: "Al‚ÇÇO‚ÇÉ", q: "Nh√¥m", a: 2 },
        { f: "Mg(OH)‚ÇÇ", q: "Oxi", a: 2 }, // Kh√≥: 2 nh√≥m OH
        { f: "Fe‚ÇÇO‚ÇÉ", q: "S·∫Øt", a: 2 },
        { f: "CO‚ÇÇ", q: "Oxi", a: 2 },
      ];
      let currentFormula = {};
      function loadFormulaGame() {
        currentFormula = FORMULAS[Math.floor(Math.random() * FORMULAS.length)];
        document.getElementById("fm-display").innerHTML =
          currentFormula.f.replace(/\d/g, (d) => `<sub>${d}</sub>`);
        document.getElementById(
          "fm-question"
        ).innerHTML = `C√≥ bao nhi√™u nguy√™n t·ª≠ <b>${currentFormula.q}</b>?`;
        document.getElementById("fm-feedback").textContent = "";
      }
      function checkFormula(ans) {
        if (ans === currentFormula.a) {
          soundCorrect.play();
          document.getElementById("fm-feedback").innerHTML =
            '<span style="color:green">Ch√≠nh x√°c!</span>';
          setTimeout(loadFormulaGame, 1000);
        } else {
          soundWrong.play();
          document.getElementById("fm-feedback").innerHTML =
            '<span style="color:red">Sai r·ªìi, th·ª≠ l·∫°i xem!</span>';
        }
      }

      // --- 5. GAME: PH√ÇN LO·∫†I NHANH ---
      let currentSortEl = {};
      function loadSorter() {
        currentSortEl = ELEMENTS[Math.floor(Math.random() * ELEMENTS.length)];
        document.getElementById(
          "element-to-sort"
        ).textContent = `${currentSortEl.n} (${currentSortEl.s})`;
      }
      function checkSort(type) {
        if (currentSortEl.type === type) {
          soundCorrect.play();
          Swal.fire({
            icon: "success",
            title: "ƒê√∫ng r·ªìi!",
            timer: 800,
            showConfirmButton: false,
          });
          loadSorter();
        } else {
          soundWrong.play();
          Swal.fire({
            icon: "error",
            title: "Sai r·ªìi!",
            text: `${currentSortEl.n} l√† ${getVNType(currentSortEl.type)}`,
          });
        }
      }
      function getVNType(t) {
        if (t === "metal") return "Kim lo·∫°i";
        if (t === "nonmetal") return "Phi kim";
        return "Kh√≠ hi·∫øm";
      }

      // --- 6. GAME: DETECTIVE ---
      function initDetective() {
        const target = ELEMENTS[Math.floor(Math.random() * ELEMENTS.length)];
        document.getElementById(
          "detective-clue"
        ).innerHTML = `T√¨m nguy√™n t·ªë thu·ªôc <b>Chu k√¨ ${
          target.shells.length
        }</b>, l√† <b>${getVNType(target.type).toUpperCase()}</b>`;

        const container = document.getElementById("detective-options");
        container.innerHTML = "";
        let options = [target];
        while (options.length < 4) {
          let r = ELEMENTS[Math.floor(Math.random() * ELEMENTS.length)];
          if (!options.includes(r)) options.push(r);
        }
        options.sort(() => 0.5 - Math.random());

        options.forEach((opt) => {
          const btn = document.createElement("button");
          btn.className = "btn-game secondary";
          btn.style.width = "100%";
          btn.style.padding = "15px";
          btn.innerHTML = `<strong>${opt.s}</strong><br><small>${opt.n}</small>`;
          btn.onclick = () => {
            if (opt.s === target.s) {
              soundCorrect.play();
              confetti({ particleCount: 100, spread: 70 });
              Swal.fire({
                icon: "success",
                title: "Xu·∫•t s·∫Øc!",
                text: "ƒê√£ t√¨m ra th·ªß ph·∫°m!",
              });
              initDetective();
            } else {
              soundWrong.play();
              Swal.fire({ icon: "error", title: "Sai r·ªìi!" });
            }
          };
          container.appendChild(btn);
        });
      }

      // --- INIT ---
      document.addEventListener("DOMContentLoaded", () => {
        loadAtom("C");
        animateAtom();
        loadAmuQuestion();
        initMemoryGame();
        loadFormulaGame();
        loadSorter();
        initDetective();
      });
    </script>
  </body>
</html>
