<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Ch·ªß ƒë·ªÅ 2 Ph√¢n T·ª≠ - L·ªõp 7 | E-Chem</title>
    <script src="atom.js"></script>
    <script src="misson.js"></script>
    <link rel="stylesheet" href="../../component/component.css" />
    <script src="../../component/component.js"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Nunito", "sans-serif"],
              display: ["Fredoka", "sans-serif"],
            },
            colors: {
              brand: {
                bg: "#0f172a",
                card: "#1e293b",
                accent: "#38bdf8",
                primary: "#6366f1",
                success: "#22c55e",
                warning: "#eab308",
                danger: "#ef4444",
              },
            },
            animation: {
              float: "float 4s ease-in-out infinite",
              pulse: "pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite",
            },
            keyframes: {
              float: {
                "0%, 100%": { transform: "translateY(0)" },
                "50%": { transform: "translateY(-10px)" },
              },
            },
          },
        },
      };
    </script>
    <style>
      body {
        background-color: #0f172a;
        color: #f8fafc;
        user-select: none;
        /* ƒê√É S·ª¨A: Cho ph√©p cu·ªôn theo tr·ª•c Y khi n·ªôi dung tr√†n */
        overflow-y: auto;
      }
      /* ... */

      .glass {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      /* Custom Scrollbar for panels */
      .scroll-y::-webkit-scrollbar {
        width: 6px;
      }
      .scroll-y::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 4px;
      }
      body {
        background-color: #0f172a;
        color: #f8fafc;
        user-select: none;
        overflow: hidden; /* D√íNG N√ÄY ƒêANG G√ÇY L·ªñI */
      }

    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef, useMemo } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { createIcons } = window.lucide;

      // --- üîä SOUND ENGINE (Gi·ªØ nguy√™n cho sinh ƒë·ªông) ---
      const playSound = (type) => {
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        if (!AudioContext) return;
        const ctx = new AudioContext();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        const now = ctx.currentTime;

        if (type === "click") {
          osc.frequency.setValueAtTime(600, now);
          gain.gain.setValueAtTime(0.05, now);
          gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
          osc.start(now);
          osc.stop(now + 0.1);
        } else if (type === "success") {
          osc.type = "triangle";
          osc.frequency.setValueAtTime(440, now);
          osc.frequency.setValueAtTime(880, now + 0.1);
          gain.gain.setValueAtTime(0.1, now);
          gain.gain.linearRampToValueAtTime(0, now + 0.5);
          osc.start(now);
          osc.stop(now + 0.5);
        } else if (type === "pop") {
          osc.frequency.setValueAtTime(300, now);
          gain.gain.setValueAtTime(0.05, now);
          osc.start(now);
          osc.stop(now + 0.05);
        }
      };

      // 1. ATOM UI
      const Atom = ({ type, size = "md", animate = false }) => {
        const data = ATOMS[type];
        const sizeClass =
          size === "lg"
            ? "w-16 h-16 text-xl"
            : size === "sm"
            ? "w-10 h-10 text-xs"
            : "w-12 h-12 text-md";

        return (
          <motion.div
            layout
            initial={animate ? { scale: 0 } : false}
            animate={{ scale: 1 }}
            className={`rounded-full flex items-center justify-center font-display font-bold shadow-lg border-b-4 ${data.color} ${data.border} ${data.text} ${sizeClass}`}
          >
            {data.symbol}
          </motion.div>
        );
      };

      // 2. TAB: L√ù THUY·∫æT (INTERACTIVE SLIDES)
      // 2. TAB: L√ù THUY·∫æT (INTERACTIVE SLIDES)
      const TheoryTab = () => {
        const [slide, setSlide] = useState(0);

        // Danh s√°ch slides ƒë∆∞·ª£c c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß theo n·ªôi dung: Ph√¢n t·ª≠ - Li√™n k·∫øt - H√≥a tr·ªã
        const slides = [
          // --- PH·∫¶N 1: PH√ÇN T·ª¨ ---
          {
            title: "1. Ph√¢n t·ª≠ l√† g√¨?",
            content: (
              <div className="text-center">
                <p className="mb-6 text-lg">
                  Ph√¢n t·ª≠ l√† h·∫°t nh·ªè nh·∫•t c·ªßa m·ªôt ch·∫•t, gi·ªØ nguy√™n{" "}
                  <b>t√≠nh ch·∫•t h√≥a h·ªçc</b> c·ªßa ch·∫•t ƒë√≥.
                  <br />
                  <span className="text-sm opacity-75">
                    (1 gi·ªçt n∆∞·ªõc ch·ª©a kho·∫£ng 10¬≤¬π ph√¢n t·ª≠ n∆∞·ªõc!)
                  </span>
                </p>
                <div className="flex justify-center gap-8 items-center bg-slate-800/50 p-6 rounded-2xl">
                  <div className="flex flex-col items-center gap-2 opacity-60">
                    <div className="flex gap-4">
                      <Atom type="H" />
                      <Atom type="H" />
                    </div>
                    <span className="text-sm">Nguy√™n t·ª≠ r·ªùi r·∫°c</span>
                  </div>
                  <div className="text-3xl text-brand-accent">‚ûú</div>
                  <div className="flex flex-col items-center gap-2">
                    <div className="flex -space-x-2 items-center bg-white/10 p-2 rounded-full ring-2 ring-brand-accent">
                      <Atom type="H" />
                      <Atom type="H" />
                    </div>
                    <span className="text-sm font-bold text-brand-accent">
                      Ph√¢n t·ª≠ H‚ÇÇ
                    </span>
                  </div>
                </div>
              </div>
            ),
          },
          {
            title: "2. ƒê∆°n ch·∫•t & H·ª£p ch·∫•t",
            content: (
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-blue-900/30 p-4 rounded-xl border border-blue-500/30 text-center">
                  <h3 className="font-bold text-blue-400 mb-2">ƒê∆°n ch·∫•t</h3>
                  <p className="text-sm mb-4 min-h-[40px]">
                    T·∫°o b·ªüi <b>1 nguy√™n t·ªë</b> h√≥a h·ªçc.
                  </p>
                  <div className="flex flex-col gap-2 items-center">
                    <div className="flex -space-x-2">
                      <Atom type="O" />
                      <Atom type="O" />
                    </div>
                    <span className="font-mono text-sm">Kh√≠ Oxi (O‚ÇÇ)</span>
                    <div className="flex">
                      <Atom type="Cu" size="md" />
                    </div>
                    <span className="font-mono text-sm">ƒê·ªìng (Cu)</span>
                  </div>
                </div>
                <div className="bg-purple-900/30 p-4 rounded-xl border border-purple-500/30 text-center">
                  <h3 className="font-bold text-purple-400 mb-2">H·ª£p ch·∫•t</h3>
                  <p className="text-sm mb-4 min-h-[40px]">
                    T·∫°o b·ªüi <b>2 nguy√™n t·ªë</b> tr·ªü l√™n.
                  </p>
                  <div className="flex flex-col gap-2 items-center">
                    <div className="flex items-center">
                      <Atom type="H" size="sm" />
                      <Atom type="O" />
                      <Atom type="H" size="sm" />
                    </div>
                    <span className="font-mono text-sm">N∆∞·ªõc (H‚ÇÇO)</span>
                    <div className="flex items-center -space-x-1">
                      <Atom type="Na" size="sm" />
                      <Atom type="Cl" size="md" />
                    </div>
                    <span className="font-mono text-sm">Mu·ªëi ƒÉn (NaCl)</span>
                  </div>
                </div>
              </div>
            ),
          },
          {
            title: "3. Ph√¢n t·ª≠ kh·ªëi (M)",
            content: (
              <div className="text-center">
                <p className="mb-4">
                  T·ªïng kh·ªëi l∆∞·ª£ng c√°c nguy√™n t·ª≠ trong ph√¢n t·ª≠. (ƒëvC / amu).
                </p>
                <div className="bg-slate-800 p-6 rounded-xl inline-block border border-slate-600">
                  <div className="flex items-center gap-1 mb-4 justify-center">
                    <Atom type="C" />
                    <div className="flex flex-col gap-1">
                      <Atom type="O" size="sm" />
                      <Atom type="O" size="sm" />
                    </div>
                  </div>
                  <div className="font-mono text-xl text-left">
                    <div className="mb-2 text-sm text-gray-400">
                      V√≠ d·ª•: Ph√¢n t·ª≠ CO‚ÇÇ
                    </div>
                    C = 12, O = 16 <br />M ={" "}
                    <span className="text-brand-accent">12</span> + (
                    <span className="text-red-400">16</span> √ó 2)
                    <div className="mt-2 pt-2 border-t border-gray-600 text-center font-bold text-2xl text-green-400">
                      = 44 amu
                    </div>
                  </div>
                </div>
              </div>
            ),
          },
          // --- PH·∫¶N 2: LI√äN K·∫æT H√ìA H·ªåC ---
          {
            title: "4. T·∫°i sao nguy√™n t·ª≠ li√™n k·∫øt?",
            content: (
              <div className="flex flex-col gap-4">
                <div className="bg-amber-900/20 p-4 rounded-lg border-l-4 border-amber-500">
                  <h4 className="font-bold text-amber-500">
                    Quy t·∫Øc b·ªÅn v·ªØng (Octet)
                  </h4>
                  <p className="text-sm mt-1">
                    C√°c nguy√™n t·ª≠ lu√¥n xu h∆∞·ªõng ƒë·∫°t c·∫•u h√¨nh electron b·ªÅn v·ªØng
                    gi·ªëng <b>Kh√≠ hi·∫øm</b> (He, Ne, Ar...) v·ªõi l·ªõp v·ªè ngo√†i c√πng
                    b√£o h√≤a (8e ho·∫∑c 2e).
                  </p>
                </div>
                <div className="grid grid-cols-3 gap-2 text-center mt-2">
                  <div className="bg-slate-800 p-3 rounded-lg">
                    <span className="block text-2xl mb-1">ü§ù</span>
                    <span className="text-sm font-bold">Nh∆∞·ªùng e</span>
                    <span className="text-xs block text-gray-400">
                      (Kim lo·∫°i)
                    </span>
                  </div>
                  <div className="bg-slate-800 p-3 rounded-lg">
                    <span className="block text-2xl mb-1">ü§≤</span>
                    <span className="text-sm font-bold">Nh·∫≠n e</span>
                    <span className="text-xs block text-gray-400">
                      (Phi kim)
                    </span>
                  </div>
                  <div className="bg-slate-800 p-3 rounded-lg">
                    <span className="block text-2xl mb-1">üîó</span>
                    <span className="text-sm font-bold">G√≥p chung</span>
                    <span className="text-xs block text-gray-400">
                      (Phi kim - Phi kim)
                    </span>
                  </div>
                </div>
              </div>
            ),
          },
          {
            title: "5. Li√™n k·∫øt Ion",
            content: (
              <div className="text-center">
                <p className="mb-4 text-sm">
                  H√¨nh th√†nh do l·ª±c h√∫t tƒ©nh ƒëi·ªán gi·ªØa <b>Kim lo·∫°i</b> (ƒëi·ªÉn
                  h√¨nh) v√† <b>Phi kim</b> (ƒëi·ªÉn h√¨nh).
                </p>
                <div className="flex items-center justify-center gap-4 bg-white/5 p-4 rounded-xl">
                  <div className="text-center">
                    <Atom type="Na" />
                    <div className="text-xs mt-1 text-red-400 font-bold">
                      - 1e
                    </div>
                    <div className="text-sm font-bold mt-1">Na‚Å∫ (Cation)</div>
                  </div>
                  <div className="text-2xl opacity-50">+</div>
                  <div className="text-center">
                    <Atom type="Cl" />
                    <div className="text-xs mt-1 text-green-400 font-bold">
                      + 1e
                    </div>
                    <div className="text-sm font-bold mt-1">Cl‚Åª (Anion)</div>
                  </div>
                  <div className="text-2xl">‚ûú</div>
                  <div className="bg-white/10 px-4 py-2 rounded-lg font-bold text-xl">
                    NaCl
                  </div>
                </div>
                <p className="mt-4 text-sm text-left bg-slate-800 p-3 rounded-lg">
                  ‚ÑπÔ∏è <b>ƒê·∫∑c ƒëi·ªÉm ch·∫•t Ion:</b> R·∫Øn, n√≥ng ch·∫£y cao, tan trong
                  n∆∞·ªõc t·∫°o dung d·ªãch d·∫´n ƒëi·ªán.
                </p>
              </div>
            ),
          },
          {
            title: "6. Li√™n k·∫øt C·ªông h√≥a tr·ªã",
            content: (
              <div className="text-center">
                <p className="mb-4 text-sm">
                  H√¨nh th√†nh do s·ª± <b>d√πng chung</b> c·∫∑p electron gi·ªØa c√°c
                  nguy√™n t·ª≠ (th∆∞·ªùng l√† Phi kim).
                </p>
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-slate-700/50 p-3 rounded-lg">
                    <div className="flex justify-center -space-x-1 mb-2">
                      <Atom type="H" size="sm" />
                      <Atom type="H" size="sm" />
                    </div>
                    <p className="text-sm font-bold">H ‚Äî H</p>
                    <p className="text-xs opacity-70">D√πng chung 1 c·∫∑p e</p>
                  </div>
                  <div className="bg-slate-700/50 p-3 rounded-lg">
                    <div className="flex justify-center -space-x-1 mb-2">
                      <Atom type="O" size="sm" />
                      <Atom type="O" size="sm" />
                    </div>
                    <p className="text-sm font-bold">O = O</p>
                    <p className="text-xs opacity-70">D√πng chung 2 c·∫∑p e</p>
                  </div>
                </div>
                <div className="mt-4 text-left bg-slate-800 p-3 rounded-lg text-sm">
                  <p>
                    ‚ÑπÔ∏è <b>ƒê·∫∑c ƒëi·ªÉm:</b> C√≥ th·ªÉ l√† r·∫Øn/l·ªèng/kh√≠. Th∆∞·ªùng √≠t tan,
                    kh√¥ng d·∫´n ƒëi·ªán (tr·ª´ m·ªôt s·ªë tr∆∞·ªùng h·ª£p).
                  </p>
                </div>
              </div>
            ),
          },
          // --- PH·∫¶N 3: H√ìA TR·ªä & C√îNG TH·ª®C ---
          {
            title: "7. H√≥a tr·ªã & Quy t·∫Øc",
            content: (
              <div>
                <div className="flex justify-around mb-4 text-sm">
                  <div className="bg-blue-900/40 px-3 py-1 rounded border border-blue-500">
                    H h√≥a tr·ªã I
                  </div>
                  <div className="bg-red-900/40 px-3 py-1 rounded border border-red-500">
                    O h√≥a tr·ªã II
                  </div>
                </div>
                <div className="bg-slate-800 p-4 rounded-xl">
                  <h4 className="font-bold text-center mb-2">
                    Quy t·∫Øc h√≥a tr·ªã
                  </h4>
                  <p className="text-center font-mono text-brand-accent bg-black/30 p-2 rounded mb-3">
                    x √ó a = y √ó b
                  </p>
                  <div className="text-sm opacity-80 text-center mb-2">
                    (x, y: ch·ªâ s·ªë; a, b: h√≥a tr·ªã)
                  </div>
                  <div className="border-t border-slate-600 pt-3 mt-3">
                    <p className="font-bold mb-2 text-center">
                      M·∫πo ch√©o (L·∫≠p CTHH)
                    </p>
                    <div className="flex justify-center items-center gap-4 font-mono text-lg">
                      <div className="flex flex-col items-center">
                        <span>Al</span>
                        <span className="text-xs text-brand-accent">III</span>
                      </div>
                      <div className="flex flex-col items-center">
                        <span>O</span>
                        <span className="text-xs text-red-400">II</span>
                      </div>
                      <span>‚ûú</span>
                      <span className="bg-white/10 px-2 py-1 rounded">
                        Al<sub className="text-red-400">2</sub>O
                        <sub className="text-brand-accent">3</sub>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            ),
          },
          {
            title: "8. T√≠nh % Nguy√™n t·ªë",
            content: (
              <div className="text-center">
                <div className="bg-slate-900 p-3 rounded-lg mb-4 text-sm font-mono border border-slate-600">
                  %X ={" "}
                  <span className="inline-block align-middle text-center">
                    <span className="block border-b border-white/20">
                      KLNT(X) √ó s·ªë nguy√™n t·ª≠
                    </span>
                    <span className="block">KLPT H·ª£p ch·∫•t</span>
                  </span>{" "}
                  √ó 100%
                </div>

                <div className="bg-indigo-900/20 p-4 rounded-xl text-left text-sm">
                  <p className="font-bold mb-2 text-indigo-300">
                    V√≠ d·ª•: %O trong n∆∞·ªõc (H‚ÇÇO)
                  </p>
                  <ul className="space-y-1 font-mono">
                    <li>‚Ä¢ M(H‚ÇÇO) = 2√ó1 + 16 = 18</li>
                    <li>‚Ä¢ %O = (16 / 18) √ó 100%</li>
                    <li className="text-green-400 font-bold text-lg text-right">
                      ‚âà 88.9%
                    </li>
                  </ul>
                </div>
              </div>
            ),
          },
        ];

        return (
          <div className="flex flex-col h-full items-center justify-center p-6 max-w-2xl mx-auto">
            <div className="glass w-full p-8 rounded-3xl min-h-[400px] flex flex-col relative overflow-hidden">
              {/* Progress Bar */}
              <div className="absolute top-0 left-0 w-full h-1 bg-slate-700">
                <motion.div
                  className="h-full bg-brand-accent"
                  initial={{ width: 0 }}
                  animate={{ width: `${((slide + 1) / slides.length) * 100}%` }}
                />
              </div>

              <h2 className="text-2xl sm:text-3xl font-display font-bold text-brand-accent mb-6">
                {slides[slide].title}
              </h2>

              {/* Slide Content Area */}
              <div className="flex-1 flex flex-col justify-center">
                {slides[slide].content}
              </div>

              {/* Navigation Buttons */}
              <div className="flex justify-between mt-8 pt-4 border-t border-white/5">
                <button
                  disabled={slide === 0}
                  onClick={() => {
                    setSlide((s) => s - 1);
                    // playSound("click"); // Uncomment if sound function exists
                  }}
                  className="px-4 py-2 rounded-lg bg-slate-700 disabled:opacity-30 hover:bg-slate-600 transition flex items-center gap-2"
                >
                  <span>‚Üê</span> Quay l·∫°i
                </button>

                <span className="self-center text-sm text-gray-500 font-mono">
                  {slide + 1}/{slides.length}
                </span>

                <button
                  disabled={slide === slides.length - 1}
                  onClick={() => {
                    setSlide((s) => s + 1);
                    // playSound("click"); // Uncomment if sound function exists
                  }}
                  className="px-6 py-2 rounded-lg bg-brand-primary font-bold hover:bg-indigo-500 transition disabled:opacity-30 disabled:hidden flex items-center gap-2"
                >
                  Ti·∫øp theo <span>‚Üí</span>
                </button>
              </div>
            </div>
          </div>
        );
      };

      // 3. TAB: CH·∫æ T·∫†O (BUILDER GAME)

      // Gi·∫£ s·ª≠ b·∫°n ƒë√£ import Atom, playSound, ATOMS v√† MISSIONS t·ª´ c√°c file kh√°c
      // import { Atom, playSound, ATOMS, MISSIONS } from './your-utils';

      const BuilderTab = () => {
        // --- C·∫•u h√¨nh s·ªë l∆∞·ª£ng c√¢u h·ªèi m·ªói v√≤ng ---
        const QUESTIONS_PER_ROUND = 25;

        // --- H√†m t·∫°o danh s√°ch nhi·ªám v·ª• ng·∫´u nhi√™n ---
        const generateRandomMissions = (count) => {
          // Sao ch√©p m·∫£ng g·ªëc ƒë·ªÉ kh√¥ng ·∫£nh h∆∞·ªüng d·ªØ li·ªáu g·ªëc
          const shuffled = [...MISSIONS].sort(() => 0.5 - Math.random());
          // L·∫•y 'count' ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n, n·∫øu kh√¥ng ƒë·ªß th√¨ l·∫•y h·∫øt
          return shuffled.slice(0, count);
        };

        // --- State ---
        // L∆∞u danh s√°ch nhi·ªám v·ª• hi·ªán t·∫°i (25 c√¢u ng·∫´u nhi√™n)
        const [currentMissions, setCurrentMissions] = useState(() =>
          generateRandomMissions(QUESTIONS_PER_ROUND)
        );
        const [missionIdx, setMissionIdx] = useState(0);
        const [bench, setBench] = useState([]); // Array of atom types e.g. ['H', 'H', 'O']
        const [success, setSuccess] = useState(false);

        // L·∫•y nhi·ªám v·ª• hi·ªán t·∫°i
        const mission = currentMissions[missionIdx];

        // --- Actions ---

        const addToBench = (type) => {
          if (success) return;
          setBench([...bench, type]);
          playSound("pop");
        };

        const removeFromBench = (index) => {
          if (success) return;
          const newBench = [...bench];
          newBench.splice(index, 1);
          setBench(newBench);
          playSound("click");
        };

        const clearBench = () => {
          setBench([]);
          setSuccess(false);
          playSound("click");
        };

        // H√†m Reset Game: T·∫°o b·ªô c√¢u h·ªèi m·ªõi v√† ƒë∆∞a v·ªÅ c√¢u s·ªë 0
        const resetGame = () => {
          setCurrentMissions(generateRandomMissions(QUESTIONS_PER_ROUND));
          setMissionIdx(0);
          setBench([]);
          setSuccess(false);
          playSound("click");
        };

        // --- Effects ---

        // Check logic ho√†n th√†nh nhi·ªám v·ª•
        useEffect(() => {
          if (!mission) return; // Ph√≤ng tr∆∞·ªùng h·ª£p mission ch∆∞a load

          const currentCount = bench.reduce((acc, type) => {
            acc[type] = (acc[type] || 0) + 1;
            return acc;
          }, {});

          const targetCount = mission.recipe;

          // Compare lengths first
          const currentKeys = Object.keys(currentCount);
          const targetKeys = Object.keys(targetCount);

          if (currentKeys.length !== targetKeys.length) return;
          if (
            bench.length !==
            Object.values(targetCount).reduce((a, b) => a + b, 0)
          )
            return;

          // Deep compare
          const isMatch = targetKeys.every(
            (key) => currentCount[key] === targetCount[key]
          );

          if (isMatch) {
            setSuccess(true);
            playSound("success");
            confetti({ particleCount: 150, spread: 60, origin: { y: 0.6 } });
          }
        }, [bench, mission]);

        // Chuy·ªÉn sang c√¢u ti·∫øp theo
        const nextMission = () => {
          if (missionIdx < currentMissions.length - 1) {
            setMissionIdx((m) => m + 1);
            setBench([]);
            setSuccess(false);
          }
        };

        // --- Render ---

        // N·∫øu b·∫±ng c√°ch n√†o ƒë√≥ kh√¥ng c√≥ mission (l·ªói kh·ªüi t·∫°o), render loading ho·∫∑c null
        if (!mission) return <div>ƒêang t·∫£i nhi·ªám v·ª•...</div>;

        return (
          <div className="flex flex-col h-full max-w-4xl mx-auto p-4 gap-4">
            {/* Header Mission */}
            <div className="bg-brand-card p-4 rounded-2xl flex justify-between items-center shadow-lg border border-slate-700">
              <div>
                <div className="text-xs text-slate-400 uppercase tracking-wider font-bold">
                  Nhi·ªám v·ª• {missionIdx + 1}/{currentMissions.length}
                </div>
                <h2 className="text-xl font-bold text-white">
                  H√£y t·∫°o ra:{" "}
                  <span className="text-brand-accent text-2xl">
                    {mission.name} ({mission.formula})
                  </span>
                </h2>
              </div>
              <div className="hidden md:block text-right text-sm text-slate-400">
                {mission.desc}
              </div>
            </div>

            {/* Main Assembly Area */}
            <div
              className="flex-1 glass rounded-3xl relative flex items-center justify-center overflow-hidden border-2 border-dashed border-slate-600 transition-colors duration-500"
              style={{
                borderColor: success ? "#22c55e" : "#475569",
                backgroundColor: success ? "rgba(34, 197, 94, 0.1)" : "",
              }}
            >
              {/* Background Grid */}
              <div
                className="absolute inset-0 opacity-10"
                style={{
                  backgroundImage: "radial-gradient(#fff 1px, transparent 1px)",
                  backgroundSize: "20px 20px",
                }}
              ></div>

              {/* Atoms on Bench */}
              <div className="relative z-10 flex flex-wrap gap-2 justify-center items-center p-8 min-h-[150px]">
                {bench.length === 0 && !success && (
                  <div className="text-slate-500 animate-pulse">
                    Ch·∫°m v√†o nguy√™n t·ª≠ b√™n d∆∞·ªõi ƒë·ªÉ th√™m...
                  </div>
                )}

                <AnimatePresence>
                  {bench.map((type, idx) => (
                    <motion.div
                      key={`${type}-${idx}`}
                      initial={{ scale: 0, rotate: 180 }}
                      animate={{ scale: 1, rotate: 0 }}
                      exit={{ scale: 0 }}
                      onClick={() => removeFromBench(idx)}
                      className="cursor-pointer hover:scale-110 transition-transform"
                    >
                      <Atom type={type} size="lg" />
                    </motion.div>
                  ))}
                </AnimatePresence>
              </div>

              {/* Success / Completion Overlay */}
              {success && (
                <motion.div
                  initial={{ y: 50, opacity: 0 }}
                  animate={{ y: 0, opacity: 1 }}
                  className="absolute bottom-6 flex flex-col items-center gap-3 bg-brand-bg/90 backdrop-blur-md p-6 rounded-2xl border border-brand-success shadow-2xl z-20"
                >
                  {missionIdx < currentMissions.length - 1 ? (
                    // Tr∆∞·ªùng h·ª£p ho√†n th√†nh 1 c√¢u b√¨nh th∆∞·ªùng
                    <>
                      <div className="text-brand-success font-bold text-2xl">
                        üéâ Ch√≠nh x√°c!
                      </div>
                      <div className="text-slate-300">
                        ƒê√¢y l√†{" "}
                        <span className="font-bold text-white">
                          {mission.type}
                        </span>
                      </div>
                      <button
                        onClick={nextMission}
                        className="bg-brand-success text-white px-8 py-3 rounded-xl font-bold hover:scale-105 transition mt-2"
                      >
                        B√†i Ti·∫øp Theo ‚ûú
                      </button>
                    </>
                  ) : (
                    // Tr∆∞·ªùng h·ª£p ho√†n th√†nh t·∫•t c·∫£ 25 c√¢u
                    <>
                      <div className="text-yellow-400 font-bold text-2xl text-center">
                        üèÜ Xu·∫•t s·∫Øc! <br /> B·∫°n ƒë√£ ho√†n th√†nh{" "}
                        {currentMissions.length} nhi·ªám v·ª•!
                      </div>
                      <div className="text-slate-300 text-center text-sm">
                        B·∫°n ƒë√£ n·∫Øm v·ªØng c·∫•u t·∫°o c√°c ch·∫•t c∆° b·∫£n.
                      </div>
                      <button
                        onClick={resetGame}
                        className="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:scale-105 transition mt-2 flex items-center gap-2"
                      >
                        <i data-lucide="refresh-cw" className="w-4 h-4"></i>{" "}
                        Ch∆°i L·∫°i (B·ªô M·ªõi)
                      </button>
                    </>
                  )}
                </motion.div>
              )}
            </div>

            {/* Inventory (Tools) */}
            <div className="h-auto bg-brand-card p-4 rounded-2xl border-t border-slate-700">
              <div className="flex justify-between items-center mb-2">
                <span className="text-xs font-bold text-slate-500 uppercase">
                  Kho Nguy√™n T·ª≠ (C·∫ßn cho nhi·ªám v·ª• n√†y)
                </span>
                <div className="flex gap-3">
                  {/* N√∫t Reset s·ªõm n·∫øu mu·ªën b·ªè cu·ªôc ho·∫∑c ch∆°i l·∫°i ngay */}
                  <button
                    onClick={resetGame}
                    className="text-xs text-slate-400 hover:text-white flex items-center gap-1"
                    title="T·∫°o b·ªô c√¢u h·ªèi m·ªõi ngay l·∫≠p t·ª©c"
                  >
                    <i data-lucide="refresh-cw" className="w-3 h-3"></i> Reset
                    Game
                  </button>
                  <button
                    onClick={clearBench}
                    className="text-xs text-red-400 hover:text-red-300 flex items-center gap-1"
                  >
                    <i data-lucide="trash-2" className="w-3 h-3"></i> X√≥a b√†n
                  </button>
                </div>
              </div>
              <div className="flex gap-4 overflow-x-auto pb-2 scroll-y justify-center md:justify-start">
                {/* Hi·ªÉn th·ªã c√°c nguy√™n t·ª≠ c·∫ßn thi·∫øt cho mission hi·ªán t·∫°i */}
                {Object.keys(mission.recipe).map((key) => (
                  <button
                    key={key}
                    onClick={() => addToBench(key)}
                    className="flex flex-col items-center gap-1 group min-w-[60px]"
                  >
                    <div className="group-active:scale-90 transition-transform">
                      <Atom type={key} />
                    </div>
                    <span className="text-xs font-bold text-slate-400">
                      {ATOMS[key].mass}
                    </span>
                  </button>
                ))}
              </div>
            </div>
          </div>
        );
      };
      // --- üéÆ CLASSIFICATION TAB (Game Ph√¢n Lo·∫°i) ---
      const ClassificationTab = () => {
        // --- STATE ---
        const [gameState, setGameState] = React.useState("menu"); // 'menu', 'playing', 'finished'
        const [gameMode, setGameMode] = React.useState("practice");

        // D·ªØ li·ªáu c√¢u h·ªèi (L·∫•y t·ª´ bi·∫øn global MISSIONS c·ªßa b·∫°n)
        const [questions, setQuestions] = React.useState([]);
        const [currentIdx, setCurrentIdx] = React.useState(0);
        const [score, setScore] = React.useState(0);
        const [streak, setStreak] = React.useState(0);
        const [message, setMessage] = React.useState("");

        // State th·ªùi gian
        const [timeLeft, setTimeLeft] = React.useState(100);
        const [isPaused, setIsPaused] = React.useState(false);

        const TIME_LIMIT = 3; // 5 gi√¢y m·ªói c√¢u
        const currentItem = questions[currentIdx];
        const totalQuestions = questions.length;

        // --- EFFECT: Render Icon ---
        // M·ªói khi giao di·ªán thay ƒë·ªïi, c·∫ßn g·ªçi h√†m n√†y ƒë·ªÉ icon hi·ªÉn th·ªã
        React.useEffect(() => {
          if (window.lucide) {
            window.lucide.createIcons();
          }
        }, [gameState, currentIdx, message]);

        // --- LOGIC GAME ---
        const startGame = (mode) => {
          // ƒê·∫£m b·∫£o MISSIONS t·ªìn t·∫°i, n·∫øu kh√¥ng d√πng d·ªØ li·ªáu m·∫´u ƒë·ªÉ tr√°nh l·ªói
          const sourceData = typeof MISSIONS !== "undefined" ? MISSIONS : [];

          if (sourceData.length === 0) {
            alert("Ch∆∞a c√≥ d·ªØ li·ªáu MISSIONS!");
            return;
          }

          const shuffled = [...sourceData].sort(() => 0.5 - Math.random());
          setQuestions(shuffled);
          setGameMode(mode);
          setGameState("playing");
          setCurrentIdx(0);
          setScore(0);
          setStreak(0);
          setMessage("");
          setTimeLeft(100);
          setIsPaused(false);
        };

        // Timer Logic
        React.useEffect(() => {
          if (gameState !== "playing" || gameMode === "practice" || isPaused)
            return;

          const interval = setInterval(() => {
            setTimeLeft((prev) => {
              if (prev <= 0) {
                clearInterval(interval);
                handleTimeOut();
                return 0;
              }
              return prev - 100 / (TIME_LIMIT * 10);
            });
          }, 100);

          return () => clearInterval(interval);
        }, [gameState, gameMode, isPaused, currentIdx]);

        const handleTimeOut = () => {
          if (gameMode === "survival") {
            endGame(false);
          } else {
            handleAnswer(null, true);
          }
        };

        const handleAnswer = (answerType, isTimeout = false) => {
          if (isPaused) return;
          setIsPaused(true);

          let isCorrect = false;
          // Ki·ªÉm tra ƒë√°p √°n (L∆∞u √Ω: ƒë·∫£m b·∫£o trong MISSIONS c√≥ tr∆∞·ªùng 'type' l√† 'ƒê∆°n ch·∫•t' ho·∫∑c 'H·ª£p ch·∫•t')
          if (!isTimeout && currentItem) {
            isCorrect = currentItem.type === answerType;
          }

          if (isCorrect) {
            setScore((s) => s + 1);
            setStreak((s) => s + 1);
            setMessage(
              streak >= 2 ? "üî• ƒêang ch√°y! Tuy·ªát v·ªùi!" : "‚úÖ Ch√≠nh x√°c!"
            );

            // G·ªçi sound/confetti n·∫øu c√≥ (ki·ªÉm tra t·ªìn t·∫°i ƒë·ªÉ kh√¥ng l·ªói)
            if (typeof playSound === "function") playSound("success");
            if (typeof confetti === "function")
              confetti({ particleCount: 50, spread: 40, origin: { y: 0.8 } });
          } else {
            if (typeof playSound === "function") playSound("click");

            if (gameMode === "survival") {
              setMessage(isTimeout ? "‚è∞ H·∫øt gi·ªù!" : `üíÄ Sai r·ªìi! Game Over.`);
              setTimeout(() => endGame(false), 1500);
              return;
            }

            setStreak(0);
            setMessage(
              isTimeout ? "‚è∞ H·∫øt gi·ªù!" : `‚ùå Sai r·ªìi. L√† ${currentItem?.type}.`
            );
          }

          setTimeout(() => {
            setMessage("");
            if (currentIdx < totalQuestions - 1) {
              setCurrentIdx((i) => i + 1);
              setIsPaused(false);
              setTimeLeft(100);
            } else {
              endGame(true);
            }
          }, 1200);
        };

        const endGame = (completed) => {
          setGameState("finished");
          if (completed && score > totalQuestions / 2) {
            if (typeof playSound === "function") playSound("success");
            if (typeof confetti === "function")
              confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
          }
        };

        // --- RENDER ---

        // 1. MENU
        if (gameState === "menu") {
          return (
            <div className="flex flex-col items-center justify-center h-full p-4 text-center">
              <div className="glass p-8 rounded-3xl w-full max-w-md shadow-2xl bg-slate-900/50">
                <h1 className="text-3xl font-display font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-purple-400 mb-2">
                  Ph√¢n Lo·∫°i Ch·∫•t
                </h1>
                <p className="text-slate-300 mb-8 text-sm">Ch·ªçn ch·∫ø ƒë·ªô ch∆°i</p>

                <div className="space-y-3">
                  {/* N√∫t Luy·ªán t·∫≠p */}
                  <button
                    onClick={() => startGame("practice")}
                    className="w-full group flex items-center justify-between bg-slate-800 hover:bg-blue-600 text-white p-4 rounded-xl transition-all border border-slate-700"
                  >
                    <div className="flex items-center gap-3">
                      <i
                        data-lucide="play"
                        className="w-5 h-5 text-blue-400 group-hover:text-white"
                      ></i>
                      <div className="text-left">
                        <div className="font-bold">Luy·ªán T·∫≠p</div>
                        <div className="text-xs text-slate-400 group-hover:text-blue-100">
                          Kh√¥ng t√≠nh gi·ªù
                        </div>
                      </div>
                    </div>
                  </button>

                  {/* N√∫t T·ªëc ƒë·ªô */}
                  <button
                    onClick={() => startGame("timed")}
                    className="w-full group flex items-center justify-between bg-slate-800 hover:bg-yellow-600 text-white p-4 rounded-xl transition-all border border-slate-700"
                  >
                    <div className="flex items-center gap-3">
                      <i
                        data-lucide="clock"
                        className="w-5 h-5 text-yellow-400 group-hover:text-white"
                      ></i>
                      <div className="text-left">
                        <div className="font-bold">T·ªëc ƒê·ªô</div>
                        <div className="text-xs text-slate-400 group-hover:text-yellow-100">
                          5 gi√¢y / c√¢u
                        </div>
                      </div>
                    </div>
                  </button>

                  {/* N√∫t Sinh t·ªìn */}
                  <button
                    onClick={() => startGame("survival")}
                    className="w-full group flex items-center justify-between bg-slate-800 hover:bg-red-600 text-white p-4 rounded-xl transition-all border border-slate-700"
                  >
                    <div className="flex items-center gap-3">
                      <i
                        data-lucide="skull"
                        className="w-5 h-5 text-red-400 group-hover:text-white"
                      ></i>
                      <div className="text-left">
                        <div className="font-bold">Sinh T·ªìn</div>
                        <div className="text-xs text-slate-400 group-hover:text-red-100">
                          Sai l√† thua
                        </div>
                      </div>
                    </div>
                  </button>
                </div>
              </div>
            </div>
          );
        }

        // 2. FINISHED
        if (gameState === "finished") {
          return (
            <div className="flex flex-col items-center justify-center h-full p-4 text-center">
              <div className="glass p-8 rounded-3xl w-full max-w-md bg-slate-900/90 border border-slate-700">
                <div className="flex justify-center mb-4">
                  <i
                    data-lucide="trophy"
                    className="w-20 h-20 text-yellow-400"
                  ></i>
                </div>
                <h2 className="text-3xl font-display font-bold text-white mb-2">
                  K·∫øt Th√∫c!
                </h2>
                <div className="text-slate-400 mb-6">
                  Ch·∫ø ƒë·ªô:{" "}
                  <span className="text-blue-400 font-bold uppercase">
                    {gameMode}
                  </span>
                </div>

                <div className="bg-slate-800/50 p-6 rounded-2xl mb-8 border border-slate-700">
                  <p className="text-sm text-slate-400 uppercase tracking-widest mb-1">
                    ƒêi·ªÉm s·ªë
                  </p>
                  <p className="text-5xl font-mono font-bold text-white">
                    <span className="text-brand-accent">{score}</span>
                    <span className="text-2xl text-slate-500">
                      /{totalQuestions}
                    </span>
                  </p>
                </div>

                <button
                  onClick={() => setGameState("menu")}
                  className="flex items-center justify-center gap-2 w-full bg-brand-primary text-white px-6 py-4 rounded-xl font-bold hover:bg-indigo-500 transition"
                >
                  <i data-lucide="rotate-ccw" className="w-5 h-5"></i> V·ªÅ Menu
                  Ch√≠nh
                </button>
              </div>
            </div>
          );
        }

        // 3. PLAYING
        return (
          <div className="flex flex-col h-full items-center justify-center p-6 max-w-xl mx-auto w-full">
            <div className="glass w-full p-6 md:p-8 rounded-3xl flex flex-col items-center relative shadow-2xl bg-slate-900/80 backdrop-blur-xl border border-white/10">
              {/* Header */}
              <div className="w-full flex justify-between items-center mb-6">
                <div className="bg-slate-800 px-3 py-1.5 rounded-lg border border-slate-700 text-slate-300 text-sm font-bold">
                  C√¢u <span className="text-white">{currentIdx + 1}</span>/
                  {totalQuestions}
                </div>

                <div
                  className={`flex items-center gap-2 px-3 py-1.5 rounded-lg border ${
                    streak > 2
                      ? "bg-orange-500/20 border-orange-500/50 text-orange-400"
                      : "bg-slate-800 border-slate-700 text-slate-400"
                  }`}
                >
                  <i data-lucide="zap" className="w-4 h-4"></i>
                  <span className="font-bold text-sm">{streak}</span>
                </div>
              </div>

              {/* Timer Bar */}
              {gameMode !== "practice" && (
                <div className="w-full h-2 bg-slate-800 rounded-full mb-8 overflow-hidden relative">
                  <div
                    className={`h-full absolute left-0 top-0 transition-all duration-100 ease-linear ${
                      timeLeft < 30 ? "bg-red-500" : "bg-blue-500"
                    }`}
                    style={{ width: `${timeLeft}%` }}
                  />
                </div>
              )}

              {/* Question Card */}
              <h2 className="text-xl font-display font-bold text-slate-200 mb-4">
                Ph√¢n lo·∫°i ch·∫•t n√†y:
              </h2>

              <motion.div
                key={currentItem.id} // Key change triggers animation
                initial={{ scale: 0.8, opacity: 0 }}
                animate={{ scale: 1, opacity: 1 }}
                className="w-full bg-gradient-to-b from-slate-800 to-slate-900 p-8 rounded-2xl mb-8 shadow-inner border border-slate-700 text-center relative overflow-hidden"
              >
                <div className="text-5xl md:text-6xl font-mono font-bold text-white mb-2 relative z-10">
                  {currentItem.formula}
                </div>
                <p className="text-base text-slate-400 mt-2 font-medium relative z-10">
                  {currentItem.desc}
                </p>
              </motion.div>

              {/* Buttons */}
              <div className="flex gap-4 w-full">
                <button
                  onClick={() => handleAnswer("ƒê∆°n ch·∫•t")}
                  disabled={message !== ""}
                  className="flex-1 bg-blue-600 text-white px-4 py-4 rounded-xl font-bold text-lg hover:bg-blue-500 transition-all active:scale-95 disabled:opacity-50"
                >
                  ƒê∆°n ch·∫•t
                </button>

                <button
                  onClick={() => handleAnswer("H·ª£p ch·∫•t")}
                  disabled={message !== ""}
                  className="flex-1 bg-purple-600 text-white px-4 py-4 rounded-xl font-bold text-lg hover:bg-purple-500 transition-all active:scale-95 disabled:opacity-50"
                >
                  H·ª£p ch·∫•t
                </button>
              </div>

              {/* Message */}
              <div className="h-8 mt-6 w-full flex justify-center items-center">
                {message && (
                  <motion.div
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    className={`font-bold text-lg px-4 py-1 rounded-full bg-slate-900/80 backdrop-blur border ${
                      message.includes("Sai") || message.includes("H·∫øt")
                        ? "text-red-400 border-red-500/30"
                        : "text-green-400 border-green-500/30"
                    }`}
                  >
                    {message}
                  </motion.div>
                )}
              </div>
            </div>
          </div>
        );
      };

      // 4. TAB: C√ÇN PH√ÇN T·ª¨ (MOLECULAR MASS CALCULATOR)

      const ScaleTab = () => {
        const [selected, setSelected] = useState(MISSIONS[0]);
        const [searchTerm, setSearchTerm] = useState("");
        // State m·ªõi ƒë·ªÉ ƒëi·ªÅu khi·ªÉn vi·ªác ·∫©n/hi·ªán panel danh s√°ch
        const [isListVisible, setIsListVisible] = useState(true);

        const filteredMissions = useMemo(() => {
          if (!searchTerm) return MISSIONS;

          const lowerCaseSearchTerm = searchTerm.toLowerCase().trim();

          return MISSIONS.filter((m) => {
            // Chu·∫©n h√≥a v√† l∆∞u tr·ªØ c√¥ng th·ª©c & t√™n (gi·∫£m thi·ªÉu vi·ªác g·ªçi toLowerCase l·∫∑p l·∫°i)
            const lowerCaseName = m.name.toLowerCase();
            const lowerCaseFormula = m.formula.toLowerCase().replace(/ /g, ""); // Lo·∫°i b·ªè kho·∫£ng tr·∫Øng

            // 1. T√¨m theo T√™n h·ª£p ch·∫•t
            if (lowerCaseName.includes(lowerCaseSearchTerm)) {
              return true;
            }

            // 2. T√¨m theo C√¥ng th·ª©c
            if (lowerCaseFormula.includes(lowerCaseSearchTerm)) {
              return true;
            }

            // 3. T√¨m theo K√Ω hi·ªáu Nguy√™n t·ªë C·∫•u th√†nh (trong m.recipe)
            const elementKeys = Object.keys(m.recipe);

            // S·ª≠ d·ª•ng .some() ƒë·ªÉ ki·ªÉm tra xem t·ª´ kh√≥a t√¨m ki·∫øm c√≥ n·∫±m trong b·∫•t k·ª≥ key n√†o kh√¥ng.
            // ƒêi·ªÅu n√†y gi√∫p t√¨m ki·∫øm linh ho·∫°t h∆°n, v√≠ d·ª•: g√µ "li" v·∫´n ra "Li"
            if (
              elementKeys.some((key) =>
                key.toLowerCase().includes(lowerCaseSearchTerm)
              )
            ) {
              return true;
            }

            return false;
          });
        }, [searchTerm]);

        // T√≠nh to√°n kh·ªëi l∆∞·ª£ng ph√¢n t·ª≠ (gi·ªØ nguy√™n)
        const calculateMass = () => {
          let total = 0;
          let breakdown = [];

          Object.entries(selected.recipe).forEach(([atomType, count]) => {
            const atom = ATOMS[atomType];
            total += atom.mass * count;
            breakdown.push({
              atomType,
              mass: atom.mass,
              count,
              subTotal: atom.mass * count,
            });
          });
          return { total, breakdown };
        };

        const { total, breakdown } = calculateMass();

        return (
          <div className="flex h-full gap-4 p-4 max-w-6xl mx-auto">
            {/* --- C·ªòT TR√ÅI: PANEL DANH S√ÅCH & T√åM KI·∫æM (C√≥ th·ªÉ ·∫©n/hi·ªán) --- */}
            <AnimatePresence>
              {isListVisible && (
                <motion.div
                  initial={{ opacity: 0, x: -50 }}
                  animate={{ opacity: 1, x: 0 }}
                  exit={{ opacity: 0, x: -50 }}
                  transition={{ duration: 0.3 }}
                  className="w-full md:w-1/3 flex flex-col gap-4 bg-slate-800/50 rounded-2xl p-4 border border-slate-700 max-h-full"
                >
                  <h3 className="text-lg font-bold text-brand-warning flex items-center justify-between">
                    <span>üîç Kho H·ª£p Ch·∫•t</span>
                    <button
                      onClick={() => setIsListVisible(false)}
                      className="p-1 rounded-full text-slate-400 hover:text-white transition"
                      title="ƒê√≥ng danh s√°ch"
                    >
                      <i data-lucide="chevron-left" className="w-5 h-5"></i>
                    </button>
                  </h3>

                  {/* Thanh t√¨m ki·∫øm */}
                  <div className="relative">
                    <input
                      type="text"
                      placeholder="T√¨m ki·∫øm theo t√™n/c√¥ng th·ª©c..."
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      className="w-full bg-slate-900 border border-slate-600 rounded-xl px-4 py-3 pl-10 text-white focus:outline-none focus:border-brand-accent transition-colors"
                    />
                    <i
                      data-lucide="search"
                      className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"
                    ></i>
                  </div>

                  {/* Danh s√°ch cu·ªôn */}
                  <div className="flex-1 overflow-y-auto pr-2 space-y-2 custom-scrollbar">
                    {filteredMissions.length > 0 ? (
                      filteredMissions.map((m) => (
                        <button
                          key={m.id}
                          onClick={() => {
                            setSelected(m);
                            playSound("click");
                          }}
                          className={`w-full text-left p-3 rounded-xl border transition-all flex justify-between items-center group ${
                            selected.id === m.id
                              ? "bg-brand-accent/20 border-brand-accent shadow-[0_0_15px_rgba(56,189,248,0.3)]"
                              : "bg-slate-800 border-slate-700 hover:bg-slate-700 hover:border-slate-500"
                          }`}
                        >
                          <div>
                            <div
                              className={`font-bold ${
                                selected.id === m.id
                                  ? "text-brand-accent"
                                  : "text-white group-hover:text-slate-200"
                              }`}
                            >
                              {m.name}
                            </div>
                            <div className="text-xs text-slate-400 font-mono mt-1 bg-slate-900/50 inline-block px-2 py-0.5 rounded">
                              {m.formula}
                            </div>
                          </div>
                          {selected.id === m.id && (
                            <motion.div
                              layoutId="active-indicator"
                              className="w-2 h-2 rounded-full bg-brand-accent shadow-[0_0_8px_currentColor]"
                            />
                          )}
                        </button>
                      ))
                    ) : (
                      <div className="text-center text-slate-500 py-8 italic">
                        Kh√¥ng t√¨m th·∫•y ch·∫•t n√†o ph√π h·ª£p.
                      </div>
                    )}
                  </div>
                </motion.div>
              )}
            </AnimatePresence>

            {/* N√∫t m·ªü danh s√°ch n·∫øu n√≥ b·ªã ·∫©n */}
            {!isListVisible && (
              <motion.button
                initial={{ x: -20, opacity: 0 }}
                animate={{ x: 0, opacity: 1 }}
                onClick={() => setIsListVisible(true)}
                className="absolute left-4 top-4 z-50 p-2 bg-brand-accent rounded-full text-slate-900 shadow-lg hover:scale-105 transition"
                title="M·ªü danh s√°ch h·ª£p ch·∫•t"
              >
                <i data-lucide="list-plus" className="w-6 h-6"></i>
              </motion.button>
            )}

            {/* --- C·ªòT PH·∫¢I: KHU V·ª∞C C√ÇN & PH√âP T√çNH --- */}
            {/* K√≠ch th∆∞·ªõc c·ªôt n√†y thay ƒë·ªïi t√πy thu·ªôc v√†o vi·ªác list c√≥ hi·ªÉn th·ªã hay kh√¥ng */}
            <div
              className={`flex flex-col bg-slate-900/30 rounded-2xl border border-slate-700 relative overflow-hidden ${
                isListVisible ? "w-2/3" : "w-full"
              }`}
            >
              {/* Header Khu V·ª±c C√¢n */}
              <div className="absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-slate-900 to-transparent z-10 flex justify-between items-start">
                <h2 className="text-2xl font-bold text-white">
                  Ph√¢n T·ª≠ Kh·ªëi c·ªßa{" "}
                  <span className="text-brand-accent">{selected.name}</span>
                </h2>
                <div className="text-right">
                  <div className="text-4xl font-mono font-bold text-brand-warning drop-shadow-md">
                    {total} <span className="text-lg text-slate-400">amu</span>
                  </div>
                  <div className="text-xs text-slate-500 uppercase tracking-widest mt-1">
                    T·ªïng Kh·ªëi L∆∞·ª£ng
                  </div>
                </div>
              </div>

              {/* V√πng C√¢n (Visualization) - Gi·ªØ nguy√™n */}
              <div className="flex-1 flex items-center justify-center relative min-h-[300px] mt-16 md:mt-0">
                {/* Background Grid Hi·ªáu ·ª©ng */}
                <div
                  className="absolute inset-0 opacity-5 pointer-events-none"
                  style={{
                    backgroundImage:
                      "linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px)",
                    backgroundSize: "40px 40px",
                  }}
                ></div>

                {/* C√°n C√¢n */}
                <motion.div
                  key={selected.id}
                  initial={{ rotate: -5 }}
                  animate={{ rotate: 0 }}
                  transition={{ type: "spring", stiffness: 120, damping: 12 }}
                  className="w-full max-w-[500px] relative mt-10"
                >
                  {/* Tr·ª•c ngang */}
                  <div className="h-2 bg-slate-600 rounded-full w-full relative">
                    {/* ƒêi·ªÉm t·ª±a trung t√¢m */}
                    <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-slate-300 rounded-full border-4 border-slate-700 shadow-lg z-20"></div>
                    <div className="absolute left-1/2 top-4 -translate-x-1/2 w-16 h-24 bg-slate-700/50 -z-10 rounded-b-xl clip-path-triangle"></div>
                  </div>

                  {/* ƒêƒ©a C√¢n Tr√°i (Ch·ª©a Nguy√™n T·ª≠) */}
                  <div className="absolute left-0 top-1/2 -translate-y-1/2 flex flex-col items-center group">
                    <div className="w-[2px] h-24 bg-slate-500 origin-top animate-swing-slight"></div>
                    <div className="w-32 h-12 border-b-4 border-slate-500 rounded-b-full bg-white/5 backdrop-blur-sm relative flex items-end justify-center pb-2 shadow-lg group-hover:bg-white/10 transition-colors">
                      <div
                        className="absolute bottom-4 flex flex-wrap justify-center w-24 gap-1 animate-float"
                        style={{ animationDuration: "3s" }}
                      >
                        {Object.entries(selected.recipe).map(([type, count]) =>
                          Array(count)
                            .fill(0)
                            .map((_, i) => (
                              <div
                                key={`${type}-${i}`}
                                className="transform scale-75 hover:scale-100 transition-transform cursor-help"
                                title={ATOMS[type].name}
                              >
                                <Atom type={type} size="sm" />
                              </div>
                            ))
                        )}
                      </div>
                    </div>
                  </div>

                  {/* ƒêƒ©a C√¢n Ph·∫£i (Qu·∫£ C√¢n S·ªë) */}
                  <div className="absolute right-0 top-1/2 -translate-y-1/2 flex flex-col items-center">
                    <div
                      className="w-[2px] h-24 bg-slate-500 origin-top animate-swing-slight"
                      style={{ animationDelay: "0.2s" }}
                    ></div>
                    <div className="w-32 h-12 border-b-4 border-slate-500 rounded-b-full bg-white/5 backdrop-blur-sm relative flex items-center justify-center shadow-lg">
                      <div className="bg-brand-warning text-slate-900 font-bold px-3 py-1 rounded shadow-inner">
                        {total}
                      </div>
                    </div>
                  </div>
                </motion.div>
              </div>

              {/* Ph√¢n T√≠ch Ph√©p T√≠nh (Breakdown) */}
              <div className="bg-slate-800 p-4 border-t border-slate-700">
                <div className="text-xs text-slate-400 uppercase font-bold mb-3">
                  C√¥ng th·ª©c t√≠nh PTK:{" "}
                  <span className="text-white font-mono">
                    {selected.formula}
                  </span>
                </div>
                <div className="flex flex-wrap items-center justify-center gap-2 text-sm md:text-base font-mono bg-slate-900 p-3 rounded-xl border border-slate-700/50 shadow-inner">
                  {breakdown.map((item, index) => (
                    <React.Fragment key={item.atomType}>
                      {index > 0 && (
                        <span className="text-slate-500 mx-1">+</span>
                      )}
                      <div className="flex items-center gap-1 bg-slate-800 px-2 py-1 rounded border border-slate-700">
                        <span
                          className={`${ATOMS[item.atomType].text} font-bold`}
                        >
                          {item.mass}
                        </span>
                        <span className="text-slate-500 text-xs">
                          x{item.count}
                        </span>
                      </div>
                    </React.Fragment>
                  ))}

                  <div className="flex items-center gap-2 ml-2 pl-2 border-l border-slate-600">
                    <span className="text-slate-400">=</span>
                    <span className="text-brand-warning font-bold text-xl">
                      {total}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // --- üöÄ MAIN APP ---
      const App = () => {
        const [tab, setTab] = useState("theory"); // theory, build, scale

        useEffect(() => {
          createIcons();
        }, [tab]);

        const NavBtn = ({ id, icon, label }) => (
          <button
            onClick={() => setTab(id)}
            className={`flex-1 flex flex-col items-center p-3 rounded-xl transition-all ${
              tab === id
                ? "bg-brand-primary text-white shadow-lg shadow-brand-primary/30"
                : "text-slate-400 hover:bg-slate-800"
            }`}
          >
            <i data-lucide={icon} className="mb-1 w-6 h-6"></i>
            <span className="text-xs font-bold">{label}</span>
          </button>
        );

        return (
          <div className="h-screen flex flex-col bg-brand-bg max-w-md md:max-w-4xl mx-auto border-x border-slate-800 shadow-2xl overflow-hidden">
            {/* Header */}
            <header className="p-4 flex items-center justify-between bg-brand-bg/80 backdrop-blur-md z-50 border-b border-slate-800">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-gradient-to-br from-brand-accent to-brand-primary rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg">
                  2
                </div>
                <a href="../../index.html">Quay v·ªÅ trang ch·ªß</a>
                <div>
                  <h1 className="font-display font-bold text-xl leading-none">
                    Ph√¢n T·ª≠
                  </h1>
                  <span className="text-xs text-brand-accent">
                    H√≥a h·ªçc L·ªõp 7
                  </span>
                </div>
              </div>
              <div className="text-xs font-bold px-3 py-1 bg-slate-800 rounded-full text-slate-400"></div>
            </header>

            {/* Main Content Area */}
            <main className="flex-1 relative overflow-hidden">
              <AnimatePresence mode="wait">
                <motion.div
                  key={tab}
                  initial={{ opacity: 0, x: 20 }}
                  animate={{ opacity: 1, x: 0 }}
                  exit={{ opacity: 0, x: -20 }}
                  transition={{ duration: 0.2 }}
                  className="h-full"
                >
                  {tab === "theory" && <TheoryTab />}
                  {tab === "build" && <BuilderTab />}
                  {tab === "scale" && <ScaleTab />}
                  {tab === "ClassificationTab" && <ClassificationTab />}
                </motion.div>
              </AnimatePresence>
            </main>

            {/* Bottom Navigation */}
            <nav className="p-2 bg-brand-card border-t border-slate-700 flex gap-2 shrink-0">
              <NavBtn id="theory" icon="book-open" label="L√Ω Thuy·∫øt" />
              <NavBtn id="build" icon="hammer" label="X∆∞·ªüng Ch·∫ø T·∫°o" />
              <NavBtn id="scale" icon="scale" label="C√¢n Ph√¢n T·ª≠" />
              <NavBtn
                id="ClassificationTab"
                icon="layers"
                label="Ph√¢n Lo·∫°i ch·∫•t"
              />
            </nav>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
