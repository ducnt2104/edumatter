<!doctype html>
<html lang="vi" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Oxygen và Không Khí - ChemStudy Junior</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Configuration for Tailwind Dark Mode -->
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              chemBlue: "#3b82f6",
              chemDark: "#0f172a",
              chemLight: "#f0f9ff",
              fire: "#ff5722",
            },
            animation: {
              float: "float 3s ease-in-out infinite",
              "pulse-slow": "pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",
            },
            keyframes: {
              float: {
                "0%, 100%": { transform: "translateY(0)" },
                "50%": { transform: "translateY(-10px)" },
              },
            },
          },
        },
      };
    </script>
    <style>
      /* =========================================================
           10. FOOTER
           ========================================================= 
      */
      footer {
        background: var(--footer-bg);
        color: var(--footer-text);
        padding: 100px 5% 40px;
        position: relative;
        overflow: hidden;
        transition:
          background-color 0.8s ease,
          color 0.8s ease;
      }

      .footer-waves {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 60px;
        background: var(--footer-bg);
        clip-path: polygon(
          0% 45%,
          16% 44%,
          33% 50%,
          54% 60%,
          70% 61%,
          84% 59%,
          100% 52%,
          100% 100%,
          0% 100%
        );
        transition: background-color 0.8s;
      }

      .footer-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 60px;
        max-width: 1200px;
        margin: 0 auto;
      }

      .footer-brand h2 {
        font-family: "Space Grotesk", sans-serif;
        font-size: 2rem;
        margin-bottom: 20px;
      }

      .footer-links h4,
      h3 {
        margin-bottom: 25px;
        text-transform: uppercase;
        letter-spacing: 2px;
        color: var(--p-primary);
      }

      .contact-item {
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
        color: #94a3b8;
        transition: 0.3s;
      }
      .contact-item i {
        color: var(--p-primary);
      }
      .contact-item:hover {
        color: white;
        transform: translateX(5px);
      }

      .copyright {
        margin-top: 80px;
        text-align: center;
        padding-top: 30px;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        color: #475569;
        font-size: 0.9rem;
      }

      /* Responsive */
      @media (max-width: 768px) {
        header {
          padding: 0 20px;
        }
        .site-title {
          font-size: 1.4rem;
        }
        .grid-container {
          grid-template-columns: 1fr;
        }
        #sidebar {
          width: 100%;
          right: -100%;
        }
        .mascot-container {
          display: none; /* Hide mascot on mobile for performance */
        }
        .audio-control {
          bottom: 20px;
          left: 20px;
          padding: 8px 12px;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .floating {
        animation: floating 3s ease-in-out infinite;
      }
      @keyframes floating {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-15px);
        }
      }

      /* Custom Styles & Animation */
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .glass-panel {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.5);
      }
      .dark .glass-panel {
        background: rgba(15, 23, 42, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* Fire Animation */
      .fire-container {
        width: 60px;
        height: 60px;
        position: relative;
        transform-origin: center bottom;
        transition: all 0.5s ease;
      }
      .flame {
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        height: 100%;
        background: radial-gradient(
          ellipse at bottom,
          #ffee00 0%,
          #ff5722 60%,
          transparent 80%
        );
        border-radius: 50% 50% 20% 20%;
        filter: blur(5px);
        animation: flicker 0.3s infinite alternate;
        opacity: 0;
        transition: opacity 0.5s;
      }
      @keyframes flicker {
        0% {
          transform: translateX(-50%) scale(1);
        }
        100% {
          transform: translateX(-50%) scale(1.1) rotate(2deg);
        }
      }

      /* Glow Splint Experiment */
      .splint {
        cursor: grab;
        transition: transform 0.1s;
      }
      .splint:active {
        cursor: grabbing;
      }
      .splint-head {
        transition:
          background-color 0.3s,
          box-shadow 0.3s;
      }
      .splint-head.burning {
        background-color: #ffeb3b;
        box-shadow:
          0 0 15px #ff5722,
          0 0 30px #ff9800;
      }

      /* Cycle Animation */
      .cycle-arrow {
        stroke-dasharray: 10;
        animation: dash 2s linear infinite;
        opacity: 0.3;
      }
      .cycle-active .cycle-arrow {
        opacity: 1;
      }
      @keyframes dash {
        to {
          stroke-dashoffset: -20;
        }
      }

      /* Pollution City */
      .city-layer {
        transition: opacity 1s ease;
      }
      .smog-overlay {
        pointer-events: none;
        transition: background-color 1s ease;
      }

      /* Fire Triangle Styled Cleanly */
      .triangle-wrapper {
        position: relative;
        width: 200px;
        height: 180px;
        margin: 0 auto;
      }
      .triangle-side {
        position: absolute;
        background: #3b82f6;
        color: white;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        user-select: none;
        font-size: 0.85rem;
      }
      .triangle-side:hover {
        filter: brightness(1.1);
        transform: scale(1.05);
        z-index: 10;
      }
      .triangle-side.removed {
        opacity: 0.2;
        transform: scale(0.9);
        filter: grayscale(1);
      }

      /* Positioning sides to form a triangle */
      .side-base {
        bottom: 0;
        left: 10%;
        width: 80%;
        height: 30px;
        border-radius: 4px;
        background: #10b981; /* Fuel */
      }
      .side-left {
        top: 50%;
        left: -10px;
        width: 100px;
        height: 30px;
        transform: rotate(-60deg) translateY(-50%);
        transform-origin: right center;
        border-radius: 4px;
        background: #ef4444; /* Heat */
      }
      .side-right {
        top: 50%;
        right: -10px;
        width: 100px;
        height: 30px;
        transform: rotate(60deg) translateY(-50%);
        transform-origin: left center;
        border-radius: 4px;
        background: #3b82f6; /* Oxygen */
      }

      /* Footer Custom CSS */
      .edu-footer {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        color: #e2e8f0;
        padding: 3rem 1rem;
        position: relative;
        overflow: hidden;
        border-top: 4px solid #3b82f6;
      }
      .edu-footer-content {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        position: relative;
        z-index: 2;
      }
      .footer-brand h2 {
        font-size: 1.5rem;
        color: #60a5fa;
        margin-bottom: 0.5rem;
        font-weight: 800;
      }
      .footer-links ul {
        list-style: none;
        padding: 0;
      }
      .footer-links li {
        margin-bottom: 0.5rem;
      }
      .footer-links a {
        color: #94a3b8;
        text-decoration: none;
        transition: color 0.3s;
      }
      .footer-links a:hover {
        color: #3b82f6;
        padding-left: 5px;
      }
      .footer-bubble {
        position: absolute;
        background: rgba(59, 130, 246, 0.1);
        border-radius: 50%;
        animation: float-up 10s infinite linear;
      }
      @keyframes float-up {
        0% {
          transform: translateY(100px) scale(0);
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          transform: translateY(-300px) scale(1.5);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body
    class="bg-chemLight text-slate-800 dark:bg-chemDark dark:text-slate-100 transition-colors duration-300"
  >
    <!-- HEADER -->
    <header class="fixed w-full top-0 z-50 glass-panel shadow-sm">
      <div
        class="container mx-auto px-4 h-16 flex justify-between items-center"
      >
        <div class="flex items-center gap-3">
          <i class="fas fa-flask-vial text-2xl text-chemBlue animate-float"></i>
          <div>
            <h1 class="font-bold text-lg leading-tight">EDUCHEM</h1>
            <p class="text-xs text-gray-500 dark:text-gray-400">
              ChemStudy Junior
            </p>
          </div>
        </div>

        <!-- Desktop Menu -->
        <nav class="hidden md:flex gap-6 text-sm font-medium">
          <a href="#oxygen" class="hover:text-chemBlue transition">1. Oxygen</a>
          <a href="#air" class="hover:text-chemBlue transition">2. Không khí</a>
          <a href="#pollution" class="hover:text-chemBlue transition"
            >3. Ô nhiễm</a
          >
          <a href="#exercises" class="hover:text-chemBlue transition"
            >Bài tập</a
          >
        </nav>

        <div class="flex items-center gap-3">
          <button
            id="themeToggle"
            class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition"
          >
            <i class="fas fa-moon dark:hidden"></i>
            <i class="fas fa-sun hidden dark:inline text-yellow-400"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- HERO SECTION -->
    <section class="relative pt-32 pb-20 px-4 text-center overflow-hidden">
      <div
        class="absolute inset-0 bg-gradient-to-b from-blue-100 to-transparent dark:from-blue-900/20 dark:to-transparent -z-10"
      ></div>
      <div class="max-w-4xl mx-auto">
        <span
          class="inline-block py-1 px-3 rounded-full bg-blue-100 text-blue-600 text-xs font-bold tracking-wider mb-4 uppercase dark:bg-blue-900 dark:text-blue-300"
          >Chủ đề 1</span
        >
        <h1
          class="text-4xl md:text-6xl font-extrabold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-teal-500"
        >
          OXYGEN VÀ KHÔNG KHÍ
        </h1>
        <p
          class="text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-2xl mx-auto"
        >
          Khám phá tính chất, vai trò của Oxygen, thành phần không khí và ý thức
          bảo vệ môi trường thông qua mô phỏng tương tác.
        </p>
        <div class="flex justify-center gap-4">
          <a
            href="#oxygen"
            class="px-6 py-3 bg-chemBlue hover:bg-blue-600 text-white rounded-xl shadow-lg shadow-blue-500/30 transition transform hover:-translate-y-1"
          >
            <i class="fas fa-book-open mr-2"></i> Vào bài học
          </a>
        </div>
      </div>
    </section>

    <!-- MAIN CONTENT -->
    <main class="container mx-auto px-4 pb-20 space-y-24">
      <!-- ================= SECTION 1: OXYGEN ================= -->
      <section id="oxygen" class="scroll-mt-24">
        <div class="border-b dark:border-gray-700 pb-4 mb-6">
          <h2 class="text-3xl font-bold text-chemBlue">1. OXYGEN (KHÍ Ô-XY)</h2>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- THEORY COLUMN -->
          <div class="lg:col-span-1 space-y-6">
            <div
              class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border-l-4 border-blue-500"
            >
              <h3 class="font-bold text-xl mb-3">
                <i class="fas fa-book mr-2 text-blue-500"></i>Tóm tắt lý thuyết
              </h3>
              <ul class="space-y-3 text-sm leading-relaxed">
                <li>
                  <strong>Tính chất vật lí:</strong> Khí không màu, không mùi,
                  không vị, nặng hơn không khí, ít tan trong nước (31ml/1 lít
                  nước ở 20°C).
                </li>
                <li>
                  <strong>Tầm quan trọng:</strong>
                  <ul
                    class="list-disc ml-4 mt-1 text-gray-600 dark:text-gray-400"
                  >
                    <li>
                      <strong>Duy trì sự sống:</strong> Cần cho hô hấp. Não
                      thiếu O₂ 4-5 phút sẽ bị tổn thương.
                    </li>
                    <li>
                      <strong>Duy trì sự cháy:</strong> Cần để đốt cháy nhiên
                      liệu (củi, than, gas...) phục vụ đời sống.
                    </li>
                  </ul>
                </li>
              </ul>
            </div>

            <div
              class="bg-green-50 dark:bg-green-900/20 p-5 rounded-xl text-sm"
            >
              <h4 class="font-bold text-green-700 dark:text-green-400 mb-2">
                <i class="fas fa-leaf mr-2"></i>Ví dụ thực tế
              </h4>
              <ul class="space-y-2">
                <li>
                  <i class="fas fa-hospital-alt mr-2 text-red-400"></i
                  ><strong>Y tế:</strong> Bệnh nhân khó thở dùng bình nén O₂.
                </li>
                <li>
                  <i class="fas fa-shrimp mr-2 text-orange-400"></i
                  ><strong>Nuôi tôm:</strong> Dùng quạt nước để hòa tan thêm O₂
                  vào nước.
                </li>
              </ul>
            </div>
          </div>

          <!-- SIMULATION COLUMN -->
          <div class="lg:col-span-2 space-y-6">
            <!-- SIM A: COMBUSTION -->
            <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg">
              <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg">
                  <i class="fas fa-vial mr-2 text-chemBlue"></i>Mô phỏng: Oxygen
                  duy trì sự cháy
                </h3>
                <span
                  class="text-xs bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded"
                  >Di chuyển thanh trượt</span
                >
              </div>

              <div
                class="flex flex-col items-center justify-center h-48 bg-gray-100 dark:bg-slate-900 rounded-xl mb-4 relative overflow-hidden"
              >
                <!-- Candle -->
                <div
                  class="w-4 h-16 bg-amber-100 rounded-sm relative mt-10 shadow-sm"
                >
                  <div
                    class="w-full h-full bg-gradient-to-b from-amber-50 to-amber-200"
                  ></div>
                  <!-- Fire Container -->
                  <div
                    class="fire-container absolute -top-10 left-1/2 transform -translate-x-1/2"
                  >
                    <div id="sim-fire" class="flame"></div>
                  </div>
                </div>
                <div
                  id="sim-status"
                  class="mt-4 text-sm font-bold text-gray-500 z-10"
                >
                  Lửa tắt
                </div>
              </div>

              <div class="space-y-2 px-4">
                <div
                  class="flex justify-between text-xs font-bold text-gray-500"
                >
                  <span>0%</span>
                  <span>Nồng độ O₂</span>
                  <span>100%</span>
                </div>
                <input
                  type="range"
                  id="oxygen-slider"
                  min="0"
                  max="100"
                  value="0"
                  class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-chemBlue"
                />
              </div>
            </div>

            <!-- SIM B: FIRE TRIANGLE (IMPROVED) -->
            <div
              class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg relative"
            >
              <h3 class="font-bold text-lg mb-2">
                <i class="fas fa-fire-extinguisher mr-2 text-red-500"></i>Mô
                hình: Tam Giác Lửa
              </h3>
              <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">
                Để sự cháy diễn ra cần đủ 3 yếu tố. Click vào từng cạnh để loại
                bỏ (dập tắt lửa).
              </p>

              <div class="bg-gray-50 dark:bg-gray-900 rounded-xl py-8 relative">
                <!-- Central Fire Display -->
                <div
                  class="absolute inset-0 flex items-center justify-center pointer-events-none"
                >
                  <div
                    id="triangle-fire"
                    class="flame"
                    style="
                      width: 40px;
                      height: 60px;
                      opacity: 1;
                      transform: translateX(-50%) scale(1.2);
                    "
                  ></div>
                </div>
                <div
                  id="triangle-msg"
                  class="absolute bottom-2 w-full text-center text-xs font-bold text-red-500 hidden"
                >
                  Đã mất 1 yếu tố → Lửa tắt!
                </div>

                <!-- Interactive Triangle -->
                <div class="triangle-wrapper">
                  <div
                    class="triangle-side side-left"
                    onclick="toggleFireSide(this, 'heat')"
                    title="Click để loại bỏ Nhiệt độ"
                  >
                    <i class="fas fa-thermometer-half mr-1"></i> Nhiệt độ
                  </div>
                  <div
                    class="triangle-side side-right"
                    onclick="toggleFireSide(this, 'oxygen')"
                    title="Click để loại bỏ Oxygen"
                  >
                    <i class="fas fa-wind mr-1"></i> Oxygen
                  </div>
                  <div
                    class="triangle-side side-base"
                    onclick="toggleFireSide(this, 'fuel')"
                    title="Click để loại bỏ Chất cháy"
                  >
                    <i class="fas fa-gas-pump mr-1"></i> Chất cháy
                  </div>
                </div>

                <button
                  onclick="resetTriangle()"
                  class="absolute top-2 right-2 text-xs bg-white dark:bg-slate-700 border border-gray-300 dark:border-gray-600 px-3 py-1 rounded hover:bg-gray-100 dark:hover:bg-slate-600 transition"
                >
                  <i class="fas fa-redo mr-1"></i> Làm lại
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- VIRTUAL LAB: IDENTIFY O2 -->
        <div
          class="mt-8 bg-blue-50 dark:bg-slate-800/50 p-6 rounded-2xl border border-blue-100 dark:border-blue-900"
        >
          <h3 class="font-bold text-lg mb-4 text-center text-chemBlue">
            Thí nghiệm ảo: Nhận biết khí Oxygen
          </h3>
          <div
            class="flex flex-col md:flex-row items-center justify-center gap-12 select-none"
            id="lab-zone"
          >
            <div class="text-center w-48">
              <div
                class="relative w-32 h-48 mx-auto border-4 border-gray-300 bg-white/50 rounded-lg flex items-center justify-center mb-2"
                id="gas-jar"
              >
                <span class="text-blue-300 font-bold text-4xl opacity-50"
                  >O₂</span
                >
              </div>
              <p class="text-sm font-bold">Bình khí Oxygen</p>
            </div>

            <div class="text-center text-sm text-gray-500">
              <i class="fas fa-arrow-right text-2xl hidden md:block"></i>
              <i class="fas fa-arrow-down text-2xl md:hidden"></i>
            </div>

            <div
              class="relative w-64 h-40 flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg bg-white dark:bg-slate-900"
            >
              <div
                id="splint"
                class="splint absolute flex items-center"
                draggable="true"
                style="touch-action: none"
              >
                <div class="w-32 h-3 bg-amber-800 rounded-l shadow-sm"></div>
                <!-- Stick -->
                <div
                  id="splint-head"
                  class="splint-head w-4 h-4 bg-red-600 rounded-full animate-pulse shadow-[0_0_8px_#f00]"
                ></div>
                <!-- Ember -->
              </div>
              <div
                class="absolute bottom-2 text-xs text-gray-400 pointer-events-none"
              >
                Kéo que đóm tàn đỏ vào bình
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ================= SECTION 2: AIR ================= -->
      <section id="air" class="scroll-mt-24 pt-8 border-t dark:border-gray-800">
        <div class="border-b dark:border-gray-700 pb-4 mb-6">
          <h2 class="text-3xl font-bold text-chemBlue">
            2. KHÔNG KHÍ VÀ THÀNH PHẦN
          </h2>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- THEORY -->
          <div class="lg:col-span-1 space-y-6">
            <div
              class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border-l-4 border-indigo-500"
            >
              <h3 class="font-bold text-xl mb-3">
                <i class="fas fa-cloud mr-2 text-indigo-500"></i>Tóm tắt lý
                thuyết
              </h3>
              <p class="mb-2 text-sm">
                <strong>Thành phần (theo thể tích):</strong>
              </p>
              <ul class="list-none space-y-2 text-sm ml-2 mb-4">
                <li>
                  <span
                    class="inline-block w-3 h-3 bg-blue-500 rounded-full mr-2"
                  ></span
                  ><strong>78%</strong> Nitrogen
                </li>
                <li>
                  <span
                    class="inline-block w-3 h-3 bg-red-500 rounded-full mr-2"
                  ></span
                  ><strong>21%</strong> Oxygen
                </li>
                <li>
                  <span
                    class="inline-block w-3 h-3 bg-yellow-400 rounded-full mr-2"
                  ></span
                  ><strong>1%</strong> Carbon dioxide, hơi nước, khí hiếm...
                </li>
              </ul>
              <p class="mb-2 text-sm"><strong>Vai trò:</strong></p>
              <ul
                class="text-sm space-y-1 pl-4 list-disc text-gray-600 dark:text-gray-400"
              >
                <li><strong>O₂:</strong> Duy trì hô hấp, sự cháy.</li>
                <li><strong>CO₂:</strong> Cần cho quang hợp.</li>
                <li><strong>N₂:</strong> Cung cấp dưỡng chất cho sinh vật.</li>
                <li>
                  <strong>Hơi nước:</strong> Ổn định nhiệt độ, tạo mây mưa.
                </li>
              </ul>
            </div>

            <div
              class="bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-xl text-sm"
            >
              <h4 class="font-bold text-indigo-700 dark:text-indigo-400 mb-2">
                Ví dụ thực tế
              </h4>
              <p class="mb-1">
                <strong>Sương mù:</strong> Hơi nước gặp lạnh ngưng tụ.
              </p>
              <p>
                <strong>Công nghiệp:</strong> Không khí là nguyên liệu sản xuất
                Nitrogen.
              </p>
            </div>
          </div>

          <!-- SIMULATIONS -->
          <div class="lg:col-span-2 space-y-6">
            <!-- SIM D: CHART (Updated Data) -->
            <div
              class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg flex flex-col items-center"
            >
              <h3 class="font-bold text-lg mb-4 w-full">
                <i class="fas fa-chart-pie mr-2 text-chemBlue"></i>Biểu đồ thành
                phần không khí
              </h3>

              <div class="relative h-64 w-64 mb-6">
                <svg
                  viewBox="0 0 100 100"
                  class="transform -rotate-90 w-full h-full"
                >
                  <!-- Chu vi hình tròn r=40 là ~251.3 -->
                  <!-- Nitrogen 78% (0.78 * 251.3 = 196) -->
                  <circle
                    cx="50"
                    cy="50"
                    r="40"
                    stroke="#3b82f6"
                    stroke-width="20"
                    fill="none"
                    stroke-dasharray="196 251.3"
                    class="transition-all duration-1000 chart-part"
                    id="chart-n2"
                  ></circle>
                  <!-- Oxygen 21% (0.21 * 251.3 = 52.8) -->
                  <circle
                    cx="50"
                    cy="50"
                    r="40"
                    stroke="#ef4444"
                    stroke-width="20"
                    fill="none"
                    stroke-dasharray="52.8 251.3"
                    stroke-dashoffset="-196"
                    class="transition-all duration-1000 chart-part"
                    id="chart-o2"
                  ></circle>
                  <!-- Others 1% (0.01 * 251.3 = 2.5) -->
                  <circle
                    cx="50"
                    cy="50"
                    r="40"
                    stroke="#fbbf24"
                    stroke-width="20"
                    fill="none"
                    stroke-dasharray="2.5 251.3"
                    stroke-dashoffset="-248.8"
                    class="transition-all duration-1000 chart-part"
                    id="chart-other"
                  ></circle>
                </svg>
                <div
                  class="absolute inset-0 flex items-center justify-center pointer-events-none"
                >
                  <span
                    class="font-bold text-lg text-slate-700 dark:text-slate-200"
                    >Không Khí</span
                  >
                </div>
              </div>

              <div class="flex flex-wrap justify-center gap-4 text-sm w-full">
                <div
                  class="flex items-center gap-2 px-3 py-1 bg-gray-50 dark:bg-slate-700 rounded-lg cursor-pointer hover:bg-blue-50"
                  onmouseover="highlightChart('n2')"
                  onmouseout="resetChart()"
                >
                  <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                  Nitrogen (78%)
                </div>
                <div
                  class="flex items-center gap-2 px-3 py-1 bg-gray-50 dark:bg-slate-700 rounded-lg cursor-pointer hover:bg-red-50"
                  onmouseover="highlightChart('o2')"
                  onmouseout="resetChart()"
                >
                  <span class="w-3 h-3 bg-red-500 rounded-full"></span> Oxygen
                  (21%)
                </div>
                <div
                  class="flex items-center gap-2 px-3 py-1 bg-gray-50 dark:bg-slate-700 rounded-lg cursor-pointer hover:bg-yellow-50"
                  onmouseover="highlightChart('other')"
                  onmouseout="resetChart()"
                >
                  <span class="w-3 h-3 bg-yellow-400 rounded-full"></span> 1%
                  (CO₂, Hơi nước...)
                </div>
              </div>

              <button
                onclick="explodeChart()"
                class="mt-4 px-4 py-2 text-sm bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 rounded transition"
              >
                <i class="fas fa-expand mr-1"></i> Tách biểu đồ
              </button>
            </div>

            <!-- SIM E: CYCLE -->
            <div
              class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg border-t-4 border-green-500"
            >
              <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg">
                  <i class="fas fa-recycle mr-2 text-green-600"></i>Chu trình
                  Oxygen - CO₂
                </h3>
                <button
                  onclick="toggleCycle()"
                  class="w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center hover:bg-green-200 transition"
                >
                  <i class="fas fa-play" id="cycle-icon"></i>
                </button>
              </div>

              <div
                class="relative h-48 bg-gradient-to-r from-green-50 to-orange-50 dark:from-green-900/20 dark:to-orange-900/20 rounded-xl flex justify-between items-center px-8 md:px-16"
                id="cycle-container"
              >
                <!-- Elements -->
                <div class="text-center relative z-10">
                  <i class="fas fa-tree text-5xl text-green-600 mb-2"></i>
                  <div
                    class="font-bold text-xs bg-white dark:bg-slate-900 px-2 py-1 rounded shadow"
                  >
                    Thực vật
                  </div>
                  <div
                    class="absolute -top-6 w-full text-center text-xs font-bold text-green-600 cycle-label opacity-0 transition-opacity"
                  >
                    Quang hợp
                  </div>
                </div>

                <!-- O2 Flow (Top) -->
                <div
                  class="absolute top-1/3 left-24 right-24 h-0.5 bg-gray-300 dark:bg-gray-600"
                >
                  <div
                    class="cycle-arrow w-full h-1 bg-blue-500 absolute top-0"
                  ></div>
                  <div
                    class="absolute -top-4 w-full text-center text-xs font-bold text-blue-500"
                  >
                    Oxygen (O₂)
                  </div>
                  <i
                    class="fas fa-chevron-right absolute -right-1 -top-1.5 text-blue-500"
                  ></i>
                </div>

                <!-- CO2 Flow (Bottom) -->
                <div
                  class="absolute bottom-1/3 left-24 right-24 h-0.5 bg-gray-300 dark:bg-gray-600"
                >
                  <div
                    class="cycle-arrow w-full h-1 bg-gray-500 absolute top-0 transform rotate-180 origin-center"
                  ></div>
                  <div
                    class="absolute -bottom-5 w-full text-center text-xs font-bold text-gray-500"
                  >
                    CO₂
                  </div>
                  <i
                    class="fas fa-chevron-left absolute -left-1 -top-1.5 text-gray-500"
                  ></i>
                </div>

                <div class="text-center relative z-10">
                  <i class="fas fa-child text-5xl text-orange-500 mb-2"></i>
                  <div
                    class="font-bold text-xs bg-white dark:bg-slate-900 px-2 py-1 rounded shadow"
                  >
                    Con người
                  </div>
                  <div
                    class="absolute -bottom-8 w-full text-center text-xs font-bold text-orange-500 cycle-label opacity-0 transition-opacity"
                  >
                    Hô hấp
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ================= SECTION 3: POLLUTION ================= -->
      <section
        id="pollution"
        class="scroll-mt-24 pt-8 border-t dark:border-gray-800"
      >
        <div class="border-b dark:border-gray-700 pb-4 mb-6">
          <h2 class="text-3xl font-bold text-chemBlue">
            3. Ô NHIỄM VÀ BẢO VỆ MÔI TRƯỜNG
          </h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
          <div
            class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border-l-4 border-red-500"
          >
            <h3 class="font-bold text-lg mb-2">
              <i class="fas fa-smog mr-2 text-gray-500"></i>Ô nhiễm không khí
            </h3>
            <p class="text-sm text-gray-600 dark:text-gray-300">
              Sự thay đổi thành phần không khí do khói, bụi, khí lạ gây mùi,
              giảm tầm nhìn, hại sức khỏe.
            </p>
          </div>
          <div
            class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border-l-4 border-yellow-500"
          >
            <h3 class="font-bold text-lg mb-2">
              <i class="fas fa-exclamation-triangle mr-2 text-yellow-500"></i
              >Nguyên nhân & Hậu quả
            </h3>
            <ul class="text-sm text-gray-600 dark:text-gray-300 list-disc ml-4">
              <li>
                <strong>Nguồn:</strong> Núi lửa, cháy rừng, khí thải xe cộ, nhà
                máy.
              </li>
              <li><strong>Hậu quả:</strong> Mưa acid, Hiệu ứng nhà kính.</li>
            </ul>
          </div>
          <div
            class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border-l-4 border-green-500"
          >
            <h3 class="font-bold text-lg mb-2">
              <i class="fas fa-shield-alt mr-2 text-green-500"></i>Biện pháp bảo
              vệ
            </h3>
            <p class="text-sm text-gray-600 dark:text-gray-300">
              Trồng cây xanh, dùng năng lượng sạch (gió, mặt trời), kiểm soát
              khí thải, nâng cao ý thức.
            </p>
          </div>
        </div>

        <!-- SIM F: CITY INTERACTION (Fixed Dark Mode Text) -->
        <div
          class="max-w-4xl mx-auto bg-white dark:bg-slate-800 rounded-3xl shadow-xl overflow-hidden border border-gray-100 dark:border-gray-700"
        >
          <!-- Status Bar -->
          <div
            class="p-4 bg-gray-50 dark:bg-slate-900 flex justify-between items-center border-b dark:border-slate-700"
          >
            <div class="font-bold text-gray-800 dark:text-gray-200">
              <i class="fas fa-city mr-2"></i>Mô phỏng Thành phố
            </div>
            <div class="flex items-center gap-3">
              <span class="text-sm text-gray-500 dark:text-gray-400"
                >Chỉ số ô nhiễm (AQI):</span
              >
              <div
                class="w-32 h-4 bg-gray-300 dark:bg-gray-600 rounded-full overflow-hidden"
              >
                <div
                  id="aqi-bar"
                  class="h-full bg-green-500 w-10 transition-all duration-500"
                ></div>
              </div>
              <span
                id="aqi-text"
                class="font-bold text-green-600 dark:text-green-400 text-sm"
                >Tốt</span
              >
            </div>
          </div>

          <!-- Scene -->
          <div
            class="relative h-80 bg-gradient-to-b from-blue-300 to-gray-200 overflow-hidden"
            id="city-scene"
          >
            <div
              class="absolute top-4 left-4 w-12 h-12 bg-yellow-400 rounded-full shadow-[0_0_20px_#fbbf24]"
            ></div>
            <i
              class="fas fa-cloud absolute top-10 right-20 text-5xl text-white/80 animate-float"
            ></i>

            <!-- Buildings -->
            <div
              class="absolute bottom-0 w-full flex items-end justify-center text-gray-700 dark:text-slate-800"
            >
              <i
                class="fas fa-building text-9xl mx-1 transform translate-y-2 text-gray-600 dark:text-slate-600"
              ></i>
              <i
                class="fas fa-hospital text-7xl mx-1 transform translate-y-2 text-gray-500 dark:text-slate-500"
              ></i>
              <i
                class="fas fa-industry text-8xl mx-1 transform translate-y-2 relative group text-slate-700 dark:text-slate-700"
              >
                <div
                  id="factory-smoke"
                  class="absolute -top-10 left-4 opacity-0 transition duration-1000"
                >
                  <i
                    class="fas fa-smog text-4xl text-gray-600 animate-pulse"
                  ></i>
                </div>
              </i>
              <i
                class="fas fa-building text-8xl mx-1 transform translate-y-2 text-gray-600 dark:text-slate-600"
              ></i>
            </div>

            <!-- Cars -->
            <div
              class="absolute bottom-2 w-full h-8 flex justify-between px-10"
            >
              <div
                id="car-traffic"
                class="flex gap-20 opacity-0 transition duration-500"
              >
                <i
                  class="fas fa-car-side text-2xl text-red-500 animate-[float_4s_linear_infinite] translate-x-full"
                ></i>
                <i
                  class="fas fa-truck text-2xl text-blue-500 animate-[float_5s_linear_infinite_reverse]"
                ></i>
              </div>
            </div>

            <!-- Trees -->
            <div
              id="forest"
              class="absolute bottom-0 left-0 w-full flex justify-between px-4 pointer-events-none opacity-0 transition duration-1000"
            >
              <i
                class="fas fa-tree text-4xl text-green-600 transform -translate-y-1"
              ></i>
              <i
                class="fas fa-tree text-5xl text-green-500 transform -translate-y-1 ml-20"
              ></i>
              <i
                class="fas fa-tree text-3xl text-green-700 transform -translate-y-1 mr-20"
              ></i>
            </div>

            <!-- Smog Overlay -->
            <div
              id="smog-overlay"
              class="absolute inset-0 bg-gray-900 opacity-0 smog-overlay z-20 mix-blend-multiply"
            ></div>
          </div>

          <!-- Controls -->
          <div
            class="p-6 grid grid-cols-3 gap-4 text-center bg-white dark:bg-slate-800"
          >
            <button
              onclick="toggleCityFactor('cars')"
              id="btn-cars"
              class="p-3 bg-gray-100 dark:bg-slate-700 rounded-xl hover:bg-gray-200 dark:hover:bg-slate-600 transition"
            >
              <i class="fas fa-car text-xl mb-1 text-red-500"></i><br />
              <span class="text-xs font-bold dark:text-gray-300">Xe cộ</span>
            </button>
            <button
              onclick="toggleCityFactor('factory')"
              id="btn-factory"
              class="p-3 bg-gray-100 dark:bg-slate-700 rounded-xl hover:bg-gray-200 dark:hover:bg-slate-600 transition"
            >
              <i
                class="fas fa-industry text-xl mb-1 text-gray-600 dark:text-gray-400"
              ></i
              ><br />
              <span class="text-xs font-bold dark:text-gray-300">Nhà máy</span>
            </button>
            <button
              onclick="toggleCityFactor('trees')"
              id="btn-trees"
              class="p-3 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-xl hover:bg-green-100 dark:hover:bg-green-900/50 transition"
            >
              <i
                class="fas fa-seedling text-xl mb-1 text-green-600 dark:text-green-400"
              ></i
              ><br />
              <span class="text-xs font-bold dark:text-gray-300"
                >Trồng cây</span
              >
            </button>
          </div>
        </div>
      </section>

      <!-- ================= EXERCISES ================= -->
      <section
        id="exercises"
        class="max-w-4xl mx-auto pt-8 border-t dark:border-gray-800"
      >
        <h2 class="text-3xl font-bold mb-6 text-center text-chemBlue">
          Bài Tập Củng Cố
        </h2>

        <div
          class="mb-6 flex items-center gap-4 bg-gray-100 dark:bg-slate-800 p-4 rounded-xl"
        >
          <div class="flex-1">
            <div class="flex justify-between text-sm font-bold mb-1">
              <span>Tiến độ hoàn thành</span>
              <span id="progress-text">0%</span>
            </div>
            <div class="w-full bg-gray-300 dark:bg-gray-600 rounded-full h-3">
              <div
                id="progress-bar"
                class="bg-gradient-to-r from-blue-500 to-teal-400 h-3 rounded-full transition-all duration-500"
                style="width: 0%"
              ></div>
            </div>
          </div>
          <button
            onclick="resetQuiz()"
            class="text-sm px-3 py-1 bg-white dark:bg-slate-700 border rounded shadow hover:bg-gray-50 dark:hover:bg-slate-600"
          >
            <i class="fas fa-sync-alt mr-1"></i> Làm lại
          </button>
        </div>

        <div class="space-y-4" id="quiz-container">
          <!-- Quiz Item Template (JS will populate) -->
        </div>
      </section>
      <button
        onclick="window.location.href = 'bai_tap.html'"
        style="
          display: inline-flex;
          align-items: center;
          gap: 10px;
          padding: 14px 30px;
          font-size: 1rem;
          font-weight: 600;
          border-radius: 999px;
          border: none;
          cursor: pointer;
          color: #fff;
          background: linear-gradient(135deg, #3b82f6, #6366f1);
          box-shadow: 0 10px 30px rgba(59, 130, 246, 0.35);
          transition: 0.3s ease;
        "
        onmouseover="
          this.style.transform = 'translateY(-3px) scale(1.03)';
          this.style.boxShadow = '0 18px 45px rgba(99,102,241,.55)';
        "
        onmouseout="
          this.style.transform = 'translateY(0) scale(1)';
          this.style.boxShadow = '0 10px 30px rgba(59,130,246,.35)';
        "
      >
        <i class="fas fa-pen-to-square"></i>
        Bài tập củng cố
      </button>

      <button
        onclick="window.location.href = '../chemstudybaby.html'"
        style="
          display: inline-flex;
          align-items: center;
          gap: 10px;
          padding: 14px 30px;
          font-size: 1rem;
          font-weight: 600;
          border-radius: 999px;
          border: none;
          cursor: pointer;
          color: #fff;
          background: linear-gradient(135deg, #22c55e, #16a34a);
          box-shadow: 0 10px 30px rgba(34, 197, 94, 0.35);
          transition: 0.3s ease;
        "
        onmouseover="
          this.style.transform = 'translateY(-3px)';
          this.style.boxShadow = '0 18px 45px rgba(22,163,74,.55)';
        "
        onmouseout="
          this.style.transform = 'translateY(0)';
          this.style.boxShadow = '0 10px 30px rgba(34,197,94,.35)';
        "
      >
        <i class="fas fa-arrow-left"></i>
        Quay về CS Junior
      </button>
    </main>

    <!-- Footer -->
    <footer>
      <div class="footer-grid">
        <div class="footer-brand" data-aos="fade-right">
          <h2>EDUMATTER</h2>
          <p style="color: #94a3b8; line-height: 1.8">
            Kiến tạo môi trường học tập cảm xúc, nơi tri thức được số hóa và
            truyền tải đầy cảm hứng.
          </p>
          <div style="display: flex; gap: 15px; margin-top: 30px">
            <a href="https://www.facebook.com/ducnt214" class="icon-btn"
              ><i class="fab fa-facebook" alt="facebook"></i
            ></a>
            <a href="https://github.com/ducnt2104" class="icon-btn" alt="github"
              ><i class="fab fa-github"></i
            ></a>
            <a
              href="https://www.tiktok.com/@ktbtcthm210"
              class="icon-btn"
              alt="tiktok"
              ><i class="fab fa-tiktok"></i
            ></a>
          </div>
        </div>
        <div class="footer-links" data-aos="fade-up">
          <h3>Liên hệ nhanh</h3>
          <div class="contact-item">
            <i class="fas fa-envelope"></i>
            <span>ducnt21042010@gmail.com</span>
          </div>
          <div class="contact-item">
            <i class="fas fa-phone"></i>
            <span>034 226 6204</span>
          </div>
          <div class="contact-item">
            <i class="fas fa-location-dot"></i>
            <span>THPT Tôn Đức Thắng, Đồng Nai</span>
          </div>
        </div>
        <div class="footer-links" data-aos="fade-left">
          <h4>Đội ngũ DNT</h4>
          <p style="color: #94a3b8">
            "Sáng tạo không ngừng - Vươn tầm tri thức"
          </p>
          <div
            style="
              margin-top: 20px;
              padding: 15px;
              background: rgba(255, 255, 255, 0.05);
              border-radius: 15px;
            "
          >
            <p style="font-size: 0.8rem; color: #fff">
              Dự án được phát triển bởi các thành viên đam mê công nghệ tại Việt
              Nam.
            </p>
          </div>
        </div>
      </div>
      <div class="copyright">
        <p>
          © 2024 EDUMATTER Educational Ecosystem. Designed with
          <i class="fas fa-heart" style="color: #ef4444"></i> by DNT Team.
        </p>
      </div>
    </footer>

    <!-- SCRIPT LOGIC -->
    <script>
      // --- DATA ---
      // Updated Quiz Data based on your text
      const quizData = [
        // Oxygen
        {
          id: 1,
          section: "Oxygen",
          q: "Nêu các tính chất vật lí cơ bản của khí oxygen?",
          options: [
            "Không màu, không mùi, nặng hơn không khí, ít tan trong nước",
            "Màu xanh nhạt, mùi hắc, nhẹ hơn không khí",
            "Không màu, tan nhiều trong nước",
          ],
          ans: 0,
          hint: "Hãy nhớ lại thí nghiệm thu khí oxygen bằng cách đẩy nước.",
        },
        {
          id: 2,
          section: "Oxygen",
          q: "Vì sao thợ lặn hoặc lính cứu hỏa phải đeo bình nén khí oxygen?",
          options: [
            "Để tránh hít phải khí độc",
            "Để cung cấp đủ oxygen cho hô hấp trong môi trường thiếu khí",
            "Để làm mát cơ thể",
          ],
          ans: 1,
          hint: "Con người cần oxygen để duy trì sự sống.",
        },
        {
          id: 3,
          section: "Oxygen",
          q: "Giải thích: Quạt vào bếp củi đang cháy thì lửa bùng to hơn?",
          options: [
            "Quạt làm tăng lượng khí CO₂",
            "Quạt cung cấp thêm lượng khí Oxygen cho sự cháy",
            "Quạt làm giảm nhiệt độ ngọn lửa",
          ],
          ans: 1,
          hint: "Oxygen là yếu tố duy trì sự cháy.",
        },
        // Air
        {
          id: 4,
          section: "Không khí",
          q: "Chất khí nào chiếm tỉ lệ lớn nhất trong không khí (78%)?",
          options: ["Oxygen", "Nitrogen", "Carbon dioxide"],
          ans: 1,
          hint: "Khí này cung cấp dưỡng chất cho sinh vật nhưng không duy trì sự cháy.",
        },
        {
          id: 5,
          section: "Không khí",
          q: "Hiện tượng nào chứng tỏ trong không khí có hơi nước?",
          options: [
            "Sương mù vào sáng sớm",
            "Khói bụi từ nhà máy",
            "Mây đen khi trời mưa",
          ],
          ans: 0,
          hint: "Hơi nước ngưng tụ khi gặp lạnh.",
        },
        // Pollution
        {
          id: 6,
          section: "Ô nhiễm",
          q: "Đâu là biện pháp hữu hiệu để làm sạch không khí?",
          options: [
            "Đốt rác thải bừa bãi",
            "Trồng nhiều cây xanh",
            "Tăng cường dùng xe máy cá nhân",
          ],
          ans: 1,
          hint: "Cây xanh hấp thụ CO₂ và nhả ra O₂.",
        },
        {
          id: 7,
          section: "Ô nhiễm",
          q: "Mưa acid chủ yếu do khí thải nào gây ra?",
          options: ["Oxygen", "Sulfur dioxide (SO₂)", "Hơi nước"],
          ans: 1,
          hint: "Khí thải từ các nhà máy công nghiệp.",
        },
      ];

      let cityState = { cars: false, factory: false, trees: false };

      // --- DOM ELEMENTS ---
      const fireEl = document.getElementById("sim-fire");
      const fireStatus = document.getElementById("sim-status");
      const slider = document.getElementById("oxygen-slider");
      const aqiBar = document.getElementById("aqi-bar");
      const aqiText = document.getElementById("aqi-text");

      // --- INIT ---
      document.addEventListener("DOMContentLoaded", () => {
        initCombustionSim();
        initDragDrop();
        renderQuiz();
        checkTheme();
      });

      // --- THEME ---
      const themeBtn = document.getElementById("themeToggle");
      themeBtn.addEventListener("click", () => {
        document.documentElement.classList.toggle("dark");
        localStorage.setItem(
          "theme",
          document.documentElement.classList.contains("dark")
            ? "dark"
            : "light",
        );
      });
      function checkTheme() {
        if (
          localStorage.getItem("theme") === "dark" ||
          (!("theme" in localStorage) &&
            window.matchMedia("(prefers-color-scheme: dark)").matches)
        ) {
          document.documentElement.classList.add("dark");
        }
      }

      // --- SIM A: COMBUSTION ---
      function initCombustionSim() {
        slider.addEventListener("input", (e) => {
          const val = parseInt(e.target.value);
          // Fire logic
          if (val < 10) {
            fireEl.style.opacity = 0;
            fireEl.style.transform = `translateX(-50%) scale(0)`;
            fireStatus.innerText = "Lửa tắt (Thiếu Oxygen)";
            fireStatus.className = "mt-4 text-sm font-bold text-gray-500 z-10";
          } else if (val < 21) {
            fireEl.style.opacity = val / 21;
            fireEl.style.transform = `translateX(-50%) scale(${val / 30})`;
            fireStatus.innerText = "Cháy yếu";
            fireStatus.className =
              "mt-4 text-sm font-bold text-yellow-600 z-10";
          } else if (val === 21) {
            fireEl.style.opacity = 1;
            fireEl.style.transform = `translateX(-50%) scale(1)`;
            fireStatus.innerText = "Cháy bình thường (Trong không khí)";
            fireStatus.className =
              "mt-4 text-sm font-bold text-orange-500 z-10";
          } else {
            fireEl.style.opacity = 1;
            fireEl.style.transform = `translateX(-50%) scale(${1 + (val - 21) / 100})`;
            fireStatus.innerText = "Cháy mãnh liệt!";
            fireStatus.className =
              "mt-4 text-sm font-bold text-red-600 animate-pulse z-10";
          }
        });
      }

      // --- SIM B: FIRE TRIANGLE (CLEANER LOGIC) ---
      let triangleState = { heat: true, fuel: true, oxygen: true };

      function toggleFireSide(el, type) {
        if (el.classList.contains("removed")) return;

        // Remove the side
        el.classList.add("removed");
        triangleState[type] = false;

        // Check if fire should die (if any side is missing)
        if (
          !triangleState.heat ||
          !triangleState.fuel ||
          !triangleState.oxygen
        ) {
          const fire = document.getElementById("triangle-fire");
          const msg = document.getElementById("triangle-msg");

          fire.style.opacity = 0;
          fire.style.transform = "translateX(-50%) scale(0)";
          msg.classList.remove("hidden");
        }
      }

      function resetTriangle() {
        triangleState = { heat: true, fuel: true, oxygen: true };
        document
          .querySelectorAll(".triangle-side")
          .forEach((el) => el.classList.remove("removed"));
        const fire = document.getElementById("triangle-fire");
        fire.style.opacity = 1;
        fire.style.transform = "translateX(-50%) scale(1.2)";
        document.getElementById("triangle-msg").classList.add("hidden");
      }

      // --- SIM C: DRAG & DROP LAB ---
      function initDragDrop() {
        const splint = document.getElementById("splint");
        const jar = document.getElementById("gas-jar");
        const head = document.getElementById("splint-head");

        let isDragging = false;
        let startX, startY, initialLeft, initialTop;

        const startDrag = (e) => {
          isDragging = true;
          const clientX = e.touches ? e.touches[0].clientX : e.clientX;
          const clientY = e.touches ? e.touches[0].clientY : e.clientY;

          startX = clientX;
          startY = clientY;
          initialLeft = splint.offsetLeft;
          initialTop = splint.offsetTop;
          splint.style.cursor = "grabbing";
        };

        const doDrag = (e) => {
          if (!isDragging) return;
          e.preventDefault();
          const clientX = e.touches ? e.touches[0].clientX : e.clientX;
          const clientY = e.touches ? e.touches[0].clientY : e.clientY;
          const dx = clientX - startX;
          const dy = clientY - startY;
          splint.style.left = `${initialLeft + dx}px`;
          splint.style.top = `${initialTop + dy}px`;

          const splintRect = head.getBoundingClientRect();
          const jarRect = jar.getBoundingClientRect();

          if (
            splintRect.left > jarRect.left &&
            splintRect.right < jarRect.right &&
            splintRect.top > jarRect.top &&
            splintRect.bottom < jarRect.bottom
          ) {
            head.classList.add("burning");
            head.style.transform = "scale(1.5)";
          } else {
            head.classList.remove("burning");
            head.style.transform = "scale(1)";
          }
        };

        const stopDrag = () => {
          isDragging = false;
          splint.style.cursor = "grab";
          if (!head.classList.contains("burning")) {
            splint.style.transition = "all 0.5s";
            splint.style.left = "auto";
            splint.style.top = "auto";
            setTimeout(() => (splint.style.transition = "transform 0.1s"), 500);
          }
        };

        splint.addEventListener("mousedown", startDrag);
        splint.addEventListener("touchstart", startDrag);
        document.addEventListener("mousemove", doDrag);
        document.addEventListener("touchmove", doDrag, { passive: false });
        document.addEventListener("mouseup", stopDrag);
        document.addEventListener("touchend", stopDrag);
      }

      // --- SIM D: CHART ---
      let chartExploded = false;
      function explodeChart() {
        chartExploded = !chartExploded;
        const n2 = document.getElementById("chart-n2");
        const o2 = document.getElementById("chart-o2");
        const other = document.getElementById("chart-other");

        if (chartExploded) {
          n2.style.transform = "translate(-5px, -5px)";
          o2.style.transform = "translate(5px, 5px)";
          other.style.transform = "translate(10px, -5px)";
        } else {
          n2.style.transform = "none";
          o2.style.transform = "none";
          other.style.transform = "none";
        }
      }
      function highlightChart(id) {
        document
          .querySelectorAll(".chart-part")
          .forEach((el) => (el.style.opacity = 0.3));
        document.getElementById(`chart-${id}`).style.opacity = 1;
        document.getElementById(`chart-${id}`).style.strokeWidth = 25;
      }
      function resetChart() {
        document.querySelectorAll(".chart-part").forEach((el) => {
          el.style.opacity = 1;
          el.style.strokeWidth = 20;
        });
      }

      // --- SIM E: CYCLE ---
      let cyclePlaying = false;
      function toggleCycle() {
        cyclePlaying = !cyclePlaying;
        const container = document.getElementById("cycle-container");
        const icon = document.getElementById("cycle-icon");
        const labels = document.querySelectorAll(".cycle-label");

        if (cyclePlaying) {
          container.classList.add("cycle-active");
          icon.className = "fas fa-pause";
          labels.forEach((l) => (l.style.opacity = 1));
        } else {
          container.classList.remove("cycle-active");
          icon.className = "fas fa-play";
          labels.forEach((l) => (l.style.opacity = 0));
        }
      }

      // --- SIM F: CITY POLLUTION ---
      function toggleCityFactor(factor) {
        cityState[factor] = !cityState[factor];
        const btn = document.getElementById(`btn-${factor}`);

        if (cityState[factor]) {
          btn.classList.add("ring-2", "ring-blue-500");
        } else {
          btn.classList.remove("ring-2", "ring-blue-500");
        }

        if (factor === "cars") {
          document.getElementById("car-traffic").style.opacity = cityState.cars
            ? 1
            : 0;
        }
        if (factor === "factory") {
          document.getElementById("factory-smoke").style.opacity =
            cityState.factory ? 1 : 0;
        }
        if (factor === "trees") {
          document.getElementById("forest").style.opacity = cityState.trees
            ? 1
            : 0;
        }

        let score = 50;
        if (cityState.cars) score += 50;
        if (cityState.factory) score += 70;
        if (cityState.trees) score -= 40;
        if (score < 0) score = 10;
        if (score > 200) score = 200;

        let color = "bg-green-500";
        let text = "Tốt";
        let overlayOp = 0;

        if (score > 50 && score <= 100) {
          color = "bg-yellow-400";
          text = "Trung bình";
          overlayOp = 0.2;
        } else if (score > 100) {
          color = "bg-red-500";
          text = "Ô nhiễm";
          overlayOp = 0.5;
        }

        aqiBar.className = `h-full ${color} transition-all duration-500`;
        aqiBar.style.width = `${(score / 200) * 100}%`;
        aqiText.innerText = text;
        aqiText.className = `font-bold text-sm ${color.replace("bg-", "text-").replace("400", "600")}`;

        document.getElementById("smog-overlay").style.opacity = overlayOp;
      }

      // --- QUIZ SYSTEM ---
      function renderQuiz() {
        const container = document.getElementById("quiz-container");
        container.innerHTML = "";

        const saved = JSON.parse(localStorage.getItem("chemQuiz1")) || {};

        quizData.forEach((item, index) => {
          const isDone = saved[item.id];
          const html = `
                    <div class="bg-white dark:bg-slate-800 rounded-xl shadow p-4 border-l-4 ${isDone ? "border-green-500" : "border-gray-300"}">
                        <div class="flex justify-between items-start cursor-pointer" onclick="toggleHint(${item.id})">
                            <div>
                                <span class="text-xs font-bold text-gray-400 uppercase mb-1 block">${item.section}</span>
                                <h4 class="font-bold text-md mb-2">Câu ${index + 1}: ${item.q}</h4>
                            </div>
                            <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                        </div>
                        <div class="hidden text-sm text-yellow-600 dark:text-yellow-400 mb-3 bg-yellow-50 dark:bg-yellow-900/20 p-2 rounded" id="hint-${item.id}">
                            <i class="fas fa-lightbulb mr-1"></i> <strong>Gợi ý:</strong> ${item.hint}
                        </div>
                        <div class="space-y-2">
                            ${item.options
                              .map(
                                (opt, i) => `
                                <label class="flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition">
                                    <input type="radio" name="q${item.id}" value="${i}" 
                                        ${isDone && i === item.ans ? "checked" : ""} 
                                        ${isDone ? "disabled" : ""}
                                        onchange="checkAnswer(${item.id}, ${i}, ${item.ans})" class="accent-chemBlue">
                                    <span class="${isDone && i === item.ans ? "font-bold text-green-600 dark:text-green-400" : ""}">${opt}</span>
                                    ${isDone && i === item.ans ? '<i class="fas fa-check text-green-500 ml-2"></i>' : ""}
                                </label>
                            `,
                              )
                              .join("")}
                        </div>
                    </div>
                `;
          container.innerHTML += html;
        });
        updateProgress();
      }

      function toggleHint(id) {
        document.getElementById(`hint-${id}`).classList.toggle("hidden");
      }

      function checkAnswer(qId, selected, correct) {
        if (selected === correct) {
          const saved = JSON.parse(localStorage.getItem("chemQuiz1")) || {};
          saved[qId] = true;
          localStorage.setItem("chemQuiz1", JSON.stringify(saved));
          renderQuiz();
        } else {
          alert("Chưa chính xác, hãy đọc lại gợi ý nhé!");
        }
      }

      function updateProgress() {
        const saved = JSON.parse(localStorage.getItem("chemQuiz1")) || {};
        const count = Object.keys(saved).length;
        const percent = Math.round((count / quizData.length) * 100);

        document.getElementById("progress-bar").style.width = `${percent}%`;
        document.getElementById("progress-text").innerText = `${percent}%`;
      }

      function resetQuiz() {
        if (
          confirm("Bạn có muốn xóa toàn bộ kết quả bài tập để làm lại không?")
        ) {
          localStorage.removeItem("chemQuiz1");
          renderQuiz();
        }
      }
    </script>
  </body>
</html>
